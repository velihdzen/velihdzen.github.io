{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/CNAME","path":"CNAME","modified":0,"renderable":0},{"_id":"source/downloads/code/bt_dig_dns_txt.txt","path":"downloads/code/bt_dig_dns_txt.txt","modified":0,"renderable":0},{"_id":"source/downloads/code/echo_server.rs","path":"downloads/code/echo_server.rs","modified":0,"renderable":0},{"_id":"themes/hiker/source/css/archive.css","path":"css/archive.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/dialog.css","path":"css/dialog.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/header-post.css","path":"css/header-post.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/home.css","path":"css/home.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/vdonate.css","path":"css/vdonate.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/dialog.js","path":"js/dialog.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/home.js","path":"js/home.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/insight.js","path":"js/insight.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/scripts.js","path":"js/scripts.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/totop.js","path":"js/totop.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/vdonate.js","path":"js/vdonate.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/browser-support.png","path":"preview/browser-support.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/donation-btn.png","path":"preview/donation-btn.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/preview-abstract.png","path":"preview/preview-abstract.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/theme-color.png","path":"preview/theme-color.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/bootstrap.css","path":"css/bootstrap.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/bootstrap.js","path":"js/bootstrap.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/js/jquery-3.1.1.min.js","path":"js/jquery-3.1.1.min.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.eot","path":"css/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/glyphicons-halflings-regular.eot","path":"css/fonts/glyphicons-halflings-regular.eot","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.woff","path":"css/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/glyphicons-halflings-regular.ttf","path":"css/fonts/glyphicons-halflings-regular.ttf","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/glyphicons-halflings-regular.woff","path":"css/fonts/glyphicons-halflings-regular.woff","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/glyphicons-halflings-regular.woff2","path":"css/fonts/glyphicons-halflings-regular.woff2","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/mylogo.jpg","path":"css/images/mylogo.jpg","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/FontAwesome.otf","path":"css/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/FuturaPTMedium.otf","path":"css/fonts/FuturaPTMedium.otf","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.ttf","path":"css/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/mylogo.png","path":"css/images/mylogo.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/rocket.png","path":"css/images/rocket.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/FuturaPTBold.otf","path":"css/fonts/FuturaPTBold.otf","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/FuturaPTBook.otf","path":"css/fonts/FuturaPTBook.otf","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/FuturaPTBoldOblique.otf","path":"css/fonts/FuturaPTBoldOblique.otf","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/FuturaPTBookOblique.otf","path":"css/fonts/FuturaPTBookOblique.otf","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/glyphicons-halflings-regular.svg","path":"css/fonts/glyphicons-halflings-regular.svg","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.svg","path":"css/fonts/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/preview-mobile.png","path":"preview/preview-mobile.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/code-theme.jpg","path":"preview/code-theme.jpg","modified":0,"renderable":1},{"_id":"themes/hiker/source/preview/preview-pc.png","path":"preview/preview-pc.png","modified":0,"renderable":1},{"_id":"themes/hiker/source/css/images/tuscany_italy.jpg","path":"css/images/tuscany_italy.jpg","modified":0,"renderable":1}],"Cache":[{"_id":"themes/hiker/.git","hash":"138ad5311d62fbf6d9d029c9d94d997fb191138d","modified":1595053888381},{"_id":"themes/hiker/.gitignore","hash":"58d26d4b5f2f94c2d02a4e4a448088e4a2527c77","modified":1595053888490},{"_id":"themes/hiker/.travis.yml","hash":"24851843a40973daaee47b2697e8b0dc4e6556b3","modified":1595053888491},{"_id":"themes/hiker/Gruntfile.js","hash":"71adaeaac1f3cc56e36c49d549b8d8a72235c9b9","modified":1595053888491},{"_id":"themes/hiker/README.cn.md","hash":"e87c3744f1fe3edeaad479a90e7e1aa66bbf6fd2","modified":1595053888491},{"_id":"themes/hiker/LICENSE","hash":"4ea4173f28adf2f688a59e3c5e6fa833bcdf7ced","modified":1595053888491},{"_id":"themes/hiker/_config.yml","hash":"9dba0ca737494f505b315e7cd31127f7e847d03d","modified":1595054869079},{"_id":"themes/hiker/README.md","hash":"4973def0c3cb2ac856071de479d11ff76087b8c6","modified":1595053888492},{"_id":"themes/hiker/package.json","hash":"ac7430d36de467f41a686fb716c8538c52f0e206","modified":1595053888504},{"_id":"source/CNAME","hash":"a431652667c5c250f5d6cfd58f36ee4b743e1a40","modified":1595053819512},{"_id":"source/_posts/bt-dht.md","hash":"66c17b22aba2fd287570aa6b63a06eb8dff9accd","modified":1595053819513},{"_id":"source/_posts/bt-advanced.md","hash":"6eb7dda2f4f7e97cdae32c167f2f18ac74c842a9","modified":1595053819513},{"_id":"source/_posts/bt-overview.md","hash":"b5de8355f43d112cc36a14190c75a3ff441c1219","modified":1595053819513},{"_id":"source/_posts/bt-metadata.md","hash":"97292486fe17bb44107ffb65fca81c6787e913f5","modified":1595053819513},{"_id":"source/_posts/bt-peer.md","hash":"24ba21c20ec6a264105226863237bfb2bad4def6","modified":1595053819514},{"_id":"source/_posts/bt-tracker.md","hash":"56af2c9f28d1d018220c1f752fb3f92731f233a4","modified":1595053819514},{"_id":"source/_posts/dht-kademlia.md","hash":"000f190bf0a632081dc509dd24dfb8c686f03a5d","modified":1595053819515},{"_id":"source/_posts/hello-world.md","hash":"87baacc663a837c17e8f566d0849139d9ac52ae2","modified":1595053819519},{"_id":"source/about/index.md","hash":"79921d629232c519d86507d7cba98eaa174e22ae","modified":1595054760157},{"_id":"source/_posts/ipfs-blog.md","hash":"a425d66e178cd39a7420d144fbed692e3f22872a","modified":1595053819519},{"_id":"source/_posts/tcp.md","hash":"602a232c9625aef5816e670781f5009254a64f59","modified":1595053819523},{"_id":"source/tags/index.md","hash":"2f7d5e58da960f1aeeeaf8bf12f9d5e38c39ea73","modified":1595053819537},{"_id":"source/_posts/Âµtp.md","hash":"ea40c009d94b0227ae1d3aec236b9bb13d8bb7f0","modified":1595053819531},{"_id":"themes/hiker/languages/de.yml","hash":"2dbfb45e86f321ec6b49a41d71bfc58dff862fff","modified":1595053888492},{"_id":"themes/hiker/languages/default.yml","hash":"568070c1e517cfdb691f48964cd30eebf6af80c3","modified":1595053888492},{"_id":"themes/hiker/languages/es.yml","hash":"2ee34444af3bacb11c30cf4433902120d2c626d2","modified":1595053888493},{"_id":"themes/hiker/languages/en.yml","hash":"568070c1e517cfdb691f48964cd30eebf6af80c3","modified":1595053888492},{"_id":"themes/hiker/languages/fr.yml","hash":"62f55b873a996256717feeabf2aafcc377f0171f","modified":1595053888493},{"_id":"themes/hiker/languages/no.yml","hash":"c3162018e0077489eec8b9aeb820c5c349f42a80","modified":1595053888493},{"_id":"themes/hiker/languages/pt.yml","hash":"eb87359475971bc9ade6b831a4bdd04d23fad995","modified":1595053888493},{"_id":"themes/hiker/languages/nl.yml","hash":"8bb3a38bc2e4ec930eed6c00c4837d056a3ff15b","modified":1595053888493},{"_id":"themes/hiker/languages/ru.yml","hash":"691202379a6ca53f514d700b91fa1825b850c034","modified":1595053888493},{"_id":"themes/hiker/languages/zh-CN.yml","hash":"6a1743dfeae69e9743f54578f3101187086a2503","modified":1595053888493},{"_id":"themes/hiker/languages/zh-TW.yml","hash":"8d4f58d60b26e6ac7a02a1401bcc53d151119e03","modified":1595053888494},{"_id":"themes/hiker/layout/archive.ejs","hash":"344da867fd0a4b9ea1bd44ce485f26ab215afff3","modified":1595053888501},{"_id":"themes/hiker/layout/categories.ejs","hash":"ac33c728b49863d3ca961547d33209618f591e4f","modified":1595053888501},{"_id":"themes/hiker/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1595053888501},{"_id":"themes/hiker/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1595053888502},{"_id":"themes/hiker/layout/layout.ejs","hash":"aa685e9762a356f9b677e6f9d17e04694492fb83","modified":1595053888502},{"_id":"themes/hiker/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1595053888502},{"_id":"themes/hiker/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1595053888502},{"_id":"themes/hiker/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1595053888504},{"_id":"themes/hiker/layout/tags.ejs","hash":"340ded907f5f52ef73c50bb9f1f27bf2f5de3fa7","modified":1595053888504},{"_id":"themes/hiker/scripts/fancybox.js","hash":"aa411cd072399df1ddc8e2181a3204678a5177d9","modified":1595053888504},{"_id":"source/_posts/bt-overview/bep_possible_paths.png","hash":"7ec567f9633893d967eac9add4d6c49a13a12e5d","modified":1595053819514},{"_id":"source/_posts/dht-kademlia/kademlia-1.png","hash":"47d535e3251d1d375f2082f03914047d6701696e","modified":1595053819515},{"_id":"source/_posts/dht-kademlia/kademlia-5.png","hash":"c7beeda33139e9ee2d5a0e23c76a4840b6c0f932","modified":1595053819519},{"_id":"source/_posts/dht-kademlia/kademlia-3.png","hash":"d78d76db715584cf6fe8886b4987451bd333e73f","modified":1595053819517},{"_id":"source/_posts/dht-kademlia/kademlia-4.png","hash":"872339b59e46f1c6bce219ddb1c4258f6999fc17","modified":1595053819518},{"_id":"source/_posts/tcp/todo.mdx","hash":"90d7ea919af484e49846964c1a2edf3d88720ee2","modified":1595053819529},{"_id":"source/downloads/code/bt_dig_dns_txt.txt","hash":"bb3576ad7b233fc7f4d9791dd01230bca17f75e1","modified":1595053819537},{"_id":"source/downloads/code/echo_server.rs","hash":"72bc85f2231a41ed51f82848e3c22382d85e32ff","modified":1595053819537},{"_id":"source/downloads/code/utp_header_format.html","hash":"3cd1268fc5232749c6269a51af79f85df232957e","modified":1595053819537},{"_id":"themes/hiker/layout/_partial/after-footer.ejs","hash":"cf844d9dda22b63e990c2b9e5c8bee82c41fd3aa","modified":1595053888494},{"_id":"themes/hiker/layout/_partial/archive-post.ejs","hash":"55d661b63ffe41489bffe4d0570af50a1b952d63","modified":1595053888494},{"_id":"themes/hiker/layout/_partial/archive.ejs","hash":"538346df9267cb701bb985faf0d5de2fa4c1e4e7","modified":1595053888494},{"_id":"themes/hiker/layout/_partial/article.ejs","hash":"dd5e51066a5651f7b736883c3ab48bf8cc9c2c24","modified":1595053888494},{"_id":"themes/hiker/layout/_partial/baidu-analytics.ejs","hash":"990da0a787e78a8e44973536cc2dd547ee5aeaaf","modified":1595053888495},{"_id":"themes/hiker/layout/_partial/busuanzi-analytics.ejs","hash":"4d88a078199c7a89461288e5f3189afd67c80afd","modified":1595053888495},{"_id":"themes/hiker/layout/_partial/cnzz-analytics.ejs","hash":"87410fedf15383f119706c96f71552be14248d57","modified":1595053888495},{"_id":"themes/hiker/layout/_partial/comment.ejs","hash":"1471bafc3e1b348cdd081ad8f79e6656323ec04b","modified":1595053888495},{"_id":"themes/hiker/layout/_partial/copyright.ejs","hash":"e5283a10763a6c279b8221a56a5e8845fdd6d725","modified":1595053888496},{"_id":"themes/hiker/layout/_partial/dialog.ejs","hash":"453934257d0efa8124afc686f299e7a21e7a1c4d","modified":1595053888496},{"_id":"themes/hiker/layout/_partial/donate.ejs","hash":"046e168c6aad9889199c9a48b57dc973b4f46dab","modified":1595053888496},{"_id":"themes/hiker/layout/_partial/facebook-sdk.ejs","hash":"06038db50d2e1febdefa3f8e1512b332c7da5a17","modified":1595053888496},{"_id":"themes/hiker/layout/_partial/gauges-analytics.ejs","hash":"aad6312ac197d6c5aaf2104ac863d7eba46b772a","modified":1595053888496},{"_id":"themes/hiker/layout/_partial/google-analytics.ejs","hash":"f921e7f9223d7c95165e0f835f353b2938e40c45","modified":1595053888497},{"_id":"themes/hiker/layout/_partial/head.ejs","hash":"ecf7c24914c34c0d920951fd606af953c7d81024","modified":1595053888497},{"_id":"themes/hiker/layout/_partial/header-post.ejs","hash":"f30b6833bdb54e5446a2078a792e4d9ef4551c24","modified":1595053888497},{"_id":"themes/hiker/layout/_partial/header.ejs","hash":"09b8060c37b578785efdd8e06fa1388b816d44ca","modified":1595053888497},{"_id":"themes/hiker/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1595053888497},{"_id":"themes/hiker/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1595053888499},{"_id":"themes/hiker/layout/_partial/tencent-analytics.ejs","hash":"3397721b004eaff1eb142dc45ae8f523af6d50f1","modified":1595053888499},{"_id":"themes/hiker/layout/_widget/archive.ejs","hash":"9fffde4e794b35f07c96eaec6d9373a40014da8f","modified":1595053888500},{"_id":"themes/hiker/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1595053888500},{"_id":"themes/hiker/layout/_widget/curtains.ejs","hash":"630c11a237602b478df5215982face6681943f21","modified":1595053888500},{"_id":"themes/hiker/layout/_widget/recent_posts.ejs","hash":"0d4f064733f8b9e45c0ce131fe4a689d570c883a","modified":1595053888500},{"_id":"themes/hiker/layout/_widget/social.ejs","hash":"013beb5d78dfe34507b766f551b4a43ff628a5fe","modified":1595053888500},{"_id":"themes/hiker/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1595053888500},{"_id":"themes/hiker/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1595053888501},{"_id":"themes/hiker/layout/search/baidu.ejs","hash":"3e603a702d20c53fd3bcbeb570a16a86d54781ce","modified":1595053888503},{"_id":"themes/hiker/layout/search/index-mobile.ejs","hash":"50a727ac1dfe3073eb6fa6699ba01e66f4ac41c0","modified":1595053888503},{"_id":"themes/hiker/layout/search/index.ejs","hash":"a027a663baaffa212f5eb4947d43008419376177","modified":1595053888503},{"_id":"themes/hiker/layout/search/insight.ejs","hash":"c97ef6478f8cd45458614cd78511c23cbd4e7a28","modified":1595053888503},{"_id":"themes/hiker/layout/search/swiftype.ejs","hash":"379e66d2c13526e72e4120c443f95fccf4edef71","modified":1595053888503},{"_id":"themes/hiker/source/css/_extend.styl","hash":"5a2b18b03c18c92f130771aa97737e100202d21b","modified":1595053888505},{"_id":"themes/hiker/source/css/_variables.styl","hash":"5a396d59dd297439a2f6f02fd769bb252115b0be","modified":1595053888508},{"_id":"themes/hiker/source/css/archive.css","hash":"17cc72203cad1b0be66008d662c7494507aaee8b","modified":1595053888508},{"_id":"themes/hiker/source/css/dialog.css","hash":"5e0333adf3f496e0d443767fe228a1d4b1a2bafc","modified":1595053888509},{"_id":"themes/hiker/layout/_partial/footer.ejs","hash":"dfbfe362953c8d44c875554f55fad74bd80b2afb","modified":1595053888496},{"_id":"themes/hiker/source/css/header-post.css","hash":"3f6d1f5593a353b4b05a67ee14e04ec9c986db21","modified":1595053888521},{"_id":"themes/hiker/source/css/home.css","hash":"f8f816bf6ec46ab8a02b13cdc8b3c44f5bb65fc4","modified":1595053888522},{"_id":"themes/hiker/source/css/style.styl","hash":"e4bb878a2617a8e4a630664ec678b0fc650c9fba","modified":1595053888535},{"_id":"themes/hiker/source/css/vdonate.css","hash":"bca2d291a71e7358654c51f23e8bfb467b2bc8b2","modified":1595053888535},{"_id":"themes/hiker/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1595053888535},{"_id":"themes/hiker/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1595053888535},{"_id":"themes/hiker/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1595053888536},{"_id":"themes/hiker/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1595053888536},{"_id":"themes/hiker/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1595053888536},{"_id":"themes/hiker/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1595053888536},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1595053888538},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1595053888538},{"_id":"themes/hiker/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1595053888539},{"_id":"themes/hiker/source/js/dialog.js","hash":"01e8b337c1721e0486fd5044f98b233e84ba1985","modified":1595053888540},{"_id":"themes/hiker/source/js/home.js","hash":"e403c3290d76c5f58571cbfe4414236e41a7ac94","modified":1595053888540},{"_id":"themes/hiker/source/js/insight.js","hash":"6f565d8edd8463ee3269ba8ad9badf404f0f4b20","modified":1595053888540},{"_id":"themes/hiker/source/js/scripts.js","hash":"e06a8948375df71cbf77abf8617db438ece811b3","modified":1595053888541},{"_id":"themes/hiker/source/js/totop.js","hash":"29bb40144ac238d22b25d59df465aff8dc38bfd0","modified":1595053888541},{"_id":"themes/hiker/source/js/vdonate.js","hash":"5738414c642d30e43943a69287b3d25a0b6be135","modified":1595053888542},{"_id":"themes/hiker/source/preview/browser-support.png","hash":"a6d8498553550c6b18a8f22bcd2f53c993c7d677","modified":1595053888542},{"_id":"themes/hiker/source/preview/donation-btn.png","hash":"ad78b1605b162e2399a1cdc5232f6a44298dba6c","modified":1595053888548},{"_id":"themes/hiker/source/preview/preview-abstract.png","hash":"3d18ad9ba38fe24770ba6758d8f1bb242f669ce3","modified":1595053888549},{"_id":"themes/hiker/source/preview/theme-color.png","hash":"725130ceea5e41bb2cc60b31e45275b4b0cc77b3","modified":1595053888554},{"_id":"source/_posts/dht-kademlia/kademlia-2.png","hash":"257bb15cbde836b395e7d067af140a0e91cd3724","modified":1595053819516},{"_id":"source/_posts/Âµtp/udp_utp_header.png","hash":"c5f80e8516d5c7f55244a105e973e9cd4f27f070","modified":1595053819532},{"_id":"source/_posts/tcp/tcp_header.png","hash":"69d8d319c43fa7ce0be86f378572c8ee05e9c605","modified":1595053819529},{"_id":"themes/hiker/source/css/bootstrap.css","hash":"84179f85b2e7c1925dfc78a37b797d17bf2c7c9e","modified":1595053888509},{"_id":"themes/hiker/source/js/bootstrap.js","hash":"3b965a36a6b08854ad6eddedf85c5319fd392b4a","modified":1595053888539},{"_id":"themes/hiker/source/js/jquery-3.1.1.min.js","hash":"f647a6d37dc4ca055ced3cf64bbc1f490070acba","modified":1595053888541},{"_id":"source/_posts/tcp/tcp_connection.png","hash":"987f536dca3acefdde97178c2087276fb69c41e1","modified":1595053819528},{"_id":"themes/hiker/layout/_partial/post/busuanzi-analytics.ejs","hash":"5daeff05509f71b93975e488d33c412516c6a5f0","modified":1595053888498},{"_id":"themes/hiker/layout/_partial/post/category.ejs","hash":"877a164bb13b46756eb111ec7bfe338a1eb36ad1","modified":1595053888498},{"_id":"themes/hiker/layout/_partial/post/date.ejs","hash":"380985bb414f9a0d517834f65cce57bc0b493d8c","modified":1595053888498},{"_id":"themes/hiker/layout/_partial/post/edit.ejs","hash":"5c2614987e39829c689d9eff25d49bef6587e841","modified":1595053888498},{"_id":"themes/hiker/layout/_partial/post/gallery.ejs","hash":"30028f10a4f03561e53da323d06b292e1ae7990c","modified":1595053888498},{"_id":"themes/hiker/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1595053888499},{"_id":"themes/hiker/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1595053888499},{"_id":"themes/hiker/layout/_partial/post/title.ejs","hash":"a61267f27f2148321e549344be91dbc4e22e1a48","modified":1595053888499},{"_id":"themes/hiker/layout/_partial/post/urlconvert.ejs","hash":"2133f1029632417f9043b9d4749d580ed0c75db0","modified":1595053888499},{"_id":"themes/hiker/source/css/_partial/archive.styl","hash":"d811e1442e36cf4ae8e21ebbb522d06cf252a7e2","modified":1595053888505},{"_id":"themes/hiker/source/css/_partial/comment.styl","hash":"f23dbf9c1224559314f7d10b7fee030a9ffab58a","modified":1595053888505},{"_id":"themes/hiker/source/css/_partial/article.styl","hash":"e63fb22720553f4ac7c933d0d0267aeec5d02ff5","modified":1595053888505},{"_id":"themes/hiker/source/css/_partial/footer.styl","hash":"ce9f600140d5cd246b59374f615c8a512bc5ecab","modified":1595053888506},{"_id":"themes/hiker/source/css/_partial/header-post.styl","hash":"e95431443eb28d45390de733068f87134e5780da","modified":1595053888506},{"_id":"themes/hiker/source/css/_partial/header.styl","hash":"4bbc6be125b55de743ad00a5ddf751eba1f617c4","modified":1595053888506},{"_id":"themes/hiker/source/css/_partial/insight.styl","hash":"8cd23d8f0ce2d083dd7409a1a95315029070cbb8","modified":1595053888507},{"_id":"themes/hiker/source/css/_partial/mobile.styl","hash":"fcfbaf24634519063af46953e0eb733a8ada5556","modified":1595053888507},{"_id":"themes/hiker/source/css/_partial/sidebar-aside.styl","hash":"1b4caeb15892b2c34cc063065b9c408eb00216a6","modified":1595053888507},{"_id":"themes/hiker/source/css/_partial/sidebar-bottom.styl","hash":"36886d5436bfafbf980539be8dbc419631b8b6ee","modified":1595053888507},{"_id":"themes/hiker/source/css/_partial/sidebar.styl","hash":"e93ca6bb5b709accd667b939980ad39582fe062b","modified":1595053888507},{"_id":"themes/hiker/source/css/_partial/highlight.styl","hash":"bbd94136777978146f6317e96d5a2afe02cef58c","modified":1595053888506},{"_id":"themes/hiker/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1595053888507},{"_id":"themes/hiker/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1595053888508},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1595053888516},{"_id":"themes/hiker/source/css/fonts/glyphicons-halflings-regular.eot","hash":"86b6f62b7853e67d3e635f6512a5a5efc58ea3c3","modified":1595053888519},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1595053888519},{"_id":"themes/hiker/source/css/fonts/glyphicons-halflings-regular.ttf","hash":"44bc1850f570972267b169ae18f1cb06b611ffa2","modified":1595053888520},{"_id":"themes/hiker/source/css/fonts/glyphicons-halflings-regular.woff","hash":"278e49a86e634da6f2a02f3b47dd9d2a8f26210f","modified":1595053888521},{"_id":"themes/hiker/source/css/fonts/glyphicons-halflings-regular.woff2","hash":"ca35b697d99cae4d1b60f2d60fcd37771987eb07","modified":1595053888521},{"_id":"themes/hiker/layout/_partial/post/mathjax.ejs","hash":"bec3d49a5ddf10b4b79f37fc31bd225e38783616","modified":1595053888498},{"_id":"themes/hiker/source/css/images/mylogo.jpg","hash":"8a890ea06da34c2be81ca28d96f3d44a2d7fcdd7","modified":1595053888522},{"_id":"themes/hiker/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1595053888536},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1595053888537},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1595053888537},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1595053888537},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1595053888537},{"_id":"themes/hiker/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1595053888537},{"_id":"source/_posts/tcp/congestion_control_example.png","hash":"02433df0635516013be7c5d96affa7d20cc883e7","modified":1595053819524},{"_id":"source/_posts/tcp/sliding_window.png","hash":"27e68439f11775d0816b712605458a940ad255bf","modified":1595053819526},{"_id":"themes/hiker/source/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1595053888510},{"_id":"themes/hiker/source/css/fonts/FuturaPTMedium.otf","hash":"b90cbd107617a2648ea088d5cd7cf6e188b90786","modified":1595053888516},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1595053888518},{"_id":"themes/hiker/source/css/images/mylogo.png","hash":"6c6233232a427cd33129e2ea6268e878a57e9ac7","modified":1595053888522},{"_id":"themes/hiker/source/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1595053888522},{"_id":"themes/hiker/source/css/fonts/FuturaPTBold.otf","hash":"134b9ed86365117365f124c88fbb2698b913cdc7","modified":1595053888511},{"_id":"themes/hiker/source/css/fonts/FuturaPTBook.otf","hash":"d633453cd20a2fe9bb6ed0067b2188500b3562d3","modified":1595053888513},{"_id":"themes/hiker/source/css/fonts/FuturaPTBoldOblique.otf","hash":"146e20605d3fc5a5e1c637fb6158a37b4838cb5c","modified":1595053888512},{"_id":"themes/hiker/source/css/fonts/FuturaPTBookOblique.otf","hash":"a9af9fc360988d9e1ede642761dc7d0be454574b","modified":1595053888515},{"_id":"themes/hiker/source/css/fonts/glyphicons-halflings-regular.svg","hash":"de51a8494180a6db074af2dee2383f0a363c5b08","modified":1595053888520},{"_id":"source/_posts/tcp/wireshark.png","hash":"14661db4e3571db5e1315f221773ec37e6f67b6b","modified":1595053819531},{"_id":"themes/hiker/source/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1595053888518},{"_id":"source/_posts/Âµtp/wireshark.png","hash":"f8da641e627808d136eeb69f7abdb497008b2c75","modified":1595053819536},{"_id":"themes/hiker/source/preview/preview-mobile.png","hash":"7679a50aef93fc364cbcee4a52cd84604bf741b1","modified":1595053888550},{"_id":"themes/hiker/source/preview/code-theme.jpg","hash":"8c8512fd04e6106033656d10e92d51de76cca6d8","modified":1595053888548},{"_id":"themes/hiker/source/preview/preview-pc.png","hash":"2471e0697938721e4c5d7c66940e165c59a31a0f","modified":1595053888553},{"_id":"themes/hiker/source/css/images/tuscany_italy.jpg","hash":"56c5c177018a237bc282aef8e8a2b4d28e843b85","modified":1595053888534},{"_id":"public/atom.xml","hash":"b54744fbcce97d9e29306961b541b2ae8d8bcc85","modified":1595054933314},{"_id":"public/content.json","hash":"7780fdb6dcaf5439b76feb4d4b5e7511e836f105","modified":1595054933318},{"_id":"public/CNAME","hash":"a431652667c5c250f5d6cfd58f36ee4b743e1a40","modified":1595054933337},{"_id":"public/downloads/code/bt_dig_dns_txt.txt","hash":"bb3576ad7b233fc7f4d9791dd01230bca17f75e1","modified":1595054933337},{"_id":"public/downloads/code/echo_server.rs","hash":"72bc85f2231a41ed51f82848e3c22382d85e32ff","modified":1595054933337},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1595054933337},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1595054933338},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1595054933338},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1595054933338},{"_id":"public/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1595054933338},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1595054933338},{"_id":"public/preview/browser-support.png","hash":"a6d8498553550c6b18a8f22bcd2f53c993c7d677","modified":1595054933338},{"_id":"public/preview/donation-btn.png","hash":"ad78b1605b162e2399a1cdc5232f6a44298dba6c","modified":1595054933338},{"_id":"public/preview/theme-color.png","hash":"725130ceea5e41bb2cc60b31e45275b4b0cc77b3","modified":1595054933338},{"_id":"public/preview/preview-abstract.png","hash":"3d18ad9ba38fe24770ba6758d8f1bb242f669ce3","modified":1595054933338},{"_id":"public/css/fonts/glyphicons-halflings-regular.eot","hash":"86b6f62b7853e67d3e635f6512a5a5efc58ea3c3","modified":1595054933338},{"_id":"public/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1595054933338},{"_id":"public/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1595054933338},{"_id":"public/css/fonts/glyphicons-halflings-regular.ttf","hash":"44bc1850f570972267b169ae18f1cb06b611ffa2","modified":1595054933338},{"_id":"public/css/fonts/glyphicons-halflings-regular.woff","hash":"278e49a86e634da6f2a02f3b47dd9d2a8f26210f","modified":1595054933339},{"_id":"public/css/fonts/glyphicons-halflings-regular.woff2","hash":"ca35b697d99cae4d1b60f2d60fcd37771987eb07","modified":1595054933339},{"_id":"public/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1595054933339},{"_id":"public/css/images/mylogo.jpg","hash":"8a890ea06da34c2be81ca28d96f3d44a2d7fcdd7","modified":1595054933339},{"_id":"public/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1595054933339},{"_id":"public/css/images/mylogo.png","hash":"6c6233232a427cd33129e2ea6268e878a57e9ac7","modified":1595054933339},{"_id":"public/css/images/rocket.png","hash":"6dee0406955aa9b7a261161d30f2538a671e806b","modified":1595054933339},{"_id":"public/2018/08/26/bt-overview/bep_possible_paths.png","hash":"7ec567f9633893d967eac9add4d6c49a13a12e5d","modified":1595054933339},{"_id":"public/2018/11/08/dht-kademlia/kademlia-1.png","hash":"47d535e3251d1d375f2082f03914047d6701696e","modified":1595054933339},{"_id":"public/2018/11/08/dht-kademlia/kademlia-3.png","hash":"d78d76db715584cf6fe8886b4987451bd333e73f","modified":1595054933339},{"_id":"public/2018/11/08/dht-kademlia/kademlia-4.png","hash":"872339b59e46f1c6bce219ddb1c4258f6999fc17","modified":1595054933339},{"_id":"public/2018/11/08/dht-kademlia/kademlia-5.png","hash":"c7beeda33139e9ee2d5a0e23c76a4840b6c0f932","modified":1595054933339},{"_id":"public/2018/07/20/tcp/todo.mdx","hash":"90d7ea919af484e49846964c1a2edf3d88720ee2","modified":1595054933339},{"_id":"public/about/index.html","hash":"f493e5bb71a7b91680ad97cbbb905431f4e096c9","modified":1595054934057},{"_id":"public/tags/index.html","hash":"7874e22023ef07126e51f83fb228c65c0ed853b6","modified":1595054934057},{"_id":"public/downloads/code/utp_header_format.html","hash":"1e2e9be6bb8512e9c4f8a70d9971f8e5b7a2a8a5","modified":1595054934058},{"_id":"public/2018/11/15/bt-advanced/index.html","hash":"454290c80e4ba0780db18dccb6cd9818108c779f","modified":1595054934058},{"_id":"public/2018/11/12/bt-dht/index.html","hash":"6d14f2174dad69d7d7f8e8753cb502fb8ccc42fd","modified":1595054934058},{"_id":"public/2018/11/08/dht-kademlia/index.html","hash":"ee7d1de54a9fd9cdb2486a4cb7acd31285ddb6f0","modified":1595054934058},{"_id":"public/2018/09/22/ipfs-blog/index.html","hash":"02aac22c9839a236699da83557e2b9c1704f1ed0","modified":1595054934058},{"_id":"public/2018/08/30/bt-peer/index.html","hash":"d13a940eabc53aaa6e90ae96f5d1e25672e76feb","modified":1595054934058},{"_id":"public/2018/08/27/bt-tracker/index.html","hash":"8a0f89c02db2f2fdfa012c4ec25aa7e619b009f2","modified":1595054934058},{"_id":"public/2018/08/26/bt-metadata/index.html","hash":"9f5eeb0c1cebbadbb2d85b604cdf9027460ad3f5","modified":1595054934058},{"_id":"public/2018/08/26/bt-overview/index.html","hash":"48800b2574e284cbeddf4aeb7234f3e281d18a88","modified":1595054934058},{"_id":"public/2018/08/04/Âµtp/index.html","hash":"49e5a37bde3004023e3a9e6c0a13e1cabea26eb4","modified":1595054934058},{"_id":"public/2018/07/20/tcp/index.html","hash":"e19bd2a8834e93aa13a63f10c3444a6e5a940a5e","modified":1595054934058},{"_id":"public/2018/07/10/hello-world/index.html","hash":"5fc5652df2de8de4570e4280b66df4b9f23e8175","modified":1595054934058},{"_id":"public/archives/index.html","hash":"07b0cb53ff0e1197675ad4169e1b0d846cef22cf","modified":1595054934058},{"_id":"public/archives/page/2/index.html","hash":"88929ea48b58f3a2108df66e115ffbfed0ee28f2","modified":1595054934058},{"_id":"public/archives/2018/index.html","hash":"7e37ac5e5855be50272d1bcb9b7220c6a920bb3f","modified":1595054934059},{"_id":"public/archives/2018/page/2/index.html","hash":"5aed25b75366aca35e8c79b524a5f68dd3cd5165","modified":1595054934059},{"_id":"public/archives/2018/07/index.html","hash":"094769cc3bf9479f219246adab86623a28a20255","modified":1595054934059},{"_id":"public/archives/2018/08/index.html","hash":"3288f4644685798db167c1aa6f9c28aaf5f29618","modified":1595054934059},{"_id":"public/archives/2018/09/index.html","hash":"a28ca4f441aecdbc917c6ea27646acea51706b87","modified":1595054934059},{"_id":"public/archives/2018/11/index.html","hash":"a9d080af65d544d256a52f7e562bdffe9ad131aa","modified":1595054934059},{"_id":"public/index.html","hash":"23197a5b5953d088c2abdcb4bb03f159254a22d7","modified":1595054934060},{"_id":"public/page/2/index.html","hash":"6862462fbf8558ae817d7a8d3713c068f4ec5133","modified":1595054934060},{"_id":"public/tags/BT/index.html","hash":"01b2132fc6097303a513fb1a6b7b59a17c8823fc","modified":1595054934060},{"_id":"public/tags/Essay/index.html","hash":"66a442158a70e5933ef0b1808f69e7eea5600811","modified":1595054934060},{"_id":"public/tags/IPFS/index.html","hash":"1d789e523b52552a04828e663c8364cd71986d82","modified":1595054934060},{"_id":"public/tags/Algorithm/index.html","hash":"f03f3dab9b466ec6dac4078d5ee022c80e3f1c70","modified":1595054934060},{"_id":"public/tags/ç¿»è¯‘/index.html","hash":"1da0c03cf531cc314d8860cbf7cbbc4ffd724138","modified":1595054934060},{"_id":"public/tags/Network/index.html","hash":"0dfc3c1b958cda1edd167b9b28becea6da88db8c","modified":1595054934061},{"_id":"public/css/fonts/FuturaPTMedium.otf","hash":"b90cbd107617a2648ea088d5cd7cf6e188b90786","modified":1595054934061},{"_id":"public/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1595054934061},{"_id":"public/css/fonts/FuturaPTBold.otf","hash":"134b9ed86365117365f124c88fbb2698b913cdc7","modified":1595054934061},{"_id":"public/css/fonts/FuturaPTBook.otf","hash":"d633453cd20a2fe9bb6ed0067b2188500b3562d3","modified":1595054934061},{"_id":"public/css/fonts/FuturaPTBoldOblique.otf","hash":"146e20605d3fc5a5e1c637fb6158a37b4838cb5c","modified":1595054934061},{"_id":"public/css/fonts/glyphicons-halflings-regular.svg","hash":"de51a8494180a6db074af2dee2383f0a363c5b08","modified":1595054934061},{"_id":"public/2018/08/04/Âµtp/udp_utp_header.png","hash":"c5f80e8516d5c7f55244a105e973e9cd4f27f070","modified":1595054934061},{"_id":"public/2018/11/08/dht-kademlia/kademlia-2.png","hash":"257bb15cbde836b395e7d067af140a0e91cd3724","modified":1595054934061},{"_id":"public/2018/07/20/tcp/tcp_header.png","hash":"69d8d319c43fa7ce0be86f378572c8ee05e9c605","modified":1595054934061},{"_id":"public/css/archive.css","hash":"17cc72203cad1b0be66008d662c7494507aaee8b","modified":1595054934066},{"_id":"public/css/dialog.css","hash":"5e0333adf3f496e0d443767fe228a1d4b1a2bafc","modified":1595054934066},{"_id":"public/css/header-post.css","hash":"3f6d1f5593a353b4b05a67ee14e04ec9c986db21","modified":1595054934066},{"_id":"public/css/home.css","hash":"f8f816bf6ec46ab8a02b13cdc8b3c44f5bb65fc4","modified":1595054934066},{"_id":"public/css/style.css","hash":"4086764950b5a8235a26a7d4f78e94ca2aa5f918","modified":1595054934066},{"_id":"public/css/vdonate.css","hash":"bca2d291a71e7358654c51f23e8bfb467b2bc8b2","modified":1595054934066},{"_id":"public/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1595054934066},{"_id":"public/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1595054934066},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1595054934067},{"_id":"public/js/dialog.js","hash":"01e8b337c1721e0486fd5044f98b233e84ba1985","modified":1595054934067},{"_id":"public/js/insight.js","hash":"6f565d8edd8463ee3269ba8ad9badf404f0f4b20","modified":1595054934067},{"_id":"public/js/home.js","hash":"e403c3290d76c5f58571cbfe4414236e41a7ac94","modified":1595054934067},{"_id":"public/js/scripts.js","hash":"e06a8948375df71cbf77abf8617db438ece811b3","modified":1595054934067},{"_id":"public/js/totop.js","hash":"29bb40144ac238d22b25d59df465aff8dc38bfd0","modified":1595054934067},{"_id":"public/js/vdonate.js","hash":"5738414c642d30e43943a69287b3d25a0b6be135","modified":1595054934067},{"_id":"public/css/bootstrap.css","hash":"84179f85b2e7c1925dfc78a37b797d17bf2c7c9e","modified":1595054934067},{"_id":"public/js/bootstrap.js","hash":"3b965a36a6b08854ad6eddedf85c5319fd392b4a","modified":1595054934067},{"_id":"public/js/jquery-3.1.1.min.js","hash":"f647a6d37dc4ca055ced3cf64bbc1f490070acba","modified":1595054934067},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1595054934067},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1595054934067},{"_id":"public/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1595054934067},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1595054934067},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1595054934068},{"_id":"public/css/fonts/FuturaPTBookOblique.otf","hash":"a9af9fc360988d9e1ede642761dc7d0be454574b","modified":1595054934068},{"_id":"public/2018/07/20/tcp/congestion_control_example.png","hash":"02433df0635516013be7c5d96affa7d20cc883e7","modified":1595054934068},{"_id":"public/2018/07/20/tcp/tcp_connection.png","hash":"987f536dca3acefdde97178c2087276fb69c41e1","modified":1595054934068},{"_id":"public/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1595054934073},{"_id":"public/2018/07/20/tcp/sliding_window.png","hash":"27e68439f11775d0816b712605458a940ad255bf","modified":1595054934073},{"_id":"public/2018/07/20/tcp/wireshark.png","hash":"14661db4e3571db5e1315f221773ec37e6f67b6b","modified":1595054934085},{"_id":"public/preview/preview-mobile.png","hash":"7679a50aef93fc364cbcee4a52cd84604bf741b1","modified":1595054934099},{"_id":"public/2018/08/04/Âµtp/wireshark.png","hash":"f8da641e627808d136eeb69f7abdb497008b2c75","modified":1595054934101},{"_id":"public/preview/code-theme.jpg","hash":"8c8512fd04e6106033656d10e92d51de76cca6d8","modified":1595054934106},{"_id":"public/preview/preview-pc.png","hash":"2471e0697938721e4c5d7c66940e165c59a31a0f","modified":1595054934112},{"_id":"public/css/images/tuscany_italy.jpg","hash":"56c5c177018a237bc282aef8e8a2b4d28e843b85","modified":1595054934113}],"Category":[],"Data":[],"Page":[{"title":"å…³äº Velih Dzen","_content":"Velih Dzenï¼Œç”Ÿäºä¹é›¶å¹´ä»£çš„æµ™æ±Ÿè¯¸æš¨ï¼Œç›®å‰æ˜¯ä¸€å¤´ç¨‹åºå‘˜ã€‚å»ºæ­¤åšå®¢ä»¥åˆ†äº«æŠ€æœ¯ä¸è¡¨è¾¾è‡ªæˆ‘ã€‚\n\n***ä¸€äº›å…´è¶£ä¸ç‰¹ç‚¹***ï¼š\n\n- ğŸ å–œæ¬¢å®¶ä¹¡çš„å†å²ï¼Œå¦‚æœä½ æ°å·§æ¥è‡ªè¯¸æš¨ï¼Œå¯ä»¥å»æ—¶å®‰çš„[åšå®¢](http://blog.sina.com.cn/u/2759005812)ä¸­äº†è§£æ›´å¤šå…³äºè¯¸æš¨çš„å†å²\n- ğŸˆ³æ¢ç´¢æ¯è¯­æ–¹è¨€å´è¯­è¯æ±‡æ¥æºæ˜¯ä¸€å¤§ä¹è¶£ï¼Œâ€œä½ ä¾¬æˆ‘ä¾¬ï¼Œå¿’ç…æƒ…å¤šâ€\n- ğŸ²å¶å°”ç©ç©æ£‹ç‰Œæ¸¸æˆ[ã€Šä¸‰å›½æ€ Onlineã€‹](http://web.sanguosha.com/)\n- ğŸ¸æ–°ä¸–çºªéŸ³ä¹ä¸[ä¸­å›½æ‘‡æ»šä¹](https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9B%BD%E6%91%87%E6%BB%9A%E4%B9%90)çˆ±å¥½è€…\n- ğŸ§¹é—´æ­‡æ€§è¿›è¡Œ[æ–­èˆç¦»](https://book.douban.com/subject/24749465/)\n- ğŸ˜ ä»£ç æ ¼å¼åŒ–ã€æ–‡å­—æ’ç‰ˆï¼ˆéä¸“ä¸šï¼‰å¼ºè¿«ç—‡\n- ğŸ§±ä¸èƒ½ç§‘å­¦ä¸Šç½‘ææƒ§ç—‡\n- ğŸ“°â€œå¤å…¸â€äº’è”ç½‘æŠ€æœ¯ RSS, Podcast ä»ç„¶æ˜¯æˆ‘è·å–æ—¥å¸¸èµ„è®¯çš„é‡è¦æ¥æº\n- ğŸ²ç›®å‰ä¸»è¦ä½¿ç”¨ç¼–ç¨‹è¯­è¨€ Go\n\nå¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥ç”µé‚® [velih.dzen@gmail.com](mailto:velih.dzen@gmail.com)ã€‚é™¤äº†é‚®ä»¶ï¼Œè¿˜å¯ä»¥åœ¨è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘ï¼š\n\n- GitHubï¼š[VelihDzen](https://github.com/velihdzen)\n- Twitter: [LostZZWooo](https://twitter.com/lostzzwooo)\n- Doubanï¼š[Aloha](https://www.douban.com/people/69104080/)\n\n***åå­—è€ƒç©¶***ï¼š\n\n- åšå®¢å â€œé—²äº‘å­¤é¹¤â€ æ¥è‡ªä¸­å›½æ–°ä¸–çºªéŸ³ä¹ â€œæ‹“è’è€…â€ åˆ˜æ˜Ÿä¸“è¾‘ã€Šä¸€æ„å­¤è¡Œã€‹ä¸­çš„ä½œå“ã€Šé—²äº‘å­¤é¹¤ã€‹\n\n--- \n<!-- netease music -->\n<div  style=\" text-align: center;\">\n{% iframe //music.163.com/outchain/player?type=0&id=2172521085&auto=1&height=430 330 330 %}\n</div>","source":"about/index.md","raw":"---\ntitle: å…³äº Velih Dzen\n---\nVelih Dzenï¼Œç”Ÿäºä¹é›¶å¹´ä»£çš„æµ™æ±Ÿè¯¸æš¨ï¼Œç›®å‰æ˜¯ä¸€å¤´ç¨‹åºå‘˜ã€‚å»ºæ­¤åšå®¢ä»¥åˆ†äº«æŠ€æœ¯ä¸è¡¨è¾¾è‡ªæˆ‘ã€‚\n\n***ä¸€äº›å…´è¶£ä¸ç‰¹ç‚¹***ï¼š\n\n- ğŸ å–œæ¬¢å®¶ä¹¡çš„å†å²ï¼Œå¦‚æœä½ æ°å·§æ¥è‡ªè¯¸æš¨ï¼Œå¯ä»¥å»æ—¶å®‰çš„[åšå®¢](http://blog.sina.com.cn/u/2759005812)ä¸­äº†è§£æ›´å¤šå…³äºè¯¸æš¨çš„å†å²\n- ğŸˆ³æ¢ç´¢æ¯è¯­æ–¹è¨€å´è¯­è¯æ±‡æ¥æºæ˜¯ä¸€å¤§ä¹è¶£ï¼Œâ€œä½ ä¾¬æˆ‘ä¾¬ï¼Œå¿’ç…æƒ…å¤šâ€\n- ğŸ²å¶å°”ç©ç©æ£‹ç‰Œæ¸¸æˆ[ã€Šä¸‰å›½æ€ Onlineã€‹](http://web.sanguosha.com/)\n- ğŸ¸æ–°ä¸–çºªéŸ³ä¹ä¸[ä¸­å›½æ‘‡æ»šä¹](https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9B%BD%E6%91%87%E6%BB%9A%E4%B9%90)çˆ±å¥½è€…\n- ğŸ§¹é—´æ­‡æ€§è¿›è¡Œ[æ–­èˆç¦»](https://book.douban.com/subject/24749465/)\n- ğŸ˜ ä»£ç æ ¼å¼åŒ–ã€æ–‡å­—æ’ç‰ˆï¼ˆéä¸“ä¸šï¼‰å¼ºè¿«ç—‡\n- ğŸ§±ä¸èƒ½ç§‘å­¦ä¸Šç½‘ææƒ§ç—‡\n- ğŸ“°â€œå¤å…¸â€äº’è”ç½‘æŠ€æœ¯ RSS, Podcast ä»ç„¶æ˜¯æˆ‘è·å–æ—¥å¸¸èµ„è®¯çš„é‡è¦æ¥æº\n- ğŸ²ç›®å‰ä¸»è¦ä½¿ç”¨ç¼–ç¨‹è¯­è¨€ Go\n\nå¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥ç”µé‚® [velih.dzen@gmail.com](mailto:velih.dzen@gmail.com)ã€‚é™¤äº†é‚®ä»¶ï¼Œè¿˜å¯ä»¥åœ¨è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘ï¼š\n\n- GitHubï¼š[VelihDzen](https://github.com/velihdzen)\n- Twitter: [LostZZWooo](https://twitter.com/lostzzwooo)\n- Doubanï¼š[Aloha](https://www.douban.com/people/69104080/)\n\n***åå­—è€ƒç©¶***ï¼š\n\n- åšå®¢å â€œé—²äº‘å­¤é¹¤â€ æ¥è‡ªä¸­å›½æ–°ä¸–çºªéŸ³ä¹ â€œæ‹“è’è€…â€ åˆ˜æ˜Ÿä¸“è¾‘ã€Šä¸€æ„å­¤è¡Œã€‹ä¸­çš„ä½œå“ã€Šé—²äº‘å­¤é¹¤ã€‹\n\n--- \n<!-- netease music -->\n<div  style=\" text-align: center;\">\n{% iframe //music.163.com/outchain/player?type=0&id=2172521085&auto=1&height=430 330 330 %}\n</div>","date":"2020-07-18T06:59:23.195Z","updated":"2020-07-18T06:59:23.195Z","path":"about/index.html","_id":"ckcraiuh50000w80vogxyhgu3","comments":1,"layout":"page","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>Velih Dzenï¼Œç”Ÿäºä¹é›¶å¹´ä»£çš„æµ™æ±Ÿè¯¸æš¨ï¼Œç›®å‰æ˜¯ä¸€å¤´ç¨‹åºå‘˜ã€‚å»ºæ­¤åšå®¢ä»¥åˆ†äº«æŠ€æœ¯ä¸è¡¨è¾¾è‡ªæˆ‘ã€‚</p>\n<p><strong><em>ä¸€äº›å…´è¶£ä¸ç‰¹ç‚¹</em></strong>ï¼š</p>\n<ul>\n<li>ğŸ å–œæ¬¢å®¶ä¹¡çš„å†å²ï¼Œå¦‚æœä½ æ°å·§æ¥è‡ªè¯¸æš¨ï¼Œå¯ä»¥å»æ—¶å®‰çš„<a href=\"http://blog.sina.com.cn/u/2759005812\" target=\"_blank\" rel=\"noopener\">åšå®¢</a>ä¸­äº†è§£æ›´å¤šå…³äºè¯¸æš¨çš„å†å²</li>\n<li>ğŸˆ³æ¢ç´¢æ¯è¯­æ–¹è¨€å´è¯­è¯æ±‡æ¥æºæ˜¯ä¸€å¤§ä¹è¶£ï¼Œâ€œä½ ä¾¬æˆ‘ä¾¬ï¼Œå¿’ç…æƒ…å¤šâ€</li>\n<li>ğŸ²å¶å°”ç©ç©æ£‹ç‰Œæ¸¸æˆ<a href=\"http://web.sanguosha.com/\" target=\"_blank\" rel=\"noopener\">ã€Šä¸‰å›½æ€ Onlineã€‹</a></li>\n<li>ğŸ¸æ–°ä¸–çºªéŸ³ä¹ä¸<a href=\"https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9B%BD%E6%91%87%E6%BB%9A%E4%B9%90\" target=\"_blank\" rel=\"noopener\">ä¸­å›½æ‘‡æ»šä¹</a>çˆ±å¥½è€…</li>\n<li>ğŸ§¹é—´æ­‡æ€§è¿›è¡Œ<a href=\"https://book.douban.com/subject/24749465/\" target=\"_blank\" rel=\"noopener\">æ–­èˆç¦»</a></li>\n<li>ğŸ˜ ä»£ç æ ¼å¼åŒ–ã€æ–‡å­—æ’ç‰ˆï¼ˆéä¸“ä¸šï¼‰å¼ºè¿«ç—‡</li>\n<li>ğŸ§±ä¸èƒ½ç§‘å­¦ä¸Šç½‘ææƒ§ç—‡</li>\n<li>ğŸ“°â€œå¤å…¸â€äº’è”ç½‘æŠ€æœ¯ RSS, Podcast ä»ç„¶æ˜¯æˆ‘è·å–æ—¥å¸¸èµ„è®¯çš„é‡è¦æ¥æº</li>\n<li>ğŸ²ç›®å‰ä¸»è¦ä½¿ç”¨ç¼–ç¨‹è¯­è¨€ Go</li>\n</ul>\n<p>å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥ç”µé‚® <a href=\"mailto:velih.dzen@gmail.com\" target=\"_blank\" rel=\"noopener\">velih.dzen@gmail.com</a>ã€‚é™¤äº†é‚®ä»¶ï¼Œè¿˜å¯ä»¥åœ¨è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘ï¼š</p>\n<ul>\n<li>GitHubï¼š<a href=\"https://github.com/velihdzen\" target=\"_blank\" rel=\"noopener\">VelihDzen</a></li>\n<li>Twitter: <a href=\"https://twitter.com/lostzzwooo\" target=\"_blank\" rel=\"noopener\">LostZZWooo</a></li>\n<li>Doubanï¼š<a href=\"https://www.douban.com/people/69104080/\" target=\"_blank\" rel=\"noopener\">Aloha</a></li>\n</ul>\n<p><strong><em>åå­—è€ƒç©¶</em></strong>ï¼š</p>\n<ul>\n<li>åšå®¢å â€œé—²äº‘å­¤é¹¤â€ æ¥è‡ªä¸­å›½æ–°ä¸–çºªéŸ³ä¹ â€œæ‹“è’è€…â€ åˆ˜æ˜Ÿä¸“è¾‘ã€Šä¸€æ„å­¤è¡Œã€‹ä¸­çš„ä½œå“ã€Šé—²äº‘å­¤é¹¤ã€‹</li>\n</ul>\n<hr>\n<!-- netease music -->\n<div style=\" text-align: center;\">\n<iframe src=\"//music.163.com/outchain/player?type=0&id=2172521085&auto=1&height=430\" width=\"330\" height=\"330\" frameborder=\"0\" allowfullscreen></iframe>\n</div>","site":{"data":{}},"excerpt":"","more":"<p>Velih Dzenï¼Œç”Ÿäºä¹é›¶å¹´ä»£çš„æµ™æ±Ÿè¯¸æš¨ï¼Œç›®å‰æ˜¯ä¸€å¤´ç¨‹åºå‘˜ã€‚å»ºæ­¤åšå®¢ä»¥åˆ†äº«æŠ€æœ¯ä¸è¡¨è¾¾è‡ªæˆ‘ã€‚</p>\n<p><strong><em>ä¸€äº›å…´è¶£ä¸ç‰¹ç‚¹</em></strong>ï¼š</p>\n<ul>\n<li>ğŸ å–œæ¬¢å®¶ä¹¡çš„å†å²ï¼Œå¦‚æœä½ æ°å·§æ¥è‡ªè¯¸æš¨ï¼Œå¯ä»¥å»æ—¶å®‰çš„<a href=\"http://blog.sina.com.cn/u/2759005812\" target=\"_blank\" rel=\"noopener\">åšå®¢</a>ä¸­äº†è§£æ›´å¤šå…³äºè¯¸æš¨çš„å†å²</li>\n<li>ğŸˆ³æ¢ç´¢æ¯è¯­æ–¹è¨€å´è¯­è¯æ±‡æ¥æºæ˜¯ä¸€å¤§ä¹è¶£ï¼Œâ€œä½ ä¾¬æˆ‘ä¾¬ï¼Œå¿’ç…æƒ…å¤šâ€</li>\n<li>ğŸ²å¶å°”ç©ç©æ£‹ç‰Œæ¸¸æˆ<a href=\"http://web.sanguosha.com/\" target=\"_blank\" rel=\"noopener\">ã€Šä¸‰å›½æ€ Onlineã€‹</a></li>\n<li>ğŸ¸æ–°ä¸–çºªéŸ³ä¹ä¸<a href=\"https://zh.wikipedia.org/wiki/%E4%B8%AD%E5%9B%BD%E6%91%87%E6%BB%9A%E4%B9%90\" target=\"_blank\" rel=\"noopener\">ä¸­å›½æ‘‡æ»šä¹</a>çˆ±å¥½è€…</li>\n<li>ğŸ§¹é—´æ­‡æ€§è¿›è¡Œ<a href=\"https://book.douban.com/subject/24749465/\" target=\"_blank\" rel=\"noopener\">æ–­èˆç¦»</a></li>\n<li>ğŸ˜ ä»£ç æ ¼å¼åŒ–ã€æ–‡å­—æ’ç‰ˆï¼ˆéä¸“ä¸šï¼‰å¼ºè¿«ç—‡</li>\n<li>ğŸ§±ä¸èƒ½ç§‘å­¦ä¸Šç½‘ææƒ§ç—‡</li>\n<li>ğŸ“°â€œå¤å…¸â€äº’è”ç½‘æŠ€æœ¯ RSS, Podcast ä»ç„¶æ˜¯æˆ‘è·å–æ—¥å¸¸èµ„è®¯çš„é‡è¦æ¥æº</li>\n<li>ğŸ²ç›®å‰ä¸»è¦ä½¿ç”¨ç¼–ç¨‹è¯­è¨€ Go</li>\n</ul>\n<p>å¦‚æœæœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥ç”µé‚® <a href=\"mailto:velih.dzen@gmail.com\" target=\"_blank\" rel=\"noopener\">velih.dzen@gmail.com</a>ã€‚é™¤äº†é‚®ä»¶ï¼Œè¿˜å¯ä»¥åœ¨è¿™äº›åœ°æ–¹æ‰¾åˆ°æˆ‘ï¼š</p>\n<ul>\n<li>GitHubï¼š<a href=\"https://github.com/velihdzen\" target=\"_blank\" rel=\"noopener\">VelihDzen</a></li>\n<li>Twitter: <a href=\"https://twitter.com/lostzzwooo\" target=\"_blank\" rel=\"noopener\">LostZZWooo</a></li>\n<li>Doubanï¼š<a href=\"https://www.douban.com/people/69104080/\" target=\"_blank\" rel=\"noopener\">Aloha</a></li>\n</ul>\n<p><strong><em>åå­—è€ƒç©¶</em></strong>ï¼š</p>\n<ul>\n<li>åšå®¢å â€œé—²äº‘å­¤é¹¤â€ æ¥è‡ªä¸­å›½æ–°ä¸–çºªéŸ³ä¹ â€œæ‹“è’è€…â€ åˆ˜æ˜Ÿä¸“è¾‘ã€Šä¸€æ„å­¤è¡Œã€‹ä¸­çš„ä½œå“ã€Šé—²äº‘å­¤é¹¤ã€‹</li>\n</ul>\n<hr>\n<!-- netease music -->\n<div style=\" text-align: center;\">\n<iframe src=\"//music.163.com/outchain/player?type=0&id=2172521085&auto=1&height=430\" width=\"330\" height=\"330\" frameborder=\"0\" allowfullscreen></iframe>\n</div>"},{"title":"tags","date":"2018-04-04T14:58:50.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2018-04-04 22:58:50\ntype: \"tags\"\n---\n","updated":"2020-07-18T06:30:19.537Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ckcraiuha0002w80v0zbvfap9","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\">","site":{"data":{}},"excerpt":"","more":""},{"_content":"<tbody>\n    <tr>\n        <th style=\"border-bottom:none; border-right:none;\"><i>Offsets</i>\n        </th>\n        <th style=\"border-left:none;\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th colspan=\"8\">0\n        </th>\n        <th colspan=\"8\">1\n        </th>\n        <th colspan=\"8\">2\n        </th>\n        <th colspan=\"8\">3\n        </th>\n    </tr>\n    <tr>\n        <th style=\"border-top: none\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th>\n            <style data-mw-deduplicate=\"TemplateStyles:r853376051\">\n                .mw-parser-output .monospaced {\n                    font-family: monospace, monospace\n                }\n                \n                .mw-parser-output .monospaced-bold {\n                    font-weight: bold\n                }\n            </style><span class=\"monospaced\"><a href=\"/wiki/Bit\" title=\"Bit\">Bit</a></span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;1</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;2</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;3</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;4</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;5</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;6</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;7</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;8</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;9</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">10</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">11</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">12</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">13</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">14</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">15</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">16</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">17</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">18</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">19</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">20</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">21</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">22</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">23</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">24</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">25</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">26</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">27</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">28</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">29</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">30</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">31</span>\n        </th>\n    </tr>\n    <tr>\n        <th>0\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span>\n        </th>\n        <td colspan=\"16\" style=\"background:#fdd;\">Source port</td>\n        <td colspan=\"16\">Destination port\n        </td>\n    </tr>\n    <tr>\n        <th>4\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">32</span>\n        </th>\n        <td colspan=\"16\">Length</td>\n        <td colspan=\"16\" style=\"background:#fdd;\">Checksum\n        </td>\n    </tr>\n    <tr>\n        <th>8\n        </th>\n        <th><tt>64</tt>\n        </th>\n        <td colspan=\"4\">type</td>\n        <td colspan=\"4\">ver</td>\n        <td colspan=\"8\">extension</td>\n        <td colspan=\"16\">connection_id</td>\n    </tr>\n    <tr>\n        <th>12\n        </th>\n        <th><tt>96</tt>\n        </th>\n        <td colspan=\"32\">timestamp_microseconds</td>\n    </tr>\n    <tr>\n        <th>16\n        </th>\n        <th><tt>128</tt>\n        </th>\n        <td colspan=\"32\">timestamp_difference_microseconds</td>\n    </tr>\n    <tr>\n        <th>20\n        </th>\n        <th><tt>160</tt>\n        </th>\n        <td colspan=\"32\">wnd_size</td>\n    </tr>\n    <tr>\n        <th>24\n        </th>\n        <th><tt>192</tt>\n        </th>\n        <td colspan=\"16\">seq_nr</td>\n        <td colspan=\"16\">ack_nr</td>\n    </tr>\n    <tr>\n        <th>28<br>...\n        </th>\n        <th><tt>224<br>...</tt>\n        </th>\n        <td colspan=\"32\" style=\"background:#ffd0d0;\">extensions<br>...\n        </td></tr>\n</tbody>","source":"downloads/code/utp_header_format.html","raw":"<tbody>\n    <tr>\n        <th style=\"border-bottom:none; border-right:none;\"><i>Offsets</i>\n        </th>\n        <th style=\"border-left:none;\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th colspan=\"8\">0\n        </th>\n        <th colspan=\"8\">1\n        </th>\n        <th colspan=\"8\">2\n        </th>\n        <th colspan=\"8\">3\n        </th>\n    </tr>\n    <tr>\n        <th style=\"border-top: none\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th>\n            <style data-mw-deduplicate=\"TemplateStyles:r853376051\">\n                .mw-parser-output .monospaced {\n                    font-family: monospace, monospace\n                }\n                \n                .mw-parser-output .monospaced-bold {\n                    font-weight: bold\n                }\n            </style><span class=\"monospaced\"><a href=\"/wiki/Bit\" title=\"Bit\">Bit</a></span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;1</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;2</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;3</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;4</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;5</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;6</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;7</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;8</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;9</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">10</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">11</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">12</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">13</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">14</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">15</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">16</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">17</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">18</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">19</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">20</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">21</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">22</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">23</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">24</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">25</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">26</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">27</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">28</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">29</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">30</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">31</span>\n        </th>\n    </tr>\n    <tr>\n        <th>0\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span>\n        </th>\n        <td colspan=\"16\" style=\"background:#fdd;\">Source port</td>\n        <td colspan=\"16\">Destination port\n        </td>\n    </tr>\n    <tr>\n        <th>4\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">32</span>\n        </th>\n        <td colspan=\"16\">Length</td>\n        <td colspan=\"16\" style=\"background:#fdd;\">Checksum\n        </td>\n    </tr>\n    <tr>\n        <th>8\n        </th>\n        <th><tt>64</tt>\n        </th>\n        <td colspan=\"4\">type</td>\n        <td colspan=\"4\">ver</td>\n        <td colspan=\"8\">extension</td>\n        <td colspan=\"16\">connection_id</td>\n    </tr>\n    <tr>\n        <th>12\n        </th>\n        <th><tt>96</tt>\n        </th>\n        <td colspan=\"32\">timestamp_microseconds</td>\n    </tr>\n    <tr>\n        <th>16\n        </th>\n        <th><tt>128</tt>\n        </th>\n        <td colspan=\"32\">timestamp_difference_microseconds</td>\n    </tr>\n    <tr>\n        <th>20\n        </th>\n        <th><tt>160</tt>\n        </th>\n        <td colspan=\"32\">wnd_size</td>\n    </tr>\n    <tr>\n        <th>24\n        </th>\n        <th><tt>192</tt>\n        </th>\n        <td colspan=\"16\">seq_nr</td>\n        <td colspan=\"16\">ack_nr</td>\n    </tr>\n    <tr>\n        <th>28<br>...\n        </th>\n        <th><tt>224<br>...</tt>\n        </th>\n        <td colspan=\"32\" style=\"background:#ffd0d0;\">extensions<br>...\n        </td></tr>\n</tbody>","date":"2020-07-18T06:30:19.537Z","updated":"2020-07-18T06:30:19.537Z","path":"downloads/code/utp_header_format.html","title":"","comments":1,"layout":"page","_id":"ckcraiuik000ew80vq00w03p0","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><tbody>\n    <tr>\n        <th style=\"border-bottom:none; border-right:none;\"><i>Offsets</i>\n        </th>\n        <th style=\"border-left:none;\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th colspan=\"8\">0\n        </th>\n        <th colspan=\"8\">1\n        </th>\n        <th colspan=\"8\">2\n        </th>\n        <th colspan=\"8\">3\n        </th>\n    </tr>\n    <tr>\n        <th style=\"border-top: none\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th>\n            <style data-mw-deduplicate=\"TemplateStyles:r853376051\">\n                .mw-parser-output .monospaced {\n                    font-family: monospace, monospace\n                }\n                \n                .mw-parser-output .monospaced-bold {\n                    font-weight: bold\n                }\n            </style><span class=\"monospaced\"><a href=\"/wiki/Bit\" title=\"Bit\">Bit</a></span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;1</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;2</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;3</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;4</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;5</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;6</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;7</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;8</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;9</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">10</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">11</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">12</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">13</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">14</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">15</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">16</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">17</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">18</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">19</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">20</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">21</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">22</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">23</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">24</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">25</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">26</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">27</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">28</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">29</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">30</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">31</span>\n        </th>\n    </tr>\n    <tr>\n        <th>0\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span>\n        </th>\n        <td colspan=\"16\" style=\"background:#fdd;\">Source port</td>\n        <td colspan=\"16\">Destination port\n        </td>\n    </tr>\n    <tr>\n        <th>4\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">32</span>\n        </th>\n        <td colspan=\"16\">Length</td>\n        <td colspan=\"16\" style=\"background:#fdd;\">Checksum\n        </td>\n    </tr>\n    <tr>\n        <th>8\n        </th>\n        <th><tt>64</tt>\n        </th>\n        <td colspan=\"4\">type</td>\n        <td colspan=\"4\">ver</td>\n        <td colspan=\"8\">extension</td>\n        <td colspan=\"16\">connection_id</td>\n    </tr>\n    <tr>\n        <th>12\n        </th>\n        <th><tt>96</tt>\n        </th>\n        <td colspan=\"32\">timestamp_microseconds</td>\n    </tr>\n    <tr>\n        <th>16\n        </th>\n        <th><tt>128</tt>\n        </th>\n        <td colspan=\"32\">timestamp_difference_microseconds</td>\n    </tr>\n    <tr>\n        <th>20\n        </th>\n        <th><tt>160</tt>\n        </th>\n        <td colspan=\"32\">wnd_size</td>\n    </tr>\n    <tr>\n        <th>24\n        </th>\n        <th><tt>192</tt>\n        </th>\n        <td colspan=\"16\">seq_nr</td>\n        <td colspan=\"16\">ack_nr</td>\n    </tr>\n    <tr>\n        <th>28<br>...\n        </th>\n        <th><tt>224<br>...</tt>\n        </th>\n        <td colspan=\"32\" style=\"background:#ffd0d0;\">extensions<br>...\n        </td></tr>\n</tbody>","site":{"data":{}},"excerpt":"","more":"<tbody>\n    <tr>\n        <th style=\"border-bottom:none; border-right:none;\"><i>Offsets</i>\n        </th>\n        <th style=\"border-left:none;\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th colspan=\"8\">0\n        </th>\n        <th colspan=\"8\">1\n        </th>\n        <th colspan=\"8\">2\n        </th>\n        <th colspan=\"8\">3\n        </th>\n    </tr>\n    <tr>\n        <th style=\"border-top: none\"><a href=\"/wiki/Octet_(computing)\" title=\"Octet (computing)\">Octet</a>\n        </th>\n        <th>\n            <style data-mw-deduplicate=\"TemplateStyles:r853376051\">\n                .mw-parser-output .monospaced {\n                    font-family: monospace, monospace\n                }\n                \n                .mw-parser-output .monospaced-bold {\n                    font-weight: bold\n                }\n            </style><span class=\"monospaced\"><a href=\"/wiki/Bit\" title=\"Bit\">Bit</a></span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;1</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;2</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;3</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;4</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;5</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;6</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;7</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;8</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;9</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">10</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">11</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">12</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">13</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">14</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">15</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">16</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">17</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">18</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">19</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">20</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">21</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">22</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">23</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">24</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">25</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">26</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">27</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">28</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">29</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">30</span></th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">31</span>\n        </th>\n    </tr>\n    <tr>\n        <th>0\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">&nbsp;0</span>\n        </th>\n        <td colspan=\"16\" style=\"background:#fdd;\">Source port</td>\n        <td colspan=\"16\">Destination port\n        </td>\n    </tr>\n    <tr>\n        <th>4\n        </th>\n        <th>\n            <link rel=\"mw-deduplicated-inline-style\" href=\"mw-data:TemplateStyles:r853376051\"><span class=\"monospaced\">32</span>\n        </th>\n        <td colspan=\"16\">Length</td>\n        <td colspan=\"16\" style=\"background:#fdd;\">Checksum\n        </td>\n    </tr>\n    <tr>\n        <th>8\n        </th>\n        <th><tt>64</tt>\n        </th>\n        <td colspan=\"4\">type</td>\n        <td colspan=\"4\">ver</td>\n        <td colspan=\"8\">extension</td>\n        <td colspan=\"16\">connection_id</td>\n    </tr>\n    <tr>\n        <th>12\n        </th>\n        <th><tt>96</tt>\n        </th>\n        <td colspan=\"32\">timestamp_microseconds</td>\n    </tr>\n    <tr>\n        <th>16\n        </th>\n        <th><tt>128</tt>\n        </th>\n        <td colspan=\"32\">timestamp_difference_microseconds</td>\n    </tr>\n    <tr>\n        <th>20\n        </th>\n        <th><tt>160</tt>\n        </th>\n        <td colspan=\"32\">wnd_size</td>\n    </tr>\n    <tr>\n        <th>24\n        </th>\n        <th><tt>192</tt>\n        </th>\n        <td colspan=\"16\">seq_nr</td>\n        <td colspan=\"16\">ack_nr</td>\n    </tr>\n    <tr>\n        <th>28<br>...\n        </th>\n        <th><tt>224<br>...</tt>\n        </th>\n        <td colspan=\"32\" style=\"background:#ffd0d0;\">extensions<br>...\n        </td></tr>\n</tbody>"}],"Post":[{"title":"BT å¢å¼ºå»ºè®®ä¹‹ DHT","date":"2018-11-12T13:11:00.000Z","_content":"\nBitTorrent ä½¿ç”¨ DHT ç½‘è·¯æ¥å­˜å‚¨ peer ä¿¡æ¯ï¼Œä»¥å®ç°å» Tracker åŒ–çš„ç§å­ã€‚æ­¤æ—¶ï¼Œæ¯ä¸ª peer éƒ½æˆäº†ä¸€ä¸ª Trackerã€‚ç½‘ç»œåŸºäº Kademlia ç®—æ³•å®ç°ï¼Œä½¿ç”¨ UDP è¿›è¡Œä¼ è¾“ã€‚\n\næœ¬æ–‡ä¸»è¦å¯¹ BT ä¸­çš„ DHT ç½‘ç»œå®ç°ä¸åœ¨åšæ–‡ {% post_link dht-kademlia %} ä¸­æè¿°çš„ Kademlia ç®—æ³•çš„åŒºåˆ«è¿›è¡Œæ€»ç»“ã€‚å‡†ç¡®çš„è¯´ä¸èƒ½è¯´æ˜¯åŒºåˆ«ï¼Œè€Œåº”è¯¥å®šä¹‰æˆå®ç°ç»†èŠ‚ï¼Œæ¯•ç«Ÿç†è®ºç®—æ³•åº”ç”¨åˆ°å®é™…æ—¶æ€»éœ€è¦å› åœ°åˆ¶å®œã€‚\n\n## å®ç°ç»†èŠ‚ç‚¹\n\n### key-value å¯¹å­˜å‚¨çš„å†…å®¹\n\nBT ä½¿ç”¨ DHT ç½‘ç»œæ¥å®ç°å» Tracker åŒ–ï¼Œå› æ­¤ peer çš„ä¿¡æ¯å°±éœ€è¦å­˜å‚¨åœ¨ DHT ç½‘ç»œä¸­ï¼ŒBT ä¸­ peer åˆæ˜¯å±€é™åœ¨æŸä¸ª Torrent æ–‡ä»¶ä¸­çš„ã€‚å› æ­¤ key-value å¯¹ä¸­ key å³ Torrent æ–‡ä»¶çš„ infohashï¼Œæ­£å¥½ infohash ä¹Ÿæ˜¯ 160 æ¯”ç‰¹é•¿åº¦çš„ï¼Œvalue ä¸ºæ‹¥æœ‰è¯¥ infohash æ–‡ä»¶çš„ peer åˆ—è¡¨ã€‚\n\n### $K$ æ¡¶å®ç°ç»†èŠ‚\n\né¦–å…ˆ $K$ æ¡¶ä¸­çš„èŠ‚ç‚¹æœ‰å¤šç§çŠ¶æ€ï¼šå¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨ 15 åˆ†é’Ÿå†…å›å¤è¿‡å½“å‰çš„èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚æˆ–è€…æ›¾ç»å›å¤è¿‡å½“å‰èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚åŒæ—¶åœ¨ 15 åˆ†é’Ÿå†…æœ‰å‘é€è¿‡æŸ¥è¯¢è¯·æ±‚ç»™å½“å‰èŠ‚ç‚¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹ç›¸å¯¹äºå½“å‰èŠ‚ç‚¹ä¸º *Good èŠ‚ç‚¹*ï¼›å¦‚æœä¸€ä¸ªèŠ‚ç‚¹ 15 åˆ†é’Ÿå†…æœªæ›¾æ´»åŠ¨è¿‡ï¼Œåˆ™æˆä¸º *Questionable èŠ‚ç‚¹*ï¼›å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æœªç›¸åº”å½“å‰èŠ‚ç‚¹çš„å¤šæ¬¡æŸ¥è¯¢è¯·æ±‚ï¼Œåˆ™è§†ä¸º *Bad èŠ‚ç‚¹*ã€‚\n\nå½“ä¸€ä¸ªæ¡¶ä¸­èŠ‚ç‚¹æ•°é‡å·²æ»¡ï¼ˆ$K$ çš„å®¹é‡ $k$ åœ¨ BT ä¸­ä¸º 8ï¼‰ä¸”éƒ½æ˜¯ Good èŠ‚ç‚¹ï¼Œæ–°çš„èŠ‚ç‚¹å¦‚æœæƒ³è¦åŠ å…¥åˆ™ç›´æ¥è¢«å¿½ç•¥ã€‚å¦‚æœæ¡¶ä¸­æœ‰ Bad èŠ‚ç‚¹ï¼Œæ–°çš„èŠ‚ç‚¹å°†ä¼šæ›¿ä»£ä¹‹ã€‚å¦‚æœæ¡¶ä¸­æœ‰ Questionable èŠ‚ç‚¹ï¼Œåˆ™æŒ‰ç…§è¿™äº›èŠ‚ç‚¹åŠ å…¥æ¡¶çš„æ—¶é—´è¿›è¡Œ ping è¯·æ±‚ï¼Œå¦‚æœæœ‰èŠ‚ç‚¹ä¸èƒ½è¢« ping æˆåŠŸåˆ™æ–°çš„èŠ‚ç‚¹å°†ä¼šå–ä»£ä¹‹ã€‚\n\næ¯ä¸ªæ¡¶éƒ½ä¼šæœ‰ä¸€ä¸ª*æœ€è¿‘æ›´æ–°æ—¶é—´*æ ‡è®°æ¥æŒ‡ç¤ºæ¡¶ä¸­èŠ‚ç‚¹çš„æ–°é²œç¨‹åº¦ã€‚å¦‚æœä¸€ä¸ªæ¡¶ä¸­èŠ‚ç‚¹è¢« ping æˆåŠŸäº†ï¼Œæˆ–è€…æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œæˆ–è€…ä¸€ä¸ªèŠ‚ç‚¹è¢«å¦ä¸€ä¸ªæ›¿ä»£äº†ï¼Œè¿™ä¸ªæ—¶é—´ä¼šæ›´æ–°ã€‚å¦‚æœä¸€ä¸ªæ¡¶æœ€è¿‘æ›´æ–°æ—¶é—´å·²ç»è¿‡å» 15 åˆ†é’Ÿï¼Œåˆ™éœ€è¦è¿›è¡Œä¸€æ¬¡æ¡¶åˆ·æ–°ï¼Œæ–¹å¼å’Œ Kademlia ä¸­æè¿°çš„ä¸€è‡´ã€‚\n\n### Peer DHT æ”¯æŒä¸å¦å‘ŠçŸ¥\n\npeer é€šè¿‡åœ¨ handshake æ¡æ‰‹æ¶ˆæ¯ä¸­å°† reserved_byte çš„æœ€åä¸€æ¯”ç‰¹è®¾ç½®ä¸º 1 æ¥è¡¨ç¤ºæ”¯æŒ DHT ç½‘ç»œã€‚åŒæ ·æ”¯æŒ DHT ç½‘ç»œçš„èŠ‚ç‚¹æ”¶åˆ°è¯¥æ¡æ‰‹æ¶ˆæ¯åä¼šå‘èµ·ä¸€ä¸ª PORT æ¶ˆæ¯ï¼Œtype ä¸º 9ï¼Œè´Ÿè½½ä¸ºä¸¤ä¸ªå­—èŠ‚çš„ DHT èŠ‚ç‚¹ UDP ç«¯å£ã€‚æ”¶åˆ° PORT æ¶ˆæ¯çš„èŠ‚ç‚¹éœ€è¦å¯¹æ”¹èŠ‚ç‚¹ç«¯å£æ‰§è¡Œ ping æ“ä½œï¼Œå¦‚æœå¯¹æ–¹å“åº”äº†ï¼Œåˆ™èŠ‚ç‚¹éœ€è¦å°è¯•å°†å…¶åŠ å…¥åˆ° $K$ æ¡¶ä¸­ã€‚\n\n### åˆå§‹èŠ‚ç‚¹è·å–\n\nå» Tracker åŒ–çš„ Torrent æ–‡ä»¶ä¸­æ˜¯æ²¡æœ‰å­˜å‚¨ Tracker åœ°å€çš„ â€announceâ€œ é”®çš„ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ â€nodesâ€œ é”®ï¼Œnodes ä¸­éœ€è¦å­˜å‚¨è·ç¦» key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹åœ°å€æˆ–è€…å­˜å‚¨ä¸€ä¸ª *Good èŠ‚ç‚¹*ï¼Œæ¯”å¦‚è¯´äº§ç”Ÿè¿™ä¸ª Torrent çš„ç”¨æˆ·èŠ‚ç‚¹ã€‚ä¸èƒ½å°†æŸäº›å…¬å…±çš„èŠ‚ç‚¹åŠ å…¥åˆ° Torrent æ–‡ä»¶ä¸­ï¼Œå¦åˆ™å°±å˜å¾—ä¸é‚£ä¹ˆå» Tracker åŒ–äº†ã€‚nodes å¤§æ¦‚å¯ä»¥è¡¨ç¤ºä¸ºï¼š\n```\nnodes = [[\"<host>\", <port>], [\"<host>\", <port>], ...]\nnodes = [[\"127.0.0.1\", 6881], [\"your.router.node\", 4804]]\n```\n\n### RPC æ¶ˆæ¯\nBT ä½¿ç”¨ KRPC æ¥å®ç° Kademlia èŠ‚ç‚¹é—´çš„ RPC é€šä¿¡ï¼ŒKRPC æ¶ˆæ¯æœ‰ä¸‰ç§æ¶ˆæ¯ç±»å‹ï¼šæŸ¥è¯¢ï¼Œå“åº”ï¼Œé”™è¯¯ã€‚å¯¹äº DHT åè®®ï¼Œæœ‰å››ç§æŸ¥è¯¢åè®®ï¼špingï¼Œfind_nodeï¼Œget_peersï¼Œannounce_peerã€‚\n\n#### KRPC åè®®\n\nKRPC åè®®æ˜¯åŸºäº UDP å’Œ bencode ç¼–ç çš„ RPC åè®®ã€‚æ¯æ¡ KRPC æ¶ˆæ¯å¸¦æœ‰ä¸‰ä¸ªå…¬å…±é”®å€¼å¯¹ä»¥åŠå…¶ä»–å› æ¶ˆæ¯ç±»å‹è€Œå¼‚çš„é”®ã€‚ä¸‰ä¸ªå…¬å…±çš„é”®æ˜¯ï¼š\n- â€tâ€œï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨ transaction IDã€‚ç”±å‘èµ· query è¯·æ±‚çš„èŠ‚ç‚¹ç”Ÿæˆï¼Œè¢«è¯·æ±‚èŠ‚ç‚¹éœ€è¦åœ¨å›å¤ä¸­è¿”å›ã€‚ä¸€èˆ¬ä¸¤ä¸ªå­—èŠ‚ï¼›\n- â€yâ€œï¼šå€¼ä¸ºå•å­—ç¬¦ï¼Œä»£è¡¨æ¶ˆæ¯ç±»å‹ï¼Œæ˜¯ q(query)ã€r(response)ã€e(error) ä¸­çš„ä¸€ä¸ªï¼›\n- \"v\"ï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨å®¢æˆ·ç«¯ç‰ˆæœ¬ [BEP 20](http://www.bittorrent.org/beps/bep_0020.html) ä¸­å®šä¹‰ï¼Œä¸ä¸€å®šå­˜åœ¨è¿™ä¸ªé”®ï¼›\n\næ¯ç§æ¶ˆæ¯ä¼šæœ‰è‡ªå·±é¢å¤–çš„é”®ï¼š\n##### Query æ¶ˆæ¯\n\n- â€qâ€œï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨å…·ä½“çš„æ–¹æ³•ç±»å‹ï¼›\n- â€aâ€œï¼šå€¼ä¸ºå­—å…¸ï¼Œä»£è¡¨å…·ä½“æ–¹æ³•å¯¹åº”çš„å‚æ•°å­—å…¸ï¼›\n\n##### Response æ¶ˆæ¯\n\nå¦‚æœ Query æ¶ˆæ¯æ‰§è¡ŒæˆåŠŸï¼Œåˆ™ä¼šè¿”å›è¯¥ Response æ¶ˆæ¯ã€‚\n\n- â€râ€œï¼šå€¼ä¸ºå­—å…¸ï¼Œä»£è¡¨è¿”å›å€¼å­—å…¸ï¼›\n\n##### Error æ¶ˆæ¯\n\nå¦‚æœ Query æ¶ˆæ¯æ‰§è¡Œå¤±è´¥ï¼Œåˆ™ä¼šè¿”å›è¯¥ Error æ¶ˆæ¯ã€‚\n\n- â€eâ€œï¼šå€¼ä¸ºåˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä»£è¡¨é”™è¯¯ç ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯é”™è¯¯æ¶ˆæ¯ï¼›\n\né”™è¯¯æ¶ˆæ¯ç±»å‹å¦‚ä¸‹ï¼š\n\n| Code | Description                                                  |\n| ---- | ------------------------------------------------------------ |\n| 201  | Generic Error                                                |\n| 202  | Server Error                                                 |\n| 203  | Protocol Error, such as a malformed packet, invalid arguments, or bad token |\n| 204  | Method Unknown                                               |\n\nç¤ºä¾‹é”™è¯¯æ¶ˆæ¯ï¼š\n```\ngeneric error = {\"t\":\"aa\", \"y\":\"e\", \"e\":[201, \"A Generic Error Ocurred\"]}\nbencoded = d1:eli201e23:A Generic Error Ocurrede1:t2:aa1:y1:ee\n```\n\n#### DHT Query æ¶ˆæ¯\n\n##### ping\nç”¨äºæ£€æµ‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å·¥ä½œï¼Œç›¸å½“äº Kademlia çš„ PING è°ƒç”¨ã€‚\n```\narguments:  {\"id\" : \"<querying nodes id>\"}\n\nresponse: {\"id\" : \"<queried nodes id>\"}\n```\n\n##### find_node\n\næŸ¥æ‰¾è·ç¦»æŒ‡å®šèŠ‚ç‚¹ ID æœ€è¿‘çš„èŠ‚ç‚¹ ID ä¿¡æ¯ï¼Œç›¸å½“äº Kademlia çš„ FIND_NODE è°ƒç”¨ã€‚\n```\narguments:  {\"id\" : \"<querying nodes id>\", \"target\" : \"<id of target node>\"}\n\nresponse: {\"id\" : \"<queried nodes id>\", \"nodes\" : \"<compact node info>\"}\n```\n\"Compact node info\" åˆ—è¡¨ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¿¡æ¯å ç”¨ 26 å­—èŠ‚ï¼Œå…¶ä¸­èŠ‚ç‚¹ ID 20 å­—èŠ‚ï¼ŒIP ä¸ Port å ç”¨ 6 å­—èŠ‚ã€‚\n\n##### get_peers\n\næŸ¥æ‰¾ä¸æŒ‡å®š info_hash ç›¸å…³çš„ peer ä¿¡æ¯ï¼Œç›¸å½“äº Kademlia çš„ FIND_VALUE è°ƒç”¨ã€‚\n\n```\narguments:  {\"id\" : \"<querying nodes id>\", \"info_hash\" : \"<20-byte infohash of target torrent>\"}\n\nresponse: {\"id\" : \"<queried nodes id>\", \"token\" :\"<opaque write token>\", \"values\" : [\"<peer 1 info string>\", \"<peer 2 info string>\"]}\n\nor: {\"id\" : \"<queried nodes id>\", \"token\" :\"<opaque write token>\", \"nodes\" : \"<compact node info>\"}\n```\n\nå¦‚æœè¢«è¯·æ±‚èŠ‚ç‚¹æœ‰æŒ‡å®š info_hash ç›¸å…³ peers åˆ™ä»¥ values ä¸ºé”®çš„ \"Compact IP-address/port info\" åˆ—è¡¨ï¼Œå¦åˆ™ï¼Œè¿”å›ä»¥ nodes ä¸ºé”®çš„ \"Compact node info\" åˆ—è¡¨ã€‚å“åº”ä¸­çš„ token éœ€è¦è¯·æ±‚è€…åœ¨é€šè¿‡ announce_peer å‘å›å¤è€…å®£å‘Š peer ä¿¡æ¯æ—¶æºå¸¦ã€‚\n\n##### announce_peer\n\nå®£å‘ŠèŠ‚ç‚¹è‡ªèº«æ‹¥æœ‰ç‰¹å®š info_hash çš„æ•°æ®ï¼Œå¹¶åœ¨æŸä¸ªç«¯å£è¿›è¡Œä¸‹è½½ï¼Œç›¸å½“äº Kademlia çš„ STORE è°ƒç”¨ã€‚\n\n```\narguments:  {\"id\" : \"<querying nodes id>\",\n  \"implied_port\": <0 or 1>,\n  \"info_hash\" : \"<20-byte infohash of target torrent>\",\n  \"port\" : <port number>,\n  \"token\" : \"<opaque token>\"}\n\nresponse: {\"id\" : \"<queried nodes id>\"}\n```\n\næ¥å—è€…éœ€è¦æ ¡éªŒ token æ˜¯å¦ä¸ä¹‹å‰å®ƒé€šè¿‡ get_peers è°ƒç”¨çš„å“åº”å›å¤ç»™è¯¥è¯·æ±‚è€…çš„ä¸€è‡´ã€‚å¦‚æœ implied_port å€¼ä¸º 1ï¼Œè¡¨ç¤º port çš„å€¼ä¸å¯ç”¨ï¼Œæ¥å—è€…éœ€è¦å°†è¯·æ±‚åŒ…çš„ UDP æºç«¯å£ä½œä¸º portã€‚\n\n## BT DHT ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\n\n### DHT Scrape å¸®åŠ©é€‰æ‹© Seeding å†…å®¹\n\nç±»ä¼¼ [Tracker Scrape](http://bittorrent.org/beps/bep_0048.html)ï¼ŒDHT ç½‘ç»œå¯ä»¥é€šè¿‡ [BEP33 - DHT Scrapes](http://bittorrent.org/beps/bep_0033.html) ä¸­å®šä¹‰çš„ DHT scrape æ¥äº†è§£æŸä¸ª Swarm ä¸­ peer çš„å¤§è‡´æƒ…å†µï¼Œç„¶åæ ¹æ®è¿™ä¸ªçŠ¶æ€é€‰æ‹© seeding é˜Ÿåˆ—ä¸­ä¸‹ä¸€ä¸ª Swarm è¿›è¡Œåšç§ã€‚è¿™ç§ç®—æ³•ä¸»è¦é€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰å®ç°ï¼Œå¸ƒéš†è¿‡æ»¤å™¨é€šå¸¸ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚ä½†åœ¨ DHT scrape ä¸­ï¼Œä½œç”¨æ‰€æœ‰ä¸åŒã€‚åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ˜¯å„ä¸ª peer çš„ IP çš„ sha1 å€¼ï¼Œå¯ä»¥æ ¹æ®è¿‡æ»¤å™¨ä¸­å‰©ä½™çš„ 0 æ¯”ç‰¹æ•°é‡æ¥ä¼°ç®—æ•´ä¸ª Swarm çš„è§„æ¨¡ã€‚\n\n### åªè¯» DHT èŠ‚ç‚¹\n\nåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒDHT èŠ‚ç‚¹ä¸»åŠ¨æˆ–è¢«åŠ¨åœ°é™åˆ¶æˆä¸ºåªè¯»èŠ‚ç‚¹ï¼ˆ[BEP43 - Read-only DHT Nodes](http://bittorrent.org/beps/bep_0043.html) ä¸­å®šä¹‰ï¼‰ï¼Œæ¯”å¦‚ä½äº NAT åä¸” hole punching å¤±è´¥çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å…·æœ‰æµé‡é™åˆ¶æˆ–è€…æœ‰æµé‡è®¡åˆ’ï¼Œæµé‡ä¼šå½±å“èŠ‚ç‚¹çš„ç”µé‡ç­‰ç­‰æƒ…å†µã€‚\n\nèŠ‚ç‚¹é€šè¿‡åœ¨æ¯æ¡å‘å¤–å‘é€çš„ DHT Query æ¶ˆæ¯ä¸­ç»™å‡ºä¸€ä¸ª `ro=1` çš„é”®å€¼å¯¹æ¥è¡¨æ˜è‡ªå·±ä¸ºåªè¯»èŠ‚ç‚¹ã€‚æˆä¸ºåªè¯»èŠ‚ç‚¹åï¼Œä¸å†å“åº”å…¶ä»–èŠ‚ç‚¹çš„ Query è¯·æ±‚ã€‚å…¶ä»–èŠ‚ç‚¹çŸ¥æ™“åªè¯»èŠ‚ç‚¹åä¹Ÿä¸ä¼šå‘é€ Query è¯·æ±‚ä»¥å‡å°‘ç½‘ç»œæµé‡ã€‚\n\n### åœ¨ DHT ä¸­å­˜å‚¨ä»»æ„æ•°æ®\n\n[BEP44 - Storing arbitrary data in the DHT](http://bittorrent.org/beps/bep_0044.html) ä¸­æä¾›äº†ä¸€ç§åœ¨ DHT ä¸­å­˜å‚¨ä»»æ„æ•°æ®çš„æ–¹å¼ã€‚å­˜å‚¨çš„æ•°æ®å¯ä»¥æ˜¯ä¸å¯å˜æ•°æ®ä¹Ÿå¯ä»¥æ˜¯å¯å˜æ•°æ®ï¼Œä¸å¯å˜æ•°æ®çš„ key æ˜¯æ•°æ®å†…å®¹çš„ sha1 å€¼ï¼Œå¯å˜æ•°æ®çš„ key æ˜¯ç”¨äºç­¾åæ•°æ®çš„å¯†é’¥å¯¹å…¬é’¥ã€‚[BEP46 - Updating Torrents Via DHT Mutable Items](http://bittorrent.org/beps/bep_0046.html) åˆ™åŸºäºåœ¨ DHT ç½‘ç»œä¸­å­˜å‚¨å¯å˜æ•°æ®è€Œç»™å‡ºäº†ä¸€ç§ç”¨äºæ›´æ–° Torrent çš„æ–¹æ³•ã€‚[BEP50 - Publish/Subscribe Protocol](http://bittorrent.org/beps/bep_0050.html) å®ç°äº†ä¸€ç§åŸºäºä¸»é¢˜çš„å‘å¸ƒè®¢é˜…æ¨¡å¼æ¥å‘è®¢é˜…ç‰¹å®šä¸»é¢˜çš„å®¢æˆ·ç«¯å‘é€æ›´æ–°åå¯å˜æ•°æ®çš„åè®®ã€‚\n\n### å¤šä¸ªç›‘å¬åœ°å€æƒ…å†µå¤„ç†\n\næŸäº›å®¢æˆ·ç«¯å¯èƒ½ä¼šç›‘å¬å¤šä¸ªå…¬ç½‘å•æ’­ IP åœ°å€ï¼Œå¦‚æœåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å®¢æˆ·ç«¯ä»…ä½¿ç”¨ä¸€ä¸ªèŠ‚ç‚¹ IDï¼Œåˆ™å…¶ä»–èŠ‚ç‚¹å¯èƒ½ä¼šå› ä¸ºå¤šåœ°å€ç°è±¡è€Œå¯¹è¯¥èŠ‚ç‚¹ ID è¿›è¡Œæ¸…ç†ã€‚[BEP45 - Multiple-address operation for the BitTorrent DHT](http://bittorrent.org/beps/bep_0045.html) ä¸­ç»™å‡ºäº†ä¸€äº›è¦æ±‚å’Œå»ºè®®ï¼š\n\n- è¦æ±‚æ¯ä¸ªå¥—æ¥å­—åœ°å€å¿…é¡»å…·æœ‰ä¸åŒçš„èŠ‚ç‚¹ IDï¼Œä¸”å®ƒä»¬çš„ XOR è·ç¦»è¦åˆ†å¾—æ¯”è¾ƒå¼€ï¼Œå“åº”å¿…é¡»ä»æ”¶åˆ°ç›¸åº”è¯·æ±‚çš„åŒä¸€å¥—æ¥å­—åœ°å€å‘é€ï¼›\n- å»ºè®®èŠ‚ç‚¹åº”é¿å…åœ¨å•ä¸ªIPåœ°å€ä¸Šä½¿ç”¨å¤šä¸ªç«¯å£ï¼›\n\n### å…¶ä»–\n\nå’Œ DHT ç›¸å…³çš„è‰æ¡ˆè¿˜æœ‰å¦‚å¯¹ IPv6 çš„æ”¯æŒï¼ˆ[BEP32 - BitTorrent DHT Extensions for IPv6](http://bittorrent.org/beps/bep_0032.html)ï¼‰ï¼ŒDHT ç½‘ç»œå®‰å…¨ï¼ˆ[BEP42 - DHT Security extension](http://bittorrent.org/beps/bep_0042.html)ï¼‰ï¼Œæ£€ç´¢å…¶ä»–èŠ‚ç‚¹å­˜å‚¨çš„ infohash åˆ—è¡¨ï¼ˆ[BEP51 - DHT Infohash Indexing](http://bittorrent.org/beps/bep_0051.html)ï¼‰ç­‰ã€‚\n\n## å‚è€ƒèµ„æ–™\n\n1. [Î¼Torrent: What's the difference between the status \"Queued Seed\" and \"Seeding\"?](https://www.quora.com/%CE%BCTorrent-Whats-the-difference-between-the-status-Queued-Seed-and-Seeding)","source":"_posts/bt-dht.md","raw":"---\ntitle: BT å¢å¼ºå»ºè®®ä¹‹ DHT\ntags:\n  - BT\ndate: 2018-11-12T21:11+08:00\n---\n\nBitTorrent ä½¿ç”¨ DHT ç½‘è·¯æ¥å­˜å‚¨ peer ä¿¡æ¯ï¼Œä»¥å®ç°å» Tracker åŒ–çš„ç§å­ã€‚æ­¤æ—¶ï¼Œæ¯ä¸ª peer éƒ½æˆäº†ä¸€ä¸ª Trackerã€‚ç½‘ç»œåŸºäº Kademlia ç®—æ³•å®ç°ï¼Œä½¿ç”¨ UDP è¿›è¡Œä¼ è¾“ã€‚\n\næœ¬æ–‡ä¸»è¦å¯¹ BT ä¸­çš„ DHT ç½‘ç»œå®ç°ä¸åœ¨åšæ–‡ {% post_link dht-kademlia %} ä¸­æè¿°çš„ Kademlia ç®—æ³•çš„åŒºåˆ«è¿›è¡Œæ€»ç»“ã€‚å‡†ç¡®çš„è¯´ä¸èƒ½è¯´æ˜¯åŒºåˆ«ï¼Œè€Œåº”è¯¥å®šä¹‰æˆå®ç°ç»†èŠ‚ï¼Œæ¯•ç«Ÿç†è®ºç®—æ³•åº”ç”¨åˆ°å®é™…æ—¶æ€»éœ€è¦å› åœ°åˆ¶å®œã€‚\n\n## å®ç°ç»†èŠ‚ç‚¹\n\n### key-value å¯¹å­˜å‚¨çš„å†…å®¹\n\nBT ä½¿ç”¨ DHT ç½‘ç»œæ¥å®ç°å» Tracker åŒ–ï¼Œå› æ­¤ peer çš„ä¿¡æ¯å°±éœ€è¦å­˜å‚¨åœ¨ DHT ç½‘ç»œä¸­ï¼ŒBT ä¸­ peer åˆæ˜¯å±€é™åœ¨æŸä¸ª Torrent æ–‡ä»¶ä¸­çš„ã€‚å› æ­¤ key-value å¯¹ä¸­ key å³ Torrent æ–‡ä»¶çš„ infohashï¼Œæ­£å¥½ infohash ä¹Ÿæ˜¯ 160 æ¯”ç‰¹é•¿åº¦çš„ï¼Œvalue ä¸ºæ‹¥æœ‰è¯¥ infohash æ–‡ä»¶çš„ peer åˆ—è¡¨ã€‚\n\n### $K$ æ¡¶å®ç°ç»†èŠ‚\n\né¦–å…ˆ $K$ æ¡¶ä¸­çš„èŠ‚ç‚¹æœ‰å¤šç§çŠ¶æ€ï¼šå¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨ 15 åˆ†é’Ÿå†…å›å¤è¿‡å½“å‰çš„èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚æˆ–è€…æ›¾ç»å›å¤è¿‡å½“å‰èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚åŒæ—¶åœ¨ 15 åˆ†é’Ÿå†…æœ‰å‘é€è¿‡æŸ¥è¯¢è¯·æ±‚ç»™å½“å‰èŠ‚ç‚¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹ç›¸å¯¹äºå½“å‰èŠ‚ç‚¹ä¸º *Good èŠ‚ç‚¹*ï¼›å¦‚æœä¸€ä¸ªèŠ‚ç‚¹ 15 åˆ†é’Ÿå†…æœªæ›¾æ´»åŠ¨è¿‡ï¼Œåˆ™æˆä¸º *Questionable èŠ‚ç‚¹*ï¼›å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æœªç›¸åº”å½“å‰èŠ‚ç‚¹çš„å¤šæ¬¡æŸ¥è¯¢è¯·æ±‚ï¼Œåˆ™è§†ä¸º *Bad èŠ‚ç‚¹*ã€‚\n\nå½“ä¸€ä¸ªæ¡¶ä¸­èŠ‚ç‚¹æ•°é‡å·²æ»¡ï¼ˆ$K$ çš„å®¹é‡ $k$ åœ¨ BT ä¸­ä¸º 8ï¼‰ä¸”éƒ½æ˜¯ Good èŠ‚ç‚¹ï¼Œæ–°çš„èŠ‚ç‚¹å¦‚æœæƒ³è¦åŠ å…¥åˆ™ç›´æ¥è¢«å¿½ç•¥ã€‚å¦‚æœæ¡¶ä¸­æœ‰ Bad èŠ‚ç‚¹ï¼Œæ–°çš„èŠ‚ç‚¹å°†ä¼šæ›¿ä»£ä¹‹ã€‚å¦‚æœæ¡¶ä¸­æœ‰ Questionable èŠ‚ç‚¹ï¼Œåˆ™æŒ‰ç…§è¿™äº›èŠ‚ç‚¹åŠ å…¥æ¡¶çš„æ—¶é—´è¿›è¡Œ ping è¯·æ±‚ï¼Œå¦‚æœæœ‰èŠ‚ç‚¹ä¸èƒ½è¢« ping æˆåŠŸåˆ™æ–°çš„èŠ‚ç‚¹å°†ä¼šå–ä»£ä¹‹ã€‚\n\næ¯ä¸ªæ¡¶éƒ½ä¼šæœ‰ä¸€ä¸ª*æœ€è¿‘æ›´æ–°æ—¶é—´*æ ‡è®°æ¥æŒ‡ç¤ºæ¡¶ä¸­èŠ‚ç‚¹çš„æ–°é²œç¨‹åº¦ã€‚å¦‚æœä¸€ä¸ªæ¡¶ä¸­èŠ‚ç‚¹è¢« ping æˆåŠŸäº†ï¼Œæˆ–è€…æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œæˆ–è€…ä¸€ä¸ªèŠ‚ç‚¹è¢«å¦ä¸€ä¸ªæ›¿ä»£äº†ï¼Œè¿™ä¸ªæ—¶é—´ä¼šæ›´æ–°ã€‚å¦‚æœä¸€ä¸ªæ¡¶æœ€è¿‘æ›´æ–°æ—¶é—´å·²ç»è¿‡å» 15 åˆ†é’Ÿï¼Œåˆ™éœ€è¦è¿›è¡Œä¸€æ¬¡æ¡¶åˆ·æ–°ï¼Œæ–¹å¼å’Œ Kademlia ä¸­æè¿°çš„ä¸€è‡´ã€‚\n\n### Peer DHT æ”¯æŒä¸å¦å‘ŠçŸ¥\n\npeer é€šè¿‡åœ¨ handshake æ¡æ‰‹æ¶ˆæ¯ä¸­å°† reserved_byte çš„æœ€åä¸€æ¯”ç‰¹è®¾ç½®ä¸º 1 æ¥è¡¨ç¤ºæ”¯æŒ DHT ç½‘ç»œã€‚åŒæ ·æ”¯æŒ DHT ç½‘ç»œçš„èŠ‚ç‚¹æ”¶åˆ°è¯¥æ¡æ‰‹æ¶ˆæ¯åä¼šå‘èµ·ä¸€ä¸ª PORT æ¶ˆæ¯ï¼Œtype ä¸º 9ï¼Œè´Ÿè½½ä¸ºä¸¤ä¸ªå­—èŠ‚çš„ DHT èŠ‚ç‚¹ UDP ç«¯å£ã€‚æ”¶åˆ° PORT æ¶ˆæ¯çš„èŠ‚ç‚¹éœ€è¦å¯¹æ”¹èŠ‚ç‚¹ç«¯å£æ‰§è¡Œ ping æ“ä½œï¼Œå¦‚æœå¯¹æ–¹å“åº”äº†ï¼Œåˆ™èŠ‚ç‚¹éœ€è¦å°è¯•å°†å…¶åŠ å…¥åˆ° $K$ æ¡¶ä¸­ã€‚\n\n### åˆå§‹èŠ‚ç‚¹è·å–\n\nå» Tracker åŒ–çš„ Torrent æ–‡ä»¶ä¸­æ˜¯æ²¡æœ‰å­˜å‚¨ Tracker åœ°å€çš„ â€announceâ€œ é”®çš„ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ â€nodesâ€œ é”®ï¼Œnodes ä¸­éœ€è¦å­˜å‚¨è·ç¦» key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹åœ°å€æˆ–è€…å­˜å‚¨ä¸€ä¸ª *Good èŠ‚ç‚¹*ï¼Œæ¯”å¦‚è¯´äº§ç”Ÿè¿™ä¸ª Torrent çš„ç”¨æˆ·èŠ‚ç‚¹ã€‚ä¸èƒ½å°†æŸäº›å…¬å…±çš„èŠ‚ç‚¹åŠ å…¥åˆ° Torrent æ–‡ä»¶ä¸­ï¼Œå¦åˆ™å°±å˜å¾—ä¸é‚£ä¹ˆå» Tracker åŒ–äº†ã€‚nodes å¤§æ¦‚å¯ä»¥è¡¨ç¤ºä¸ºï¼š\n```\nnodes = [[\"<host>\", <port>], [\"<host>\", <port>], ...]\nnodes = [[\"127.0.0.1\", 6881], [\"your.router.node\", 4804]]\n```\n\n### RPC æ¶ˆæ¯\nBT ä½¿ç”¨ KRPC æ¥å®ç° Kademlia èŠ‚ç‚¹é—´çš„ RPC é€šä¿¡ï¼ŒKRPC æ¶ˆæ¯æœ‰ä¸‰ç§æ¶ˆæ¯ç±»å‹ï¼šæŸ¥è¯¢ï¼Œå“åº”ï¼Œé”™è¯¯ã€‚å¯¹äº DHT åè®®ï¼Œæœ‰å››ç§æŸ¥è¯¢åè®®ï¼špingï¼Œfind_nodeï¼Œget_peersï¼Œannounce_peerã€‚\n\n#### KRPC åè®®\n\nKRPC åè®®æ˜¯åŸºäº UDP å’Œ bencode ç¼–ç çš„ RPC åè®®ã€‚æ¯æ¡ KRPC æ¶ˆæ¯å¸¦æœ‰ä¸‰ä¸ªå…¬å…±é”®å€¼å¯¹ä»¥åŠå…¶ä»–å› æ¶ˆæ¯ç±»å‹è€Œå¼‚çš„é”®ã€‚ä¸‰ä¸ªå…¬å…±çš„é”®æ˜¯ï¼š\n- â€tâ€œï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨ transaction IDã€‚ç”±å‘èµ· query è¯·æ±‚çš„èŠ‚ç‚¹ç”Ÿæˆï¼Œè¢«è¯·æ±‚èŠ‚ç‚¹éœ€è¦åœ¨å›å¤ä¸­è¿”å›ã€‚ä¸€èˆ¬ä¸¤ä¸ªå­—èŠ‚ï¼›\n- â€yâ€œï¼šå€¼ä¸ºå•å­—ç¬¦ï¼Œä»£è¡¨æ¶ˆæ¯ç±»å‹ï¼Œæ˜¯ q(query)ã€r(response)ã€e(error) ä¸­çš„ä¸€ä¸ªï¼›\n- \"v\"ï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨å®¢æˆ·ç«¯ç‰ˆæœ¬ [BEP 20](http://www.bittorrent.org/beps/bep_0020.html) ä¸­å®šä¹‰ï¼Œä¸ä¸€å®šå­˜åœ¨è¿™ä¸ªé”®ï¼›\n\næ¯ç§æ¶ˆæ¯ä¼šæœ‰è‡ªå·±é¢å¤–çš„é”®ï¼š\n##### Query æ¶ˆæ¯\n\n- â€qâ€œï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨å…·ä½“çš„æ–¹æ³•ç±»å‹ï¼›\n- â€aâ€œï¼šå€¼ä¸ºå­—å…¸ï¼Œä»£è¡¨å…·ä½“æ–¹æ³•å¯¹åº”çš„å‚æ•°å­—å…¸ï¼›\n\n##### Response æ¶ˆæ¯\n\nå¦‚æœ Query æ¶ˆæ¯æ‰§è¡ŒæˆåŠŸï¼Œåˆ™ä¼šè¿”å›è¯¥ Response æ¶ˆæ¯ã€‚\n\n- â€râ€œï¼šå€¼ä¸ºå­—å…¸ï¼Œä»£è¡¨è¿”å›å€¼å­—å…¸ï¼›\n\n##### Error æ¶ˆæ¯\n\nå¦‚æœ Query æ¶ˆæ¯æ‰§è¡Œå¤±è´¥ï¼Œåˆ™ä¼šè¿”å›è¯¥ Error æ¶ˆæ¯ã€‚\n\n- â€eâ€œï¼šå€¼ä¸ºåˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä»£è¡¨é”™è¯¯ç ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯é”™è¯¯æ¶ˆæ¯ï¼›\n\né”™è¯¯æ¶ˆæ¯ç±»å‹å¦‚ä¸‹ï¼š\n\n| Code | Description                                                  |\n| ---- | ------------------------------------------------------------ |\n| 201  | Generic Error                                                |\n| 202  | Server Error                                                 |\n| 203  | Protocol Error, such as a malformed packet, invalid arguments, or bad token |\n| 204  | Method Unknown                                               |\n\nç¤ºä¾‹é”™è¯¯æ¶ˆæ¯ï¼š\n```\ngeneric error = {\"t\":\"aa\", \"y\":\"e\", \"e\":[201, \"A Generic Error Ocurred\"]}\nbencoded = d1:eli201e23:A Generic Error Ocurrede1:t2:aa1:y1:ee\n```\n\n#### DHT Query æ¶ˆæ¯\n\n##### ping\nç”¨äºæ£€æµ‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å·¥ä½œï¼Œç›¸å½“äº Kademlia çš„ PING è°ƒç”¨ã€‚\n```\narguments:  {\"id\" : \"<querying nodes id>\"}\n\nresponse: {\"id\" : \"<queried nodes id>\"}\n```\n\n##### find_node\n\næŸ¥æ‰¾è·ç¦»æŒ‡å®šèŠ‚ç‚¹ ID æœ€è¿‘çš„èŠ‚ç‚¹ ID ä¿¡æ¯ï¼Œç›¸å½“äº Kademlia çš„ FIND_NODE è°ƒç”¨ã€‚\n```\narguments:  {\"id\" : \"<querying nodes id>\", \"target\" : \"<id of target node>\"}\n\nresponse: {\"id\" : \"<queried nodes id>\", \"nodes\" : \"<compact node info>\"}\n```\n\"Compact node info\" åˆ—è¡¨ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¿¡æ¯å ç”¨ 26 å­—èŠ‚ï¼Œå…¶ä¸­èŠ‚ç‚¹ ID 20 å­—èŠ‚ï¼ŒIP ä¸ Port å ç”¨ 6 å­—èŠ‚ã€‚\n\n##### get_peers\n\næŸ¥æ‰¾ä¸æŒ‡å®š info_hash ç›¸å…³çš„ peer ä¿¡æ¯ï¼Œç›¸å½“äº Kademlia çš„ FIND_VALUE è°ƒç”¨ã€‚\n\n```\narguments:  {\"id\" : \"<querying nodes id>\", \"info_hash\" : \"<20-byte infohash of target torrent>\"}\n\nresponse: {\"id\" : \"<queried nodes id>\", \"token\" :\"<opaque write token>\", \"values\" : [\"<peer 1 info string>\", \"<peer 2 info string>\"]}\n\nor: {\"id\" : \"<queried nodes id>\", \"token\" :\"<opaque write token>\", \"nodes\" : \"<compact node info>\"}\n```\n\nå¦‚æœè¢«è¯·æ±‚èŠ‚ç‚¹æœ‰æŒ‡å®š info_hash ç›¸å…³ peers åˆ™ä»¥ values ä¸ºé”®çš„ \"Compact IP-address/port info\" åˆ—è¡¨ï¼Œå¦åˆ™ï¼Œè¿”å›ä»¥ nodes ä¸ºé”®çš„ \"Compact node info\" åˆ—è¡¨ã€‚å“åº”ä¸­çš„ token éœ€è¦è¯·æ±‚è€…åœ¨é€šè¿‡ announce_peer å‘å›å¤è€…å®£å‘Š peer ä¿¡æ¯æ—¶æºå¸¦ã€‚\n\n##### announce_peer\n\nå®£å‘ŠèŠ‚ç‚¹è‡ªèº«æ‹¥æœ‰ç‰¹å®š info_hash çš„æ•°æ®ï¼Œå¹¶åœ¨æŸä¸ªç«¯å£è¿›è¡Œä¸‹è½½ï¼Œç›¸å½“äº Kademlia çš„ STORE è°ƒç”¨ã€‚\n\n```\narguments:  {\"id\" : \"<querying nodes id>\",\n  \"implied_port\": <0 or 1>,\n  \"info_hash\" : \"<20-byte infohash of target torrent>\",\n  \"port\" : <port number>,\n  \"token\" : \"<opaque token>\"}\n\nresponse: {\"id\" : \"<queried nodes id>\"}\n```\n\næ¥å—è€…éœ€è¦æ ¡éªŒ token æ˜¯å¦ä¸ä¹‹å‰å®ƒé€šè¿‡ get_peers è°ƒç”¨çš„å“åº”å›å¤ç»™è¯¥è¯·æ±‚è€…çš„ä¸€è‡´ã€‚å¦‚æœ implied_port å€¼ä¸º 1ï¼Œè¡¨ç¤º port çš„å€¼ä¸å¯ç”¨ï¼Œæ¥å—è€…éœ€è¦å°†è¯·æ±‚åŒ…çš„ UDP æºç«¯å£ä½œä¸º portã€‚\n\n## BT DHT ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\n\n### DHT Scrape å¸®åŠ©é€‰æ‹© Seeding å†…å®¹\n\nç±»ä¼¼ [Tracker Scrape](http://bittorrent.org/beps/bep_0048.html)ï¼ŒDHT ç½‘ç»œå¯ä»¥é€šè¿‡ [BEP33 - DHT Scrapes](http://bittorrent.org/beps/bep_0033.html) ä¸­å®šä¹‰çš„ DHT scrape æ¥äº†è§£æŸä¸ª Swarm ä¸­ peer çš„å¤§è‡´æƒ…å†µï¼Œç„¶åæ ¹æ®è¿™ä¸ªçŠ¶æ€é€‰æ‹© seeding é˜Ÿåˆ—ä¸­ä¸‹ä¸€ä¸ª Swarm è¿›è¡Œåšç§ã€‚è¿™ç§ç®—æ³•ä¸»è¦é€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰å®ç°ï¼Œå¸ƒéš†è¿‡æ»¤å™¨é€šå¸¸ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚ä½†åœ¨ DHT scrape ä¸­ï¼Œä½œç”¨æ‰€æœ‰ä¸åŒã€‚åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ˜¯å„ä¸ª peer çš„ IP çš„ sha1 å€¼ï¼Œå¯ä»¥æ ¹æ®è¿‡æ»¤å™¨ä¸­å‰©ä½™çš„ 0 æ¯”ç‰¹æ•°é‡æ¥ä¼°ç®—æ•´ä¸ª Swarm çš„è§„æ¨¡ã€‚\n\n### åªè¯» DHT èŠ‚ç‚¹\n\nåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒDHT èŠ‚ç‚¹ä¸»åŠ¨æˆ–è¢«åŠ¨åœ°é™åˆ¶æˆä¸ºåªè¯»èŠ‚ç‚¹ï¼ˆ[BEP43 - Read-only DHT Nodes](http://bittorrent.org/beps/bep_0043.html) ä¸­å®šä¹‰ï¼‰ï¼Œæ¯”å¦‚ä½äº NAT åä¸” hole punching å¤±è´¥çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å…·æœ‰æµé‡é™åˆ¶æˆ–è€…æœ‰æµé‡è®¡åˆ’ï¼Œæµé‡ä¼šå½±å“èŠ‚ç‚¹çš„ç”µé‡ç­‰ç­‰æƒ…å†µã€‚\n\nèŠ‚ç‚¹é€šè¿‡åœ¨æ¯æ¡å‘å¤–å‘é€çš„ DHT Query æ¶ˆæ¯ä¸­ç»™å‡ºä¸€ä¸ª `ro=1` çš„é”®å€¼å¯¹æ¥è¡¨æ˜è‡ªå·±ä¸ºåªè¯»èŠ‚ç‚¹ã€‚æˆä¸ºåªè¯»èŠ‚ç‚¹åï¼Œä¸å†å“åº”å…¶ä»–èŠ‚ç‚¹çš„ Query è¯·æ±‚ã€‚å…¶ä»–èŠ‚ç‚¹çŸ¥æ™“åªè¯»èŠ‚ç‚¹åä¹Ÿä¸ä¼šå‘é€ Query è¯·æ±‚ä»¥å‡å°‘ç½‘ç»œæµé‡ã€‚\n\n### åœ¨ DHT ä¸­å­˜å‚¨ä»»æ„æ•°æ®\n\n[BEP44 - Storing arbitrary data in the DHT](http://bittorrent.org/beps/bep_0044.html) ä¸­æä¾›äº†ä¸€ç§åœ¨ DHT ä¸­å­˜å‚¨ä»»æ„æ•°æ®çš„æ–¹å¼ã€‚å­˜å‚¨çš„æ•°æ®å¯ä»¥æ˜¯ä¸å¯å˜æ•°æ®ä¹Ÿå¯ä»¥æ˜¯å¯å˜æ•°æ®ï¼Œä¸å¯å˜æ•°æ®çš„ key æ˜¯æ•°æ®å†…å®¹çš„ sha1 å€¼ï¼Œå¯å˜æ•°æ®çš„ key æ˜¯ç”¨äºç­¾åæ•°æ®çš„å¯†é’¥å¯¹å…¬é’¥ã€‚[BEP46 - Updating Torrents Via DHT Mutable Items](http://bittorrent.org/beps/bep_0046.html) åˆ™åŸºäºåœ¨ DHT ç½‘ç»œä¸­å­˜å‚¨å¯å˜æ•°æ®è€Œç»™å‡ºäº†ä¸€ç§ç”¨äºæ›´æ–° Torrent çš„æ–¹æ³•ã€‚[BEP50 - Publish/Subscribe Protocol](http://bittorrent.org/beps/bep_0050.html) å®ç°äº†ä¸€ç§åŸºäºä¸»é¢˜çš„å‘å¸ƒè®¢é˜…æ¨¡å¼æ¥å‘è®¢é˜…ç‰¹å®šä¸»é¢˜çš„å®¢æˆ·ç«¯å‘é€æ›´æ–°åå¯å˜æ•°æ®çš„åè®®ã€‚\n\n### å¤šä¸ªç›‘å¬åœ°å€æƒ…å†µå¤„ç†\n\næŸäº›å®¢æˆ·ç«¯å¯èƒ½ä¼šç›‘å¬å¤šä¸ªå…¬ç½‘å•æ’­ IP åœ°å€ï¼Œå¦‚æœåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å®¢æˆ·ç«¯ä»…ä½¿ç”¨ä¸€ä¸ªèŠ‚ç‚¹ IDï¼Œåˆ™å…¶ä»–èŠ‚ç‚¹å¯èƒ½ä¼šå› ä¸ºå¤šåœ°å€ç°è±¡è€Œå¯¹è¯¥èŠ‚ç‚¹ ID è¿›è¡Œæ¸…ç†ã€‚[BEP45 - Multiple-address operation for the BitTorrent DHT](http://bittorrent.org/beps/bep_0045.html) ä¸­ç»™å‡ºäº†ä¸€äº›è¦æ±‚å’Œå»ºè®®ï¼š\n\n- è¦æ±‚æ¯ä¸ªå¥—æ¥å­—åœ°å€å¿…é¡»å…·æœ‰ä¸åŒçš„èŠ‚ç‚¹ IDï¼Œä¸”å®ƒä»¬çš„ XOR è·ç¦»è¦åˆ†å¾—æ¯”è¾ƒå¼€ï¼Œå“åº”å¿…é¡»ä»æ”¶åˆ°ç›¸åº”è¯·æ±‚çš„åŒä¸€å¥—æ¥å­—åœ°å€å‘é€ï¼›\n- å»ºè®®èŠ‚ç‚¹åº”é¿å…åœ¨å•ä¸ªIPåœ°å€ä¸Šä½¿ç”¨å¤šä¸ªç«¯å£ï¼›\n\n### å…¶ä»–\n\nå’Œ DHT ç›¸å…³çš„è‰æ¡ˆè¿˜æœ‰å¦‚å¯¹ IPv6 çš„æ”¯æŒï¼ˆ[BEP32 - BitTorrent DHT Extensions for IPv6](http://bittorrent.org/beps/bep_0032.html)ï¼‰ï¼ŒDHT ç½‘ç»œå®‰å…¨ï¼ˆ[BEP42 - DHT Security extension](http://bittorrent.org/beps/bep_0042.html)ï¼‰ï¼Œæ£€ç´¢å…¶ä»–èŠ‚ç‚¹å­˜å‚¨çš„ infohash åˆ—è¡¨ï¼ˆ[BEP51 - DHT Infohash Indexing](http://bittorrent.org/beps/bep_0051.html)ï¼‰ç­‰ã€‚\n\n## å‚è€ƒèµ„æ–™\n\n1. [Î¼Torrent: What's the difference between the status \"Queued Seed\" and \"Seeding\"?](https://www.quora.com/%CE%BCTorrent-Whats-the-difference-between-the-status-Queued-Seed-and-Seeding)","slug":"bt-dht","published":1,"updated":"2020-07-18T06:30:19.513Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuh60001w80vleuabny5","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>BitTorrent ä½¿ç”¨ DHT ç½‘è·¯æ¥å­˜å‚¨ peer ä¿¡æ¯ï¼Œä»¥å®ç°å» Tracker åŒ–çš„ç§å­ã€‚æ­¤æ—¶ï¼Œæ¯ä¸ª peer éƒ½æˆäº†ä¸€ä¸ª Trackerã€‚ç½‘ç»œåŸºäº Kademlia ç®—æ³•å®ç°ï¼Œä½¿ç”¨ UDP è¿›è¡Œä¼ è¾“ã€‚</p>\n<p>æœ¬æ–‡ä¸»è¦å¯¹ BT ä¸­çš„ DHT ç½‘ç»œå®ç°ä¸åœ¨åšæ–‡ <a href=\"/2018/11/08/dht-kademlia/\" title=\"DHT ç½‘ç»œä¹‹ Kademlia ç®—æ³•\">DHT ç½‘ç»œä¹‹ Kademlia ç®—æ³•</a> ä¸­æè¿°çš„ Kademlia ç®—æ³•çš„åŒºåˆ«è¿›è¡Œæ€»ç»“ã€‚å‡†ç¡®çš„è¯´ä¸èƒ½è¯´æ˜¯åŒºåˆ«ï¼Œè€Œåº”è¯¥å®šä¹‰æˆå®ç°ç»†èŠ‚ï¼Œæ¯•ç«Ÿç†è®ºç®—æ³•åº”ç”¨åˆ°å®é™…æ—¶æ€»éœ€è¦å› åœ°åˆ¶å®œã€‚</p>\n<h2 id=\"å®ç°ç»†èŠ‚ç‚¹\"><a href=\"#å®ç°ç»†èŠ‚ç‚¹\" class=\"headerlink\" title=\"å®ç°ç»†èŠ‚ç‚¹\"></a>å®ç°ç»†èŠ‚ç‚¹</h2><h3 id=\"key-value-å¯¹å­˜å‚¨çš„å†…å®¹\"><a href=\"#key-value-å¯¹å­˜å‚¨çš„å†…å®¹\" class=\"headerlink\" title=\"key-value å¯¹å­˜å‚¨çš„å†…å®¹\"></a>key-value å¯¹å­˜å‚¨çš„å†…å®¹</h3><p>BT ä½¿ç”¨ DHT ç½‘ç»œæ¥å®ç°å» Tracker åŒ–ï¼Œå› æ­¤ peer çš„ä¿¡æ¯å°±éœ€è¦å­˜å‚¨åœ¨ DHT ç½‘ç»œä¸­ï¼ŒBT ä¸­ peer åˆæ˜¯å±€é™åœ¨æŸä¸ª Torrent æ–‡ä»¶ä¸­çš„ã€‚å› æ­¤ key-value å¯¹ä¸­ key å³ Torrent æ–‡ä»¶çš„ infohashï¼Œæ­£å¥½ infohash ä¹Ÿæ˜¯ 160 æ¯”ç‰¹é•¿åº¦çš„ï¼Œvalue ä¸ºæ‹¥æœ‰è¯¥ infohash æ–‡ä»¶çš„ peer åˆ—è¡¨ã€‚</p>\n<h3 id=\"K-æ¡¶å®ç°ç»†èŠ‚\"><a href=\"#K-æ¡¶å®ç°ç»†èŠ‚\" class=\"headerlink\" title=\"$K$ æ¡¶å®ç°ç»†èŠ‚\"></a>$K$ æ¡¶å®ç°ç»†èŠ‚</h3><p>é¦–å…ˆ $K$ æ¡¶ä¸­çš„èŠ‚ç‚¹æœ‰å¤šç§çŠ¶æ€ï¼šå¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨ 15 åˆ†é’Ÿå†…å›å¤è¿‡å½“å‰çš„èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚æˆ–è€…æ›¾ç»å›å¤è¿‡å½“å‰èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚åŒæ—¶åœ¨ 15 åˆ†é’Ÿå†…æœ‰å‘é€è¿‡æŸ¥è¯¢è¯·æ±‚ç»™å½“å‰èŠ‚ç‚¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹ç›¸å¯¹äºå½“å‰èŠ‚ç‚¹ä¸º <em>Good èŠ‚ç‚¹</em>ï¼›å¦‚æœä¸€ä¸ªèŠ‚ç‚¹ 15 åˆ†é’Ÿå†…æœªæ›¾æ´»åŠ¨è¿‡ï¼Œåˆ™æˆä¸º <em>Questionable èŠ‚ç‚¹</em>ï¼›å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æœªç›¸åº”å½“å‰èŠ‚ç‚¹çš„å¤šæ¬¡æŸ¥è¯¢è¯·æ±‚ï¼Œåˆ™è§†ä¸º <em>Bad èŠ‚ç‚¹</em>ã€‚</p>\n<p>å½“ä¸€ä¸ªæ¡¶ä¸­èŠ‚ç‚¹æ•°é‡å·²æ»¡ï¼ˆ$K$ çš„å®¹é‡ $k$ åœ¨ BT ä¸­ä¸º 8ï¼‰ä¸”éƒ½æ˜¯ Good èŠ‚ç‚¹ï¼Œæ–°çš„èŠ‚ç‚¹å¦‚æœæƒ³è¦åŠ å…¥åˆ™ç›´æ¥è¢«å¿½ç•¥ã€‚å¦‚æœæ¡¶ä¸­æœ‰ Bad èŠ‚ç‚¹ï¼Œæ–°çš„èŠ‚ç‚¹å°†ä¼šæ›¿ä»£ä¹‹ã€‚å¦‚æœæ¡¶ä¸­æœ‰ Questionable èŠ‚ç‚¹ï¼Œåˆ™æŒ‰ç…§è¿™äº›èŠ‚ç‚¹åŠ å…¥æ¡¶çš„æ—¶é—´è¿›è¡Œ ping è¯·æ±‚ï¼Œå¦‚æœæœ‰èŠ‚ç‚¹ä¸èƒ½è¢« ping æˆåŠŸåˆ™æ–°çš„èŠ‚ç‚¹å°†ä¼šå–ä»£ä¹‹ã€‚</p>\n<p>æ¯ä¸ªæ¡¶éƒ½ä¼šæœ‰ä¸€ä¸ª<em>æœ€è¿‘æ›´æ–°æ—¶é—´</em>æ ‡è®°æ¥æŒ‡ç¤ºæ¡¶ä¸­èŠ‚ç‚¹çš„æ–°é²œç¨‹åº¦ã€‚å¦‚æœä¸€ä¸ªæ¡¶ä¸­èŠ‚ç‚¹è¢« ping æˆåŠŸäº†ï¼Œæˆ–è€…æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œæˆ–è€…ä¸€ä¸ªèŠ‚ç‚¹è¢«å¦ä¸€ä¸ªæ›¿ä»£äº†ï¼Œè¿™ä¸ªæ—¶é—´ä¼šæ›´æ–°ã€‚å¦‚æœä¸€ä¸ªæ¡¶æœ€è¿‘æ›´æ–°æ—¶é—´å·²ç»è¿‡å» 15 åˆ†é’Ÿï¼Œåˆ™éœ€è¦è¿›è¡Œä¸€æ¬¡æ¡¶åˆ·æ–°ï¼Œæ–¹å¼å’Œ Kademlia ä¸­æè¿°çš„ä¸€è‡´ã€‚</p>\n<h3 id=\"Peer-DHT-æ”¯æŒä¸å¦å‘ŠçŸ¥\"><a href=\"#Peer-DHT-æ”¯æŒä¸å¦å‘ŠçŸ¥\" class=\"headerlink\" title=\"Peer DHT æ”¯æŒä¸å¦å‘ŠçŸ¥\"></a>Peer DHT æ”¯æŒä¸å¦å‘ŠçŸ¥</h3><p>peer é€šè¿‡åœ¨ handshake æ¡æ‰‹æ¶ˆæ¯ä¸­å°† reserved_byte çš„æœ€åä¸€æ¯”ç‰¹è®¾ç½®ä¸º 1 æ¥è¡¨ç¤ºæ”¯æŒ DHT ç½‘ç»œã€‚åŒæ ·æ”¯æŒ DHT ç½‘ç»œçš„èŠ‚ç‚¹æ”¶åˆ°è¯¥æ¡æ‰‹æ¶ˆæ¯åä¼šå‘èµ·ä¸€ä¸ª PORT æ¶ˆæ¯ï¼Œtype ä¸º 9ï¼Œè´Ÿè½½ä¸ºä¸¤ä¸ªå­—èŠ‚çš„ DHT èŠ‚ç‚¹ UDP ç«¯å£ã€‚æ”¶åˆ° PORT æ¶ˆæ¯çš„èŠ‚ç‚¹éœ€è¦å¯¹æ”¹èŠ‚ç‚¹ç«¯å£æ‰§è¡Œ ping æ“ä½œï¼Œå¦‚æœå¯¹æ–¹å“åº”äº†ï¼Œåˆ™èŠ‚ç‚¹éœ€è¦å°è¯•å°†å…¶åŠ å…¥åˆ° $K$ æ¡¶ä¸­ã€‚</p>\n<h3 id=\"åˆå§‹èŠ‚ç‚¹è·å–\"><a href=\"#åˆå§‹èŠ‚ç‚¹è·å–\" class=\"headerlink\" title=\"åˆå§‹èŠ‚ç‚¹è·å–\"></a>åˆå§‹èŠ‚ç‚¹è·å–</h3><p>å» Tracker åŒ–çš„ Torrent æ–‡ä»¶ä¸­æ˜¯æ²¡æœ‰å­˜å‚¨ Tracker åœ°å€çš„ â€announceâ€œ é”®çš„ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ â€nodesâ€œ é”®ï¼Œnodes ä¸­éœ€è¦å­˜å‚¨è·ç¦» key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹åœ°å€æˆ–è€…å­˜å‚¨ä¸€ä¸ª <em>Good èŠ‚ç‚¹</em>ï¼Œæ¯”å¦‚è¯´äº§ç”Ÿè¿™ä¸ª Torrent çš„ç”¨æˆ·èŠ‚ç‚¹ã€‚ä¸èƒ½å°†æŸäº›å…¬å…±çš„èŠ‚ç‚¹åŠ å…¥åˆ° Torrent æ–‡ä»¶ä¸­ï¼Œå¦åˆ™å°±å˜å¾—ä¸é‚£ä¹ˆå» Tracker åŒ–äº†ã€‚nodes å¤§æ¦‚å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nodes = [[&quot;&lt;host&gt;&quot;, &lt;port&gt;], [&quot;&lt;host&gt;&quot;, &lt;port&gt;], ...]</span><br><span class=\"line\">nodes = [[&quot;127.0.0.1&quot;, 6881], [&quot;your.router.node&quot;, 4804]]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"RPC-æ¶ˆæ¯\"><a href=\"#RPC-æ¶ˆæ¯\" class=\"headerlink\" title=\"RPC æ¶ˆæ¯\"></a>RPC æ¶ˆæ¯</h3><p>BT ä½¿ç”¨ KRPC æ¥å®ç° Kademlia èŠ‚ç‚¹é—´çš„ RPC é€šä¿¡ï¼ŒKRPC æ¶ˆæ¯æœ‰ä¸‰ç§æ¶ˆæ¯ç±»å‹ï¼šæŸ¥è¯¢ï¼Œå“åº”ï¼Œé”™è¯¯ã€‚å¯¹äº DHT åè®®ï¼Œæœ‰å››ç§æŸ¥è¯¢åè®®ï¼špingï¼Œfind_nodeï¼Œget_peersï¼Œannounce_peerã€‚</p>\n<h4 id=\"KRPC-åè®®\"><a href=\"#KRPC-åè®®\" class=\"headerlink\" title=\"KRPC åè®®\"></a>KRPC åè®®</h4><p>KRPC åè®®æ˜¯åŸºäº UDP å’Œ bencode ç¼–ç çš„ RPC åè®®ã€‚æ¯æ¡ KRPC æ¶ˆæ¯å¸¦æœ‰ä¸‰ä¸ªå…¬å…±é”®å€¼å¯¹ä»¥åŠå…¶ä»–å› æ¶ˆæ¯ç±»å‹è€Œå¼‚çš„é”®ã€‚ä¸‰ä¸ªå…¬å…±çš„é”®æ˜¯ï¼š</p>\n<ul>\n<li>â€tâ€œï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨ transaction IDã€‚ç”±å‘èµ· query è¯·æ±‚çš„èŠ‚ç‚¹ç”Ÿæˆï¼Œè¢«è¯·æ±‚èŠ‚ç‚¹éœ€è¦åœ¨å›å¤ä¸­è¿”å›ã€‚ä¸€èˆ¬ä¸¤ä¸ªå­—èŠ‚ï¼›</li>\n<li>â€yâ€œï¼šå€¼ä¸ºå•å­—ç¬¦ï¼Œä»£è¡¨æ¶ˆæ¯ç±»å‹ï¼Œæ˜¯ q(query)ã€r(response)ã€e(error) ä¸­çš„ä¸€ä¸ªï¼›</li>\n<li>â€œvâ€ï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨å®¢æˆ·ç«¯ç‰ˆæœ¬ <a href=\"http://www.bittorrent.org/beps/bep_0020.html\" target=\"_blank\" rel=\"noopener\">BEP 20</a> ä¸­å®šä¹‰ï¼Œä¸ä¸€å®šå­˜åœ¨è¿™ä¸ªé”®ï¼›</li>\n</ul>\n<p>æ¯ç§æ¶ˆæ¯ä¼šæœ‰è‡ªå·±é¢å¤–çš„é”®ï¼š</p>\n<h5 id=\"Query-æ¶ˆæ¯\"><a href=\"#Query-æ¶ˆæ¯\" class=\"headerlink\" title=\"Query æ¶ˆæ¯\"></a>Query æ¶ˆæ¯</h5><ul>\n<li>â€qâ€œï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨å…·ä½“çš„æ–¹æ³•ç±»å‹ï¼›</li>\n<li>â€aâ€œï¼šå€¼ä¸ºå­—å…¸ï¼Œä»£è¡¨å…·ä½“æ–¹æ³•å¯¹åº”çš„å‚æ•°å­—å…¸ï¼›</li>\n</ul>\n<h5 id=\"Response-æ¶ˆæ¯\"><a href=\"#Response-æ¶ˆæ¯\" class=\"headerlink\" title=\"Response æ¶ˆæ¯\"></a>Response æ¶ˆæ¯</h5><p>å¦‚æœ Query æ¶ˆæ¯æ‰§è¡ŒæˆåŠŸï¼Œåˆ™ä¼šè¿”å›è¯¥ Response æ¶ˆæ¯ã€‚</p>\n<ul>\n<li>â€râ€œï¼šå€¼ä¸ºå­—å…¸ï¼Œä»£è¡¨è¿”å›å€¼å­—å…¸ï¼›</li>\n</ul>\n<h5 id=\"Error-æ¶ˆæ¯\"><a href=\"#Error-æ¶ˆæ¯\" class=\"headerlink\" title=\"Error æ¶ˆæ¯\"></a>Error æ¶ˆæ¯</h5><p>å¦‚æœ Query æ¶ˆæ¯æ‰§è¡Œå¤±è´¥ï¼Œåˆ™ä¼šè¿”å›è¯¥ Error æ¶ˆæ¯ã€‚</p>\n<ul>\n<li>â€eâ€œï¼šå€¼ä¸ºåˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä»£è¡¨é”™è¯¯ç ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯é”™è¯¯æ¶ˆæ¯ï¼›</li>\n</ul>\n<p>é”™è¯¯æ¶ˆæ¯ç±»å‹å¦‚ä¸‹ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>Code</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>201</td>\n<td>Generic Error</td>\n</tr>\n<tr>\n<td>202</td>\n<td>Server Error</td>\n</tr>\n<tr>\n<td>203</td>\n<td>Protocol Error, such as a malformed packet, invalid arguments, or bad token</td>\n</tr>\n<tr>\n<td>204</td>\n<td>Method Unknown</td>\n</tr>\n</tbody></table>\n<p>ç¤ºä¾‹é”™è¯¯æ¶ˆæ¯ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">generic error = &#123;&quot;t&quot;:&quot;aa&quot;, &quot;y&quot;:&quot;e&quot;, &quot;e&quot;:[201, &quot;A Generic Error Ocurred&quot;]&#125;</span><br><span class=\"line\">bencoded = d1:eli201e23:A Generic Error Ocurrede1:t2:aa1:y1:ee</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"DHT-Query-æ¶ˆæ¯\"><a href=\"#DHT-Query-æ¶ˆæ¯\" class=\"headerlink\" title=\"DHT Query æ¶ˆæ¯\"></a>DHT Query æ¶ˆæ¯</h4><h5 id=\"ping\"><a href=\"#ping\" class=\"headerlink\" title=\"ping\"></a>ping</h5><p>ç”¨äºæ£€æµ‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å·¥ä½œï¼Œç›¸å½“äº Kademlia çš„ PING è°ƒç”¨ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arguments:  &#123;&quot;id&quot; : &quot;&lt;querying nodes id&gt;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">response: &#123;&quot;id&quot; : &quot;&lt;queried nodes id&gt;&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"find-node\"><a href=\"#find-node\" class=\"headerlink\" title=\"find_node\"></a>find_node</h5><p>æŸ¥æ‰¾è·ç¦»æŒ‡å®šèŠ‚ç‚¹ ID æœ€è¿‘çš„èŠ‚ç‚¹ ID ä¿¡æ¯ï¼Œç›¸å½“äº Kademlia çš„ FIND_NODE è°ƒç”¨ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arguments:  &#123;&quot;id&quot; : &quot;&lt;querying nodes id&gt;&quot;, &quot;target&quot; : &quot;&lt;id of target node&gt;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">response: &#123;&quot;id&quot; : &quot;&lt;queried nodes id&gt;&quot;, &quot;nodes&quot; : &quot;&lt;compact node info&gt;&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>â€œCompact node infoâ€ åˆ—è¡¨ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¿¡æ¯å ç”¨ 26 å­—èŠ‚ï¼Œå…¶ä¸­èŠ‚ç‚¹ ID 20 å­—èŠ‚ï¼ŒIP ä¸ Port å ç”¨ 6 å­—èŠ‚ã€‚</p>\n<h5 id=\"get-peers\"><a href=\"#get-peers\" class=\"headerlink\" title=\"get_peers\"></a>get_peers</h5><p>æŸ¥æ‰¾ä¸æŒ‡å®š info_hash ç›¸å…³çš„ peer ä¿¡æ¯ï¼Œç›¸å½“äº Kademlia çš„ FIND_VALUE è°ƒç”¨ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arguments:  &#123;&quot;id&quot; : &quot;&lt;querying nodes id&gt;&quot;, &quot;info_hash&quot; : &quot;&lt;20-byte infohash of target torrent&gt;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">response: &#123;&quot;id&quot; : &quot;&lt;queried nodes id&gt;&quot;, &quot;token&quot; :&quot;&lt;opaque write token&gt;&quot;, &quot;values&quot; : [&quot;&lt;peer 1 info string&gt;&quot;, &quot;&lt;peer 2 info string&gt;&quot;]&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">or: &#123;&quot;id&quot; : &quot;&lt;queried nodes id&gt;&quot;, &quot;token&quot; :&quot;&lt;opaque write token&gt;&quot;, &quot;nodes&quot; : &quot;&lt;compact node info&gt;&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¦‚æœè¢«è¯·æ±‚èŠ‚ç‚¹æœ‰æŒ‡å®š info_hash ç›¸å…³ peers åˆ™ä»¥ values ä¸ºé”®çš„ â€œCompact IP-address/port infoâ€ åˆ—è¡¨ï¼Œå¦åˆ™ï¼Œè¿”å›ä»¥ nodes ä¸ºé”®çš„ â€œCompact node infoâ€ åˆ—è¡¨ã€‚å“åº”ä¸­çš„ token éœ€è¦è¯·æ±‚è€…åœ¨é€šè¿‡ announce_peer å‘å›å¤è€…å®£å‘Š peer ä¿¡æ¯æ—¶æºå¸¦ã€‚</p>\n<h5 id=\"announce-peer\"><a href=\"#announce-peer\" class=\"headerlink\" title=\"announce_peer\"></a>announce_peer</h5><p>å®£å‘ŠèŠ‚ç‚¹è‡ªèº«æ‹¥æœ‰ç‰¹å®š info_hash çš„æ•°æ®ï¼Œå¹¶åœ¨æŸä¸ªç«¯å£è¿›è¡Œä¸‹è½½ï¼Œç›¸å½“äº Kademlia çš„ STORE è°ƒç”¨ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arguments:  &#123;&quot;id&quot; : &quot;&lt;querying nodes id&gt;&quot;,</span><br><span class=\"line\">  &quot;implied_port&quot;: &lt;0 or 1&gt;,</span><br><span class=\"line\">  &quot;info_hash&quot; : &quot;&lt;20-byte infohash of target torrent&gt;&quot;,</span><br><span class=\"line\">  &quot;port&quot; : &lt;port number&gt;,</span><br><span class=\"line\">  &quot;token&quot; : &quot;&lt;opaque token&gt;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">response: &#123;&quot;id&quot; : &quot;&lt;queried nodes id&gt;&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ¥å—è€…éœ€è¦æ ¡éªŒ token æ˜¯å¦ä¸ä¹‹å‰å®ƒé€šè¿‡ get_peers è°ƒç”¨çš„å“åº”å›å¤ç»™è¯¥è¯·æ±‚è€…çš„ä¸€è‡´ã€‚å¦‚æœ implied_port å€¼ä¸º 1ï¼Œè¡¨ç¤º port çš„å€¼ä¸å¯ç”¨ï¼Œæ¥å—è€…éœ€è¦å°†è¯·æ±‚åŒ…çš„ UDP æºç«¯å£ä½œä¸º portã€‚</p>\n<h2 id=\"BT-DHT-ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\"><a href=\"#BT-DHT-ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\" class=\"headerlink\" title=\"BT DHT ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\"></a>BT DHT ç›¸å…³å¢å¼ºæ–¹æ¡ˆ</h2><h3 id=\"DHT-Scrape-å¸®åŠ©é€‰æ‹©-Seeding-å†…å®¹\"><a href=\"#DHT-Scrape-å¸®åŠ©é€‰æ‹©-Seeding-å†…å®¹\" class=\"headerlink\" title=\"DHT Scrape å¸®åŠ©é€‰æ‹© Seeding å†…å®¹\"></a>DHT Scrape å¸®åŠ©é€‰æ‹© Seeding å†…å®¹</h3><p>ç±»ä¼¼ <a href=\"http://bittorrent.org/beps/bep_0048.html\" target=\"_blank\" rel=\"noopener\">Tracker Scrape</a>ï¼ŒDHT ç½‘ç»œå¯ä»¥é€šè¿‡ <a href=\"http://bittorrent.org/beps/bep_0033.html\" target=\"_blank\" rel=\"noopener\">BEP33 - DHT Scrapes</a> ä¸­å®šä¹‰çš„ DHT scrape æ¥äº†è§£æŸä¸ª Swarm ä¸­ peer çš„å¤§è‡´æƒ…å†µï¼Œç„¶åæ ¹æ®è¿™ä¸ªçŠ¶æ€é€‰æ‹© seeding é˜Ÿåˆ—ä¸­ä¸‹ä¸€ä¸ª Swarm è¿›è¡Œåšç§ã€‚è¿™ç§ç®—æ³•ä¸»è¦é€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰å®ç°ï¼Œå¸ƒéš†è¿‡æ»¤å™¨é€šå¸¸ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚ä½†åœ¨ DHT scrape ä¸­ï¼Œä½œç”¨æ‰€æœ‰ä¸åŒã€‚åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ˜¯å„ä¸ª peer çš„ IP çš„ sha1 å€¼ï¼Œå¯ä»¥æ ¹æ®è¿‡æ»¤å™¨ä¸­å‰©ä½™çš„ 0 æ¯”ç‰¹æ•°é‡æ¥ä¼°ç®—æ•´ä¸ª Swarm çš„è§„æ¨¡ã€‚</p>\n<h3 id=\"åªè¯»-DHT-èŠ‚ç‚¹\"><a href=\"#åªè¯»-DHT-èŠ‚ç‚¹\" class=\"headerlink\" title=\"åªè¯» DHT èŠ‚ç‚¹\"></a>åªè¯» DHT èŠ‚ç‚¹</h3><p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒDHT èŠ‚ç‚¹ä¸»åŠ¨æˆ–è¢«åŠ¨åœ°é™åˆ¶æˆä¸ºåªè¯»èŠ‚ç‚¹ï¼ˆ<a href=\"http://bittorrent.org/beps/bep_0043.html\" target=\"_blank\" rel=\"noopener\">BEP43 - Read-only DHT Nodes</a> ä¸­å®šä¹‰ï¼‰ï¼Œæ¯”å¦‚ä½äº NAT åä¸” hole punching å¤±è´¥çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å…·æœ‰æµé‡é™åˆ¶æˆ–è€…æœ‰æµé‡è®¡åˆ’ï¼Œæµé‡ä¼šå½±å“èŠ‚ç‚¹çš„ç”µé‡ç­‰ç­‰æƒ…å†µã€‚</p>\n<p>èŠ‚ç‚¹é€šè¿‡åœ¨æ¯æ¡å‘å¤–å‘é€çš„ DHT Query æ¶ˆæ¯ä¸­ç»™å‡ºä¸€ä¸ª <code>ro=1</code> çš„é”®å€¼å¯¹æ¥è¡¨æ˜è‡ªå·±ä¸ºåªè¯»èŠ‚ç‚¹ã€‚æˆä¸ºåªè¯»èŠ‚ç‚¹åï¼Œä¸å†å“åº”å…¶ä»–èŠ‚ç‚¹çš„ Query è¯·æ±‚ã€‚å…¶ä»–èŠ‚ç‚¹çŸ¥æ™“åªè¯»èŠ‚ç‚¹åä¹Ÿä¸ä¼šå‘é€ Query è¯·æ±‚ä»¥å‡å°‘ç½‘ç»œæµé‡ã€‚</p>\n<h3 id=\"åœ¨-DHT-ä¸­å­˜å‚¨ä»»æ„æ•°æ®\"><a href=\"#åœ¨-DHT-ä¸­å­˜å‚¨ä»»æ„æ•°æ®\" class=\"headerlink\" title=\"åœ¨ DHT ä¸­å­˜å‚¨ä»»æ„æ•°æ®\"></a>åœ¨ DHT ä¸­å­˜å‚¨ä»»æ„æ•°æ®</h3><p><a href=\"http://bittorrent.org/beps/bep_0044.html\" target=\"_blank\" rel=\"noopener\">BEP44 - Storing arbitrary data in the DHT</a> ä¸­æä¾›äº†ä¸€ç§åœ¨ DHT ä¸­å­˜å‚¨ä»»æ„æ•°æ®çš„æ–¹å¼ã€‚å­˜å‚¨çš„æ•°æ®å¯ä»¥æ˜¯ä¸å¯å˜æ•°æ®ä¹Ÿå¯ä»¥æ˜¯å¯å˜æ•°æ®ï¼Œä¸å¯å˜æ•°æ®çš„ key æ˜¯æ•°æ®å†…å®¹çš„ sha1 å€¼ï¼Œå¯å˜æ•°æ®çš„ key æ˜¯ç”¨äºç­¾åæ•°æ®çš„å¯†é’¥å¯¹å…¬é’¥ã€‚<a href=\"http://bittorrent.org/beps/bep_0046.html\" target=\"_blank\" rel=\"noopener\">BEP46 - Updating Torrents Via DHT Mutable Items</a> åˆ™åŸºäºåœ¨ DHT ç½‘ç»œä¸­å­˜å‚¨å¯å˜æ•°æ®è€Œç»™å‡ºäº†ä¸€ç§ç”¨äºæ›´æ–° Torrent çš„æ–¹æ³•ã€‚<a href=\"http://bittorrent.org/beps/bep_0050.html\" target=\"_blank\" rel=\"noopener\">BEP50 - Publish/Subscribe Protocol</a> å®ç°äº†ä¸€ç§åŸºäºä¸»é¢˜çš„å‘å¸ƒè®¢é˜…æ¨¡å¼æ¥å‘è®¢é˜…ç‰¹å®šä¸»é¢˜çš„å®¢æˆ·ç«¯å‘é€æ›´æ–°åå¯å˜æ•°æ®çš„åè®®ã€‚</p>\n<h3 id=\"å¤šä¸ªç›‘å¬åœ°å€æƒ…å†µå¤„ç†\"><a href=\"#å¤šä¸ªç›‘å¬åœ°å€æƒ…å†µå¤„ç†\" class=\"headerlink\" title=\"å¤šä¸ªç›‘å¬åœ°å€æƒ…å†µå¤„ç†\"></a>å¤šä¸ªç›‘å¬åœ°å€æƒ…å†µå¤„ç†</h3><p>æŸäº›å®¢æˆ·ç«¯å¯èƒ½ä¼šç›‘å¬å¤šä¸ªå…¬ç½‘å•æ’­ IP åœ°å€ï¼Œå¦‚æœåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å®¢æˆ·ç«¯ä»…ä½¿ç”¨ä¸€ä¸ªèŠ‚ç‚¹ IDï¼Œåˆ™å…¶ä»–èŠ‚ç‚¹å¯èƒ½ä¼šå› ä¸ºå¤šåœ°å€ç°è±¡è€Œå¯¹è¯¥èŠ‚ç‚¹ ID è¿›è¡Œæ¸…ç†ã€‚<a href=\"http://bittorrent.org/beps/bep_0045.html\" target=\"_blank\" rel=\"noopener\">BEP45 - Multiple-address operation for the BitTorrent DHT</a> ä¸­ç»™å‡ºäº†ä¸€äº›è¦æ±‚å’Œå»ºè®®ï¼š</p>\n<ul>\n<li>è¦æ±‚æ¯ä¸ªå¥—æ¥å­—åœ°å€å¿…é¡»å…·æœ‰ä¸åŒçš„èŠ‚ç‚¹ IDï¼Œä¸”å®ƒä»¬çš„ XOR è·ç¦»è¦åˆ†å¾—æ¯”è¾ƒå¼€ï¼Œå“åº”å¿…é¡»ä»æ”¶åˆ°ç›¸åº”è¯·æ±‚çš„åŒä¸€å¥—æ¥å­—åœ°å€å‘é€ï¼›</li>\n<li>å»ºè®®èŠ‚ç‚¹åº”é¿å…åœ¨å•ä¸ªIPåœ°å€ä¸Šä½¿ç”¨å¤šä¸ªç«¯å£ï¼›</li>\n</ul>\n<h3 id=\"å…¶ä»–\"><a href=\"#å…¶ä»–\" class=\"headerlink\" title=\"å…¶ä»–\"></a>å…¶ä»–</h3><p>å’Œ DHT ç›¸å…³çš„è‰æ¡ˆè¿˜æœ‰å¦‚å¯¹ IPv6 çš„æ”¯æŒï¼ˆ<a href=\"http://bittorrent.org/beps/bep_0032.html\" target=\"_blank\" rel=\"noopener\">BEP32 - BitTorrent DHT Extensions for IPv6</a>ï¼‰ï¼ŒDHT ç½‘ç»œå®‰å…¨ï¼ˆ<a href=\"http://bittorrent.org/beps/bep_0042.html\" target=\"_blank\" rel=\"noopener\">BEP42 - DHT Security extension</a>ï¼‰ï¼Œæ£€ç´¢å…¶ä»–èŠ‚ç‚¹å­˜å‚¨çš„ infohash åˆ—è¡¨ï¼ˆ<a href=\"http://bittorrent.org/beps/bep_0051.html\" target=\"_blank\" rel=\"noopener\">BEP51 - DHT Infohash Indexing</a>ï¼‰ç­‰ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://www.quora.com/%CE%BCTorrent-Whats-the-difference-between-the-status-Queued-Seed-and-Seeding\" target=\"_blank\" rel=\"noopener\">Î¼Torrent: Whatâ€™s the difference between the status â€œQueued Seedâ€ and â€œSeedingâ€?</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p>BitTorrent ä½¿ç”¨ DHT ç½‘è·¯æ¥å­˜å‚¨ peer ä¿¡æ¯ï¼Œä»¥å®ç°å» Tracker åŒ–çš„ç§å­ã€‚æ­¤æ—¶ï¼Œæ¯ä¸ª peer éƒ½æˆäº†ä¸€ä¸ª Trackerã€‚ç½‘ç»œåŸºäº Kademlia ç®—æ³•å®ç°ï¼Œä½¿ç”¨ UDP è¿›è¡Œä¼ è¾“ã€‚</p>\n<p>æœ¬æ–‡ä¸»è¦å¯¹ BT ä¸­çš„ DHT ç½‘ç»œå®ç°ä¸åœ¨åšæ–‡ <a href=\"/2018/11/08/dht-kademlia/\" title=\"DHT ç½‘ç»œä¹‹ Kademlia ç®—æ³•\">DHT ç½‘ç»œä¹‹ Kademlia ç®—æ³•</a> ä¸­æè¿°çš„ Kademlia ç®—æ³•çš„åŒºåˆ«è¿›è¡Œæ€»ç»“ã€‚å‡†ç¡®çš„è¯´ä¸èƒ½è¯´æ˜¯åŒºåˆ«ï¼Œè€Œåº”è¯¥å®šä¹‰æˆå®ç°ç»†èŠ‚ï¼Œæ¯•ç«Ÿç†è®ºç®—æ³•åº”ç”¨åˆ°å®é™…æ—¶æ€»éœ€è¦å› åœ°åˆ¶å®œã€‚</p>\n<h2 id=\"å®ç°ç»†èŠ‚ç‚¹\"><a href=\"#å®ç°ç»†èŠ‚ç‚¹\" class=\"headerlink\" title=\"å®ç°ç»†èŠ‚ç‚¹\"></a>å®ç°ç»†èŠ‚ç‚¹</h2><h3 id=\"key-value-å¯¹å­˜å‚¨çš„å†…å®¹\"><a href=\"#key-value-å¯¹å­˜å‚¨çš„å†…å®¹\" class=\"headerlink\" title=\"key-value å¯¹å­˜å‚¨çš„å†…å®¹\"></a>key-value å¯¹å­˜å‚¨çš„å†…å®¹</h3><p>BT ä½¿ç”¨ DHT ç½‘ç»œæ¥å®ç°å» Tracker åŒ–ï¼Œå› æ­¤ peer çš„ä¿¡æ¯å°±éœ€è¦å­˜å‚¨åœ¨ DHT ç½‘ç»œä¸­ï¼ŒBT ä¸­ peer åˆæ˜¯å±€é™åœ¨æŸä¸ª Torrent æ–‡ä»¶ä¸­çš„ã€‚å› æ­¤ key-value å¯¹ä¸­ key å³ Torrent æ–‡ä»¶çš„ infohashï¼Œæ­£å¥½ infohash ä¹Ÿæ˜¯ 160 æ¯”ç‰¹é•¿åº¦çš„ï¼Œvalue ä¸ºæ‹¥æœ‰è¯¥ infohash æ–‡ä»¶çš„ peer åˆ—è¡¨ã€‚</p>\n<h3 id=\"K-æ¡¶å®ç°ç»†èŠ‚\"><a href=\"#K-æ¡¶å®ç°ç»†èŠ‚\" class=\"headerlink\" title=\"$K$ æ¡¶å®ç°ç»†èŠ‚\"></a>$K$ æ¡¶å®ç°ç»†èŠ‚</h3><p>é¦–å…ˆ $K$ æ¡¶ä¸­çš„èŠ‚ç‚¹æœ‰å¤šç§çŠ¶æ€ï¼šå¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨ 15 åˆ†é’Ÿå†…å›å¤è¿‡å½“å‰çš„èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚æˆ–è€…æ›¾ç»å›å¤è¿‡å½“å‰èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚åŒæ—¶åœ¨ 15 åˆ†é’Ÿå†…æœ‰å‘é€è¿‡æŸ¥è¯¢è¯·æ±‚ç»™å½“å‰èŠ‚ç‚¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹ç›¸å¯¹äºå½“å‰èŠ‚ç‚¹ä¸º <em>Good èŠ‚ç‚¹</em>ï¼›å¦‚æœä¸€ä¸ªèŠ‚ç‚¹ 15 åˆ†é’Ÿå†…æœªæ›¾æ´»åŠ¨è¿‡ï¼Œåˆ™æˆä¸º <em>Questionable èŠ‚ç‚¹</em>ï¼›å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æœªç›¸åº”å½“å‰èŠ‚ç‚¹çš„å¤šæ¬¡æŸ¥è¯¢è¯·æ±‚ï¼Œåˆ™è§†ä¸º <em>Bad èŠ‚ç‚¹</em>ã€‚</p>\n<p>å½“ä¸€ä¸ªæ¡¶ä¸­èŠ‚ç‚¹æ•°é‡å·²æ»¡ï¼ˆ$K$ çš„å®¹é‡ $k$ åœ¨ BT ä¸­ä¸º 8ï¼‰ä¸”éƒ½æ˜¯ Good èŠ‚ç‚¹ï¼Œæ–°çš„èŠ‚ç‚¹å¦‚æœæƒ³è¦åŠ å…¥åˆ™ç›´æ¥è¢«å¿½ç•¥ã€‚å¦‚æœæ¡¶ä¸­æœ‰ Bad èŠ‚ç‚¹ï¼Œæ–°çš„èŠ‚ç‚¹å°†ä¼šæ›¿ä»£ä¹‹ã€‚å¦‚æœæ¡¶ä¸­æœ‰ Questionable èŠ‚ç‚¹ï¼Œåˆ™æŒ‰ç…§è¿™äº›èŠ‚ç‚¹åŠ å…¥æ¡¶çš„æ—¶é—´è¿›è¡Œ ping è¯·æ±‚ï¼Œå¦‚æœæœ‰èŠ‚ç‚¹ä¸èƒ½è¢« ping æˆåŠŸåˆ™æ–°çš„èŠ‚ç‚¹å°†ä¼šå–ä»£ä¹‹ã€‚</p>\n<p>æ¯ä¸ªæ¡¶éƒ½ä¼šæœ‰ä¸€ä¸ª<em>æœ€è¿‘æ›´æ–°æ—¶é—´</em>æ ‡è®°æ¥æŒ‡ç¤ºæ¡¶ä¸­èŠ‚ç‚¹çš„æ–°é²œç¨‹åº¦ã€‚å¦‚æœä¸€ä¸ªæ¡¶ä¸­èŠ‚ç‚¹è¢« ping æˆåŠŸäº†ï¼Œæˆ–è€…æœ‰æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œæˆ–è€…ä¸€ä¸ªèŠ‚ç‚¹è¢«å¦ä¸€ä¸ªæ›¿ä»£äº†ï¼Œè¿™ä¸ªæ—¶é—´ä¼šæ›´æ–°ã€‚å¦‚æœä¸€ä¸ªæ¡¶æœ€è¿‘æ›´æ–°æ—¶é—´å·²ç»è¿‡å» 15 åˆ†é’Ÿï¼Œåˆ™éœ€è¦è¿›è¡Œä¸€æ¬¡æ¡¶åˆ·æ–°ï¼Œæ–¹å¼å’Œ Kademlia ä¸­æè¿°çš„ä¸€è‡´ã€‚</p>\n<h3 id=\"Peer-DHT-æ”¯æŒä¸å¦å‘ŠçŸ¥\"><a href=\"#Peer-DHT-æ”¯æŒä¸å¦å‘ŠçŸ¥\" class=\"headerlink\" title=\"Peer DHT æ”¯æŒä¸å¦å‘ŠçŸ¥\"></a>Peer DHT æ”¯æŒä¸å¦å‘ŠçŸ¥</h3><p>peer é€šè¿‡åœ¨ handshake æ¡æ‰‹æ¶ˆæ¯ä¸­å°† reserved_byte çš„æœ€åä¸€æ¯”ç‰¹è®¾ç½®ä¸º 1 æ¥è¡¨ç¤ºæ”¯æŒ DHT ç½‘ç»œã€‚åŒæ ·æ”¯æŒ DHT ç½‘ç»œçš„èŠ‚ç‚¹æ”¶åˆ°è¯¥æ¡æ‰‹æ¶ˆæ¯åä¼šå‘èµ·ä¸€ä¸ª PORT æ¶ˆæ¯ï¼Œtype ä¸º 9ï¼Œè´Ÿè½½ä¸ºä¸¤ä¸ªå­—èŠ‚çš„ DHT èŠ‚ç‚¹ UDP ç«¯å£ã€‚æ”¶åˆ° PORT æ¶ˆæ¯çš„èŠ‚ç‚¹éœ€è¦å¯¹æ”¹èŠ‚ç‚¹ç«¯å£æ‰§è¡Œ ping æ“ä½œï¼Œå¦‚æœå¯¹æ–¹å“åº”äº†ï¼Œåˆ™èŠ‚ç‚¹éœ€è¦å°è¯•å°†å…¶åŠ å…¥åˆ° $K$ æ¡¶ä¸­ã€‚</p>\n<h3 id=\"åˆå§‹èŠ‚ç‚¹è·å–\"><a href=\"#åˆå§‹èŠ‚ç‚¹è·å–\" class=\"headerlink\" title=\"åˆå§‹èŠ‚ç‚¹è·å–\"></a>åˆå§‹èŠ‚ç‚¹è·å–</h3><p>å» Tracker åŒ–çš„ Torrent æ–‡ä»¶ä¸­æ˜¯æ²¡æœ‰å­˜å‚¨ Tracker åœ°å€çš„ â€announceâ€œ é”®çš„ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ â€nodesâ€œ é”®ï¼Œnodes ä¸­éœ€è¦å­˜å‚¨è·ç¦» key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹åœ°å€æˆ–è€…å­˜å‚¨ä¸€ä¸ª <em>Good èŠ‚ç‚¹</em>ï¼Œæ¯”å¦‚è¯´äº§ç”Ÿè¿™ä¸ª Torrent çš„ç”¨æˆ·èŠ‚ç‚¹ã€‚ä¸èƒ½å°†æŸäº›å…¬å…±çš„èŠ‚ç‚¹åŠ å…¥åˆ° Torrent æ–‡ä»¶ä¸­ï¼Œå¦åˆ™å°±å˜å¾—ä¸é‚£ä¹ˆå» Tracker åŒ–äº†ã€‚nodes å¤§æ¦‚å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nodes = [[&quot;&lt;host&gt;&quot;, &lt;port&gt;], [&quot;&lt;host&gt;&quot;, &lt;port&gt;], ...]</span><br><span class=\"line\">nodes = [[&quot;127.0.0.1&quot;, 6881], [&quot;your.router.node&quot;, 4804]]</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"RPC-æ¶ˆæ¯\"><a href=\"#RPC-æ¶ˆæ¯\" class=\"headerlink\" title=\"RPC æ¶ˆæ¯\"></a>RPC æ¶ˆæ¯</h3><p>BT ä½¿ç”¨ KRPC æ¥å®ç° Kademlia èŠ‚ç‚¹é—´çš„ RPC é€šä¿¡ï¼ŒKRPC æ¶ˆæ¯æœ‰ä¸‰ç§æ¶ˆæ¯ç±»å‹ï¼šæŸ¥è¯¢ï¼Œå“åº”ï¼Œé”™è¯¯ã€‚å¯¹äº DHT åè®®ï¼Œæœ‰å››ç§æŸ¥è¯¢åè®®ï¼špingï¼Œfind_nodeï¼Œget_peersï¼Œannounce_peerã€‚</p>\n<h4 id=\"KRPC-åè®®\"><a href=\"#KRPC-åè®®\" class=\"headerlink\" title=\"KRPC åè®®\"></a>KRPC åè®®</h4><p>KRPC åè®®æ˜¯åŸºäº UDP å’Œ bencode ç¼–ç çš„ RPC åè®®ã€‚æ¯æ¡ KRPC æ¶ˆæ¯å¸¦æœ‰ä¸‰ä¸ªå…¬å…±é”®å€¼å¯¹ä»¥åŠå…¶ä»–å› æ¶ˆæ¯ç±»å‹è€Œå¼‚çš„é”®ã€‚ä¸‰ä¸ªå…¬å…±çš„é”®æ˜¯ï¼š</p>\n<ul>\n<li>â€tâ€œï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨ transaction IDã€‚ç”±å‘èµ· query è¯·æ±‚çš„èŠ‚ç‚¹ç”Ÿæˆï¼Œè¢«è¯·æ±‚èŠ‚ç‚¹éœ€è¦åœ¨å›å¤ä¸­è¿”å›ã€‚ä¸€èˆ¬ä¸¤ä¸ªå­—èŠ‚ï¼›</li>\n<li>â€yâ€œï¼šå€¼ä¸ºå•å­—ç¬¦ï¼Œä»£è¡¨æ¶ˆæ¯ç±»å‹ï¼Œæ˜¯ q(query)ã€r(response)ã€e(error) ä¸­çš„ä¸€ä¸ªï¼›</li>\n<li>â€œvâ€ï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨å®¢æˆ·ç«¯ç‰ˆæœ¬ <a href=\"http://www.bittorrent.org/beps/bep_0020.html\" target=\"_blank\" rel=\"noopener\">BEP 20</a> ä¸­å®šä¹‰ï¼Œä¸ä¸€å®šå­˜åœ¨è¿™ä¸ªé”®ï¼›</li>\n</ul>\n<p>æ¯ç§æ¶ˆæ¯ä¼šæœ‰è‡ªå·±é¢å¤–çš„é”®ï¼š</p>\n<h5 id=\"Query-æ¶ˆæ¯\"><a href=\"#Query-æ¶ˆæ¯\" class=\"headerlink\" title=\"Query æ¶ˆæ¯\"></a>Query æ¶ˆæ¯</h5><ul>\n<li>â€qâ€œï¼šå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä»£è¡¨å…·ä½“çš„æ–¹æ³•ç±»å‹ï¼›</li>\n<li>â€aâ€œï¼šå€¼ä¸ºå­—å…¸ï¼Œä»£è¡¨å…·ä½“æ–¹æ³•å¯¹åº”çš„å‚æ•°å­—å…¸ï¼›</li>\n</ul>\n<h5 id=\"Response-æ¶ˆæ¯\"><a href=\"#Response-æ¶ˆæ¯\" class=\"headerlink\" title=\"Response æ¶ˆæ¯\"></a>Response æ¶ˆæ¯</h5><p>å¦‚æœ Query æ¶ˆæ¯æ‰§è¡ŒæˆåŠŸï¼Œåˆ™ä¼šè¿”å›è¯¥ Response æ¶ˆæ¯ã€‚</p>\n<ul>\n<li>â€râ€œï¼šå€¼ä¸ºå­—å…¸ï¼Œä»£è¡¨è¿”å›å€¼å­—å…¸ï¼›</li>\n</ul>\n<h5 id=\"Error-æ¶ˆæ¯\"><a href=\"#Error-æ¶ˆæ¯\" class=\"headerlink\" title=\"Error æ¶ˆæ¯\"></a>Error æ¶ˆæ¯</h5><p>å¦‚æœ Query æ¶ˆæ¯æ‰§è¡Œå¤±è´¥ï¼Œåˆ™ä¼šè¿”å›è¯¥ Error æ¶ˆæ¯ã€‚</p>\n<ul>\n<li>â€eâ€œï¼šå€¼ä¸ºåˆ—è¡¨ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ ä»£è¡¨é”™è¯¯ç ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯é”™è¯¯æ¶ˆæ¯ï¼›</li>\n</ul>\n<p>é”™è¯¯æ¶ˆæ¯ç±»å‹å¦‚ä¸‹ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>Code</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>201</td>\n<td>Generic Error</td>\n</tr>\n<tr>\n<td>202</td>\n<td>Server Error</td>\n</tr>\n<tr>\n<td>203</td>\n<td>Protocol Error, such as a malformed packet, invalid arguments, or bad token</td>\n</tr>\n<tr>\n<td>204</td>\n<td>Method Unknown</td>\n</tr>\n</tbody></table>\n<p>ç¤ºä¾‹é”™è¯¯æ¶ˆæ¯ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">generic error = &#123;&quot;t&quot;:&quot;aa&quot;, &quot;y&quot;:&quot;e&quot;, &quot;e&quot;:[201, &quot;A Generic Error Ocurred&quot;]&#125;</span><br><span class=\"line\">bencoded = d1:eli201e23:A Generic Error Ocurrede1:t2:aa1:y1:ee</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"DHT-Query-æ¶ˆæ¯\"><a href=\"#DHT-Query-æ¶ˆæ¯\" class=\"headerlink\" title=\"DHT Query æ¶ˆæ¯\"></a>DHT Query æ¶ˆæ¯</h4><h5 id=\"ping\"><a href=\"#ping\" class=\"headerlink\" title=\"ping\"></a>ping</h5><p>ç”¨äºæ£€æµ‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å·¥ä½œï¼Œç›¸å½“äº Kademlia çš„ PING è°ƒç”¨ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arguments:  &#123;&quot;id&quot; : &quot;&lt;querying nodes id&gt;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">response: &#123;&quot;id&quot; : &quot;&lt;queried nodes id&gt;&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"find-node\"><a href=\"#find-node\" class=\"headerlink\" title=\"find_node\"></a>find_node</h5><p>æŸ¥æ‰¾è·ç¦»æŒ‡å®šèŠ‚ç‚¹ ID æœ€è¿‘çš„èŠ‚ç‚¹ ID ä¿¡æ¯ï¼Œç›¸å½“äº Kademlia çš„ FIND_NODE è°ƒç”¨ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arguments:  &#123;&quot;id&quot; : &quot;&lt;querying nodes id&gt;&quot;, &quot;target&quot; : &quot;&lt;id of target node&gt;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">response: &#123;&quot;id&quot; : &quot;&lt;queried nodes id&gt;&quot;, &quot;nodes&quot; : &quot;&lt;compact node info&gt;&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>â€œCompact node infoâ€ åˆ—è¡¨ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¿¡æ¯å ç”¨ 26 å­—èŠ‚ï¼Œå…¶ä¸­èŠ‚ç‚¹ ID 20 å­—èŠ‚ï¼ŒIP ä¸ Port å ç”¨ 6 å­—èŠ‚ã€‚</p>\n<h5 id=\"get-peers\"><a href=\"#get-peers\" class=\"headerlink\" title=\"get_peers\"></a>get_peers</h5><p>æŸ¥æ‰¾ä¸æŒ‡å®š info_hash ç›¸å…³çš„ peer ä¿¡æ¯ï¼Œç›¸å½“äº Kademlia çš„ FIND_VALUE è°ƒç”¨ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arguments:  &#123;&quot;id&quot; : &quot;&lt;querying nodes id&gt;&quot;, &quot;info_hash&quot; : &quot;&lt;20-byte infohash of target torrent&gt;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">response: &#123;&quot;id&quot; : &quot;&lt;queried nodes id&gt;&quot;, &quot;token&quot; :&quot;&lt;opaque write token&gt;&quot;, &quot;values&quot; : [&quot;&lt;peer 1 info string&gt;&quot;, &quot;&lt;peer 2 info string&gt;&quot;]&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">or: &#123;&quot;id&quot; : &quot;&lt;queried nodes id&gt;&quot;, &quot;token&quot; :&quot;&lt;opaque write token&gt;&quot;, &quot;nodes&quot; : &quot;&lt;compact node info&gt;&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>å¦‚æœè¢«è¯·æ±‚èŠ‚ç‚¹æœ‰æŒ‡å®š info_hash ç›¸å…³ peers åˆ™ä»¥ values ä¸ºé”®çš„ â€œCompact IP-address/port infoâ€ åˆ—è¡¨ï¼Œå¦åˆ™ï¼Œè¿”å›ä»¥ nodes ä¸ºé”®çš„ â€œCompact node infoâ€ åˆ—è¡¨ã€‚å“åº”ä¸­çš„ token éœ€è¦è¯·æ±‚è€…åœ¨é€šè¿‡ announce_peer å‘å›å¤è€…å®£å‘Š peer ä¿¡æ¯æ—¶æºå¸¦ã€‚</p>\n<h5 id=\"announce-peer\"><a href=\"#announce-peer\" class=\"headerlink\" title=\"announce_peer\"></a>announce_peer</h5><p>å®£å‘ŠèŠ‚ç‚¹è‡ªèº«æ‹¥æœ‰ç‰¹å®š info_hash çš„æ•°æ®ï¼Œå¹¶åœ¨æŸä¸ªç«¯å£è¿›è¡Œä¸‹è½½ï¼Œç›¸å½“äº Kademlia çš„ STORE è°ƒç”¨ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">arguments:  &#123;&quot;id&quot; : &quot;&lt;querying nodes id&gt;&quot;,</span><br><span class=\"line\">  &quot;implied_port&quot;: &lt;0 or 1&gt;,</span><br><span class=\"line\">  &quot;info_hash&quot; : &quot;&lt;20-byte infohash of target torrent&gt;&quot;,</span><br><span class=\"line\">  &quot;port&quot; : &lt;port number&gt;,</span><br><span class=\"line\">  &quot;token&quot; : &quot;&lt;opaque token&gt;&quot;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">response: &#123;&quot;id&quot; : &quot;&lt;queried nodes id&gt;&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ¥å—è€…éœ€è¦æ ¡éªŒ token æ˜¯å¦ä¸ä¹‹å‰å®ƒé€šè¿‡ get_peers è°ƒç”¨çš„å“åº”å›å¤ç»™è¯¥è¯·æ±‚è€…çš„ä¸€è‡´ã€‚å¦‚æœ implied_port å€¼ä¸º 1ï¼Œè¡¨ç¤º port çš„å€¼ä¸å¯ç”¨ï¼Œæ¥å—è€…éœ€è¦å°†è¯·æ±‚åŒ…çš„ UDP æºç«¯å£ä½œä¸º portã€‚</p>\n<h2 id=\"BT-DHT-ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\"><a href=\"#BT-DHT-ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\" class=\"headerlink\" title=\"BT DHT ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\"></a>BT DHT ç›¸å…³å¢å¼ºæ–¹æ¡ˆ</h2><h3 id=\"DHT-Scrape-å¸®åŠ©é€‰æ‹©-Seeding-å†…å®¹\"><a href=\"#DHT-Scrape-å¸®åŠ©é€‰æ‹©-Seeding-å†…å®¹\" class=\"headerlink\" title=\"DHT Scrape å¸®åŠ©é€‰æ‹© Seeding å†…å®¹\"></a>DHT Scrape å¸®åŠ©é€‰æ‹© Seeding å†…å®¹</h3><p>ç±»ä¼¼ <a href=\"http://bittorrent.org/beps/bep_0048.html\" target=\"_blank\" rel=\"noopener\">Tracker Scrape</a>ï¼ŒDHT ç½‘ç»œå¯ä»¥é€šè¿‡ <a href=\"http://bittorrent.org/beps/bep_0033.html\" target=\"_blank\" rel=\"noopener\">BEP33 - DHT Scrapes</a> ä¸­å®šä¹‰çš„ DHT scrape æ¥äº†è§£æŸä¸ª Swarm ä¸­ peer çš„å¤§è‡´æƒ…å†µï¼Œç„¶åæ ¹æ®è¿™ä¸ªçŠ¶æ€é€‰æ‹© seeding é˜Ÿåˆ—ä¸­ä¸‹ä¸€ä¸ª Swarm è¿›è¡Œåšç§ã€‚è¿™ç§ç®—æ³•ä¸»è¦é€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰å®ç°ï¼Œå¸ƒéš†è¿‡æ»¤å™¨é€šå¸¸ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚ä½†åœ¨ DHT scrape ä¸­ï¼Œä½œç”¨æ‰€æœ‰ä¸åŒã€‚åŠ å…¥å¸ƒéš†è¿‡æ»¤å™¨ä¸­çš„æ˜¯å„ä¸ª peer çš„ IP çš„ sha1 å€¼ï¼Œå¯ä»¥æ ¹æ®è¿‡æ»¤å™¨ä¸­å‰©ä½™çš„ 0 æ¯”ç‰¹æ•°é‡æ¥ä¼°ç®—æ•´ä¸ª Swarm çš„è§„æ¨¡ã€‚</p>\n<h3 id=\"åªè¯»-DHT-èŠ‚ç‚¹\"><a href=\"#åªè¯»-DHT-èŠ‚ç‚¹\" class=\"headerlink\" title=\"åªè¯» DHT èŠ‚ç‚¹\"></a>åªè¯» DHT èŠ‚ç‚¹</h3><p>åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒDHT èŠ‚ç‚¹ä¸»åŠ¨æˆ–è¢«åŠ¨åœ°é™åˆ¶æˆä¸ºåªè¯»èŠ‚ç‚¹ï¼ˆ<a href=\"http://bittorrent.org/beps/bep_0043.html\" target=\"_blank\" rel=\"noopener\">BEP43 - Read-only DHT Nodes</a> ä¸­å®šä¹‰ï¼‰ï¼Œæ¯”å¦‚ä½äº NAT åä¸” hole punching å¤±è´¥çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å…·æœ‰æµé‡é™åˆ¶æˆ–è€…æœ‰æµé‡è®¡åˆ’ï¼Œæµé‡ä¼šå½±å“èŠ‚ç‚¹çš„ç”µé‡ç­‰ç­‰æƒ…å†µã€‚</p>\n<p>èŠ‚ç‚¹é€šè¿‡åœ¨æ¯æ¡å‘å¤–å‘é€çš„ DHT Query æ¶ˆæ¯ä¸­ç»™å‡ºä¸€ä¸ª <code>ro=1</code> çš„é”®å€¼å¯¹æ¥è¡¨æ˜è‡ªå·±ä¸ºåªè¯»èŠ‚ç‚¹ã€‚æˆä¸ºåªè¯»èŠ‚ç‚¹åï¼Œä¸å†å“åº”å…¶ä»–èŠ‚ç‚¹çš„ Query è¯·æ±‚ã€‚å…¶ä»–èŠ‚ç‚¹çŸ¥æ™“åªè¯»èŠ‚ç‚¹åä¹Ÿä¸ä¼šå‘é€ Query è¯·æ±‚ä»¥å‡å°‘ç½‘ç»œæµé‡ã€‚</p>\n<h3 id=\"åœ¨-DHT-ä¸­å­˜å‚¨ä»»æ„æ•°æ®\"><a href=\"#åœ¨-DHT-ä¸­å­˜å‚¨ä»»æ„æ•°æ®\" class=\"headerlink\" title=\"åœ¨ DHT ä¸­å­˜å‚¨ä»»æ„æ•°æ®\"></a>åœ¨ DHT ä¸­å­˜å‚¨ä»»æ„æ•°æ®</h3><p><a href=\"http://bittorrent.org/beps/bep_0044.html\" target=\"_blank\" rel=\"noopener\">BEP44 - Storing arbitrary data in the DHT</a> ä¸­æä¾›äº†ä¸€ç§åœ¨ DHT ä¸­å­˜å‚¨ä»»æ„æ•°æ®çš„æ–¹å¼ã€‚å­˜å‚¨çš„æ•°æ®å¯ä»¥æ˜¯ä¸å¯å˜æ•°æ®ä¹Ÿå¯ä»¥æ˜¯å¯å˜æ•°æ®ï¼Œä¸å¯å˜æ•°æ®çš„ key æ˜¯æ•°æ®å†…å®¹çš„ sha1 å€¼ï¼Œå¯å˜æ•°æ®çš„ key æ˜¯ç”¨äºç­¾åæ•°æ®çš„å¯†é’¥å¯¹å…¬é’¥ã€‚<a href=\"http://bittorrent.org/beps/bep_0046.html\" target=\"_blank\" rel=\"noopener\">BEP46 - Updating Torrents Via DHT Mutable Items</a> åˆ™åŸºäºåœ¨ DHT ç½‘ç»œä¸­å­˜å‚¨å¯å˜æ•°æ®è€Œç»™å‡ºäº†ä¸€ç§ç”¨äºæ›´æ–° Torrent çš„æ–¹æ³•ã€‚<a href=\"http://bittorrent.org/beps/bep_0050.html\" target=\"_blank\" rel=\"noopener\">BEP50 - Publish/Subscribe Protocol</a> å®ç°äº†ä¸€ç§åŸºäºä¸»é¢˜çš„å‘å¸ƒè®¢é˜…æ¨¡å¼æ¥å‘è®¢é˜…ç‰¹å®šä¸»é¢˜çš„å®¢æˆ·ç«¯å‘é€æ›´æ–°åå¯å˜æ•°æ®çš„åè®®ã€‚</p>\n<h3 id=\"å¤šä¸ªç›‘å¬åœ°å€æƒ…å†µå¤„ç†\"><a href=\"#å¤šä¸ªç›‘å¬åœ°å€æƒ…å†µå¤„ç†\" class=\"headerlink\" title=\"å¤šä¸ªç›‘å¬åœ°å€æƒ…å†µå¤„ç†\"></a>å¤šä¸ªç›‘å¬åœ°å€æƒ…å†µå¤„ç†</h3><p>æŸäº›å®¢æˆ·ç«¯å¯èƒ½ä¼šç›‘å¬å¤šä¸ªå…¬ç½‘å•æ’­ IP åœ°å€ï¼Œå¦‚æœåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å®¢æˆ·ç«¯ä»…ä½¿ç”¨ä¸€ä¸ªèŠ‚ç‚¹ IDï¼Œåˆ™å…¶ä»–èŠ‚ç‚¹å¯èƒ½ä¼šå› ä¸ºå¤šåœ°å€ç°è±¡è€Œå¯¹è¯¥èŠ‚ç‚¹ ID è¿›è¡Œæ¸…ç†ã€‚<a href=\"http://bittorrent.org/beps/bep_0045.html\" target=\"_blank\" rel=\"noopener\">BEP45 - Multiple-address operation for the BitTorrent DHT</a> ä¸­ç»™å‡ºäº†ä¸€äº›è¦æ±‚å’Œå»ºè®®ï¼š</p>\n<ul>\n<li>è¦æ±‚æ¯ä¸ªå¥—æ¥å­—åœ°å€å¿…é¡»å…·æœ‰ä¸åŒçš„èŠ‚ç‚¹ IDï¼Œä¸”å®ƒä»¬çš„ XOR è·ç¦»è¦åˆ†å¾—æ¯”è¾ƒå¼€ï¼Œå“åº”å¿…é¡»ä»æ”¶åˆ°ç›¸åº”è¯·æ±‚çš„åŒä¸€å¥—æ¥å­—åœ°å€å‘é€ï¼›</li>\n<li>å»ºè®®èŠ‚ç‚¹åº”é¿å…åœ¨å•ä¸ªIPåœ°å€ä¸Šä½¿ç”¨å¤šä¸ªç«¯å£ï¼›</li>\n</ul>\n<h3 id=\"å…¶ä»–\"><a href=\"#å…¶ä»–\" class=\"headerlink\" title=\"å…¶ä»–\"></a>å…¶ä»–</h3><p>å’Œ DHT ç›¸å…³çš„è‰æ¡ˆè¿˜æœ‰å¦‚å¯¹ IPv6 çš„æ”¯æŒï¼ˆ<a href=\"http://bittorrent.org/beps/bep_0032.html\" target=\"_blank\" rel=\"noopener\">BEP32 - BitTorrent DHT Extensions for IPv6</a>ï¼‰ï¼ŒDHT ç½‘ç»œå®‰å…¨ï¼ˆ<a href=\"http://bittorrent.org/beps/bep_0042.html\" target=\"_blank\" rel=\"noopener\">BEP42 - DHT Security extension</a>ï¼‰ï¼Œæ£€ç´¢å…¶ä»–èŠ‚ç‚¹å­˜å‚¨çš„ infohash åˆ—è¡¨ï¼ˆ<a href=\"http://bittorrent.org/beps/bep_0051.html\" target=\"_blank\" rel=\"noopener\">BEP51 - DHT Infohash Indexing</a>ï¼‰ç­‰ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://www.quora.com/%CE%BCTorrent-Whats-the-difference-between-the-status-Queued-Seed-and-Seeding\" target=\"_blank\" rel=\"noopener\">Î¼Torrent: Whatâ€™s the difference between the status â€œQueued Seedâ€ and â€œSeedingâ€?</a></li>\n</ol>\n"},{"title":"BT å¢å¼ºå»ºè®®ä¹‹è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ","date":"2018-11-15T11:45:00.000Z","_content":"\næœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» BEP ä¸­å‰©ä¸‹çš„æ”¹è¿›æ–¹æ¡ˆï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡ {% post_link bt-overview %}ã€‚\n\n## è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\n\næœ¬èŠ‚ç‚¹è¯¦ç»†ä»‹ç»å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆã€‚å‰©ä½™çš„åªä½œç®€å•å½’çº³ã€‚\n\n### è¶…çº§åšç§æ¨¡å¼æé«˜åšç§æ•ˆç‡\n\n[BEP16 - Superseeding](http://bittorrent.org/beps/bep_0016.html) ä¸­èµ·è‰çš„è¶…çº§åšç§åŠŸèƒ½æ˜¯ä¸€ä¸ªæ¥å¸®åŠ©åˆå§‹åšç§è€…ä½¿ç”¨è¾ƒå°‘çš„æµé‡æ¥å®Œæˆåšç§çš„ç®—æ³•ã€‚å½“ä¸€ä¸ªåšç§å®¢æˆ·ç«¯è¿›å…¥è¶…çº§åšç§æ¨¡å¼åï¼Œå®ƒå°†ä¸ä¼šè¡¨ç°ä¸ºä¸€ä¸ªæ ‡å‡†çš„åšç§è€…ï¼Œè€Œæ˜¯ä¼ªè£…æˆä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„æ­£å¸¸ peerã€‚å½“æœ‰å…¶ä»– peer è¿æ¥æ—¶ï¼Œå®ƒä»…å°†ä¸€ä¸ªä»æœªå‘é€è¿‡çš„ç‰‡æ®µå‘é€ç»™åˆšè¿æ¥çš„ peerï¼Œåœ¨ä¸€ä¸ªåˆ«çš„ peer é€šçŸ¥åˆ°è¯¥åšç§è€…è¿™ä¸ªç‰‡æ®µå‰ï¼Œåšç§è€…ä¸ä¼šå‘åˆšæ‰çš„ peer å‘é€æ–°çš„ç‰‡æ®µï¼Œä»¥æ­¤èŠ‚çº¦åšç§è€…çš„æµé‡ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨è¶…çº§ç§å­æ¨¡å¼ã€‚è™½ç„¶å®ƒç¡®å®æœ‰åŠ©äºæ›´å¹¿æ³›åœ°åˆ†å‘ç¨€æœ‰æ•°æ®ï¼Œå› ä¸ºå®ƒé™åˆ¶äº†å®¢æˆ·ç«¯å¯ä»¥ä¸‹è½½çš„ç‰‡æ®µçš„é€‰æ‹©ï¼Œä½†ä¹Ÿé™åˆ¶äº†è¿™äº›å®¢æˆ·ç«¯ä¸‹è½½å·²ç»æ£€ç´¢åˆ°çš„éƒ¨åˆ†ç‰‡æ®µæ•°æ®çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œè¶…çº§ç§å­æ¨¡å¼ä»…æ¨èç”¨äºåˆå§‹ç§å­æœåŠ¡å™¨ã€‚\n\n### ä½¿ç”¨ Web æ–¹å¼åšç§\n\nWebSeed åœ¨ BEP ä¸­æœ‰ä¸¤ä¸ªå¢å¼ºå»ºè®®ï¼š[BEP19 - HTTP/FTP Seeding (GetRight style)](http://bittorrent.org/beps/bep_0019.html) å’Œ [BEP17 - Seeding (Hoffman-style)](http://bittorrent.org/beps/bep_0017.html)\n\nBEP17 æä¾›äº†ä¸€ç§é€šè¿‡ HTTP åè®®åšç§ä»¥åŠä» HTTP è·å–æ•°æ®çš„æ–¹å¼ã€‚åˆå§‹åšç§è€…ä¸»è¦åœ¨å…ƒæ•°æ®æ–‡ä»¶ä¸­åŠ å…¥é”® `httpseeds`ï¼Œå€¼ä¸ºæ”¯æŒ HTTP Seeding æœåŠ¡å™¨åœ°å€åˆ—è¡¨ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š\n\n```\nd['httpseeds'] = [ 'http://www.site1.com/source1.php',\n                   'http://www.site2.com/source2.php'  ]\n```\n\nå®¢æˆ·ç«¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—® HTTP Seeding æœåŠ¡å™¨è·å–å…¨éƒ¨æˆ–è€…ç‰¹å®šæ•°æ®ç‰‡æ®µã€‚\n\n```\n<url>?info_hash=[hash]&piece=[piece]{&ranges=[start]-[end]{,[start]-[end]}...}\n```\n\nBEP19 é€šå‘ŠæœåŠ¡å™¨åœ°å€çš„æ–¹å¼å’Œ BEP17 å·®ä¸å¤šï¼Œä½†æ˜¯é”®æ”¹ä¸ºäº† `url-list`ã€‚BEP19 çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿå¤„ç†ä»»ä½•å¯é€šè¿‡æ™®é€š HTTP æˆ– FTP è®¿é—®çš„æ–‡ä»¶ï¼Œåˆ©ç”¨æ ‡å‡† HTTP è¯·æ±‚ä¸‹è½½ç‰‡æ®µã€‚BEP17 è¦æ±‚å¯¹æœåŠ¡å™¨åšé€‚å½“ä¿®æ”¹ï¼Œä»¥æ”¯æŒ BEP17ï¼Œè¿™åœ¨äº’æ“ä½œæ€§æ–¹é¢æ˜¯ä¸€ä¸ªç¼ºç‚¹ï¼Œä½†å®ƒç¡®å®å…·æœ‰å…è®¸ç§å­æœåŠ¡å™¨æ›´å¥½åœ°æ§åˆ¶æµé‡å’Œé¿å…å¸¦å®½æ»¥ç”¨çš„ä¼˜åŠ¿ã€‚\n\n### ç§æœ‰ç§å­åŠ å¼ºæ•°æ®åˆ†äº«éšç§æ€§\n\nç§æœ‰ç§å­æ˜¯åœ¨ [BEP27 - Private Torrents](http://bittorrent.org/beps/bep_0027.html) ä¸­æè¿°çš„ï¼Œé€šè¿‡åœ¨å…ƒæ•°æ®ä¿¡æ¯æ€»å¢åŠ é”®å€¼å¯¹ `private=1` æ¥æ ‡è®°ç§å­ä¸ºç§æœ‰ç§å­ã€‚å®¢æˆ·ç«¯åªèƒ½å‘ç§æœ‰ç§å­å¯¹åº”çš„ç§æœ‰ Tracker é€šå‘Šè‡ªèº«ï¼Œè€Œä¸”åªèƒ½ä¸ç§æœ‰ Tracker è¿”å›çš„ peer å»ºç«‹è¿æ¥ã€‚\n\nå½“ç§æœ‰ç§å­çš„ `announce-list` ä¸­å‡ºç°å¤šä¸ª Tracker åœ°å€æ—¶ï¼Œæ¯ä¸ª peer åœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€ä¸ª Trackerï¼Œåªæœ‰å½“ Tracker å‡ºé”™æ—¶æ‰å¯ä»¥åˆ‡æ¢ Trackerã€‚åœ¨åˆ‡æ¢ Tracker æ—¶ï¼Œpeer å¿…é¡»æ–­å¼€æ‰€æœ‰ä¸å…¶ä»– peer çš„è¿æ¥ï¼Œä¹‹ååªèƒ½ä¸æ–°çš„ Tracker æä¾›çš„ peer å»ºç«‹è¿æ¥ã€‚è¿™å‡è½»äº†æ”»å‡»è€…é€šè¿‡ä¿®æ”¹å…ƒæ•°æ®æ–‡ä»¶ä¸­ `announce-list` åå‘å¸ƒæ–°çš„å…ƒæ•°æ®æ–‡ä»¶è¿›è¡Œæ”»å‡»å¸¦æ¥çš„å½±å“ã€‚\n\nå½“ç§å­ä¸ºç§æœ‰ç§å­æ—¶ï¼Œé€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆåŒ…æ‹¬ DHT, PEX, LSD ç­‰ï¼‰è·å– peer éƒ½ä¼šå¯¹â€œç§æœ‰â€è¿›è¡Œç ´åã€‚ä½†æ˜¯ä¸èƒ½é¿å…æ”»å‡»è€…é€šè¿‡çŒœæµ‹ peer çš„ IP ä¸ç«¯å£çš„æ–¹å¼æ‰¾åˆ° peerï¼Œè¿›è€Œäº§ç”Ÿè¿æ¥ã€‚\n\n### Merkle Tree æ•°æ®ç»“æ„ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°\n\nå¦‚æœç§å­æ–‡ä»¶è¿‡å¤§ï¼Œå¯¹äºæä¾›ç§å­æ–‡ä»¶ä¸‹è½½çš„ä¸­å¿ƒåŒ–æœåŠ¡å™¨å°±ä¼šæœ‰è¾ƒå¤§å‹åŠ›ã€‚ä¸ºäº†è®©å…ƒæ•°æ®æ–‡ä»¶ä½“ç§¯å‡å°ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯å°†æ¯ä¸ªç‰‡æ®µçš„å¤§å°å¢åŠ ï¼ˆä¸Šé™æ˜¯ 2 Mbï¼‰ï¼ŒåŒæ ·å¤§å°çš„æ–‡ä»¶å› æ­¤ä¼šäº§ç”Ÿæ›´å°‘çš„æ‘˜è¦æ•°é‡ã€‚è€ƒè™‘åˆ°åªæœ‰å½“ä¸€ä¸ªç‰‡æ®µè¢«å®Œå…¨æ¥å—å®Œæˆä¸”éªŒè¯æ‘˜è¦åï¼Œæ‰èƒ½å°†ä¹‹ä¸å…¶ä»– peer è¿›è¡Œäº¤æ¢ï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å’Œå…¶ä»– peer è¿›è¡Œäº¤æ¢ã€‚\n\n[BEP30 - Merkle hash torrent extension](http://bittorrent.org/beps/bep_0030.html) åˆ©ç”¨äº† Merkle Tree è¿™ç§æ•°æ®ç»“æ„æ¥ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°ã€‚è¯¥æ–¹æ¡ˆä½¿ç”¨å•ä¸€çš„ Merkle å“ˆå¸Œæ¥æ›¿ä»£æ‘˜è¦åˆ—è¡¨ã€‚Merkle æ•£åˆ—å¯ç”¨äºé€šè¿‡åˆ†å±‚æ–¹æ¡ˆéªŒè¯æ•´ä¸ªå†…å®¹æ–‡ä»¶ä»¥åŠå„ä¸ªå—çš„å®Œæ•´æ€§ã€‚å®ƒé€šè¿‡æ„å»ºä¸æ•°æ®ç›¸å…³çš„å“ˆå¸Œæ ‘å¹¶ä»…éœ€ä½¿ç”¨æ ¹å“ˆå¸Œä½œä¸ºéªŒè¯æ•°æ®å®Œæ•´æ€§çš„ä¾æ®ã€‚\n\nå¦‚å›¾æ‰€ç¤ºï¼ŒP0-P12 ä»£è¡¨ç‰‡æ®µ 0-12ï¼ŒX æ˜¯ä¸ºäº†æ ‘çš„å®Œæ•´è€Œå¡«å……çš„é›¶å€¼ç‰‡æ®µï¼Œ0-30 å‡è¡¨ç¤ºå“ˆå¸Œï¼Œå…¶ä¸­ 0 æ˜¯æ ¹å“ˆå¸Œã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ¥å—åˆ°äº†å®Œæ•´çš„ç‰‡æ®µ P8ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹åªéœ€è¦é¢å¤–é€šè¿‡ä¸€äº›é€”å¾„çŸ¥é“ P8 çš„å§Šå¦¹ç‰‡æ®µ P9 çš„å“ˆå¸Œå€¼ï¼Œä»¥åŠ P8 çš„æ‰€æœ‰å”å—å“ˆå¸Œï¼ˆä¾æ¬¡ä¸º 12ï¼Œ6ï¼Œ1ï¼‰å°±å¯ä»¥éªŒè¯ P8 çš„å®Œæ•´æ€§ã€‚\n\n```\n                                          0* = root hash\n                                       /     \\\n                                   /            \\\n                               /                   \\\n                           /                          \\\n                       /                                 \\\n                     1*                                     2\n                    / \\                                    / \\\n                  /     \\                                /     \\\n                /         \\                            /         \\\n              /             \\                        /             \\\n            /                 \\                    /                 \\\n           3                   4                  5                   6* = uncle\n          / \\                 / \\                / \\                 / \\\n         /   \\               /   \\              /   \\               /   \\\n        /     \\             /     \\            /     \\             /     \\\n      7         8         9        10        11        12*       13        14 \n     / \\       / \\       / \\       / \\       / \\       / \\       / \\       / \\\n   15   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30\n   \n   P0   P1   P2   P3   P4   P5   P6   P7   P8*  P9*  P10  P11  P12   X    X    X\n   = piece index                            =    =                   = filler hash \n                                            p    s                   \n                                            i    i                   \n                                            e    b                   \n                                            c    l\n                                            e    i\n                                                 n\n                                                 g\n```\n\nåŸå§‹èµ„æºå‘å¸ƒè€…éœ€è¦å°†å…ƒæ•°æ®ä¸­çš„åŸæœ¬ç”¨æ¥å­˜å‚¨ç‰‡æ®µæ•£åˆ—å€¼çš„ **pieces** é”®æ›¿æ¢ä¸ºå­˜å‚¨æ ¹å“ˆå¸Œçš„é”® **root hash**ã€‚\n\næ”¯æŒ Merkle Tree å“ˆå¸Œæ–¹å¼çš„å®¢æˆ·ç«¯éœ€è¦åŒæ—¶æ”¯æŒæ‰©å±•æ¶ˆæ¯ï¼ˆè§ {% post_link bt-peer %}ï¼‰æ¥æ›¿ä»£æ™®é€šçš„ **piece** æ¶ˆæ¯æ¥å®Œæˆæ•°æ®ä¼ è¾“ã€‚ç”¨äºä¼ è¾“æ•°æ®çš„æ‰©å±•æ¶ˆæ¯ç±»å‹æ˜¯ **Tr_hashpiece** ï¼Œå’Œå…¶ä»–æ‰©å±•æ¶ˆæ¯ä¸€æ ·ï¼Œè¿™ä¸ªæ¶ˆæ¯ä¹Ÿéœ€è¦åœ¨ peer é—´çš„æ‰©å±•æ¡æ‰‹æ¶ˆæ¯ä¸­å£°æ˜ã€‚\n\n**Tr_hashpiece** æ¶ˆæ¯çš„è´Ÿè½½å†…å®¹å¦‚ä¸‹ï¼š\n\n- indexï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨æ•°æ®ç‰‡æ®µåºå·ï¼›\n- beginï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨å½“å‰å½“å‰æ•°æ®å­ç‰‡æ®µåœ¨æ•´ä¸ªç‰‡æ®µä¸­çš„åç§»é‡ï¼›\n- hashlist lengthï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨å“ˆå¸Œåˆ—è¡¨çš„é•¿åº¦\n- hashlistï¼šå“ˆå¸Œåˆ—è¡¨ï¼ŒåŒ…æ‹¬ç‰‡æ®µè‡ªèº«å“ˆå¸Œï¼Œå§Šå¦¹ç‰‡æ®µå“ˆå¸Œï¼Œä»¥åŠå„ä¸ªå”ç‰‡æ®µå“ˆå¸Œï¼Œæœ€åæ˜¯æ ¹å“ˆå¸Œï¼Œåªæœ‰å½“ begin ä¸º 0 æ—¶ï¼Œæ‰éœ€è¦ä¼ è¾“ hashlistï¼›\n- subpiece dataï¼šæ•°æ®å­ç‰‡æ®µï¼›\n\nåœ¨ peer æ¥æ”¶å®ŒæˆæŸä¸ªæ•°æ®ç‰‡æ®µçš„ **Tr_hashpiece** æ¶ˆæ¯åï¼Œå®ƒå°†æ ¹æ® hashlist ä¸­çš„å“ˆå¸Œåˆ—è¡¨è®¡ç®—å‡ºçš„æ ¹å“ˆå¸Œä¸åŸæœ‰çš„æ ¹å“ˆå¸Œè¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœåŒ¹é…ï¼Œæ‰€æœ‰å“ˆå¸Œå€¼éƒ½ä¿å­˜åœ¨è¯¥ peer è‡ªå·±çš„ Merkle Tree ä¸­ï¼Œä¹‹åå®ƒä»¬å¯ä»¥è¢«ä¼ é€’ç»™å…¶ä»–äººã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ Merkle Tree çš„ Torrent ä¸ä½¿ç”¨æ•£åˆ—å€¼åˆ—è¡¨çš„ Torrent å³ä½¿å®ƒä»¬çš„æ•°æ®å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯ç”±äº infohash ä¸ä¸€è‡´ï¼Œå¯¼è‡´å®ƒä»¬ä¸åœ¨åŒä¸€ä¸ª Swarm ä¸­ã€‚å¦å¤–ä¸€æ—¦é‡‡ç”¨äº† Merkle Tree çš„æ–¹å¼ï¼Œé€šè¿‡ WebSeed æ¥è·å–æ•°æ®å°±å˜å¾—ä¸å…¼å®¹ã€‚\n\n## å…¶ä»–æ–¹æ¡ˆç®€è¿°\n\n- [BEP35 - Torrent Signing](http://www.bittorrent.org/beps/bep_0035.html)ã€€åˆ©ç”¨å¯¹ç§å­è¿›è¡Œç­¾åä»¥å¢åŠ ä¸‹è½½å®‰å…¨æ€§ã€‚\n- [BEP36 - Torrent RSS feeds](http://bittorrent.org/beps/bep_0036.html) å®šä¹‰äº† RSS è®¢é˜…ç§å­çš„ feed æ ¼å¼ã€‚\n- [BEP38 - Finding Local Data Via Torrent File Hints](http://bittorrent.org/beps/bep_0038.html) åˆ™æå‡ºäº†ç²—ç•¥åœ°æ£€æµ‹ç”¨æˆ·æœ¬åœ°æ˜¯å¦å·²ç»å­˜åœ¨å…¨éƒ¨æˆ–è€…éƒ¨åˆ†å³å°†ä¸‹è½½çš„æ–‡ä»¶çš„æ–¹æ¡ˆã€‚ä¸»è¦æ¶‰åŠåœ¨ç§å­æ–‡ä»¶ä¸­æ·»åŠ  `similar` æˆ– `collections` è¿™ä¸¤ä¸ªé”®ã€‚å‰è€…è¡¨ç¤ºå¯èƒ½ä¸æŸä¸ª infohash å…±äº«éƒ¨åˆ†æ•°æ®ï¼Œåè€…è¡¨ç¤ºè¯¥ç§å­æ–‡ä»¶æ‰€å±çš„é›†åˆï¼Œå±äºåŒä¸€é›†åˆçš„ç§å­å¯èƒ½å…±äº«æ–‡ä»¶ã€‚\n- [BEP39 - Updating Torrents Via Feed URL](http://bittorrent.org/beps/bep_0039.html) ä½¿ç”¨åœ¨ info ä¸­çš„é”® `update-url` æ¥è¡¨æ˜ç”¨äºæ›´æ–°è¯¥ç§å­çš„é“¾æ¥åœ°å€ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚è¯¥åœ°å€æˆåŠŸä¸”å¾—åˆ°ä¸€ä¸ªç§å­æ–‡ä»¶ï¼Œåˆ™éœ€è¦ä¸‹è½½è¯¥æ›´æ–°åçš„ç§å­ã€‚\n- [BEP47 - Padding files and extended file attributes](http://bittorrent.org/beps/bep_0047.html) åœ¨åŸå§‹å…ƒæ•°æ®æè¿°æ–‡ä»¶ä¿¡æ¯çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›é¢å¤–çš„å±æ€§ã€‚ä¾‹å¦‚ç¬¦å·é“¾æ¥é‡å¤æ–‡ä»¶ï¼›ä¸ºæ–‡ä»¶æ·»åŠ  padding ä»¥ä½¿å¾—ä¸‹ä¸€ä¸ªæ–‡ä»¶æ•°æ®ä»ç‰‡æ®µè¾¹ç¼˜å¼€å§‹ã€‚\n- [BEP49 - Distributed Torrent Feeds](http://bittorrent.org/beps/bep_0049.html) ä¸ BEP36 æä¾›çš„ RSS è®¢é˜…åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯é€šè¿‡ DHT ç½‘ç»œå®ç°ã€‚\n\n## å‚è€ƒèµ„æ–™\n\n1. [Implement Web (HTTP) Seeding (BEP17+BEP19) Â· Issue #67 Â· webtorrent/webtorrent](https://github.com/webtorrent/webtorrent/issues/67)\n","source":"_posts/bt-advanced.md","raw":"---\ntitle: BT å¢å¼ºå»ºè®®ä¹‹è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\ntags:\n  - BT\ndate: 2018-11-15 19:45:00\ncategories:\n---\n\næœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» BEP ä¸­å‰©ä¸‹çš„æ”¹è¿›æ–¹æ¡ˆï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡ {% post_link bt-overview %}ã€‚\n\n## è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\n\næœ¬èŠ‚ç‚¹è¯¦ç»†ä»‹ç»å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆã€‚å‰©ä½™çš„åªä½œç®€å•å½’çº³ã€‚\n\n### è¶…çº§åšç§æ¨¡å¼æé«˜åšç§æ•ˆç‡\n\n[BEP16 - Superseeding](http://bittorrent.org/beps/bep_0016.html) ä¸­èµ·è‰çš„è¶…çº§åšç§åŠŸèƒ½æ˜¯ä¸€ä¸ªæ¥å¸®åŠ©åˆå§‹åšç§è€…ä½¿ç”¨è¾ƒå°‘çš„æµé‡æ¥å®Œæˆåšç§çš„ç®—æ³•ã€‚å½“ä¸€ä¸ªåšç§å®¢æˆ·ç«¯è¿›å…¥è¶…çº§åšç§æ¨¡å¼åï¼Œå®ƒå°†ä¸ä¼šè¡¨ç°ä¸ºä¸€ä¸ªæ ‡å‡†çš„åšç§è€…ï¼Œè€Œæ˜¯ä¼ªè£…æˆä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„æ­£å¸¸ peerã€‚å½“æœ‰å…¶ä»– peer è¿æ¥æ—¶ï¼Œå®ƒä»…å°†ä¸€ä¸ªä»æœªå‘é€è¿‡çš„ç‰‡æ®µå‘é€ç»™åˆšè¿æ¥çš„ peerï¼Œåœ¨ä¸€ä¸ªåˆ«çš„ peer é€šçŸ¥åˆ°è¯¥åšç§è€…è¿™ä¸ªç‰‡æ®µå‰ï¼Œåšç§è€…ä¸ä¼šå‘åˆšæ‰çš„ peer å‘é€æ–°çš„ç‰‡æ®µï¼Œä»¥æ­¤èŠ‚çº¦åšç§è€…çš„æµé‡ã€‚\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨è¶…çº§ç§å­æ¨¡å¼ã€‚è™½ç„¶å®ƒç¡®å®æœ‰åŠ©äºæ›´å¹¿æ³›åœ°åˆ†å‘ç¨€æœ‰æ•°æ®ï¼Œå› ä¸ºå®ƒé™åˆ¶äº†å®¢æˆ·ç«¯å¯ä»¥ä¸‹è½½çš„ç‰‡æ®µçš„é€‰æ‹©ï¼Œä½†ä¹Ÿé™åˆ¶äº†è¿™äº›å®¢æˆ·ç«¯ä¸‹è½½å·²ç»æ£€ç´¢åˆ°çš„éƒ¨åˆ†ç‰‡æ®µæ•°æ®çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œè¶…çº§ç§å­æ¨¡å¼ä»…æ¨èç”¨äºåˆå§‹ç§å­æœåŠ¡å™¨ã€‚\n\n### ä½¿ç”¨ Web æ–¹å¼åšç§\n\nWebSeed åœ¨ BEP ä¸­æœ‰ä¸¤ä¸ªå¢å¼ºå»ºè®®ï¼š[BEP19 - HTTP/FTP Seeding (GetRight style)](http://bittorrent.org/beps/bep_0019.html) å’Œ [BEP17 - Seeding (Hoffman-style)](http://bittorrent.org/beps/bep_0017.html)\n\nBEP17 æä¾›äº†ä¸€ç§é€šè¿‡ HTTP åè®®åšç§ä»¥åŠä» HTTP è·å–æ•°æ®çš„æ–¹å¼ã€‚åˆå§‹åšç§è€…ä¸»è¦åœ¨å…ƒæ•°æ®æ–‡ä»¶ä¸­åŠ å…¥é”® `httpseeds`ï¼Œå€¼ä¸ºæ”¯æŒ HTTP Seeding æœåŠ¡å™¨åœ°å€åˆ—è¡¨ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š\n\n```\nd['httpseeds'] = [ 'http://www.site1.com/source1.php',\n                   'http://www.site2.com/source2.php'  ]\n```\n\nå®¢æˆ·ç«¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—® HTTP Seeding æœåŠ¡å™¨è·å–å…¨éƒ¨æˆ–è€…ç‰¹å®šæ•°æ®ç‰‡æ®µã€‚\n\n```\n<url>?info_hash=[hash]&piece=[piece]{&ranges=[start]-[end]{,[start]-[end]}...}\n```\n\nBEP19 é€šå‘ŠæœåŠ¡å™¨åœ°å€çš„æ–¹å¼å’Œ BEP17 å·®ä¸å¤šï¼Œä½†æ˜¯é”®æ”¹ä¸ºäº† `url-list`ã€‚BEP19 çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿå¤„ç†ä»»ä½•å¯é€šè¿‡æ™®é€š HTTP æˆ– FTP è®¿é—®çš„æ–‡ä»¶ï¼Œåˆ©ç”¨æ ‡å‡† HTTP è¯·æ±‚ä¸‹è½½ç‰‡æ®µã€‚BEP17 è¦æ±‚å¯¹æœåŠ¡å™¨åšé€‚å½“ä¿®æ”¹ï¼Œä»¥æ”¯æŒ BEP17ï¼Œè¿™åœ¨äº’æ“ä½œæ€§æ–¹é¢æ˜¯ä¸€ä¸ªç¼ºç‚¹ï¼Œä½†å®ƒç¡®å®å…·æœ‰å…è®¸ç§å­æœåŠ¡å™¨æ›´å¥½åœ°æ§åˆ¶æµé‡å’Œé¿å…å¸¦å®½æ»¥ç”¨çš„ä¼˜åŠ¿ã€‚\n\n### ç§æœ‰ç§å­åŠ å¼ºæ•°æ®åˆ†äº«éšç§æ€§\n\nç§æœ‰ç§å­æ˜¯åœ¨ [BEP27 - Private Torrents](http://bittorrent.org/beps/bep_0027.html) ä¸­æè¿°çš„ï¼Œé€šè¿‡åœ¨å…ƒæ•°æ®ä¿¡æ¯æ€»å¢åŠ é”®å€¼å¯¹ `private=1` æ¥æ ‡è®°ç§å­ä¸ºç§æœ‰ç§å­ã€‚å®¢æˆ·ç«¯åªèƒ½å‘ç§æœ‰ç§å­å¯¹åº”çš„ç§æœ‰ Tracker é€šå‘Šè‡ªèº«ï¼Œè€Œä¸”åªèƒ½ä¸ç§æœ‰ Tracker è¿”å›çš„ peer å»ºç«‹è¿æ¥ã€‚\n\nå½“ç§æœ‰ç§å­çš„ `announce-list` ä¸­å‡ºç°å¤šä¸ª Tracker åœ°å€æ—¶ï¼Œæ¯ä¸ª peer åœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€ä¸ª Trackerï¼Œåªæœ‰å½“ Tracker å‡ºé”™æ—¶æ‰å¯ä»¥åˆ‡æ¢ Trackerã€‚åœ¨åˆ‡æ¢ Tracker æ—¶ï¼Œpeer å¿…é¡»æ–­å¼€æ‰€æœ‰ä¸å…¶ä»– peer çš„è¿æ¥ï¼Œä¹‹ååªèƒ½ä¸æ–°çš„ Tracker æä¾›çš„ peer å»ºç«‹è¿æ¥ã€‚è¿™å‡è½»äº†æ”»å‡»è€…é€šè¿‡ä¿®æ”¹å…ƒæ•°æ®æ–‡ä»¶ä¸­ `announce-list` åå‘å¸ƒæ–°çš„å…ƒæ•°æ®æ–‡ä»¶è¿›è¡Œæ”»å‡»å¸¦æ¥çš„å½±å“ã€‚\n\nå½“ç§å­ä¸ºç§æœ‰ç§å­æ—¶ï¼Œé€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆåŒ…æ‹¬ DHT, PEX, LSD ç­‰ï¼‰è·å– peer éƒ½ä¼šå¯¹â€œç§æœ‰â€è¿›è¡Œç ´åã€‚ä½†æ˜¯ä¸èƒ½é¿å…æ”»å‡»è€…é€šè¿‡çŒœæµ‹ peer çš„ IP ä¸ç«¯å£çš„æ–¹å¼æ‰¾åˆ° peerï¼Œè¿›è€Œäº§ç”Ÿè¿æ¥ã€‚\n\n### Merkle Tree æ•°æ®ç»“æ„ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°\n\nå¦‚æœç§å­æ–‡ä»¶è¿‡å¤§ï¼Œå¯¹äºæä¾›ç§å­æ–‡ä»¶ä¸‹è½½çš„ä¸­å¿ƒåŒ–æœåŠ¡å™¨å°±ä¼šæœ‰è¾ƒå¤§å‹åŠ›ã€‚ä¸ºäº†è®©å…ƒæ•°æ®æ–‡ä»¶ä½“ç§¯å‡å°ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯å°†æ¯ä¸ªç‰‡æ®µçš„å¤§å°å¢åŠ ï¼ˆä¸Šé™æ˜¯ 2 Mbï¼‰ï¼ŒåŒæ ·å¤§å°çš„æ–‡ä»¶å› æ­¤ä¼šäº§ç”Ÿæ›´å°‘çš„æ‘˜è¦æ•°é‡ã€‚è€ƒè™‘åˆ°åªæœ‰å½“ä¸€ä¸ªç‰‡æ®µè¢«å®Œå…¨æ¥å—å®Œæˆä¸”éªŒè¯æ‘˜è¦åï¼Œæ‰èƒ½å°†ä¹‹ä¸å…¶ä»– peer è¿›è¡Œäº¤æ¢ï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å’Œå…¶ä»– peer è¿›è¡Œäº¤æ¢ã€‚\n\n[BEP30 - Merkle hash torrent extension](http://bittorrent.org/beps/bep_0030.html) åˆ©ç”¨äº† Merkle Tree è¿™ç§æ•°æ®ç»“æ„æ¥ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°ã€‚è¯¥æ–¹æ¡ˆä½¿ç”¨å•ä¸€çš„ Merkle å“ˆå¸Œæ¥æ›¿ä»£æ‘˜è¦åˆ—è¡¨ã€‚Merkle æ•£åˆ—å¯ç”¨äºé€šè¿‡åˆ†å±‚æ–¹æ¡ˆéªŒè¯æ•´ä¸ªå†…å®¹æ–‡ä»¶ä»¥åŠå„ä¸ªå—çš„å®Œæ•´æ€§ã€‚å®ƒé€šè¿‡æ„å»ºä¸æ•°æ®ç›¸å…³çš„å“ˆå¸Œæ ‘å¹¶ä»…éœ€ä½¿ç”¨æ ¹å“ˆå¸Œä½œä¸ºéªŒè¯æ•°æ®å®Œæ•´æ€§çš„ä¾æ®ã€‚\n\nå¦‚å›¾æ‰€ç¤ºï¼ŒP0-P12 ä»£è¡¨ç‰‡æ®µ 0-12ï¼ŒX æ˜¯ä¸ºäº†æ ‘çš„å®Œæ•´è€Œå¡«å……çš„é›¶å€¼ç‰‡æ®µï¼Œ0-30 å‡è¡¨ç¤ºå“ˆå¸Œï¼Œå…¶ä¸­ 0 æ˜¯æ ¹å“ˆå¸Œã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ¥å—åˆ°äº†å®Œæ•´çš„ç‰‡æ®µ P8ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹åªéœ€è¦é¢å¤–é€šè¿‡ä¸€äº›é€”å¾„çŸ¥é“ P8 çš„å§Šå¦¹ç‰‡æ®µ P9 çš„å“ˆå¸Œå€¼ï¼Œä»¥åŠ P8 çš„æ‰€æœ‰å”å—å“ˆå¸Œï¼ˆä¾æ¬¡ä¸º 12ï¼Œ6ï¼Œ1ï¼‰å°±å¯ä»¥éªŒè¯ P8 çš„å®Œæ•´æ€§ã€‚\n\n```\n                                          0* = root hash\n                                       /     \\\n                                   /            \\\n                               /                   \\\n                           /                          \\\n                       /                                 \\\n                     1*                                     2\n                    / \\                                    / \\\n                  /     \\                                /     \\\n                /         \\                            /         \\\n              /             \\                        /             \\\n            /                 \\                    /                 \\\n           3                   4                  5                   6* = uncle\n          / \\                 / \\                / \\                 / \\\n         /   \\               /   \\              /   \\               /   \\\n        /     \\             /     \\            /     \\             /     \\\n      7         8         9        10        11        12*       13        14 \n     / \\       / \\       / \\       / \\       / \\       / \\       / \\       / \\\n   15   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30\n   \n   P0   P1   P2   P3   P4   P5   P6   P7   P8*  P9*  P10  P11  P12   X    X    X\n   = piece index                            =    =                   = filler hash \n                                            p    s                   \n                                            i    i                   \n                                            e    b                   \n                                            c    l\n                                            e    i\n                                                 n\n                                                 g\n```\n\nåŸå§‹èµ„æºå‘å¸ƒè€…éœ€è¦å°†å…ƒæ•°æ®ä¸­çš„åŸæœ¬ç”¨æ¥å­˜å‚¨ç‰‡æ®µæ•£åˆ—å€¼çš„ **pieces** é”®æ›¿æ¢ä¸ºå­˜å‚¨æ ¹å“ˆå¸Œçš„é”® **root hash**ã€‚\n\næ”¯æŒ Merkle Tree å“ˆå¸Œæ–¹å¼çš„å®¢æˆ·ç«¯éœ€è¦åŒæ—¶æ”¯æŒæ‰©å±•æ¶ˆæ¯ï¼ˆè§ {% post_link bt-peer %}ï¼‰æ¥æ›¿ä»£æ™®é€šçš„ **piece** æ¶ˆæ¯æ¥å®Œæˆæ•°æ®ä¼ è¾“ã€‚ç”¨äºä¼ è¾“æ•°æ®çš„æ‰©å±•æ¶ˆæ¯ç±»å‹æ˜¯ **Tr_hashpiece** ï¼Œå’Œå…¶ä»–æ‰©å±•æ¶ˆæ¯ä¸€æ ·ï¼Œè¿™ä¸ªæ¶ˆæ¯ä¹Ÿéœ€è¦åœ¨ peer é—´çš„æ‰©å±•æ¡æ‰‹æ¶ˆæ¯ä¸­å£°æ˜ã€‚\n\n**Tr_hashpiece** æ¶ˆæ¯çš„è´Ÿè½½å†…å®¹å¦‚ä¸‹ï¼š\n\n- indexï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨æ•°æ®ç‰‡æ®µåºå·ï¼›\n- beginï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨å½“å‰å½“å‰æ•°æ®å­ç‰‡æ®µåœ¨æ•´ä¸ªç‰‡æ®µä¸­çš„åç§»é‡ï¼›\n- hashlist lengthï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨å“ˆå¸Œåˆ—è¡¨çš„é•¿åº¦\n- hashlistï¼šå“ˆå¸Œåˆ—è¡¨ï¼ŒåŒ…æ‹¬ç‰‡æ®µè‡ªèº«å“ˆå¸Œï¼Œå§Šå¦¹ç‰‡æ®µå“ˆå¸Œï¼Œä»¥åŠå„ä¸ªå”ç‰‡æ®µå“ˆå¸Œï¼Œæœ€åæ˜¯æ ¹å“ˆå¸Œï¼Œåªæœ‰å½“ begin ä¸º 0 æ—¶ï¼Œæ‰éœ€è¦ä¼ è¾“ hashlistï¼›\n- subpiece dataï¼šæ•°æ®å­ç‰‡æ®µï¼›\n\nåœ¨ peer æ¥æ”¶å®ŒæˆæŸä¸ªæ•°æ®ç‰‡æ®µçš„ **Tr_hashpiece** æ¶ˆæ¯åï¼Œå®ƒå°†æ ¹æ® hashlist ä¸­çš„å“ˆå¸Œåˆ—è¡¨è®¡ç®—å‡ºçš„æ ¹å“ˆå¸Œä¸åŸæœ‰çš„æ ¹å“ˆå¸Œè¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœåŒ¹é…ï¼Œæ‰€æœ‰å“ˆå¸Œå€¼éƒ½ä¿å­˜åœ¨è¯¥ peer è‡ªå·±çš„ Merkle Tree ä¸­ï¼Œä¹‹åå®ƒä»¬å¯ä»¥è¢«ä¼ é€’ç»™å…¶ä»–äººã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ Merkle Tree çš„ Torrent ä¸ä½¿ç”¨æ•£åˆ—å€¼åˆ—è¡¨çš„ Torrent å³ä½¿å®ƒä»¬çš„æ•°æ®å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯ç”±äº infohash ä¸ä¸€è‡´ï¼Œå¯¼è‡´å®ƒä»¬ä¸åœ¨åŒä¸€ä¸ª Swarm ä¸­ã€‚å¦å¤–ä¸€æ—¦é‡‡ç”¨äº† Merkle Tree çš„æ–¹å¼ï¼Œé€šè¿‡ WebSeed æ¥è·å–æ•°æ®å°±å˜å¾—ä¸å…¼å®¹ã€‚\n\n## å…¶ä»–æ–¹æ¡ˆç®€è¿°\n\n- [BEP35 - Torrent Signing](http://www.bittorrent.org/beps/bep_0035.html)ã€€åˆ©ç”¨å¯¹ç§å­è¿›è¡Œç­¾åä»¥å¢åŠ ä¸‹è½½å®‰å…¨æ€§ã€‚\n- [BEP36 - Torrent RSS feeds](http://bittorrent.org/beps/bep_0036.html) å®šä¹‰äº† RSS è®¢é˜…ç§å­çš„ feed æ ¼å¼ã€‚\n- [BEP38 - Finding Local Data Via Torrent File Hints](http://bittorrent.org/beps/bep_0038.html) åˆ™æå‡ºäº†ç²—ç•¥åœ°æ£€æµ‹ç”¨æˆ·æœ¬åœ°æ˜¯å¦å·²ç»å­˜åœ¨å…¨éƒ¨æˆ–è€…éƒ¨åˆ†å³å°†ä¸‹è½½çš„æ–‡ä»¶çš„æ–¹æ¡ˆã€‚ä¸»è¦æ¶‰åŠåœ¨ç§å­æ–‡ä»¶ä¸­æ·»åŠ  `similar` æˆ– `collections` è¿™ä¸¤ä¸ªé”®ã€‚å‰è€…è¡¨ç¤ºå¯èƒ½ä¸æŸä¸ª infohash å…±äº«éƒ¨åˆ†æ•°æ®ï¼Œåè€…è¡¨ç¤ºè¯¥ç§å­æ–‡ä»¶æ‰€å±çš„é›†åˆï¼Œå±äºåŒä¸€é›†åˆçš„ç§å­å¯èƒ½å…±äº«æ–‡ä»¶ã€‚\n- [BEP39 - Updating Torrents Via Feed URL](http://bittorrent.org/beps/bep_0039.html) ä½¿ç”¨åœ¨ info ä¸­çš„é”® `update-url` æ¥è¡¨æ˜ç”¨äºæ›´æ–°è¯¥ç§å­çš„é“¾æ¥åœ°å€ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚è¯¥åœ°å€æˆåŠŸä¸”å¾—åˆ°ä¸€ä¸ªç§å­æ–‡ä»¶ï¼Œåˆ™éœ€è¦ä¸‹è½½è¯¥æ›´æ–°åçš„ç§å­ã€‚\n- [BEP47 - Padding files and extended file attributes](http://bittorrent.org/beps/bep_0047.html) åœ¨åŸå§‹å…ƒæ•°æ®æè¿°æ–‡ä»¶ä¿¡æ¯çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›é¢å¤–çš„å±æ€§ã€‚ä¾‹å¦‚ç¬¦å·é“¾æ¥é‡å¤æ–‡ä»¶ï¼›ä¸ºæ–‡ä»¶æ·»åŠ  padding ä»¥ä½¿å¾—ä¸‹ä¸€ä¸ªæ–‡ä»¶æ•°æ®ä»ç‰‡æ®µè¾¹ç¼˜å¼€å§‹ã€‚\n- [BEP49 - Distributed Torrent Feeds](http://bittorrent.org/beps/bep_0049.html) ä¸ BEP36 æä¾›çš„ RSS è®¢é˜…åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯é€šè¿‡ DHT ç½‘ç»œå®ç°ã€‚\n\n## å‚è€ƒèµ„æ–™\n\n1. [Implement Web (HTTP) Seeding (BEP17+BEP19) Â· Issue #67 Â· webtorrent/webtorrent](https://github.com/webtorrent/webtorrent/issues/67)\n","slug":"bt-advanced","published":1,"updated":"2020-07-18T06:30:19.513Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuhb0003w80v41haxnk7","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>æœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» BEP ä¸­å‰©ä¸‹çš„æ”¹è¿›æ–¹æ¡ˆï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡ <a href=\"/2018/08/26/bt-overview/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\">BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°</a>ã€‚</p>\n<h2 id=\"è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\"><a href=\"#è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\" class=\"headerlink\" title=\"è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\"></a>è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ</h2><p>æœ¬èŠ‚ç‚¹è¯¦ç»†ä»‹ç»å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆã€‚å‰©ä½™çš„åªä½œç®€å•å½’çº³ã€‚</p>\n<h3 id=\"è¶…çº§åšç§æ¨¡å¼æé«˜åšç§æ•ˆç‡\"><a href=\"#è¶…çº§åšç§æ¨¡å¼æé«˜åšç§æ•ˆç‡\" class=\"headerlink\" title=\"è¶…çº§åšç§æ¨¡å¼æé«˜åšç§æ•ˆç‡\"></a>è¶…çº§åšç§æ¨¡å¼æé«˜åšç§æ•ˆç‡</h3><p><a href=\"http://bittorrent.org/beps/bep_0016.html\" target=\"_blank\" rel=\"noopener\">BEP16 - Superseeding</a> ä¸­èµ·è‰çš„è¶…çº§åšç§åŠŸèƒ½æ˜¯ä¸€ä¸ªæ¥å¸®åŠ©åˆå§‹åšç§è€…ä½¿ç”¨è¾ƒå°‘çš„æµé‡æ¥å®Œæˆåšç§çš„ç®—æ³•ã€‚å½“ä¸€ä¸ªåšç§å®¢æˆ·ç«¯è¿›å…¥è¶…çº§åšç§æ¨¡å¼åï¼Œå®ƒå°†ä¸ä¼šè¡¨ç°ä¸ºä¸€ä¸ªæ ‡å‡†çš„åšç§è€…ï¼Œè€Œæ˜¯ä¼ªè£…æˆä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„æ­£å¸¸ peerã€‚å½“æœ‰å…¶ä»– peer è¿æ¥æ—¶ï¼Œå®ƒä»…å°†ä¸€ä¸ªä»æœªå‘é€è¿‡çš„ç‰‡æ®µå‘é€ç»™åˆšè¿æ¥çš„ peerï¼Œåœ¨ä¸€ä¸ªåˆ«çš„ peer é€šçŸ¥åˆ°è¯¥åšç§è€…è¿™ä¸ªç‰‡æ®µå‰ï¼Œåšç§è€…ä¸ä¼šå‘åˆšæ‰çš„ peer å‘é€æ–°çš„ç‰‡æ®µï¼Œä»¥æ­¤èŠ‚çº¦åšç§è€…çš„æµé‡ã€‚<br>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨è¶…çº§ç§å­æ¨¡å¼ã€‚è™½ç„¶å®ƒç¡®å®æœ‰åŠ©äºæ›´å¹¿æ³›åœ°åˆ†å‘ç¨€æœ‰æ•°æ®ï¼Œå› ä¸ºå®ƒé™åˆ¶äº†å®¢æˆ·ç«¯å¯ä»¥ä¸‹è½½çš„ç‰‡æ®µçš„é€‰æ‹©ï¼Œä½†ä¹Ÿé™åˆ¶äº†è¿™äº›å®¢æˆ·ç«¯ä¸‹è½½å·²ç»æ£€ç´¢åˆ°çš„éƒ¨åˆ†ç‰‡æ®µæ•°æ®çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œè¶…çº§ç§å­æ¨¡å¼ä»…æ¨èç”¨äºåˆå§‹ç§å­æœåŠ¡å™¨ã€‚</p>\n<h3 id=\"ä½¿ç”¨-Web-æ–¹å¼åšç§\"><a href=\"#ä½¿ç”¨-Web-æ–¹å¼åšç§\" class=\"headerlink\" title=\"ä½¿ç”¨ Web æ–¹å¼åšç§\"></a>ä½¿ç”¨ Web æ–¹å¼åšç§</h3><p>WebSeed åœ¨ BEP ä¸­æœ‰ä¸¤ä¸ªå¢å¼ºå»ºè®®ï¼š<a href=\"http://bittorrent.org/beps/bep_0019.html\" target=\"_blank\" rel=\"noopener\">BEP19 - HTTP/FTP Seeding (GetRight style)</a> å’Œ <a href=\"http://bittorrent.org/beps/bep_0017.html\" target=\"_blank\" rel=\"noopener\">BEP17 - Seeding (Hoffman-style)</a></p>\n<p>BEP17 æä¾›äº†ä¸€ç§é€šè¿‡ HTTP åè®®åšç§ä»¥åŠä» HTTP è·å–æ•°æ®çš„æ–¹å¼ã€‚åˆå§‹åšç§è€…ä¸»è¦åœ¨å…ƒæ•°æ®æ–‡ä»¶ä¸­åŠ å…¥é”® <code>httpseeds</code>ï¼Œå€¼ä¸ºæ”¯æŒ HTTP Seeding æœåŠ¡å™¨åœ°å€åˆ—è¡¨ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">d[&apos;httpseeds&apos;] = [ &apos;http://www.site1.com/source1.php&apos;,</span><br><span class=\"line\">                   &apos;http://www.site2.com/source2.php&apos;  ]</span><br></pre></td></tr></table></figure>\n\n<p>å®¢æˆ·ç«¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—® HTTP Seeding æœåŠ¡å™¨è·å–å…¨éƒ¨æˆ–è€…ç‰¹å®šæ•°æ®ç‰‡æ®µã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;url&gt;?info_hash=[hash]&amp;piece=[piece]&#123;&amp;ranges=[start]-[end]&#123;,[start]-[end]&#125;...&#125;</span><br></pre></td></tr></table></figure>\n\n<p>BEP19 é€šå‘ŠæœåŠ¡å™¨åœ°å€çš„æ–¹å¼å’Œ BEP17 å·®ä¸å¤šï¼Œä½†æ˜¯é”®æ”¹ä¸ºäº† <code>url-list</code>ã€‚BEP19 çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿå¤„ç†ä»»ä½•å¯é€šè¿‡æ™®é€š HTTP æˆ– FTP è®¿é—®çš„æ–‡ä»¶ï¼Œåˆ©ç”¨æ ‡å‡† HTTP è¯·æ±‚ä¸‹è½½ç‰‡æ®µã€‚BEP17 è¦æ±‚å¯¹æœåŠ¡å™¨åšé€‚å½“ä¿®æ”¹ï¼Œä»¥æ”¯æŒ BEP17ï¼Œè¿™åœ¨äº’æ“ä½œæ€§æ–¹é¢æ˜¯ä¸€ä¸ªç¼ºç‚¹ï¼Œä½†å®ƒç¡®å®å…·æœ‰å…è®¸ç§å­æœåŠ¡å™¨æ›´å¥½åœ°æ§åˆ¶æµé‡å’Œé¿å…å¸¦å®½æ»¥ç”¨çš„ä¼˜åŠ¿ã€‚</p>\n<h3 id=\"ç§æœ‰ç§å­åŠ å¼ºæ•°æ®åˆ†äº«éšç§æ€§\"><a href=\"#ç§æœ‰ç§å­åŠ å¼ºæ•°æ®åˆ†äº«éšç§æ€§\" class=\"headerlink\" title=\"ç§æœ‰ç§å­åŠ å¼ºæ•°æ®åˆ†äº«éšç§æ€§\"></a>ç§æœ‰ç§å­åŠ å¼ºæ•°æ®åˆ†äº«éšç§æ€§</h3><p>ç§æœ‰ç§å­æ˜¯åœ¨ <a href=\"http://bittorrent.org/beps/bep_0027.html\" target=\"_blank\" rel=\"noopener\">BEP27 - Private Torrents</a> ä¸­æè¿°çš„ï¼Œé€šè¿‡åœ¨å…ƒæ•°æ®ä¿¡æ¯æ€»å¢åŠ é”®å€¼å¯¹ <code>private=1</code> æ¥æ ‡è®°ç§å­ä¸ºç§æœ‰ç§å­ã€‚å®¢æˆ·ç«¯åªèƒ½å‘ç§æœ‰ç§å­å¯¹åº”çš„ç§æœ‰ Tracker é€šå‘Šè‡ªèº«ï¼Œè€Œä¸”åªèƒ½ä¸ç§æœ‰ Tracker è¿”å›çš„ peer å»ºç«‹è¿æ¥ã€‚</p>\n<p>å½“ç§æœ‰ç§å­çš„ <code>announce-list</code> ä¸­å‡ºç°å¤šä¸ª Tracker åœ°å€æ—¶ï¼Œæ¯ä¸ª peer åœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€ä¸ª Trackerï¼Œåªæœ‰å½“ Tracker å‡ºé”™æ—¶æ‰å¯ä»¥åˆ‡æ¢ Trackerã€‚åœ¨åˆ‡æ¢ Tracker æ—¶ï¼Œpeer å¿…é¡»æ–­å¼€æ‰€æœ‰ä¸å…¶ä»– peer çš„è¿æ¥ï¼Œä¹‹ååªèƒ½ä¸æ–°çš„ Tracker æä¾›çš„ peer å»ºç«‹è¿æ¥ã€‚è¿™å‡è½»äº†æ”»å‡»è€…é€šè¿‡ä¿®æ”¹å…ƒæ•°æ®æ–‡ä»¶ä¸­ <code>announce-list</code> åå‘å¸ƒæ–°çš„å…ƒæ•°æ®æ–‡ä»¶è¿›è¡Œæ”»å‡»å¸¦æ¥çš„å½±å“ã€‚</p>\n<p>å½“ç§å­ä¸ºç§æœ‰ç§å­æ—¶ï¼Œé€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆåŒ…æ‹¬ DHT, PEX, LSD ç­‰ï¼‰è·å– peer éƒ½ä¼šå¯¹â€œç§æœ‰â€è¿›è¡Œç ´åã€‚ä½†æ˜¯ä¸èƒ½é¿å…æ”»å‡»è€…é€šè¿‡çŒœæµ‹ peer çš„ IP ä¸ç«¯å£çš„æ–¹å¼æ‰¾åˆ° peerï¼Œè¿›è€Œäº§ç”Ÿè¿æ¥ã€‚</p>\n<h3 id=\"Merkle-Tree-æ•°æ®ç»“æ„ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°\"><a href=\"#Merkle-Tree-æ•°æ®ç»“æ„ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°\" class=\"headerlink\" title=\"Merkle Tree æ•°æ®ç»“æ„ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°\"></a>Merkle Tree æ•°æ®ç»“æ„ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°</h3><p>å¦‚æœç§å­æ–‡ä»¶è¿‡å¤§ï¼Œå¯¹äºæä¾›ç§å­æ–‡ä»¶ä¸‹è½½çš„ä¸­å¿ƒåŒ–æœåŠ¡å™¨å°±ä¼šæœ‰è¾ƒå¤§å‹åŠ›ã€‚ä¸ºäº†è®©å…ƒæ•°æ®æ–‡ä»¶ä½“ç§¯å‡å°ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯å°†æ¯ä¸ªç‰‡æ®µçš„å¤§å°å¢åŠ ï¼ˆä¸Šé™æ˜¯ 2 Mbï¼‰ï¼ŒåŒæ ·å¤§å°çš„æ–‡ä»¶å› æ­¤ä¼šäº§ç”Ÿæ›´å°‘çš„æ‘˜è¦æ•°é‡ã€‚è€ƒè™‘åˆ°åªæœ‰å½“ä¸€ä¸ªç‰‡æ®µè¢«å®Œå…¨æ¥å—å®Œæˆä¸”éªŒè¯æ‘˜è¦åï¼Œæ‰èƒ½å°†ä¹‹ä¸å…¶ä»– peer è¿›è¡Œäº¤æ¢ï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å’Œå…¶ä»– peer è¿›è¡Œäº¤æ¢ã€‚</p>\n<p><a href=\"http://bittorrent.org/beps/bep_0030.html\" target=\"_blank\" rel=\"noopener\">BEP30 - Merkle hash torrent extension</a> åˆ©ç”¨äº† Merkle Tree è¿™ç§æ•°æ®ç»“æ„æ¥ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°ã€‚è¯¥æ–¹æ¡ˆä½¿ç”¨å•ä¸€çš„ Merkle å“ˆå¸Œæ¥æ›¿ä»£æ‘˜è¦åˆ—è¡¨ã€‚Merkle æ•£åˆ—å¯ç”¨äºé€šè¿‡åˆ†å±‚æ–¹æ¡ˆéªŒè¯æ•´ä¸ªå†…å®¹æ–‡ä»¶ä»¥åŠå„ä¸ªå—çš„å®Œæ•´æ€§ã€‚å®ƒé€šè¿‡æ„å»ºä¸æ•°æ®ç›¸å…³çš„å“ˆå¸Œæ ‘å¹¶ä»…éœ€ä½¿ç”¨æ ¹å“ˆå¸Œä½œä¸ºéªŒè¯æ•°æ®å®Œæ•´æ€§çš„ä¾æ®ã€‚</p>\n<p>å¦‚å›¾æ‰€ç¤ºï¼ŒP0-P12 ä»£è¡¨ç‰‡æ®µ 0-12ï¼ŒX æ˜¯ä¸ºäº†æ ‘çš„å®Œæ•´è€Œå¡«å……çš„é›¶å€¼ç‰‡æ®µï¼Œ0-30 å‡è¡¨ç¤ºå“ˆå¸Œï¼Œå…¶ä¸­ 0 æ˜¯æ ¹å“ˆå¸Œã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ¥å—åˆ°äº†å®Œæ•´çš„ç‰‡æ®µ P8ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹åªéœ€è¦é¢å¤–é€šè¿‡ä¸€äº›é€”å¾„çŸ¥é“ P8 çš„å§Šå¦¹ç‰‡æ®µ P9 çš„å“ˆå¸Œå€¼ï¼Œä»¥åŠ P8 çš„æ‰€æœ‰å”å—å“ˆå¸Œï¼ˆä¾æ¬¡ä¸º 12ï¼Œ6ï¼Œ1ï¼‰å°±å¯ä»¥éªŒè¯ P8 çš„å®Œæ•´æ€§ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                                       0* = root hash</span><br><span class=\"line\">                                    /     \\</span><br><span class=\"line\">                                /            \\</span><br><span class=\"line\">                            /                   \\</span><br><span class=\"line\">                        /                          \\</span><br><span class=\"line\">                    /                                 \\</span><br><span class=\"line\">                  1*                                     2</span><br><span class=\"line\">                 / \\                                    / \\</span><br><span class=\"line\">               /     \\                                /     \\</span><br><span class=\"line\">             /         \\                            /         \\</span><br><span class=\"line\">           /             \\                        /             \\</span><br><span class=\"line\">         /                 \\                    /                 \\</span><br><span class=\"line\">        3                   4                  5                   6* = uncle</span><br><span class=\"line\">       / \\                 / \\                / \\                 / \\</span><br><span class=\"line\">      /   \\               /   \\              /   \\               /   \\</span><br><span class=\"line\">     /     \\             /     \\            /     \\             /     \\</span><br><span class=\"line\">   7         8         9        10        11        12*       13        14 </span><br><span class=\"line\">  / \\       / \\       / \\       / \\       / \\       / \\       / \\       / \\</span><br><span class=\"line\">15   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30</span><br><span class=\"line\"></span><br><span class=\"line\">P0   P1   P2   P3   P4   P5   P6   P7   P8*  P9*  P10  P11  P12   X    X    X</span><br><span class=\"line\">= piece index                            =    =                   = filler hash </span><br><span class=\"line\">                                         p    s                   </span><br><span class=\"line\">                                         i    i                   </span><br><span class=\"line\">                                         e    b                   </span><br><span class=\"line\">                                         c    l</span><br><span class=\"line\">                                         e    i</span><br><span class=\"line\">                                              n</span><br><span class=\"line\">                                              g</span><br></pre></td></tr></table></figure>\n\n<p>åŸå§‹èµ„æºå‘å¸ƒè€…éœ€è¦å°†å…ƒæ•°æ®ä¸­çš„åŸæœ¬ç”¨æ¥å­˜å‚¨ç‰‡æ®µæ•£åˆ—å€¼çš„ <strong>pieces</strong> é”®æ›¿æ¢ä¸ºå­˜å‚¨æ ¹å“ˆå¸Œçš„é”® <strong>root hash</strong>ã€‚</p>\n<p>æ”¯æŒ Merkle Tree å“ˆå¸Œæ–¹å¼çš„å®¢æˆ·ç«¯éœ€è¦åŒæ—¶æ”¯æŒæ‰©å±•æ¶ˆæ¯ï¼ˆè§ <a href=\"/2018/08/30/bt-peer/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹ Peer\">BT å¢å¼ºå»ºè®®ä¹‹ Peer</a>ï¼‰æ¥æ›¿ä»£æ™®é€šçš„ <strong>piece</strong> æ¶ˆæ¯æ¥å®Œæˆæ•°æ®ä¼ è¾“ã€‚ç”¨äºä¼ è¾“æ•°æ®çš„æ‰©å±•æ¶ˆæ¯ç±»å‹æ˜¯ <strong>Tr_hashpiece</strong> ï¼Œå’Œå…¶ä»–æ‰©å±•æ¶ˆæ¯ä¸€æ ·ï¼Œè¿™ä¸ªæ¶ˆæ¯ä¹Ÿéœ€è¦åœ¨ peer é—´çš„æ‰©å±•æ¡æ‰‹æ¶ˆæ¯ä¸­å£°æ˜ã€‚</p>\n<p><strong>Tr_hashpiece</strong> æ¶ˆæ¯çš„è´Ÿè½½å†…å®¹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>indexï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨æ•°æ®ç‰‡æ®µåºå·ï¼›</li>\n<li>beginï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨å½“å‰å½“å‰æ•°æ®å­ç‰‡æ®µåœ¨æ•´ä¸ªç‰‡æ®µä¸­çš„åç§»é‡ï¼›</li>\n<li>hashlist lengthï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨å“ˆå¸Œåˆ—è¡¨çš„é•¿åº¦</li>\n<li>hashlistï¼šå“ˆå¸Œåˆ—è¡¨ï¼ŒåŒ…æ‹¬ç‰‡æ®µè‡ªèº«å“ˆå¸Œï¼Œå§Šå¦¹ç‰‡æ®µå“ˆå¸Œï¼Œä»¥åŠå„ä¸ªå”ç‰‡æ®µå“ˆå¸Œï¼Œæœ€åæ˜¯æ ¹å“ˆå¸Œï¼Œåªæœ‰å½“ begin ä¸º 0 æ—¶ï¼Œæ‰éœ€è¦ä¼ è¾“ hashlistï¼›</li>\n<li>subpiece dataï¼šæ•°æ®å­ç‰‡æ®µï¼›</li>\n</ul>\n<p>åœ¨ peer æ¥æ”¶å®ŒæˆæŸä¸ªæ•°æ®ç‰‡æ®µçš„ <strong>Tr_hashpiece</strong> æ¶ˆæ¯åï¼Œå®ƒå°†æ ¹æ® hashlist ä¸­çš„å“ˆå¸Œåˆ—è¡¨è®¡ç®—å‡ºçš„æ ¹å“ˆå¸Œä¸åŸæœ‰çš„æ ¹å“ˆå¸Œè¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœåŒ¹é…ï¼Œæ‰€æœ‰å“ˆå¸Œå€¼éƒ½ä¿å­˜åœ¨è¯¥ peer è‡ªå·±çš„ Merkle Tree ä¸­ï¼Œä¹‹åå®ƒä»¬å¯ä»¥è¢«ä¼ é€’ç»™å…¶ä»–äººã€‚</p>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ Merkle Tree çš„ Torrent ä¸ä½¿ç”¨æ•£åˆ—å€¼åˆ—è¡¨çš„ Torrent å³ä½¿å®ƒä»¬çš„æ•°æ®å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯ç”±äº infohash ä¸ä¸€è‡´ï¼Œå¯¼è‡´å®ƒä»¬ä¸åœ¨åŒä¸€ä¸ª Swarm ä¸­ã€‚å¦å¤–ä¸€æ—¦é‡‡ç”¨äº† Merkle Tree çš„æ–¹å¼ï¼Œé€šè¿‡ WebSeed æ¥è·å–æ•°æ®å°±å˜å¾—ä¸å…¼å®¹ã€‚</p>\n<h2 id=\"å…¶ä»–æ–¹æ¡ˆç®€è¿°\"><a href=\"#å…¶ä»–æ–¹æ¡ˆç®€è¿°\" class=\"headerlink\" title=\"å…¶ä»–æ–¹æ¡ˆç®€è¿°\"></a>å…¶ä»–æ–¹æ¡ˆç®€è¿°</h2><ul>\n<li><a href=\"http://www.bittorrent.org/beps/bep_0035.html\" target=\"_blank\" rel=\"noopener\">BEP35 - Torrent Signing</a>ã€€åˆ©ç”¨å¯¹ç§å­è¿›è¡Œç­¾åä»¥å¢åŠ ä¸‹è½½å®‰å…¨æ€§ã€‚</li>\n<li><a href=\"http://bittorrent.org/beps/bep_0036.html\" target=\"_blank\" rel=\"noopener\">BEP36 - Torrent RSS feeds</a> å®šä¹‰äº† RSS è®¢é˜…ç§å­çš„ feed æ ¼å¼ã€‚</li>\n<li><a href=\"http://bittorrent.org/beps/bep_0038.html\" target=\"_blank\" rel=\"noopener\">BEP38 - Finding Local Data Via Torrent File Hints</a> åˆ™æå‡ºäº†ç²—ç•¥åœ°æ£€æµ‹ç”¨æˆ·æœ¬åœ°æ˜¯å¦å·²ç»å­˜åœ¨å…¨éƒ¨æˆ–è€…éƒ¨åˆ†å³å°†ä¸‹è½½çš„æ–‡ä»¶çš„æ–¹æ¡ˆã€‚ä¸»è¦æ¶‰åŠåœ¨ç§å­æ–‡ä»¶ä¸­æ·»åŠ  <code>similar</code> æˆ– <code>collections</code> è¿™ä¸¤ä¸ªé”®ã€‚å‰è€…è¡¨ç¤ºå¯èƒ½ä¸æŸä¸ª infohash å…±äº«éƒ¨åˆ†æ•°æ®ï¼Œåè€…è¡¨ç¤ºè¯¥ç§å­æ–‡ä»¶æ‰€å±çš„é›†åˆï¼Œå±äºåŒä¸€é›†åˆçš„ç§å­å¯èƒ½å…±äº«æ–‡ä»¶ã€‚</li>\n<li><a href=\"http://bittorrent.org/beps/bep_0039.html\" target=\"_blank\" rel=\"noopener\">BEP39 - Updating Torrents Via Feed URL</a> ä½¿ç”¨åœ¨ info ä¸­çš„é”® <code>update-url</code> æ¥è¡¨æ˜ç”¨äºæ›´æ–°è¯¥ç§å­çš„é“¾æ¥åœ°å€ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚è¯¥åœ°å€æˆåŠŸä¸”å¾—åˆ°ä¸€ä¸ªç§å­æ–‡ä»¶ï¼Œåˆ™éœ€è¦ä¸‹è½½è¯¥æ›´æ–°åçš„ç§å­ã€‚</li>\n<li><a href=\"http://bittorrent.org/beps/bep_0047.html\" target=\"_blank\" rel=\"noopener\">BEP47 - Padding files and extended file attributes</a> åœ¨åŸå§‹å…ƒæ•°æ®æè¿°æ–‡ä»¶ä¿¡æ¯çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›é¢å¤–çš„å±æ€§ã€‚ä¾‹å¦‚ç¬¦å·é“¾æ¥é‡å¤æ–‡ä»¶ï¼›ä¸ºæ–‡ä»¶æ·»åŠ  padding ä»¥ä½¿å¾—ä¸‹ä¸€ä¸ªæ–‡ä»¶æ•°æ®ä»ç‰‡æ®µè¾¹ç¼˜å¼€å§‹ã€‚</li>\n<li><a href=\"http://bittorrent.org/beps/bep_0049.html\" target=\"_blank\" rel=\"noopener\">BEP49 - Distributed Torrent Feeds</a> ä¸ BEP36 æä¾›çš„ RSS è®¢é˜…åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯é€šè¿‡ DHT ç½‘ç»œå®ç°ã€‚</li>\n</ul>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://github.com/webtorrent/webtorrent/issues/67\" target=\"_blank\" rel=\"noopener\">Implement Web (HTTP) Seeding (BEP17+BEP19) Â· Issue #67 Â· webtorrent/webtorrent</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p>æœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» BEP ä¸­å‰©ä¸‹çš„æ”¹è¿›æ–¹æ¡ˆï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡ <a href=\"/2018/08/26/bt-overview/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\">BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°</a>ã€‚</p>\n<h2 id=\"è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\"><a href=\"#è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\" class=\"headerlink\" title=\"è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\"></a>è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ</h2><p>æœ¬èŠ‚ç‚¹è¯¦ç»†ä»‹ç»å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆã€‚å‰©ä½™çš„åªä½œç®€å•å½’çº³ã€‚</p>\n<h3 id=\"è¶…çº§åšç§æ¨¡å¼æé«˜åšç§æ•ˆç‡\"><a href=\"#è¶…çº§åšç§æ¨¡å¼æé«˜åšç§æ•ˆç‡\" class=\"headerlink\" title=\"è¶…çº§åšç§æ¨¡å¼æé«˜åšç§æ•ˆç‡\"></a>è¶…çº§åšç§æ¨¡å¼æé«˜åšç§æ•ˆç‡</h3><p><a href=\"http://bittorrent.org/beps/bep_0016.html\" target=\"_blank\" rel=\"noopener\">BEP16 - Superseeding</a> ä¸­èµ·è‰çš„è¶…çº§åšç§åŠŸèƒ½æ˜¯ä¸€ä¸ªæ¥å¸®åŠ©åˆå§‹åšç§è€…ä½¿ç”¨è¾ƒå°‘çš„æµé‡æ¥å®Œæˆåšç§çš„ç®—æ³•ã€‚å½“ä¸€ä¸ªåšç§å®¢æˆ·ç«¯è¿›å…¥è¶…çº§åšç§æ¨¡å¼åï¼Œå®ƒå°†ä¸ä¼šè¡¨ç°ä¸ºä¸€ä¸ªæ ‡å‡†çš„åšç§è€…ï¼Œè€Œæ˜¯ä¼ªè£…æˆä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„æ­£å¸¸ peerã€‚å½“æœ‰å…¶ä»– peer è¿æ¥æ—¶ï¼Œå®ƒä»…å°†ä¸€ä¸ªä»æœªå‘é€è¿‡çš„ç‰‡æ®µå‘é€ç»™åˆšè¿æ¥çš„ peerï¼Œåœ¨ä¸€ä¸ªåˆ«çš„ peer é€šçŸ¥åˆ°è¯¥åšç§è€…è¿™ä¸ªç‰‡æ®µå‰ï¼Œåšç§è€…ä¸ä¼šå‘åˆšæ‰çš„ peer å‘é€æ–°çš„ç‰‡æ®µï¼Œä»¥æ­¤èŠ‚çº¦åšç§è€…çš„æµé‡ã€‚<br>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ä½¿ç”¨è¶…çº§ç§å­æ¨¡å¼ã€‚è™½ç„¶å®ƒç¡®å®æœ‰åŠ©äºæ›´å¹¿æ³›åœ°åˆ†å‘ç¨€æœ‰æ•°æ®ï¼Œå› ä¸ºå®ƒé™åˆ¶äº†å®¢æˆ·ç«¯å¯ä»¥ä¸‹è½½çš„ç‰‡æ®µçš„é€‰æ‹©ï¼Œä½†ä¹Ÿé™åˆ¶äº†è¿™äº›å®¢æˆ·ç«¯ä¸‹è½½å·²ç»æ£€ç´¢åˆ°çš„éƒ¨åˆ†ç‰‡æ®µæ•°æ®çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œè¶…çº§ç§å­æ¨¡å¼ä»…æ¨èç”¨äºåˆå§‹ç§å­æœåŠ¡å™¨ã€‚</p>\n<h3 id=\"ä½¿ç”¨-Web-æ–¹å¼åšç§\"><a href=\"#ä½¿ç”¨-Web-æ–¹å¼åšç§\" class=\"headerlink\" title=\"ä½¿ç”¨ Web æ–¹å¼åšç§\"></a>ä½¿ç”¨ Web æ–¹å¼åšç§</h3><p>WebSeed åœ¨ BEP ä¸­æœ‰ä¸¤ä¸ªå¢å¼ºå»ºè®®ï¼š<a href=\"http://bittorrent.org/beps/bep_0019.html\" target=\"_blank\" rel=\"noopener\">BEP19 - HTTP/FTP Seeding (GetRight style)</a> å’Œ <a href=\"http://bittorrent.org/beps/bep_0017.html\" target=\"_blank\" rel=\"noopener\">BEP17 - Seeding (Hoffman-style)</a></p>\n<p>BEP17 æä¾›äº†ä¸€ç§é€šè¿‡ HTTP åè®®åšç§ä»¥åŠä» HTTP è·å–æ•°æ®çš„æ–¹å¼ã€‚åˆå§‹åšç§è€…ä¸»è¦åœ¨å…ƒæ•°æ®æ–‡ä»¶ä¸­åŠ å…¥é”® <code>httpseeds</code>ï¼Œå€¼ä¸ºæ”¯æŒ HTTP Seeding æœåŠ¡å™¨åœ°å€åˆ—è¡¨ï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">d[&apos;httpseeds&apos;] = [ &apos;http://www.site1.com/source1.php&apos;,</span><br><span class=\"line\">                   &apos;http://www.site2.com/source2.php&apos;  ]</span><br></pre></td></tr></table></figure>\n\n<p>å®¢æˆ·ç«¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—® HTTP Seeding æœåŠ¡å™¨è·å–å…¨éƒ¨æˆ–è€…ç‰¹å®šæ•°æ®ç‰‡æ®µã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;url&gt;?info_hash=[hash]&amp;piece=[piece]&#123;&amp;ranges=[start]-[end]&#123;,[start]-[end]&#125;...&#125;</span><br></pre></td></tr></table></figure>\n\n<p>BEP19 é€šå‘ŠæœåŠ¡å™¨åœ°å€çš„æ–¹å¼å’Œ BEP17 å·®ä¸å¤šï¼Œä½†æ˜¯é”®æ”¹ä¸ºäº† <code>url-list</code>ã€‚BEP19 çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿå¤„ç†ä»»ä½•å¯é€šè¿‡æ™®é€š HTTP æˆ– FTP è®¿é—®çš„æ–‡ä»¶ï¼Œåˆ©ç”¨æ ‡å‡† HTTP è¯·æ±‚ä¸‹è½½ç‰‡æ®µã€‚BEP17 è¦æ±‚å¯¹æœåŠ¡å™¨åšé€‚å½“ä¿®æ”¹ï¼Œä»¥æ”¯æŒ BEP17ï¼Œè¿™åœ¨äº’æ“ä½œæ€§æ–¹é¢æ˜¯ä¸€ä¸ªç¼ºç‚¹ï¼Œä½†å®ƒç¡®å®å…·æœ‰å…è®¸ç§å­æœåŠ¡å™¨æ›´å¥½åœ°æ§åˆ¶æµé‡å’Œé¿å…å¸¦å®½æ»¥ç”¨çš„ä¼˜åŠ¿ã€‚</p>\n<h3 id=\"ç§æœ‰ç§å­åŠ å¼ºæ•°æ®åˆ†äº«éšç§æ€§\"><a href=\"#ç§æœ‰ç§å­åŠ å¼ºæ•°æ®åˆ†äº«éšç§æ€§\" class=\"headerlink\" title=\"ç§æœ‰ç§å­åŠ å¼ºæ•°æ®åˆ†äº«éšç§æ€§\"></a>ç§æœ‰ç§å­åŠ å¼ºæ•°æ®åˆ†äº«éšç§æ€§</h3><p>ç§æœ‰ç§å­æ˜¯åœ¨ <a href=\"http://bittorrent.org/beps/bep_0027.html\" target=\"_blank\" rel=\"noopener\">BEP27 - Private Torrents</a> ä¸­æè¿°çš„ï¼Œé€šè¿‡åœ¨å…ƒæ•°æ®ä¿¡æ¯æ€»å¢åŠ é”®å€¼å¯¹ <code>private=1</code> æ¥æ ‡è®°ç§å­ä¸ºç§æœ‰ç§å­ã€‚å®¢æˆ·ç«¯åªèƒ½å‘ç§æœ‰ç§å­å¯¹åº”çš„ç§æœ‰ Tracker é€šå‘Šè‡ªèº«ï¼Œè€Œä¸”åªèƒ½ä¸ç§æœ‰ Tracker è¿”å›çš„ peer å»ºç«‹è¿æ¥ã€‚</p>\n<p>å½“ç§æœ‰ç§å­çš„ <code>announce-list</code> ä¸­å‡ºç°å¤šä¸ª Tracker åœ°å€æ—¶ï¼Œæ¯ä¸ª peer åœ¨ä¸€ä¸ªæ—¶åˆ»åªèƒ½ä½¿ç”¨å…¶ä¸­ä¸€ä¸ª Trackerï¼Œåªæœ‰å½“ Tracker å‡ºé”™æ—¶æ‰å¯ä»¥åˆ‡æ¢ Trackerã€‚åœ¨åˆ‡æ¢ Tracker æ—¶ï¼Œpeer å¿…é¡»æ–­å¼€æ‰€æœ‰ä¸å…¶ä»– peer çš„è¿æ¥ï¼Œä¹‹ååªèƒ½ä¸æ–°çš„ Tracker æä¾›çš„ peer å»ºç«‹è¿æ¥ã€‚è¿™å‡è½»äº†æ”»å‡»è€…é€šè¿‡ä¿®æ”¹å…ƒæ•°æ®æ–‡ä»¶ä¸­ <code>announce-list</code> åå‘å¸ƒæ–°çš„å…ƒæ•°æ®æ–‡ä»¶è¿›è¡Œæ”»å‡»å¸¦æ¥çš„å½±å“ã€‚</p>\n<p>å½“ç§å­ä¸ºç§æœ‰ç§å­æ—¶ï¼Œé€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆåŒ…æ‹¬ DHT, PEX, LSD ç­‰ï¼‰è·å– peer éƒ½ä¼šå¯¹â€œç§æœ‰â€è¿›è¡Œç ´åã€‚ä½†æ˜¯ä¸èƒ½é¿å…æ”»å‡»è€…é€šè¿‡çŒœæµ‹ peer çš„ IP ä¸ç«¯å£çš„æ–¹å¼æ‰¾åˆ° peerï¼Œè¿›è€Œäº§ç”Ÿè¿æ¥ã€‚</p>\n<h3 id=\"Merkle-Tree-æ•°æ®ç»“æ„ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°\"><a href=\"#Merkle-Tree-æ•°æ®ç»“æ„ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°\" class=\"headerlink\" title=\"Merkle Tree æ•°æ®ç»“æ„ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°\"></a>Merkle Tree æ•°æ®ç»“æ„ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°</h3><p>å¦‚æœç§å­æ–‡ä»¶è¿‡å¤§ï¼Œå¯¹äºæä¾›ç§å­æ–‡ä»¶ä¸‹è½½çš„ä¸­å¿ƒåŒ–æœåŠ¡å™¨å°±ä¼šæœ‰è¾ƒå¤§å‹åŠ›ã€‚ä¸ºäº†è®©å…ƒæ•°æ®æ–‡ä»¶ä½“ç§¯å‡å°ï¼Œä¸€ä¸ªæœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯å°†æ¯ä¸ªç‰‡æ®µçš„å¤§å°å¢åŠ ï¼ˆä¸Šé™æ˜¯ 2 Mbï¼‰ï¼ŒåŒæ ·å¤§å°çš„æ–‡ä»¶å› æ­¤ä¼šäº§ç”Ÿæ›´å°‘çš„æ‘˜è¦æ•°é‡ã€‚è€ƒè™‘åˆ°åªæœ‰å½“ä¸€ä¸ªç‰‡æ®µè¢«å®Œå…¨æ¥å—å®Œæˆä¸”éªŒè¯æ‘˜è¦åï¼Œæ‰èƒ½å°†ä¹‹ä¸å…¶ä»– peer è¿›è¡Œäº¤æ¢ï¼Œè¿™æ„å‘³ç€èŠ‚ç‚¹éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å’Œå…¶ä»– peer è¿›è¡Œäº¤æ¢ã€‚</p>\n<p><a href=\"http://bittorrent.org/beps/bep_0030.html\" target=\"_blank\" rel=\"noopener\">BEP30 - Merkle hash torrent extension</a> åˆ©ç”¨äº† Merkle Tree è¿™ç§æ•°æ®ç»“æ„æ¥ä¼˜åŒ–å…ƒæ•°æ®æ–‡ä»¶å¤§å°ã€‚è¯¥æ–¹æ¡ˆä½¿ç”¨å•ä¸€çš„ Merkle å“ˆå¸Œæ¥æ›¿ä»£æ‘˜è¦åˆ—è¡¨ã€‚Merkle æ•£åˆ—å¯ç”¨äºé€šè¿‡åˆ†å±‚æ–¹æ¡ˆéªŒè¯æ•´ä¸ªå†…å®¹æ–‡ä»¶ä»¥åŠå„ä¸ªå—çš„å®Œæ•´æ€§ã€‚å®ƒé€šè¿‡æ„å»ºä¸æ•°æ®ç›¸å…³çš„å“ˆå¸Œæ ‘å¹¶ä»…éœ€ä½¿ç”¨æ ¹å“ˆå¸Œä½œä¸ºéªŒè¯æ•°æ®å®Œæ•´æ€§çš„ä¾æ®ã€‚</p>\n<p>å¦‚å›¾æ‰€ç¤ºï¼ŒP0-P12 ä»£è¡¨ç‰‡æ®µ 0-12ï¼ŒX æ˜¯ä¸ºäº†æ ‘çš„å®Œæ•´è€Œå¡«å……çš„é›¶å€¼ç‰‡æ®µï¼Œ0-30 å‡è¡¨ç¤ºå“ˆå¸Œï¼Œå…¶ä¸­ 0 æ˜¯æ ¹å“ˆå¸Œã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ¥å—åˆ°äº†å®Œæ•´çš„ç‰‡æ®µ P8ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹åªéœ€è¦é¢å¤–é€šè¿‡ä¸€äº›é€”å¾„çŸ¥é“ P8 çš„å§Šå¦¹ç‰‡æ®µ P9 çš„å“ˆå¸Œå€¼ï¼Œä»¥åŠ P8 çš„æ‰€æœ‰å”å—å“ˆå¸Œï¼ˆä¾æ¬¡ä¸º 12ï¼Œ6ï¼Œ1ï¼‰å°±å¯ä»¥éªŒè¯ P8 çš„å®Œæ•´æ€§ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">                                       0* = root hash</span><br><span class=\"line\">                                    /     \\</span><br><span class=\"line\">                                /            \\</span><br><span class=\"line\">                            /                   \\</span><br><span class=\"line\">                        /                          \\</span><br><span class=\"line\">                    /                                 \\</span><br><span class=\"line\">                  1*                                     2</span><br><span class=\"line\">                 / \\                                    / \\</span><br><span class=\"line\">               /     \\                                /     \\</span><br><span class=\"line\">             /         \\                            /         \\</span><br><span class=\"line\">           /             \\                        /             \\</span><br><span class=\"line\">         /                 \\                    /                 \\</span><br><span class=\"line\">        3                   4                  5                   6* = uncle</span><br><span class=\"line\">       / \\                 / \\                / \\                 / \\</span><br><span class=\"line\">      /   \\               /   \\              /   \\               /   \\</span><br><span class=\"line\">     /     \\             /     \\            /     \\             /     \\</span><br><span class=\"line\">   7         8         9        10        11        12*       13        14 </span><br><span class=\"line\">  / \\       / \\       / \\       / \\       / \\       / \\       / \\       / \\</span><br><span class=\"line\">15   16   17   18   19   20   21   22   23   24   25   26   27   28   29   30</span><br><span class=\"line\"></span><br><span class=\"line\">P0   P1   P2   P3   P4   P5   P6   P7   P8*  P9*  P10  P11  P12   X    X    X</span><br><span class=\"line\">= piece index                            =    =                   = filler hash </span><br><span class=\"line\">                                         p    s                   </span><br><span class=\"line\">                                         i    i                   </span><br><span class=\"line\">                                         e    b                   </span><br><span class=\"line\">                                         c    l</span><br><span class=\"line\">                                         e    i</span><br><span class=\"line\">                                              n</span><br><span class=\"line\">                                              g</span><br></pre></td></tr></table></figure>\n\n<p>åŸå§‹èµ„æºå‘å¸ƒè€…éœ€è¦å°†å…ƒæ•°æ®ä¸­çš„åŸæœ¬ç”¨æ¥å­˜å‚¨ç‰‡æ®µæ•£åˆ—å€¼çš„ <strong>pieces</strong> é”®æ›¿æ¢ä¸ºå­˜å‚¨æ ¹å“ˆå¸Œçš„é”® <strong>root hash</strong>ã€‚</p>\n<p>æ”¯æŒ Merkle Tree å“ˆå¸Œæ–¹å¼çš„å®¢æˆ·ç«¯éœ€è¦åŒæ—¶æ”¯æŒæ‰©å±•æ¶ˆæ¯ï¼ˆè§ <a href=\"/2018/08/30/bt-peer/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹ Peer\">BT å¢å¼ºå»ºè®®ä¹‹ Peer</a>ï¼‰æ¥æ›¿ä»£æ™®é€šçš„ <strong>piece</strong> æ¶ˆæ¯æ¥å®Œæˆæ•°æ®ä¼ è¾“ã€‚ç”¨äºä¼ è¾“æ•°æ®çš„æ‰©å±•æ¶ˆæ¯ç±»å‹æ˜¯ <strong>Tr_hashpiece</strong> ï¼Œå’Œå…¶ä»–æ‰©å±•æ¶ˆæ¯ä¸€æ ·ï¼Œè¿™ä¸ªæ¶ˆæ¯ä¹Ÿéœ€è¦åœ¨ peer é—´çš„æ‰©å±•æ¡æ‰‹æ¶ˆæ¯ä¸­å£°æ˜ã€‚</p>\n<p><strong>Tr_hashpiece</strong> æ¶ˆæ¯çš„è´Ÿè½½å†…å®¹å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>indexï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨æ•°æ®ç‰‡æ®µåºå·ï¼›</li>\n<li>beginï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨å½“å‰å½“å‰æ•°æ®å­ç‰‡æ®µåœ¨æ•´ä¸ªç‰‡æ®µä¸­çš„åç§»é‡ï¼›</li>\n<li>hashlist lengthï¼š4 ä¸ªå­—èŠ‚ï¼Œä»£è¡¨å“ˆå¸Œåˆ—è¡¨çš„é•¿åº¦</li>\n<li>hashlistï¼šå“ˆå¸Œåˆ—è¡¨ï¼ŒåŒ…æ‹¬ç‰‡æ®µè‡ªèº«å“ˆå¸Œï¼Œå§Šå¦¹ç‰‡æ®µå“ˆå¸Œï¼Œä»¥åŠå„ä¸ªå”ç‰‡æ®µå“ˆå¸Œï¼Œæœ€åæ˜¯æ ¹å“ˆå¸Œï¼Œåªæœ‰å½“ begin ä¸º 0 æ—¶ï¼Œæ‰éœ€è¦ä¼ è¾“ hashlistï¼›</li>\n<li>subpiece dataï¼šæ•°æ®å­ç‰‡æ®µï¼›</li>\n</ul>\n<p>åœ¨ peer æ¥æ”¶å®ŒæˆæŸä¸ªæ•°æ®ç‰‡æ®µçš„ <strong>Tr_hashpiece</strong> æ¶ˆæ¯åï¼Œå®ƒå°†æ ¹æ® hashlist ä¸­çš„å“ˆå¸Œåˆ—è¡¨è®¡ç®—å‡ºçš„æ ¹å“ˆå¸Œä¸åŸæœ‰çš„æ ¹å“ˆå¸Œè¿›è¡Œæ¯”å¯¹ã€‚å¦‚æœåŒ¹é…ï¼Œæ‰€æœ‰å“ˆå¸Œå€¼éƒ½ä¿å­˜åœ¨è¯¥ peer è‡ªå·±çš„ Merkle Tree ä¸­ï¼Œä¹‹åå®ƒä»¬å¯ä»¥è¢«ä¼ é€’ç»™å…¶ä»–äººã€‚</p>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨ Merkle Tree çš„ Torrent ä¸ä½¿ç”¨æ•£åˆ—å€¼åˆ—è¡¨çš„ Torrent å³ä½¿å®ƒä»¬çš„æ•°æ®å®Œå…¨ç›¸åŒï¼Œä½†æ˜¯ç”±äº infohash ä¸ä¸€è‡´ï¼Œå¯¼è‡´å®ƒä»¬ä¸åœ¨åŒä¸€ä¸ª Swarm ä¸­ã€‚å¦å¤–ä¸€æ—¦é‡‡ç”¨äº† Merkle Tree çš„æ–¹å¼ï¼Œé€šè¿‡ WebSeed æ¥è·å–æ•°æ®å°±å˜å¾—ä¸å…¼å®¹ã€‚</p>\n<h2 id=\"å…¶ä»–æ–¹æ¡ˆç®€è¿°\"><a href=\"#å…¶ä»–æ–¹æ¡ˆç®€è¿°\" class=\"headerlink\" title=\"å…¶ä»–æ–¹æ¡ˆç®€è¿°\"></a>å…¶ä»–æ–¹æ¡ˆç®€è¿°</h2><ul>\n<li><a href=\"http://www.bittorrent.org/beps/bep_0035.html\" target=\"_blank\" rel=\"noopener\">BEP35 - Torrent Signing</a>ã€€åˆ©ç”¨å¯¹ç§å­è¿›è¡Œç­¾åä»¥å¢åŠ ä¸‹è½½å®‰å…¨æ€§ã€‚</li>\n<li><a href=\"http://bittorrent.org/beps/bep_0036.html\" target=\"_blank\" rel=\"noopener\">BEP36 - Torrent RSS feeds</a> å®šä¹‰äº† RSS è®¢é˜…ç§å­çš„ feed æ ¼å¼ã€‚</li>\n<li><a href=\"http://bittorrent.org/beps/bep_0038.html\" target=\"_blank\" rel=\"noopener\">BEP38 - Finding Local Data Via Torrent File Hints</a> åˆ™æå‡ºäº†ç²—ç•¥åœ°æ£€æµ‹ç”¨æˆ·æœ¬åœ°æ˜¯å¦å·²ç»å­˜åœ¨å…¨éƒ¨æˆ–è€…éƒ¨åˆ†å³å°†ä¸‹è½½çš„æ–‡ä»¶çš„æ–¹æ¡ˆã€‚ä¸»è¦æ¶‰åŠåœ¨ç§å­æ–‡ä»¶ä¸­æ·»åŠ  <code>similar</code> æˆ– <code>collections</code> è¿™ä¸¤ä¸ªé”®ã€‚å‰è€…è¡¨ç¤ºå¯èƒ½ä¸æŸä¸ª infohash å…±äº«éƒ¨åˆ†æ•°æ®ï¼Œåè€…è¡¨ç¤ºè¯¥ç§å­æ–‡ä»¶æ‰€å±çš„é›†åˆï¼Œå±äºåŒä¸€é›†åˆçš„ç§å­å¯èƒ½å…±äº«æ–‡ä»¶ã€‚</li>\n<li><a href=\"http://bittorrent.org/beps/bep_0039.html\" target=\"_blank\" rel=\"noopener\">BEP39 - Updating Torrents Via Feed URL</a> ä½¿ç”¨åœ¨ info ä¸­çš„é”® <code>update-url</code> æ¥è¡¨æ˜ç”¨äºæ›´æ–°è¯¥ç§å­çš„é“¾æ¥åœ°å€ï¼Œå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚è¯¥åœ°å€æˆåŠŸä¸”å¾—åˆ°ä¸€ä¸ªç§å­æ–‡ä»¶ï¼Œåˆ™éœ€è¦ä¸‹è½½è¯¥æ›´æ–°åçš„ç§å­ã€‚</li>\n<li><a href=\"http://bittorrent.org/beps/bep_0047.html\" target=\"_blank\" rel=\"noopener\">BEP47 - Padding files and extended file attributes</a> åœ¨åŸå§‹å…ƒæ•°æ®æè¿°æ–‡ä»¶ä¿¡æ¯çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›é¢å¤–çš„å±æ€§ã€‚ä¾‹å¦‚ç¬¦å·é“¾æ¥é‡å¤æ–‡ä»¶ï¼›ä¸ºæ–‡ä»¶æ·»åŠ  padding ä»¥ä½¿å¾—ä¸‹ä¸€ä¸ªæ–‡ä»¶æ•°æ®ä»ç‰‡æ®µè¾¹ç¼˜å¼€å§‹ã€‚</li>\n<li><a href=\"http://bittorrent.org/beps/bep_0049.html\" target=\"_blank\" rel=\"noopener\">BEP49 - Distributed Torrent Feeds</a> ä¸ BEP36 æä¾›çš„ RSS è®¢é˜…åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ˜¯é€šè¿‡ DHT ç½‘ç»œå®ç°ã€‚</li>\n</ul>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://github.com/webtorrent/webtorrent/issues/67\" target=\"_blank\" rel=\"noopener\">Implement Web (HTTP) Seeding (BEP17+BEP19) Â· Issue #67 Â· webtorrent/webtorrent</a></li>\n</ol>\n"},{"title":"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°","keywords":[],"date":"2018-08-26T09:00:00.000Z","_content":"\nåœ¨ç‰ˆæƒæ„è¯†æ„ˆæ¸åŠ å¼ºçš„ä»Šå¤©ï¼ŒBT æµé‡å å…¨çƒæµé‡çš„æ¯”é‡ä¸æ–­ä¸‹é™ï¼Œè¿™ç§ p2p æŠ€æœ¯çš„åº”ç”¨åœ¨[é€æ¸è¡°è½](http://www.donews.com/article/detail/4805/11133.html)ã€‚ä½†æ˜¯è¯·è®°ä½\n\n- â€œæŠ€æœ¯æ— ç½ªâ€â€”â€”çºµç„¶æ®è¯´çˆ±å› æ–¯å¦ä¹Ÿæ›¾å¯¹â€œæŠŠåŸå­å¼¹é€åˆ°äº†ç–¯å­æ‰‹é‡Œâ€æ„Ÿåˆ°åæ‚”ã€‚\n- â€œä¸ªä½“é‡å¤ç³»ç»Ÿå‘è‚²â€ï¼š\n  {% blockquote Andrew Tanenbaum, ç°ä»£æ“ä½œç³»ç»Ÿ %}\n  æŠ€æœ¯çš„å˜åŒ–ä¼šå¯¼è‡´æŸäº›æ€æƒ³è¿‡æ—¶å¹¶è¿…é€Ÿæ¶ˆå¤±ï¼Œè¿™ç§æƒ…å½¢ç»å¸¸å‘ç”Ÿã€‚ä½†æ˜¯ï¼ŒæŠ€æœ¯çš„å¦ä¸€ç§å˜åŒ–è¿˜å¯èƒ½ä½¿æŸäº›æ€æƒ³å†æ¬¡å¤æ´»ã€‚\n  {% endblockquote %}\n\n## æ€»ç›®å½•\n\nä¸‹é¢è¿›å…¥æ­£é¢˜ã€‚ä¸€ä¸ªä½¿ç”¨ BT è¿›è¡Œä¸‹è½½çš„è¿‡ç¨‹å¯ä»¥ç®€çŸ­åœ°æè¿°å¦‚ä¸‹ï¼š\n\nå½“ä½ è·å–äº†ä¸€ä¸ª**ç£åŠ›é“¾æ¥**æˆ–è€…**ç§å­æ–‡ä»¶**ï¼Œä½¿ç”¨ BT å®¢æˆ·ç«¯æ‰“å¼€æ–‡ä»¶ç¡®è®¤ä¸‹è½½åï¼Œå®¢æˆ·ç«¯å°±æˆä¸ºäº†ä¸€ä¸ª peerï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿æ¥ **Tracker** æœåŠ¡å™¨æˆ–è€… **DHT** ç½‘ç»œå¯»æ‰¾åˆ°å…¶ä»–æ‹¥æœ‰æ‰€éœ€è¦æ–‡ä»¶åˆ†ç‰‡çš„ peerï¼Œä»è¿™äº› peer ä¸­ä¸‹è½½èµ„æºåˆ†ç‰‡ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¸Šä¼ æ•°æ®ç»™å…¶ä»–æ¥ç´¢è¦è‡ªå·±æ‰€æ‹¥æœ‰åˆ†ç‰‡çš„ peerï¼Œä»¥æ­¤åå¤ï¼Œç›´åˆ°ä¸‹è½½å®Œæˆã€‚\n\nææ¸…æ¥šè¿™ä¸ªä¸‹è½½è¿‡ç¨‹ä¸­åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…å°±æ˜¯è®°å½•è¿™ä¸ªç³»åˆ—æ–‡ç« çš„ç›®çš„æ‰€åœ¨ã€‚æ•´ä¸ªå­¦ä¹ è¿‡ç¨‹ä»¥ BT å¢å¼ºå»ºè®® [BEP](http://www.bittorrent.org/beps/bep_0000.html) ä¸ºä¸»è¦å‚è€ƒï¼ŒåŒæ—¶é€‚å½“å‚è€ƒ [BT çš„ä¸€ä¸ª Java ç‰ˆæœ¬å®ç°æºç ](https://github.com/atomashpolskiy/bt)ã€‚\n\næ•´ä¸ªç³»åˆ—åˆ†ä¸ºï¼š\n\n- {% post_link bt-overview %}ï¼šä¸»è¦ä»‹ç» BEP ä¸ Bencode ç¼–ç \n- {% post_link bt-metadata %}ï¼šTorrent ç§å­æ–‡ä»¶ç»“æ„ä¸ Magnet ç£åŠ›é“¾æ¥çš„åŸç†\n- {% post_link bt-tracker %}ï¼šä½œä¸º Peer é—´æ¡¥æ¢çš„ Tracker æœåŠ¡å™¨çš„å·¥ä½œåŸç†\n- {% post_link bt-peer %}ï¼š Peer é—´çš„é€šä¿¡çš„è¿‡ç¨‹ä»¥åŠä»¥ç‰™è¿˜ç‰™ç­–ç•¥\n- DHTï¼šä½¿å¾— BT ç½‘ç»œè„±ç¦» Trackerï¼Œå®ç°å®Œå…¨å»ä¸­å¿ƒåŒ–\n  - {% post_link dht-kademlia %}\n  - {% post_link bt-dht %}\n- {% post_link bt-advanced %}ï¼šBEP ä¸­æå‡ºçš„ä¸€äº›è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\n\nç”¨äºä¿è¯ BT é«˜é€Ÿä¸‹è½½æ—¶å…¶ä»–åº”ç”¨ä½æ—¶å»¶ç½‘ç»œé€šä¿¡çš„ä¼ è¾“å±‚åè®® **ÂµTP** å·²åœ¨ç‹¬ç«‹çš„åšæ–‡ {% post_link Âµtp %} ä¸­ä»‹ç»ã€‚\n\nè¿™ä¸ªç³»åˆ—å°†å°½å¯èƒ½æ¶µç›–æ‰€æœ‰çš„ BEPã€‚ä¸‹é¢çš„è¡¨æ ¼æ˜¾ç¤ºäº†ç« èŠ‚ä¸ BEP çš„å¼•ç”¨å…³ç³»ï¼Œå› æ­¤åœ¨æ¯ç¯‡æ–‡ç« çš„å‚è€ƒèµ„æ–™ä¸­å°†ä¸åœ¨åˆ—ä¸¾ç›¸å…³ BEPã€‚\n\n## BEP\n\nBEPï¼ˆBitTorrent Enhancement Proposalï¼‰æ˜¯ BitTorrent ç¤¾åŒºä»¿ç…§ PEPï¼ˆPython Enhancement Proposalï¼‰æ¥æ”¹è¿› BitTorrent çš„æŠ€æœ¯æ–‡æ¡£ï¼Œå¯ä»¥è§†ä¸ºä¸€ç§å¼€å‘æ–¹å¼ã€‚ä¸€ä¸ª[è§„èŒƒ](http://www.bittorrent.org/beps/bep_0002.html)çš„ BEP è¢«æå‡ºåå¯èƒ½ç»å†å¦‚ä¸‹çš„å‡ ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯ç›®å‰åªæœ‰ Finalï¼ŒAcceptedï¼ŒDraftï¼ŒDeferred å››ç§çŠ¶æ€çš„ BEPã€‚\n![BEP å¯èƒ½ç»å†çš„è¿‡ç¨‹](bep_possible_paths.png)\nåŒæ—¶ Bittorrent å’Œ Python è¿˜æœ‰ä¸ªç›¸ä¼¼çš„å…±åŒç‚¹ï¼Œä»–ä»¬çš„æœ€åˆè®¾è®¡è€…éƒ½**æ›¾ç»**æ˜¯è‡ªå·±é¡¹ç›®çš„ç»ˆèº«ä»æ…ˆç‹¬è£è€…ï¼ˆBenevolent Dictator For Lifeï¼Œ[BDFL](https://en.wikipedia.org/wiki/Benevolent_dictator_for_life)ï¼‰ã€‚ä¾‹å¦‚ [BEP1000 - Pending Standards Track Documents](http://www.bittorrent.org/beps/bep_0000.html) ä¸­æ‰€è¯´çš„è¿™ä¸ªä¸å­˜åœ¨çš„ BEP13 - Protocol Encryption ä¸€ç›´æ²¡èƒ½æˆä¸ºæ­£å¼çš„ BEP çš„åŸå› å°±å’Œ BitTorrent çš„ä½œè€… Bram Cohen åå¯¹ BT æµé‡åŠ å¯†ç›¸å…³ã€‚\n\n- 2018å¹´7æœˆï¼ŒGuido van Rossum å®£å¸ƒä¸å†æ‹…ä»» Python ç¤¾åŒºçš„ BDFLã€‚\n- 2018å¹´8æœˆï¼Œåœ¨è‡ªå·±ä¸€æ‰‹åˆ›åŠçš„å…¬å¸è¢«æ³¢åœºæ”¶è´­åï¼ŒBram Cohen è¡¨ç¤ºè‡ªå·±å·²ç»ç¦»å¼€äº† Bittorrentï¼Œ[ç›®å‰åœ¨åšæ•°å­—è´§å¸ç›¸å…³çš„å·¥ä½œ](https://chia.net/)ã€‚\n\n## Bencode\n\nbencode æ˜¯ BT åè®®åœ¨ä¼ è¾“æ•°æ®è¿‡ç¨‹ä¸­å¹¿æ³›é‡‡ç”¨çš„ä¸€ç§ç¼–ç æ ¼å¼ã€‚ä¸»è¦æ”¯æŒä»¥ä¸‹å››ç§æ•°æ®ç±»å‹çš„ç¼–ç ï¼š\n\n- **String**ï¼šåè¿›åˆ¶å­—ç¬¦ä¸²å ç”¨å­—èŠ‚æ•° + â€˜:â€™ + å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ â€œspamâ€ä¼šè¢«ç¼–ç æˆâ€œ4:spamâ€\n- **Integer**ï¼š'i' + åè¿›åˆ¶æ•´å½¢æ•°å­— + 'e'ã€‚é™¤ 0 ä¹‹å¤–ï¼Œä¸èƒ½ä»¥ 0 å¼€å¤´ã€‚ä¾‹å¦‚ï¼ši3eã€i-3e\n- **List**ï¼šä½¿ç”¨å­—ç¬¦ â€˜lâ€™ å’Œ â€˜eâ€™ è¿›è¡Œç•Œå®šï¼Œä¸­é—´æ˜¯å…¶ä»–å…ƒç´ ã€‚ä¾‹å¦‚ *l4:spami:-42ee* ä»£è¡¨åˆ—è¡¨ *[spam, -42]*\n- **Dictionary**ï¼šä½¿ç”¨å­—ç¬¦ â€˜dâ€™ å’Œ â€˜eâ€™ è¿›è¡Œç•Œå®šï¼Œä¸­é—´æ˜¯æ¯ä¸ªé”®å€¼å¯¹å…ƒç´ ,è€Œä¸”æ‰€æœ‰é”®ä¸ºå­—ç¬¦ä¸²ç±»å‹å¹¶æŒ‰å­—å…¸é¡ºåºæ’åˆ—ã€‚ä¾‹å¦‚ *d3:cow3:moo4:spam4:eggse* ä»£è¡¨å­—å…¸ *{cow: moo, spam: eggs}*\n\n## å‚è€ƒèµ„æ–™\n\n1. [BEP çš„ Github åœ°å€](https://github.com/bittorrent/bittorrent.org)\n2. [Wikipedia - BitTorrent protocol encryption](https://en.wikipedia.org/wiki/BitTorrent_protocol_encryption)\n3. [BTæµé‡è¯†åˆ«æŠ€æœ¯çš„ç ”ç©¶](http://cdmd.cnki.com.cn/Article/CDMD-10614-2010234919.htm)\n4. [è°ˆeD2kå’Œç”µé©´çš„å…´è¡°](http://pcedu.pconline.com.cn/960/9603584_all.html)\n5. [Slashdot - BitTorrent Founder Bram Cohen Has Left the Company](https://tech.slashdot.org/story/18/08/20/0457247/bittorrent-founder-bram-cohen-has-left-the-company)","source":"_posts/bt-overview.md","raw":"---\ntitle: BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\ntags:\n  - BT\nkeywords: []\ndate: 2018-08-26 17:00:00\ncategories:\n---\n\nåœ¨ç‰ˆæƒæ„è¯†æ„ˆæ¸åŠ å¼ºçš„ä»Šå¤©ï¼ŒBT æµé‡å å…¨çƒæµé‡çš„æ¯”é‡ä¸æ–­ä¸‹é™ï¼Œè¿™ç§ p2p æŠ€æœ¯çš„åº”ç”¨åœ¨[é€æ¸è¡°è½](http://www.donews.com/article/detail/4805/11133.html)ã€‚ä½†æ˜¯è¯·è®°ä½\n\n- â€œæŠ€æœ¯æ— ç½ªâ€â€”â€”çºµç„¶æ®è¯´çˆ±å› æ–¯å¦ä¹Ÿæ›¾å¯¹â€œæŠŠåŸå­å¼¹é€åˆ°äº†ç–¯å­æ‰‹é‡Œâ€æ„Ÿåˆ°åæ‚”ã€‚\n- â€œä¸ªä½“é‡å¤ç³»ç»Ÿå‘è‚²â€ï¼š\n  {% blockquote Andrew Tanenbaum, ç°ä»£æ“ä½œç³»ç»Ÿ %}\n  æŠ€æœ¯çš„å˜åŒ–ä¼šå¯¼è‡´æŸäº›æ€æƒ³è¿‡æ—¶å¹¶è¿…é€Ÿæ¶ˆå¤±ï¼Œè¿™ç§æƒ…å½¢ç»å¸¸å‘ç”Ÿã€‚ä½†æ˜¯ï¼ŒæŠ€æœ¯çš„å¦ä¸€ç§å˜åŒ–è¿˜å¯èƒ½ä½¿æŸäº›æ€æƒ³å†æ¬¡å¤æ´»ã€‚\n  {% endblockquote %}\n\n## æ€»ç›®å½•\n\nä¸‹é¢è¿›å…¥æ­£é¢˜ã€‚ä¸€ä¸ªä½¿ç”¨ BT è¿›è¡Œä¸‹è½½çš„è¿‡ç¨‹å¯ä»¥ç®€çŸ­åœ°æè¿°å¦‚ä¸‹ï¼š\n\nå½“ä½ è·å–äº†ä¸€ä¸ª**ç£åŠ›é“¾æ¥**æˆ–è€…**ç§å­æ–‡ä»¶**ï¼Œä½¿ç”¨ BT å®¢æˆ·ç«¯æ‰“å¼€æ–‡ä»¶ç¡®è®¤ä¸‹è½½åï¼Œå®¢æˆ·ç«¯å°±æˆä¸ºäº†ä¸€ä¸ª peerï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿æ¥ **Tracker** æœåŠ¡å™¨æˆ–è€… **DHT** ç½‘ç»œå¯»æ‰¾åˆ°å…¶ä»–æ‹¥æœ‰æ‰€éœ€è¦æ–‡ä»¶åˆ†ç‰‡çš„ peerï¼Œä»è¿™äº› peer ä¸­ä¸‹è½½èµ„æºåˆ†ç‰‡ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¸Šä¼ æ•°æ®ç»™å…¶ä»–æ¥ç´¢è¦è‡ªå·±æ‰€æ‹¥æœ‰åˆ†ç‰‡çš„ peerï¼Œä»¥æ­¤åå¤ï¼Œç›´åˆ°ä¸‹è½½å®Œæˆã€‚\n\nææ¸…æ¥šè¿™ä¸ªä¸‹è½½è¿‡ç¨‹ä¸­åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…å°±æ˜¯è®°å½•è¿™ä¸ªç³»åˆ—æ–‡ç« çš„ç›®çš„æ‰€åœ¨ã€‚æ•´ä¸ªå­¦ä¹ è¿‡ç¨‹ä»¥ BT å¢å¼ºå»ºè®® [BEP](http://www.bittorrent.org/beps/bep_0000.html) ä¸ºä¸»è¦å‚è€ƒï¼ŒåŒæ—¶é€‚å½“å‚è€ƒ [BT çš„ä¸€ä¸ª Java ç‰ˆæœ¬å®ç°æºç ](https://github.com/atomashpolskiy/bt)ã€‚\n\næ•´ä¸ªç³»åˆ—åˆ†ä¸ºï¼š\n\n- {% post_link bt-overview %}ï¼šä¸»è¦ä»‹ç» BEP ä¸ Bencode ç¼–ç \n- {% post_link bt-metadata %}ï¼šTorrent ç§å­æ–‡ä»¶ç»“æ„ä¸ Magnet ç£åŠ›é“¾æ¥çš„åŸç†\n- {% post_link bt-tracker %}ï¼šä½œä¸º Peer é—´æ¡¥æ¢çš„ Tracker æœåŠ¡å™¨çš„å·¥ä½œåŸç†\n- {% post_link bt-peer %}ï¼š Peer é—´çš„é€šä¿¡çš„è¿‡ç¨‹ä»¥åŠä»¥ç‰™è¿˜ç‰™ç­–ç•¥\n- DHTï¼šä½¿å¾— BT ç½‘ç»œè„±ç¦» Trackerï¼Œå®ç°å®Œå…¨å»ä¸­å¿ƒåŒ–\n  - {% post_link dht-kademlia %}\n  - {% post_link bt-dht %}\n- {% post_link bt-advanced %}ï¼šBEP ä¸­æå‡ºçš„ä¸€äº›è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\n\nç”¨äºä¿è¯ BT é«˜é€Ÿä¸‹è½½æ—¶å…¶ä»–åº”ç”¨ä½æ—¶å»¶ç½‘ç»œé€šä¿¡çš„ä¼ è¾“å±‚åè®® **ÂµTP** å·²åœ¨ç‹¬ç«‹çš„åšæ–‡ {% post_link Âµtp %} ä¸­ä»‹ç»ã€‚\n\nè¿™ä¸ªç³»åˆ—å°†å°½å¯èƒ½æ¶µç›–æ‰€æœ‰çš„ BEPã€‚ä¸‹é¢çš„è¡¨æ ¼æ˜¾ç¤ºäº†ç« èŠ‚ä¸ BEP çš„å¼•ç”¨å…³ç³»ï¼Œå› æ­¤åœ¨æ¯ç¯‡æ–‡ç« çš„å‚è€ƒèµ„æ–™ä¸­å°†ä¸åœ¨åˆ—ä¸¾ç›¸å…³ BEPã€‚\n\n## BEP\n\nBEPï¼ˆBitTorrent Enhancement Proposalï¼‰æ˜¯ BitTorrent ç¤¾åŒºä»¿ç…§ PEPï¼ˆPython Enhancement Proposalï¼‰æ¥æ”¹è¿› BitTorrent çš„æŠ€æœ¯æ–‡æ¡£ï¼Œå¯ä»¥è§†ä¸ºä¸€ç§å¼€å‘æ–¹å¼ã€‚ä¸€ä¸ª[è§„èŒƒ](http://www.bittorrent.org/beps/bep_0002.html)çš„ BEP è¢«æå‡ºåå¯èƒ½ç»å†å¦‚ä¸‹çš„å‡ ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯ç›®å‰åªæœ‰ Finalï¼ŒAcceptedï¼ŒDraftï¼ŒDeferred å››ç§çŠ¶æ€çš„ BEPã€‚\n![BEP å¯èƒ½ç»å†çš„è¿‡ç¨‹](bep_possible_paths.png)\nåŒæ—¶ Bittorrent å’Œ Python è¿˜æœ‰ä¸ªç›¸ä¼¼çš„å…±åŒç‚¹ï¼Œä»–ä»¬çš„æœ€åˆè®¾è®¡è€…éƒ½**æ›¾ç»**æ˜¯è‡ªå·±é¡¹ç›®çš„ç»ˆèº«ä»æ…ˆç‹¬è£è€…ï¼ˆBenevolent Dictator For Lifeï¼Œ[BDFL](https://en.wikipedia.org/wiki/Benevolent_dictator_for_life)ï¼‰ã€‚ä¾‹å¦‚ [BEP1000 - Pending Standards Track Documents](http://www.bittorrent.org/beps/bep_0000.html) ä¸­æ‰€è¯´çš„è¿™ä¸ªä¸å­˜åœ¨çš„ BEP13 - Protocol Encryption ä¸€ç›´æ²¡èƒ½æˆä¸ºæ­£å¼çš„ BEP çš„åŸå› å°±å’Œ BitTorrent çš„ä½œè€… Bram Cohen åå¯¹ BT æµé‡åŠ å¯†ç›¸å…³ã€‚\n\n- 2018å¹´7æœˆï¼ŒGuido van Rossum å®£å¸ƒä¸å†æ‹…ä»» Python ç¤¾åŒºçš„ BDFLã€‚\n- 2018å¹´8æœˆï¼Œåœ¨è‡ªå·±ä¸€æ‰‹åˆ›åŠçš„å…¬å¸è¢«æ³¢åœºæ”¶è´­åï¼ŒBram Cohen è¡¨ç¤ºè‡ªå·±å·²ç»ç¦»å¼€äº† Bittorrentï¼Œ[ç›®å‰åœ¨åšæ•°å­—è´§å¸ç›¸å…³çš„å·¥ä½œ](https://chia.net/)ã€‚\n\n## Bencode\n\nbencode æ˜¯ BT åè®®åœ¨ä¼ è¾“æ•°æ®è¿‡ç¨‹ä¸­å¹¿æ³›é‡‡ç”¨çš„ä¸€ç§ç¼–ç æ ¼å¼ã€‚ä¸»è¦æ”¯æŒä»¥ä¸‹å››ç§æ•°æ®ç±»å‹çš„ç¼–ç ï¼š\n\n- **String**ï¼šåè¿›åˆ¶å­—ç¬¦ä¸²å ç”¨å­—èŠ‚æ•° + â€˜:â€™ + å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ â€œspamâ€ä¼šè¢«ç¼–ç æˆâ€œ4:spamâ€\n- **Integer**ï¼š'i' + åè¿›åˆ¶æ•´å½¢æ•°å­— + 'e'ã€‚é™¤ 0 ä¹‹å¤–ï¼Œä¸èƒ½ä»¥ 0 å¼€å¤´ã€‚ä¾‹å¦‚ï¼ši3eã€i-3e\n- **List**ï¼šä½¿ç”¨å­—ç¬¦ â€˜lâ€™ å’Œ â€˜eâ€™ è¿›è¡Œç•Œå®šï¼Œä¸­é—´æ˜¯å…¶ä»–å…ƒç´ ã€‚ä¾‹å¦‚ *l4:spami:-42ee* ä»£è¡¨åˆ—è¡¨ *[spam, -42]*\n- **Dictionary**ï¼šä½¿ç”¨å­—ç¬¦ â€˜dâ€™ å’Œ â€˜eâ€™ è¿›è¡Œç•Œå®šï¼Œä¸­é—´æ˜¯æ¯ä¸ªé”®å€¼å¯¹å…ƒç´ ,è€Œä¸”æ‰€æœ‰é”®ä¸ºå­—ç¬¦ä¸²ç±»å‹å¹¶æŒ‰å­—å…¸é¡ºåºæ’åˆ—ã€‚ä¾‹å¦‚ *d3:cow3:moo4:spam4:eggse* ä»£è¡¨å­—å…¸ *{cow: moo, spam: eggs}*\n\n## å‚è€ƒèµ„æ–™\n\n1. [BEP çš„ Github åœ°å€](https://github.com/bittorrent/bittorrent.org)\n2. [Wikipedia - BitTorrent protocol encryption](https://en.wikipedia.org/wiki/BitTorrent_protocol_encryption)\n3. [BTæµé‡è¯†åˆ«æŠ€æœ¯çš„ç ”ç©¶](http://cdmd.cnki.com.cn/Article/CDMD-10614-2010234919.htm)\n4. [è°ˆeD2kå’Œç”µé©´çš„å…´è¡°](http://pcedu.pconline.com.cn/960/9603584_all.html)\n5. [Slashdot - BitTorrent Founder Bram Cohen Has Left the Company](https://tech.slashdot.org/story/18/08/20/0457247/bittorrent-founder-bram-cohen-has-left-the-company)","slug":"bt-overview","published":1,"updated":"2020-07-18T06:30:19.513Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuhc0004w80vuzvf98im","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>åœ¨ç‰ˆæƒæ„è¯†æ„ˆæ¸åŠ å¼ºçš„ä»Šå¤©ï¼ŒBT æµé‡å å…¨çƒæµé‡çš„æ¯”é‡ä¸æ–­ä¸‹é™ï¼Œè¿™ç§ p2p æŠ€æœ¯çš„åº”ç”¨åœ¨<a href=\"http://www.donews.com/article/detail/4805/11133.html\" target=\"_blank\" rel=\"noopener\">é€æ¸è¡°è½</a>ã€‚ä½†æ˜¯è¯·è®°ä½</p>\n<ul>\n<li>â€œæŠ€æœ¯æ— ç½ªâ€â€”â€”çºµç„¶æ®è¯´çˆ±å› æ–¯å¦ä¹Ÿæ›¾å¯¹â€œæŠŠåŸå­å¼¹é€åˆ°äº†ç–¯å­æ‰‹é‡Œâ€æ„Ÿåˆ°åæ‚”ã€‚</li>\n<li>â€œä¸ªä½“é‡å¤ç³»ç»Ÿå‘è‚²â€ï¼š<blockquote><p>æŠ€æœ¯çš„å˜åŒ–ä¼šå¯¼è‡´æŸäº›æ€æƒ³è¿‡æ—¶å¹¶è¿…é€Ÿæ¶ˆå¤±ï¼Œè¿™ç§æƒ…å½¢ç»å¸¸å‘ç”Ÿã€‚ä½†æ˜¯ï¼ŒæŠ€æœ¯çš„å¦ä¸€ç§å˜åŒ–è¿˜å¯èƒ½ä½¿æŸäº›æ€æƒ³å†æ¬¡å¤æ´»ã€‚</p>\n<footer><strong>Andrew Tanenbaum</strong><cite>ç°ä»£æ“ä½œç³»ç»Ÿ</cite></footer></blockquote>\n\n</li>\n</ul>\n<h2 id=\"æ€»ç›®å½•\"><a href=\"#æ€»ç›®å½•\" class=\"headerlink\" title=\"æ€»ç›®å½•\"></a>æ€»ç›®å½•</h2><p>ä¸‹é¢è¿›å…¥æ­£é¢˜ã€‚ä¸€ä¸ªä½¿ç”¨ BT è¿›è¡Œä¸‹è½½çš„è¿‡ç¨‹å¯ä»¥ç®€çŸ­åœ°æè¿°å¦‚ä¸‹ï¼š</p>\n<p>å½“ä½ è·å–äº†ä¸€ä¸ª<strong>ç£åŠ›é“¾æ¥</strong>æˆ–è€…<strong>ç§å­æ–‡ä»¶</strong>ï¼Œä½¿ç”¨ BT å®¢æˆ·ç«¯æ‰“å¼€æ–‡ä»¶ç¡®è®¤ä¸‹è½½åï¼Œå®¢æˆ·ç«¯å°±æˆä¸ºäº†ä¸€ä¸ª peerï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿æ¥ <strong>Tracker</strong> æœåŠ¡å™¨æˆ–è€… <strong>DHT</strong> ç½‘ç»œå¯»æ‰¾åˆ°å…¶ä»–æ‹¥æœ‰æ‰€éœ€è¦æ–‡ä»¶åˆ†ç‰‡çš„ peerï¼Œä»è¿™äº› peer ä¸­ä¸‹è½½èµ„æºåˆ†ç‰‡ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¸Šä¼ æ•°æ®ç»™å…¶ä»–æ¥ç´¢è¦è‡ªå·±æ‰€æ‹¥æœ‰åˆ†ç‰‡çš„ peerï¼Œä»¥æ­¤åå¤ï¼Œç›´åˆ°ä¸‹è½½å®Œæˆã€‚</p>\n<p>ææ¸…æ¥šè¿™ä¸ªä¸‹è½½è¿‡ç¨‹ä¸­åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…å°±æ˜¯è®°å½•è¿™ä¸ªç³»åˆ—æ–‡ç« çš„ç›®çš„æ‰€åœ¨ã€‚æ•´ä¸ªå­¦ä¹ è¿‡ç¨‹ä»¥ BT å¢å¼ºå»ºè®® <a href=\"http://www.bittorrent.org/beps/bep_0000.html\" target=\"_blank\" rel=\"noopener\">BEP</a> ä¸ºä¸»è¦å‚è€ƒï¼ŒåŒæ—¶é€‚å½“å‚è€ƒ <a href=\"https://github.com/atomashpolskiy/bt\" target=\"_blank\" rel=\"noopener\">BT çš„ä¸€ä¸ª Java ç‰ˆæœ¬å®ç°æºç </a>ã€‚</p>\n<p>æ•´ä¸ªç³»åˆ—åˆ†ä¸ºï¼š</p>\n<ul>\n<li><a href=\"/2018/08/26/bt-overview/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\">BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°</a>ï¼šä¸»è¦ä»‹ç» BEP ä¸ Bencode ç¼–ç </li>\n<li><a href=\"/2018/08/26/bt-metadata/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹ Metadataï¼šTorrent ä¸ Magnet\">BT å¢å¼ºå»ºè®®ä¹‹ Metadataï¼šTorrent ä¸ Magnet</a>ï¼šTorrent ç§å­æ–‡ä»¶ç»“æ„ä¸ Magnet ç£åŠ›é“¾æ¥çš„åŸç†</li>\n<li><a href=\"/2018/08/27/bt-tracker/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹ Tracker\">BT å¢å¼ºå»ºè®®ä¹‹ Tracker</a>ï¼šä½œä¸º Peer é—´æ¡¥æ¢çš„ Tracker æœåŠ¡å™¨çš„å·¥ä½œåŸç†</li>\n<li><a href=\"/2018/08/30/bt-peer/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹ Peer\">BT å¢å¼ºå»ºè®®ä¹‹ Peer</a>ï¼š Peer é—´çš„é€šä¿¡çš„è¿‡ç¨‹ä»¥åŠä»¥ç‰™è¿˜ç‰™ç­–ç•¥</li>\n<li>DHTï¼šä½¿å¾— BT ç½‘ç»œè„±ç¦» Trackerï¼Œå®ç°å®Œå…¨å»ä¸­å¿ƒåŒ–<ul>\n<li><a href=\"/2018/11/08/dht-kademlia/\" title=\"DHT ç½‘ç»œä¹‹ Kademlia ç®—æ³•\">DHT ç½‘ç»œä¹‹ Kademlia ç®—æ³•</a></li>\n<li><a href=\"/2018/11/12/bt-dht/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹ DHT\">BT å¢å¼ºå»ºè®®ä¹‹ DHT</a></li>\n</ul>\n</li>\n<li><a href=\"/2018/11/15/bt-advanced/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\">BT å¢å¼ºå»ºè®®ä¹‹è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ</a>ï¼šBEP ä¸­æå‡ºçš„ä¸€äº›è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\n\n</li>\n</ul>\n<p>ç”¨äºä¿è¯ BT é«˜é€Ÿä¸‹è½½æ—¶å…¶ä»–åº”ç”¨ä½æ—¶å»¶ç½‘ç»œé€šä¿¡çš„ä¼ è¾“å±‚åè®® <strong>ÂµTP</strong> å·²åœ¨ç‹¬ç«‹çš„åšæ–‡ <a href=\"/2018/08/04/Âµtp/\" title=\"ÂµTP åè®® â€”â€” å¯¹ BEP29 çš„ç®€è¦ç†è§£\">ÂµTP åè®® â€”â€” å¯¹ BEP29 çš„ç®€è¦ç†è§£</a> ä¸­ä»‹ç»ã€‚</p>\n<p>è¿™ä¸ªç³»åˆ—å°†å°½å¯èƒ½æ¶µç›–æ‰€æœ‰çš„ BEPã€‚ä¸‹é¢çš„è¡¨æ ¼æ˜¾ç¤ºäº†ç« èŠ‚ä¸ BEP çš„å¼•ç”¨å…³ç³»ï¼Œå› æ­¤åœ¨æ¯ç¯‡æ–‡ç« çš„å‚è€ƒèµ„æ–™ä¸­å°†ä¸åœ¨åˆ—ä¸¾ç›¸å…³ BEPã€‚</p>\n<h2 id=\"BEP\"><a href=\"#BEP\" class=\"headerlink\" title=\"BEP\"></a>BEP</h2><p>BEPï¼ˆBitTorrent Enhancement Proposalï¼‰æ˜¯ BitTorrent ç¤¾åŒºä»¿ç…§ PEPï¼ˆPython Enhancement Proposalï¼‰æ¥æ”¹è¿› BitTorrent çš„æŠ€æœ¯æ–‡æ¡£ï¼Œå¯ä»¥è§†ä¸ºä¸€ç§å¼€å‘æ–¹å¼ã€‚ä¸€ä¸ª<a href=\"http://www.bittorrent.org/beps/bep_0002.html\" target=\"_blank\" rel=\"noopener\">è§„èŒƒ</a>çš„ BEP è¢«æå‡ºåå¯èƒ½ç»å†å¦‚ä¸‹çš„å‡ ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯ç›®å‰åªæœ‰ Finalï¼ŒAcceptedï¼ŒDraftï¼ŒDeferred å››ç§çŠ¶æ€çš„ BEPã€‚<br><img src=\"bep_possible_paths.png\" alt=\"BEP å¯èƒ½ç»å†çš„è¿‡ç¨‹\"><br>åŒæ—¶ Bittorrent å’Œ Python è¿˜æœ‰ä¸ªç›¸ä¼¼çš„å…±åŒç‚¹ï¼Œä»–ä»¬çš„æœ€åˆè®¾è®¡è€…éƒ½<strong>æ›¾ç»</strong>æ˜¯è‡ªå·±é¡¹ç›®çš„ç»ˆèº«ä»æ…ˆç‹¬è£è€…ï¼ˆBenevolent Dictator For Lifeï¼Œ<a href=\"https://en.wikipedia.org/wiki/Benevolent_dictator_for_life\" target=\"_blank\" rel=\"noopener\">BDFL</a>ï¼‰ã€‚ä¾‹å¦‚ <a href=\"http://www.bittorrent.org/beps/bep_0000.html\" target=\"_blank\" rel=\"noopener\">BEP1000 - Pending Standards Track Documents</a> ä¸­æ‰€è¯´çš„è¿™ä¸ªä¸å­˜åœ¨çš„ BEP13 - Protocol Encryption ä¸€ç›´æ²¡èƒ½æˆä¸ºæ­£å¼çš„ BEP çš„åŸå› å°±å’Œ BitTorrent çš„ä½œè€… Bram Cohen åå¯¹ BT æµé‡åŠ å¯†ç›¸å…³ã€‚</p>\n<ul>\n<li>2018å¹´7æœˆï¼ŒGuido van Rossum å®£å¸ƒä¸å†æ‹…ä»» Python ç¤¾åŒºçš„ BDFLã€‚</li>\n<li>2018å¹´8æœˆï¼Œåœ¨è‡ªå·±ä¸€æ‰‹åˆ›åŠçš„å…¬å¸è¢«æ³¢åœºæ”¶è´­åï¼ŒBram Cohen è¡¨ç¤ºè‡ªå·±å·²ç»ç¦»å¼€äº† Bittorrentï¼Œ<a href=\"https://chia.net/\" target=\"_blank\" rel=\"noopener\">ç›®å‰åœ¨åšæ•°å­—è´§å¸ç›¸å…³çš„å·¥ä½œ</a>ã€‚</li>\n</ul>\n<h2 id=\"Bencode\"><a href=\"#Bencode\" class=\"headerlink\" title=\"Bencode\"></a>Bencode</h2><p>bencode æ˜¯ BT åè®®åœ¨ä¼ è¾“æ•°æ®è¿‡ç¨‹ä¸­å¹¿æ³›é‡‡ç”¨çš„ä¸€ç§ç¼–ç æ ¼å¼ã€‚ä¸»è¦æ”¯æŒä»¥ä¸‹å››ç§æ•°æ®ç±»å‹çš„ç¼–ç ï¼š</p>\n<ul>\n<li><strong>String</strong>ï¼šåè¿›åˆ¶å­—ç¬¦ä¸²å ç”¨å­—èŠ‚æ•° + â€˜:â€™ + å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ â€œspamâ€ä¼šè¢«ç¼–ç æˆâ€œ4:spamâ€</li>\n<li><strong>Integer</strong>ï¼šâ€™iâ€™ + åè¿›åˆ¶æ•´å½¢æ•°å­— + â€˜eâ€™ã€‚é™¤ 0 ä¹‹å¤–ï¼Œä¸èƒ½ä»¥ 0 å¼€å¤´ã€‚ä¾‹å¦‚ï¼ši3eã€i-3e</li>\n<li><strong>List</strong>ï¼šä½¿ç”¨å­—ç¬¦ â€˜lâ€™ å’Œ â€˜eâ€™ è¿›è¡Œç•Œå®šï¼Œä¸­é—´æ˜¯å…¶ä»–å…ƒç´ ã€‚ä¾‹å¦‚ <em>l4:spami:-42ee</em> ä»£è¡¨åˆ—è¡¨ <em>[spam, -42]</em></li>\n<li><strong>Dictionary</strong>ï¼šä½¿ç”¨å­—ç¬¦ â€˜dâ€™ å’Œ â€˜eâ€™ è¿›è¡Œç•Œå®šï¼Œä¸­é—´æ˜¯æ¯ä¸ªé”®å€¼å¯¹å…ƒç´ ,è€Œä¸”æ‰€æœ‰é”®ä¸ºå­—ç¬¦ä¸²ç±»å‹å¹¶æŒ‰å­—å…¸é¡ºåºæ’åˆ—ã€‚ä¾‹å¦‚ <em>d3:cow3:moo4:spam4:eggse</em> ä»£è¡¨å­—å…¸ <em>{cow: moo, spam: eggs}</em></li>\n</ul>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://github.com/bittorrent/bittorrent.org\" target=\"_blank\" rel=\"noopener\">BEP çš„ Github åœ°å€</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/BitTorrent_protocol_encryption\" target=\"_blank\" rel=\"noopener\">Wikipedia - BitTorrent protocol encryption</a></li>\n<li><a href=\"http://cdmd.cnki.com.cn/Article/CDMD-10614-2010234919.htm\" target=\"_blank\" rel=\"noopener\">BTæµé‡è¯†åˆ«æŠ€æœ¯çš„ç ”ç©¶</a></li>\n<li><a href=\"http://pcedu.pconline.com.cn/960/9603584_all.html\" target=\"_blank\" rel=\"noopener\">è°ˆeD2kå’Œç”µé©´çš„å…´è¡°</a></li>\n<li><a href=\"https://tech.slashdot.org/story/18/08/20/0457247/bittorrent-founder-bram-cohen-has-left-the-company\" target=\"_blank\" rel=\"noopener\">Slashdot - BitTorrent Founder Bram Cohen Has Left the Company</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p>åœ¨ç‰ˆæƒæ„è¯†æ„ˆæ¸åŠ å¼ºçš„ä»Šå¤©ï¼ŒBT æµé‡å å…¨çƒæµé‡çš„æ¯”é‡ä¸æ–­ä¸‹é™ï¼Œè¿™ç§ p2p æŠ€æœ¯çš„åº”ç”¨åœ¨<a href=\"http://www.donews.com/article/detail/4805/11133.html\" target=\"_blank\" rel=\"noopener\">é€æ¸è¡°è½</a>ã€‚ä½†æ˜¯è¯·è®°ä½</p>\n<ul>\n<li>â€œæŠ€æœ¯æ— ç½ªâ€â€”â€”çºµç„¶æ®è¯´çˆ±å› æ–¯å¦ä¹Ÿæ›¾å¯¹â€œæŠŠåŸå­å¼¹é€åˆ°äº†ç–¯å­æ‰‹é‡Œâ€æ„Ÿåˆ°åæ‚”ã€‚</li>\n<li>â€œä¸ªä½“é‡å¤ç³»ç»Ÿå‘è‚²â€ï¼š<blockquote><p>æŠ€æœ¯çš„å˜åŒ–ä¼šå¯¼è‡´æŸäº›æ€æƒ³è¿‡æ—¶å¹¶è¿…é€Ÿæ¶ˆå¤±ï¼Œè¿™ç§æƒ…å½¢ç»å¸¸å‘ç”Ÿã€‚ä½†æ˜¯ï¼ŒæŠ€æœ¯çš„å¦ä¸€ç§å˜åŒ–è¿˜å¯èƒ½ä½¿æŸäº›æ€æƒ³å†æ¬¡å¤æ´»ã€‚</p>\n<footer><strong>Andrew Tanenbaum</strong><cite>ç°ä»£æ“ä½œç³»ç»Ÿ</cite></footer></blockquote>\n\n</li>\n</ul>\n<h2 id=\"æ€»ç›®å½•\"><a href=\"#æ€»ç›®å½•\" class=\"headerlink\" title=\"æ€»ç›®å½•\"></a>æ€»ç›®å½•</h2><p>ä¸‹é¢è¿›å…¥æ­£é¢˜ã€‚ä¸€ä¸ªä½¿ç”¨ BT è¿›è¡Œä¸‹è½½çš„è¿‡ç¨‹å¯ä»¥ç®€çŸ­åœ°æè¿°å¦‚ä¸‹ï¼š</p>\n<p>å½“ä½ è·å–äº†ä¸€ä¸ª<strong>ç£åŠ›é“¾æ¥</strong>æˆ–è€…<strong>ç§å­æ–‡ä»¶</strong>ï¼Œä½¿ç”¨ BT å®¢æˆ·ç«¯æ‰“å¼€æ–‡ä»¶ç¡®è®¤ä¸‹è½½åï¼Œå®¢æˆ·ç«¯å°±æˆä¸ºäº†ä¸€ä¸ª peerï¼Œå®¢æˆ·ç«¯é€šè¿‡è¿æ¥ <strong>Tracker</strong> æœåŠ¡å™¨æˆ–è€… <strong>DHT</strong> ç½‘ç»œå¯»æ‰¾åˆ°å…¶ä»–æ‹¥æœ‰æ‰€éœ€è¦æ–‡ä»¶åˆ†ç‰‡çš„ peerï¼Œä»è¿™äº› peer ä¸­ä¸‹è½½èµ„æºåˆ†ç‰‡ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¸Šä¼ æ•°æ®ç»™å…¶ä»–æ¥ç´¢è¦è‡ªå·±æ‰€æ‹¥æœ‰åˆ†ç‰‡çš„ peerï¼Œä»¥æ­¤åå¤ï¼Œç›´åˆ°ä¸‹è½½å®Œæˆã€‚</p>\n<p>ææ¸…æ¥šè¿™ä¸ªä¸‹è½½è¿‡ç¨‹ä¸­åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…å°±æ˜¯è®°å½•è¿™ä¸ªç³»åˆ—æ–‡ç« çš„ç›®çš„æ‰€åœ¨ã€‚æ•´ä¸ªå­¦ä¹ è¿‡ç¨‹ä»¥ BT å¢å¼ºå»ºè®® <a href=\"http://www.bittorrent.org/beps/bep_0000.html\" target=\"_blank\" rel=\"noopener\">BEP</a> ä¸ºä¸»è¦å‚è€ƒï¼ŒåŒæ—¶é€‚å½“å‚è€ƒ <a href=\"https://github.com/atomashpolskiy/bt\" target=\"_blank\" rel=\"noopener\">BT çš„ä¸€ä¸ª Java ç‰ˆæœ¬å®ç°æºç </a>ã€‚</p>\n<p>æ•´ä¸ªç³»åˆ—åˆ†ä¸ºï¼š</p>\n<ul>\n<li><a href=\"/2018/08/26/bt-overview/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\">BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°</a>ï¼šä¸»è¦ä»‹ç» BEP ä¸ Bencode ç¼–ç </li>\n<li><a href=\"/2018/08/26/bt-metadata/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹ Metadataï¼šTorrent ä¸ Magnet\">BT å¢å¼ºå»ºè®®ä¹‹ Metadataï¼šTorrent ä¸ Magnet</a>ï¼šTorrent ç§å­æ–‡ä»¶ç»“æ„ä¸ Magnet ç£åŠ›é“¾æ¥çš„åŸç†</li>\n<li><a href=\"/2018/08/27/bt-tracker/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹ Tracker\">BT å¢å¼ºå»ºè®®ä¹‹ Tracker</a>ï¼šä½œä¸º Peer é—´æ¡¥æ¢çš„ Tracker æœåŠ¡å™¨çš„å·¥ä½œåŸç†</li>\n<li><a href=\"/2018/08/30/bt-peer/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹ Peer\">BT å¢å¼ºå»ºè®®ä¹‹ Peer</a>ï¼š Peer é—´çš„é€šä¿¡çš„è¿‡ç¨‹ä»¥åŠä»¥ç‰™è¿˜ç‰™ç­–ç•¥</li>\n<li>DHTï¼šä½¿å¾— BT ç½‘ç»œè„±ç¦» Trackerï¼Œå®ç°å®Œå…¨å»ä¸­å¿ƒåŒ–<ul>\n<li><a href=\"/2018/11/08/dht-kademlia/\" title=\"DHT ç½‘ç»œä¹‹ Kademlia ç®—æ³•\">DHT ç½‘ç»œä¹‹ Kademlia ç®—æ³•</a></li>\n<li><a href=\"/2018/11/12/bt-dht/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹ DHT\">BT å¢å¼ºå»ºè®®ä¹‹ DHT</a></li>\n</ul>\n</li>\n<li><a href=\"/2018/11/15/bt-advanced/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\">BT å¢å¼ºå»ºè®®ä¹‹è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ</a>ï¼šBEP ä¸­æå‡ºçš„ä¸€äº›è¿›é˜¶æ”¹è¿›æ–¹æ¡ˆ\n\n</li>\n</ul>\n<p>ç”¨äºä¿è¯ BT é«˜é€Ÿä¸‹è½½æ—¶å…¶ä»–åº”ç”¨ä½æ—¶å»¶ç½‘ç»œé€šä¿¡çš„ä¼ è¾“å±‚åè®® <strong>ÂµTP</strong> å·²åœ¨ç‹¬ç«‹çš„åšæ–‡ <a href=\"/2018/08/04/Âµtp/\" title=\"ÂµTP åè®® â€”â€” å¯¹ BEP29 çš„ç®€è¦ç†è§£\">ÂµTP åè®® â€”â€” å¯¹ BEP29 çš„ç®€è¦ç†è§£</a> ä¸­ä»‹ç»ã€‚</p>\n<p>è¿™ä¸ªç³»åˆ—å°†å°½å¯èƒ½æ¶µç›–æ‰€æœ‰çš„ BEPã€‚ä¸‹é¢çš„è¡¨æ ¼æ˜¾ç¤ºäº†ç« èŠ‚ä¸ BEP çš„å¼•ç”¨å…³ç³»ï¼Œå› æ­¤åœ¨æ¯ç¯‡æ–‡ç« çš„å‚è€ƒèµ„æ–™ä¸­å°†ä¸åœ¨åˆ—ä¸¾ç›¸å…³ BEPã€‚</p>\n<h2 id=\"BEP\"><a href=\"#BEP\" class=\"headerlink\" title=\"BEP\"></a>BEP</h2><p>BEPï¼ˆBitTorrent Enhancement Proposalï¼‰æ˜¯ BitTorrent ç¤¾åŒºä»¿ç…§ PEPï¼ˆPython Enhancement Proposalï¼‰æ¥æ”¹è¿› BitTorrent çš„æŠ€æœ¯æ–‡æ¡£ï¼Œå¯ä»¥è§†ä¸ºä¸€ç§å¼€å‘æ–¹å¼ã€‚ä¸€ä¸ª<a href=\"http://www.bittorrent.org/beps/bep_0002.html\" target=\"_blank\" rel=\"noopener\">è§„èŒƒ</a>çš„ BEP è¢«æå‡ºåå¯èƒ½ç»å†å¦‚ä¸‹çš„å‡ ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯ç›®å‰åªæœ‰ Finalï¼ŒAcceptedï¼ŒDraftï¼ŒDeferred å››ç§çŠ¶æ€çš„ BEPã€‚<br><img src=\"bep_possible_paths.png\" alt=\"BEP å¯èƒ½ç»å†çš„è¿‡ç¨‹\"><br>åŒæ—¶ Bittorrent å’Œ Python è¿˜æœ‰ä¸ªç›¸ä¼¼çš„å…±åŒç‚¹ï¼Œä»–ä»¬çš„æœ€åˆè®¾è®¡è€…éƒ½<strong>æ›¾ç»</strong>æ˜¯è‡ªå·±é¡¹ç›®çš„ç»ˆèº«ä»æ…ˆç‹¬è£è€…ï¼ˆBenevolent Dictator For Lifeï¼Œ<a href=\"https://en.wikipedia.org/wiki/Benevolent_dictator_for_life\" target=\"_blank\" rel=\"noopener\">BDFL</a>ï¼‰ã€‚ä¾‹å¦‚ <a href=\"http://www.bittorrent.org/beps/bep_0000.html\" target=\"_blank\" rel=\"noopener\">BEP1000 - Pending Standards Track Documents</a> ä¸­æ‰€è¯´çš„è¿™ä¸ªä¸å­˜åœ¨çš„ BEP13 - Protocol Encryption ä¸€ç›´æ²¡èƒ½æˆä¸ºæ­£å¼çš„ BEP çš„åŸå› å°±å’Œ BitTorrent çš„ä½œè€… Bram Cohen åå¯¹ BT æµé‡åŠ å¯†ç›¸å…³ã€‚</p>\n<ul>\n<li>2018å¹´7æœˆï¼ŒGuido van Rossum å®£å¸ƒä¸å†æ‹…ä»» Python ç¤¾åŒºçš„ BDFLã€‚</li>\n<li>2018å¹´8æœˆï¼Œåœ¨è‡ªå·±ä¸€æ‰‹åˆ›åŠçš„å…¬å¸è¢«æ³¢åœºæ”¶è´­åï¼ŒBram Cohen è¡¨ç¤ºè‡ªå·±å·²ç»ç¦»å¼€äº† Bittorrentï¼Œ<a href=\"https://chia.net/\" target=\"_blank\" rel=\"noopener\">ç›®å‰åœ¨åšæ•°å­—è´§å¸ç›¸å…³çš„å·¥ä½œ</a>ã€‚</li>\n</ul>\n<h2 id=\"Bencode\"><a href=\"#Bencode\" class=\"headerlink\" title=\"Bencode\"></a>Bencode</h2><p>bencode æ˜¯ BT åè®®åœ¨ä¼ è¾“æ•°æ®è¿‡ç¨‹ä¸­å¹¿æ³›é‡‡ç”¨çš„ä¸€ç§ç¼–ç æ ¼å¼ã€‚ä¸»è¦æ”¯æŒä»¥ä¸‹å››ç§æ•°æ®ç±»å‹çš„ç¼–ç ï¼š</p>\n<ul>\n<li><strong>String</strong>ï¼šåè¿›åˆ¶å­—ç¬¦ä¸²å ç”¨å­—èŠ‚æ•° + â€˜:â€™ + å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ â€œspamâ€ä¼šè¢«ç¼–ç æˆâ€œ4:spamâ€</li>\n<li><strong>Integer</strong>ï¼šâ€™iâ€™ + åè¿›åˆ¶æ•´å½¢æ•°å­— + â€˜eâ€™ã€‚é™¤ 0 ä¹‹å¤–ï¼Œä¸èƒ½ä»¥ 0 å¼€å¤´ã€‚ä¾‹å¦‚ï¼ši3eã€i-3e</li>\n<li><strong>List</strong>ï¼šä½¿ç”¨å­—ç¬¦ â€˜lâ€™ å’Œ â€˜eâ€™ è¿›è¡Œç•Œå®šï¼Œä¸­é—´æ˜¯å…¶ä»–å…ƒç´ ã€‚ä¾‹å¦‚ <em>l4:spami:-42ee</em> ä»£è¡¨åˆ—è¡¨ <em>[spam, -42]</em></li>\n<li><strong>Dictionary</strong>ï¼šä½¿ç”¨å­—ç¬¦ â€˜dâ€™ å’Œ â€˜eâ€™ è¿›è¡Œç•Œå®šï¼Œä¸­é—´æ˜¯æ¯ä¸ªé”®å€¼å¯¹å…ƒç´ ,è€Œä¸”æ‰€æœ‰é”®ä¸ºå­—ç¬¦ä¸²ç±»å‹å¹¶æŒ‰å­—å…¸é¡ºåºæ’åˆ—ã€‚ä¾‹å¦‚ <em>d3:cow3:moo4:spam4:eggse</em> ä»£è¡¨å­—å…¸ <em>{cow: moo, spam: eggs}</em></li>\n</ul>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://github.com/bittorrent/bittorrent.org\" target=\"_blank\" rel=\"noopener\">BEP çš„ Github åœ°å€</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/BitTorrent_protocol_encryption\" target=\"_blank\" rel=\"noopener\">Wikipedia - BitTorrent protocol encryption</a></li>\n<li><a href=\"http://cdmd.cnki.com.cn/Article/CDMD-10614-2010234919.htm\" target=\"_blank\" rel=\"noopener\">BTæµé‡è¯†åˆ«æŠ€æœ¯çš„ç ”ç©¶</a></li>\n<li><a href=\"http://pcedu.pconline.com.cn/960/9603584_all.html\" target=\"_blank\" rel=\"noopener\">è°ˆeD2kå’Œç”µé©´çš„å…´è¡°</a></li>\n<li><a href=\"https://tech.slashdot.org/story/18/08/20/0457247/bittorrent-founder-bram-cohen-has-left-the-company\" target=\"_blank\" rel=\"noopener\">Slashdot - BitTorrent Founder Bram Cohen Has Left the Company</a></li>\n</ol>\n"},{"title":"BT å¢å¼ºå»ºè®®ä¹‹ Metadataï¼šTorrent ä¸ Magnet","date":"2018-08-26T14:00:00.000Z","_content":"\næœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» Tracker æœåŠ¡å™¨çš„å·¥ä½œåŸç†ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡{% post_link bt-overview %}ã€‚\n\nåœ¨ç£åŠ›é“¾æ¥å‡ºç°å‰ï¼ŒBT ä¸‹è½½çš„ç¬¬ä¸€æ­¥å°±æ˜¯è·å– Torrentï¼ˆç§å­ï¼‰æ–‡ä»¶ã€‚ç§å­æ–‡ä»¶ä¸­åŒ…å«äº†èµ„æºçš„æœ€å…³é”®ä¿¡æ¯ â€”â€” Metadataï¼ˆå…ƒæ•°æ®ï¼‰ã€‚Magnetï¼ˆç£åŠ›é“¾æ¥ï¼‰çš„å¼•å…¥åˆ™çœå»äº†è·å–ç§å­æ–‡ä»¶è¿™ä¸€æ­¥ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦å…ƒæ•°æ®ï¼Œåªæ˜¯æ”¹ä¸ºä» peer å¤„è·å–ã€‚æœ‰äº†å…ƒæ•°æ®åï¼Œæ‰èƒ½çŸ¥é“æ•´ä¸ªèµ„æºçš„æ¦‚å†µï¼Œç»§è€Œè¿›è¡Œä¸‹è½½ã€‚\n\n## Torrent\n### æ–‡ä»¶ç»“æ„\nç§å­æ–‡ä»¶ä½¿ç”¨ bencode è¿›è¡Œç¼–ç ï¼Œæ•´ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå­—å…¸ã€‚æœ‰ä¸‹åˆ—ä¸»è¦çš„ keyï¼ˆvalue ä¸­ï¼Œæ•´å‹å€¼çš„å•ä½å‡ä¸ºå­—èŠ‚ï¼Œå­—ç¬¦ä¸²é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç ï¼‰ï¼š\n - **announce**ï¼šå­—ç¬¦ä¸²ã€‚tracker çš„ URL åœ°å€ï¼Œä»…èƒ½å®šä¹‰ä¸€ä¸ª Trackerã€‚\n - **info**ï¼šå­—å…¸ã€‚ä¹Ÿå°±æ˜¯èµ„æºçš„å…ƒæ•°æ®ï¼š\n     - **length**ï¼šæ•´å‹ã€‚å¦‚æœæœ‰è¯¥å­—æ®µï¼Œåˆ™ä»£è¡¨ç§å­ä¸ºå•æ–‡ä»¶ç§å­ï¼Œä»£è¡¨è¯¥æ–‡ä»¶çš„å¤§å°ã€‚\n     - **files**ï¼šåˆ—è¡¨ï¼Œå­é¡¹ç±»å‹ä¸ºå­—å…¸ã€‚å¦‚æœæœ‰è¯¥å­—æ®µï¼Œåˆ™ä»£è¡¨ç§å­ä¸ºå¤šæ–‡ä»¶ç§å­ã€‚ä¸€ä¸ªç§å­åªèƒ½ä¸ºå•æ–‡ä»¶ç§å­æˆ–è€…å¤šæ–‡ä»¶ç§å­ï¼Œå› æ­¤ **files å­—æ®µå’Œä¸Šè¿° length å­—æ®µåªèƒ½é€‰å…¶ä¸­ä¹‹ä¸€**ã€‚files å­—å…¸çš„å­—æ®µåŒ…æ‹¬ï¼š\n         - **length**ï¼šæ•´å‹ã€‚ä»£è¡¨è¯¥æ–‡ä»¶çš„å¤§å°ã€‚\n         - **path**ï¼šåˆ—è¡¨ï¼Œå­é¡¹ç±»å‹ä¸ºå­—ç¬¦ä¸²ã€‚å­ç›®å½•åç§°åˆ—è¡¨ï¼Œæœ€åä¸€é¡¹ä¸ºæ–‡ä»¶åï¼Œå› æ­¤è¯¥åˆ—è¡¨é•¿åº¦è‡³å°‘éœ€è¦ä¸º 1ã€‚\n     - **name**ï¼šå­—ç¬¦ä¸²ã€‚å¦‚æœæ˜¯å•ä¸ªæ–‡ä»¶çš„ç§å­ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—æ®µè¡¨ç¤ºè¯¥æ–‡ä»¶çš„æ–‡ä»¶åï¼Œå¦åˆ™è¡¨ç¤ºå¤šä¸ªæ–‡ä»¶å­˜å‚¨çš„æ ¹ç›®å½•ã€‚\n     - **piece length**ï¼šæ•´å‹ã€‚ä¸ºäº†æ–¹ä¾¿ä¼ è¾“ä¸èŠ‚ç‚¹é—´äº¤æ¢æ•°æ®ï¼Œæ–‡ä»¶è¢«åˆ†ç‰‡ï¼Œè¿™ä¸ªå­—æ®µä»£è¡¨æ¯ä¸ªç‰‡æ®µçš„å¤§å°ï¼Œé™¤äº†æœ€åä¸€ç‰‡å¯èƒ½ä¼šè¢«æˆªæ–­ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬ä¸º 2 çš„å¹‚æ¬¡ã€‚\n     - **pieces**ï¼šè¢«ç¼–ç æˆå­—ç¬¦ä¸²ï¼Œä½†æ˜¯éœ€è¦è¢«è§£ææˆ SHA1 å€¼ã€‚ä»£è¡¨æ‰€æœ‰ç‰‡æ®µçš„ SHA1 å€¼ï¼ˆæ¯ä¸ªå€¼å ç”¨ 160 æ¯”ç‰¹ï¼‰ã€‚\n\n### ä¸¾ä¾‹\n#### å•æ–‡ä»¶ç§å­\nè¿™æ˜¯ä¸€ä¸ªå•æ–‡ä»¶ç§å­æ–‡ä»¶çš„ JSON åŒ–ç»“æ„ç¤ºæ„ï¼Œæ–‡ä»¶ debian-503-amd64-CD-1.iso è¢«åˆ†æˆå¤§å°ä¸º 256 KiB çš„ $\\left(\\lceil\\frac{length}{piece length}\\rceil = 2588\\right)$ ç‰‡ã€‚\n``` json\n {\n     \"announce\": \"http://bttracker.debian.org:6969/announce\",\n     \"info\":\n     {\n         \"name\": \"debian-503-amd64-CD-1.iso\",\n         \"piece length\": 262144,\n         \"length\": 678301696,\n         \"pieces\": <binary SHA1 hashes>\n     }\n }\n```\n\n#### å¤šæ–‡ä»¶ç§å­\nè¿™ä¸ªä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ–‡ä»¶çš„ç§å­çš„ç¤ºä¾‹ã€‚ç›¸å¯¹äºå•æ–‡ä»¶ç§å­ï¼Œå®ƒä½¿ç”¨äº† files å­—æ®µå–ä»£äº† length å­—æ®µã€‚\n``` json\n {\n     \"announce\": \"http://tracker.site1.com/announce\",\n     \"info\":\n     {\n         \"name\": \"directoryName\",\n         \"piece length\": 262144,\n         \"files\":\n         [\n             {\"path\": [\"111.txt\"], \"length\": 111},\n             {\"path\": [\"222.txt\"], \"length\": 222}\n         ],\n         \"pieces\": <binary SHA1 hashes>\n     }\n }\n```\n\n## Magnet\n### MAGNET-URI Project\næåˆ° Magnetï¼ˆç£åŠ›é“¾æ¥ï¼‰å¤§å®¶éƒ½ä¼šæƒ³åˆ° BTï¼Œä½†æ˜¯ç£åŠ›é“¾æ¥ä¸æ˜¯å› ä¸º BT è€Œè¯ç”Ÿçš„ï¼Œä¹Ÿä¸æ­¢ç”¨äº BTï¼Œäº‹å®ä¸Šç£åŠ›é“¾æ¥çš„æ¥è‡ª [MAGNET-URI Project](http://magnet-uri.sourceforge.net/) è¿™ä¸ªé¡¹ç›®ï¼š\n{% blockquote Gordon Mohr http://magnet-uri.sourceforge.net/magnet-draft-overview.txt %}\nMAGNET is a work-in-progress URI specification, and collection of standard practices/implementing code to allow a website to seamlessly integrate with features made available by local utility programs. In one way, it could be thought of as a vendor- and project-neutral generalization of the \"freenet:\" and \"ed2k:\" URI-schemes used by the Freenet and EDonkey2000 peer-to-peer networks, respectively.\n{% endblockquote %}\n\nç£åŠ›é“¾æ¥æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒï¼Œå®ƒå¸Œæœ›è¿™ç§ p2p çš„é“¾æ¥éƒ½å¯ä»¥ä»¥æŒ‰ç…§è¿™ä¸ªè§„èŒƒå±•ç¤ºï¼Œè¿™æ ·çš„è¯å½“ç”¨æˆ·åœ¨ç½‘é¡µä¸Šç‚¹å‡»ç£åŠ›é“¾æ¥çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç£åŠ›é“¾æ¥çš„å‚æ•°ï¼ˆ`xt`ï¼Œä¸‹æ–‡ä¼šæåŠï¼‰â€œå¬å”¤â€åˆé€‚çš„å®¢æˆ·ç«¯ã€‚å®ƒå…ˆè¢« eDonkeyï¼ˆç”µé©´ï¼‰æ¨åŠ¨ï¼Œç”µé©´é“¾æ¥ç†è®ºä¸Šå¯ä»¥è¢«è½¬æ¢æˆç£åŠ›é“¾æ¥ã€‚è½¬æ¢è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š\n```\ned2k://|file|<name>|<file-size>|<ed2k-hash>|/\nmagnet:?xt=urn:ed2k:<ed2k-hash>&xl=<file-size>&dn=<name>\n```\nç„¶è€Œï¼Œè¿™ä¸ª MAGNET-URI Project åæ¥åº”è¯¥æ²¡æœ‰è¢«æ¨åŠ¨ä¸‹å»ï¼Œå¯¼è‡´ç”šè‡³è¿ç”µé©´è‡ªå·±çš„å®¢æˆ·ç«¯éƒ½æ²¡æœ‰æ”¯æŒ ed2k çš„ magnet æ ¼å¼ã€‚ç›´åˆ°åæ¥åœ¨ BT ä¸­å¤§æ”¾å¼‚å½©ï¼Œå¯¼è‡´ç°åœ¨ç‹­ä¹‰ä¸Šçš„ç£åŠ›é“¾æ¥å°±æ˜¯æŒ‡ BT ä¸­ä½¿ç”¨çš„ç£åŠ›é“¾æ¥ã€‚\n\n### BT ä¸­çš„ç£åŠ›é“¾æ¥\nBT ä¸­çš„ç£åŠ›é“¾æ¥å¤§æ¦‚æœ‰è¿™ä¸¤ç§æ ¼å¼ï¼š\n```\nv1: magnet:?xt=urn:btih:<info-hash>&dn=<name>&tr=<tracker-url>&x.pe=<peer-address>\nv2: magnet:?xt=urn:btmh:<tagged-info-hash>&dn=<name>&tr=<tracker-url>&x.pe=<peer-address>\n```\næ ¹æ® [URL çš„å®šä¹‰](https://zh.wikipedia.org/wiki/ç»Ÿä¸€èµ„æºå®šä½ç¬¦)ï¼Œ`magnet` å‰ç¼€è¡¨ç¤ºè¿™ä¸ªé“¾æ¥æ˜¯ç£åŠ›é“¾æ¥ï¼Œ`ï¼Ÿ` åè¡¨ç¤ºä¸º GET æ¨¡å¼æŸ¥è¯¢å‚æ•°åˆ—è¡¨ï¼Œå‚æ•°ä½¿ç”¨ `&` ç¬¦å·éš”å¼€ã€‚BT ç£åŠ›é“¾æ¥çš„å‚æ•°å¦‚ä¸‹:\n - **xt**ï¼šè¡¨ç¤ºåŒ…å«æ–‡ä»¶æ•£åˆ—å‡½æ•°å€¼çš„ URNï¼Œè¿™æ˜¯å”¯ä¸€ä¸€ä¸ªå¿…é€‰å‚æ•°ï¼Œå¯èƒ½çš„ URN ç±»å‹æœ‰ï¼š\n    - **btih**ï¼šè¡¨ç¤º Torrent æ–‡ä»¶ info éƒ¨åˆ†çš„ SHA1 å€¼ï¼Œå¯ä»¥æ˜¯ Hex ç¼–ç æˆ–è€… Base32 ç¼–ç å½¢å¼ã€‚\n    - **btmh**ï¼šè¡¨ç¤º Torrent æ–‡ä»¶ info éƒ¨åˆ†çš„ HEX ç¼–ç  [multihash](https://github.com/multiformats/multihash) å€¼ï¼Œmultihash æ˜¯ç”±åˆ›é€  IPFS  çš„ Protocal Lab çš„é¡¹ç›®ï¼Œç”¨äºç¼–ç å¤šç§ hash å‡½æ•°çš„ hash ç»“æœã€‚**btmh å¯ä»¥å’Œ btih åŒæ—¶å­˜åœ¨ï¼Œè¿™ä¸ªåº”è¯¥å’Œ [SHA1 è¢«ç ´è§£](https://security.googleblog.com/2017/02/announcing-first-sha1-collision.html)ç›¸å…³â€”â€”æœ‰ btmh ä¸­ä½¿ç”¨å…¶ä»– hash å‡½æ•°å¾—åˆ°çš„ hash å€¼åŠ ä¸ŠåŸæ¥çš„ SHA1 å€¼å°±å¯ä»¥åšåˆ°å…¼å®¹ï¼ŒåŒæ—¶æ£€æµ‹ç¢°æ’ã€‚**\n - **dn**ï¼šè¡¨ç¤ºå»ºè®®æ˜¾ç¤ºçš„æ–‡ä»¶åã€‚\n - **tr**ï¼šè¡¨ç¤º Trackerçš„ URLï¼Œå¦‚æœæœ‰å¤šä¸ª Tracker,åˆ™ä¼šæœ‰å¤šä¸ª `tr` å‚æ•°ã€‚\n - **x.pe**ï¼šè¡¨ç¤º Peer çš„ï¼Œæ ¼å¼ä¸º `hostname:port`ï¼Œ`ipv4-literal:port` æˆ–è€… `[ipv6-literal]:port`ï¼Œè¿™äº› peer å¯ä»¥è¢«æ·»åŠ åˆ° peer åˆ—è¡¨ä¸­ç”¨äºè·å–å…ƒæ•°æ®ä»¥åŠåç»­çš„æ–‡ä»¶ç‰‡æ®µè·å–ã€‚å®é™…ä¸Š Magnet é“¾æ¥ä¸­å®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„å‚æ•° `xt` ç”¨äºæŒ‡å®šç±»ä¼¼ `x.pe` æ‰€è¡¨ç¤ºçš„ p2p è¿æ¥ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰åˆé€‚çš„ URI æ ‡è¯†ç¬¦åˆ†é…ç»™ BTï¼ˆæ¯”å¦‚ç”µé©´æœ‰ ed2kï¼‰ï¼Œæ‰€ä»¥ BT ä½¿ç”¨äº†è¿™ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯ `xt`ã€‚\n - **so**ï¼šå®šä¹‰åœ¨ [BEP53 - Magnet URI extension - Select specific file indices for download](http://www.bittorrent.org/beps/bep_0053.html) ä¸­ï¼Œç”¨äºæŒ‡å®šä¸‹è½½ç‰¹å®šæ–‡ä»¶ï¼Œæ¯”å¦‚ `so=0,2,4,6-8` è¡¨ç¤ºä¸‹è½½ files åˆ—è¡¨ä¸­ç´¢å¼•ä¸º 0,2,4,6,7,8 çš„è¿™å…­ä¸ªæ–‡ä»¶ã€‚\n\næœ‰äº†ç£åŠ›é“¾æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥å‘ peer è¯·æ±‚ Torrent æ–‡ä»¶çš„ info éƒ¨åˆ†äº†ï¼Œè·å–å®Œæˆåå°±ç›¸å½“äºæ‹¥æœ‰äº† Torrent æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æœ‰äº†å®Œæ•´çš„å…ƒæ•°æ®ï¼Œç»§è€Œå¯ä»¥ä¸‹è½½èµ„æºã€‚\n\n\n## å‚è€ƒèµ„æ–™\n1. [Wikipedia - Torrent file](https://en.wikipedia.org/wiki/Torrent_file#Draft_extensions)\n2. [Online Torrent File Decoder](http://marquisdegeek.com/code_bencode.php)\n3. [Online Magnet Link to Torrent File converter](http://magnet2torrent.me/)\n4. [Wikipedia - Magnet URI scheme](https://en.wikipedia.org/wiki/Magnet_URI_scheme)\n5. [Stack Overflow - What is the difference between URI, URL and URN?](https://stackoverflow.com/questions/4913343/what-is-the-difference-between-uri-url-and-urn)\n","source":"_posts/bt-metadata.md","raw":"---\ntitle: BT å¢å¼ºå»ºè®®ä¹‹ Metadataï¼šTorrent ä¸ Magnet\ntags:\n  - BT\ndate: 2018-08-26 22:00:00\ncategories:\n---\n\næœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» Tracker æœåŠ¡å™¨çš„å·¥ä½œåŸç†ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡{% post_link bt-overview %}ã€‚\n\nåœ¨ç£åŠ›é“¾æ¥å‡ºç°å‰ï¼ŒBT ä¸‹è½½çš„ç¬¬ä¸€æ­¥å°±æ˜¯è·å– Torrentï¼ˆç§å­ï¼‰æ–‡ä»¶ã€‚ç§å­æ–‡ä»¶ä¸­åŒ…å«äº†èµ„æºçš„æœ€å…³é”®ä¿¡æ¯ â€”â€” Metadataï¼ˆå…ƒæ•°æ®ï¼‰ã€‚Magnetï¼ˆç£åŠ›é“¾æ¥ï¼‰çš„å¼•å…¥åˆ™çœå»äº†è·å–ç§å­æ–‡ä»¶è¿™ä¸€æ­¥ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦å…ƒæ•°æ®ï¼Œåªæ˜¯æ”¹ä¸ºä» peer å¤„è·å–ã€‚æœ‰äº†å…ƒæ•°æ®åï¼Œæ‰èƒ½çŸ¥é“æ•´ä¸ªèµ„æºçš„æ¦‚å†µï¼Œç»§è€Œè¿›è¡Œä¸‹è½½ã€‚\n\n## Torrent\n### æ–‡ä»¶ç»“æ„\nç§å­æ–‡ä»¶ä½¿ç”¨ bencode è¿›è¡Œç¼–ç ï¼Œæ•´ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå­—å…¸ã€‚æœ‰ä¸‹åˆ—ä¸»è¦çš„ keyï¼ˆvalue ä¸­ï¼Œæ•´å‹å€¼çš„å•ä½å‡ä¸ºå­—èŠ‚ï¼Œå­—ç¬¦ä¸²é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç ï¼‰ï¼š\n - **announce**ï¼šå­—ç¬¦ä¸²ã€‚tracker çš„ URL åœ°å€ï¼Œä»…èƒ½å®šä¹‰ä¸€ä¸ª Trackerã€‚\n - **info**ï¼šå­—å…¸ã€‚ä¹Ÿå°±æ˜¯èµ„æºçš„å…ƒæ•°æ®ï¼š\n     - **length**ï¼šæ•´å‹ã€‚å¦‚æœæœ‰è¯¥å­—æ®µï¼Œåˆ™ä»£è¡¨ç§å­ä¸ºå•æ–‡ä»¶ç§å­ï¼Œä»£è¡¨è¯¥æ–‡ä»¶çš„å¤§å°ã€‚\n     - **files**ï¼šåˆ—è¡¨ï¼Œå­é¡¹ç±»å‹ä¸ºå­—å…¸ã€‚å¦‚æœæœ‰è¯¥å­—æ®µï¼Œåˆ™ä»£è¡¨ç§å­ä¸ºå¤šæ–‡ä»¶ç§å­ã€‚ä¸€ä¸ªç§å­åªèƒ½ä¸ºå•æ–‡ä»¶ç§å­æˆ–è€…å¤šæ–‡ä»¶ç§å­ï¼Œå› æ­¤ **files å­—æ®µå’Œä¸Šè¿° length å­—æ®µåªèƒ½é€‰å…¶ä¸­ä¹‹ä¸€**ã€‚files å­—å…¸çš„å­—æ®µåŒ…æ‹¬ï¼š\n         - **length**ï¼šæ•´å‹ã€‚ä»£è¡¨è¯¥æ–‡ä»¶çš„å¤§å°ã€‚\n         - **path**ï¼šåˆ—è¡¨ï¼Œå­é¡¹ç±»å‹ä¸ºå­—ç¬¦ä¸²ã€‚å­ç›®å½•åç§°åˆ—è¡¨ï¼Œæœ€åä¸€é¡¹ä¸ºæ–‡ä»¶åï¼Œå› æ­¤è¯¥åˆ—è¡¨é•¿åº¦è‡³å°‘éœ€è¦ä¸º 1ã€‚\n     - **name**ï¼šå­—ç¬¦ä¸²ã€‚å¦‚æœæ˜¯å•ä¸ªæ–‡ä»¶çš„ç§å­ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—æ®µè¡¨ç¤ºè¯¥æ–‡ä»¶çš„æ–‡ä»¶åï¼Œå¦åˆ™è¡¨ç¤ºå¤šä¸ªæ–‡ä»¶å­˜å‚¨çš„æ ¹ç›®å½•ã€‚\n     - **piece length**ï¼šæ•´å‹ã€‚ä¸ºäº†æ–¹ä¾¿ä¼ è¾“ä¸èŠ‚ç‚¹é—´äº¤æ¢æ•°æ®ï¼Œæ–‡ä»¶è¢«åˆ†ç‰‡ï¼Œè¿™ä¸ªå­—æ®µä»£è¡¨æ¯ä¸ªç‰‡æ®µçš„å¤§å°ï¼Œé™¤äº†æœ€åä¸€ç‰‡å¯èƒ½ä¼šè¢«æˆªæ–­ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬ä¸º 2 çš„å¹‚æ¬¡ã€‚\n     - **pieces**ï¼šè¢«ç¼–ç æˆå­—ç¬¦ä¸²ï¼Œä½†æ˜¯éœ€è¦è¢«è§£ææˆ SHA1 å€¼ã€‚ä»£è¡¨æ‰€æœ‰ç‰‡æ®µçš„ SHA1 å€¼ï¼ˆæ¯ä¸ªå€¼å ç”¨ 160 æ¯”ç‰¹ï¼‰ã€‚\n\n### ä¸¾ä¾‹\n#### å•æ–‡ä»¶ç§å­\nè¿™æ˜¯ä¸€ä¸ªå•æ–‡ä»¶ç§å­æ–‡ä»¶çš„ JSON åŒ–ç»“æ„ç¤ºæ„ï¼Œæ–‡ä»¶ debian-503-amd64-CD-1.iso è¢«åˆ†æˆå¤§å°ä¸º 256 KiB çš„ $\\left(\\lceil\\frac{length}{piece length}\\rceil = 2588\\right)$ ç‰‡ã€‚\n``` json\n {\n     \"announce\": \"http://bttracker.debian.org:6969/announce\",\n     \"info\":\n     {\n         \"name\": \"debian-503-amd64-CD-1.iso\",\n         \"piece length\": 262144,\n         \"length\": 678301696,\n         \"pieces\": <binary SHA1 hashes>\n     }\n }\n```\n\n#### å¤šæ–‡ä»¶ç§å­\nè¿™ä¸ªä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ–‡ä»¶çš„ç§å­çš„ç¤ºä¾‹ã€‚ç›¸å¯¹äºå•æ–‡ä»¶ç§å­ï¼Œå®ƒä½¿ç”¨äº† files å­—æ®µå–ä»£äº† length å­—æ®µã€‚\n``` json\n {\n     \"announce\": \"http://tracker.site1.com/announce\",\n     \"info\":\n     {\n         \"name\": \"directoryName\",\n         \"piece length\": 262144,\n         \"files\":\n         [\n             {\"path\": [\"111.txt\"], \"length\": 111},\n             {\"path\": [\"222.txt\"], \"length\": 222}\n         ],\n         \"pieces\": <binary SHA1 hashes>\n     }\n }\n```\n\n## Magnet\n### MAGNET-URI Project\næåˆ° Magnetï¼ˆç£åŠ›é“¾æ¥ï¼‰å¤§å®¶éƒ½ä¼šæƒ³åˆ° BTï¼Œä½†æ˜¯ç£åŠ›é“¾æ¥ä¸æ˜¯å› ä¸º BT è€Œè¯ç”Ÿçš„ï¼Œä¹Ÿä¸æ­¢ç”¨äº BTï¼Œäº‹å®ä¸Šç£åŠ›é“¾æ¥çš„æ¥è‡ª [MAGNET-URI Project](http://magnet-uri.sourceforge.net/) è¿™ä¸ªé¡¹ç›®ï¼š\n{% blockquote Gordon Mohr http://magnet-uri.sourceforge.net/magnet-draft-overview.txt %}\nMAGNET is a work-in-progress URI specification, and collection of standard practices/implementing code to allow a website to seamlessly integrate with features made available by local utility programs. In one way, it could be thought of as a vendor- and project-neutral generalization of the \"freenet:\" and \"ed2k:\" URI-schemes used by the Freenet and EDonkey2000 peer-to-peer networks, respectively.\n{% endblockquote %}\n\nç£åŠ›é“¾æ¥æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒï¼Œå®ƒå¸Œæœ›è¿™ç§ p2p çš„é“¾æ¥éƒ½å¯ä»¥ä»¥æŒ‰ç…§è¿™ä¸ªè§„èŒƒå±•ç¤ºï¼Œè¿™æ ·çš„è¯å½“ç”¨æˆ·åœ¨ç½‘é¡µä¸Šç‚¹å‡»ç£åŠ›é“¾æ¥çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç£åŠ›é“¾æ¥çš„å‚æ•°ï¼ˆ`xt`ï¼Œä¸‹æ–‡ä¼šæåŠï¼‰â€œå¬å”¤â€åˆé€‚çš„å®¢æˆ·ç«¯ã€‚å®ƒå…ˆè¢« eDonkeyï¼ˆç”µé©´ï¼‰æ¨åŠ¨ï¼Œç”µé©´é“¾æ¥ç†è®ºä¸Šå¯ä»¥è¢«è½¬æ¢æˆç£åŠ›é“¾æ¥ã€‚è½¬æ¢è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š\n```\ned2k://|file|<name>|<file-size>|<ed2k-hash>|/\nmagnet:?xt=urn:ed2k:<ed2k-hash>&xl=<file-size>&dn=<name>\n```\nç„¶è€Œï¼Œè¿™ä¸ª MAGNET-URI Project åæ¥åº”è¯¥æ²¡æœ‰è¢«æ¨åŠ¨ä¸‹å»ï¼Œå¯¼è‡´ç”šè‡³è¿ç”µé©´è‡ªå·±çš„å®¢æˆ·ç«¯éƒ½æ²¡æœ‰æ”¯æŒ ed2k çš„ magnet æ ¼å¼ã€‚ç›´åˆ°åæ¥åœ¨ BT ä¸­å¤§æ”¾å¼‚å½©ï¼Œå¯¼è‡´ç°åœ¨ç‹­ä¹‰ä¸Šçš„ç£åŠ›é“¾æ¥å°±æ˜¯æŒ‡ BT ä¸­ä½¿ç”¨çš„ç£åŠ›é“¾æ¥ã€‚\n\n### BT ä¸­çš„ç£åŠ›é“¾æ¥\nBT ä¸­çš„ç£åŠ›é“¾æ¥å¤§æ¦‚æœ‰è¿™ä¸¤ç§æ ¼å¼ï¼š\n```\nv1: magnet:?xt=urn:btih:<info-hash>&dn=<name>&tr=<tracker-url>&x.pe=<peer-address>\nv2: magnet:?xt=urn:btmh:<tagged-info-hash>&dn=<name>&tr=<tracker-url>&x.pe=<peer-address>\n```\næ ¹æ® [URL çš„å®šä¹‰](https://zh.wikipedia.org/wiki/ç»Ÿä¸€èµ„æºå®šä½ç¬¦)ï¼Œ`magnet` å‰ç¼€è¡¨ç¤ºè¿™ä¸ªé“¾æ¥æ˜¯ç£åŠ›é“¾æ¥ï¼Œ`ï¼Ÿ` åè¡¨ç¤ºä¸º GET æ¨¡å¼æŸ¥è¯¢å‚æ•°åˆ—è¡¨ï¼Œå‚æ•°ä½¿ç”¨ `&` ç¬¦å·éš”å¼€ã€‚BT ç£åŠ›é“¾æ¥çš„å‚æ•°å¦‚ä¸‹:\n - **xt**ï¼šè¡¨ç¤ºåŒ…å«æ–‡ä»¶æ•£åˆ—å‡½æ•°å€¼çš„ URNï¼Œè¿™æ˜¯å”¯ä¸€ä¸€ä¸ªå¿…é€‰å‚æ•°ï¼Œå¯èƒ½çš„ URN ç±»å‹æœ‰ï¼š\n    - **btih**ï¼šè¡¨ç¤º Torrent æ–‡ä»¶ info éƒ¨åˆ†çš„ SHA1 å€¼ï¼Œå¯ä»¥æ˜¯ Hex ç¼–ç æˆ–è€… Base32 ç¼–ç å½¢å¼ã€‚\n    - **btmh**ï¼šè¡¨ç¤º Torrent æ–‡ä»¶ info éƒ¨åˆ†çš„ HEX ç¼–ç  [multihash](https://github.com/multiformats/multihash) å€¼ï¼Œmultihash æ˜¯ç”±åˆ›é€  IPFS  çš„ Protocal Lab çš„é¡¹ç›®ï¼Œç”¨äºç¼–ç å¤šç§ hash å‡½æ•°çš„ hash ç»“æœã€‚**btmh å¯ä»¥å’Œ btih åŒæ—¶å­˜åœ¨ï¼Œè¿™ä¸ªåº”è¯¥å’Œ [SHA1 è¢«ç ´è§£](https://security.googleblog.com/2017/02/announcing-first-sha1-collision.html)ç›¸å…³â€”â€”æœ‰ btmh ä¸­ä½¿ç”¨å…¶ä»– hash å‡½æ•°å¾—åˆ°çš„ hash å€¼åŠ ä¸ŠåŸæ¥çš„ SHA1 å€¼å°±å¯ä»¥åšåˆ°å…¼å®¹ï¼ŒåŒæ—¶æ£€æµ‹ç¢°æ’ã€‚**\n - **dn**ï¼šè¡¨ç¤ºå»ºè®®æ˜¾ç¤ºçš„æ–‡ä»¶åã€‚\n - **tr**ï¼šè¡¨ç¤º Trackerçš„ URLï¼Œå¦‚æœæœ‰å¤šä¸ª Tracker,åˆ™ä¼šæœ‰å¤šä¸ª `tr` å‚æ•°ã€‚\n - **x.pe**ï¼šè¡¨ç¤º Peer çš„ï¼Œæ ¼å¼ä¸º `hostname:port`ï¼Œ`ipv4-literal:port` æˆ–è€… `[ipv6-literal]:port`ï¼Œè¿™äº› peer å¯ä»¥è¢«æ·»åŠ åˆ° peer åˆ—è¡¨ä¸­ç”¨äºè·å–å…ƒæ•°æ®ä»¥åŠåç»­çš„æ–‡ä»¶ç‰‡æ®µè·å–ã€‚å®é™…ä¸Š Magnet é“¾æ¥ä¸­å®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„å‚æ•° `xt` ç”¨äºæŒ‡å®šç±»ä¼¼ `x.pe` æ‰€è¡¨ç¤ºçš„ p2p è¿æ¥ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰åˆé€‚çš„ URI æ ‡è¯†ç¬¦åˆ†é…ç»™ BTï¼ˆæ¯”å¦‚ç”µé©´æœ‰ ed2kï¼‰ï¼Œæ‰€ä»¥ BT ä½¿ç”¨äº†è¿™ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯ `xt`ã€‚\n - **so**ï¼šå®šä¹‰åœ¨ [BEP53 - Magnet URI extension - Select specific file indices for download](http://www.bittorrent.org/beps/bep_0053.html) ä¸­ï¼Œç”¨äºæŒ‡å®šä¸‹è½½ç‰¹å®šæ–‡ä»¶ï¼Œæ¯”å¦‚ `so=0,2,4,6-8` è¡¨ç¤ºä¸‹è½½ files åˆ—è¡¨ä¸­ç´¢å¼•ä¸º 0,2,4,6,7,8 çš„è¿™å…­ä¸ªæ–‡ä»¶ã€‚\n\næœ‰äº†ç£åŠ›é“¾æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥å‘ peer è¯·æ±‚ Torrent æ–‡ä»¶çš„ info éƒ¨åˆ†äº†ï¼Œè·å–å®Œæˆåå°±ç›¸å½“äºæ‹¥æœ‰äº† Torrent æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æœ‰äº†å®Œæ•´çš„å…ƒæ•°æ®ï¼Œç»§è€Œå¯ä»¥ä¸‹è½½èµ„æºã€‚\n\n\n## å‚è€ƒèµ„æ–™\n1. [Wikipedia - Torrent file](https://en.wikipedia.org/wiki/Torrent_file#Draft_extensions)\n2. [Online Torrent File Decoder](http://marquisdegeek.com/code_bencode.php)\n3. [Online Magnet Link to Torrent File converter](http://magnet2torrent.me/)\n4. [Wikipedia - Magnet URI scheme](https://en.wikipedia.org/wiki/Magnet_URI_scheme)\n5. [Stack Overflow - What is the difference between URI, URL and URN?](https://stackoverflow.com/questions/4913343/what-is-the-difference-between-uri-url-and-urn)\n","slug":"bt-metadata","published":1,"updated":"2020-07-18T06:30:19.513Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuhd0005w80vtrf0gwfs","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>æœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» Tracker æœåŠ¡å™¨çš„å·¥ä½œåŸç†ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡<a href=\"/2018/08/26/bt-overview/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\">BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°</a>ã€‚</p>\n<p>åœ¨ç£åŠ›é“¾æ¥å‡ºç°å‰ï¼ŒBT ä¸‹è½½çš„ç¬¬ä¸€æ­¥å°±æ˜¯è·å– Torrentï¼ˆç§å­ï¼‰æ–‡ä»¶ã€‚ç§å­æ–‡ä»¶ä¸­åŒ…å«äº†èµ„æºçš„æœ€å…³é”®ä¿¡æ¯ â€”â€” Metadataï¼ˆå…ƒæ•°æ®ï¼‰ã€‚Magnetï¼ˆç£åŠ›é“¾æ¥ï¼‰çš„å¼•å…¥åˆ™çœå»äº†è·å–ç§å­æ–‡ä»¶è¿™ä¸€æ­¥ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦å…ƒæ•°æ®ï¼Œåªæ˜¯æ”¹ä¸ºä» peer å¤„è·å–ã€‚æœ‰äº†å…ƒæ•°æ®åï¼Œæ‰èƒ½çŸ¥é“æ•´ä¸ªèµ„æºçš„æ¦‚å†µï¼Œç»§è€Œè¿›è¡Œä¸‹è½½ã€‚</p>\n<h2 id=\"Torrent\"><a href=\"#Torrent\" class=\"headerlink\" title=\"Torrent\"></a>Torrent</h2><h3 id=\"æ–‡ä»¶ç»“æ„\"><a href=\"#æ–‡ä»¶ç»“æ„\" class=\"headerlink\" title=\"æ–‡ä»¶ç»“æ„\"></a>æ–‡ä»¶ç»“æ„</h3><p>ç§å­æ–‡ä»¶ä½¿ç”¨ bencode è¿›è¡Œç¼–ç ï¼Œæ•´ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå­—å…¸ã€‚æœ‰ä¸‹åˆ—ä¸»è¦çš„ keyï¼ˆvalue ä¸­ï¼Œæ•´å‹å€¼çš„å•ä½å‡ä¸ºå­—èŠ‚ï¼Œå­—ç¬¦ä¸²é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç ï¼‰ï¼š</p>\n<ul>\n<li><strong>announce</strong>ï¼šå­—ç¬¦ä¸²ã€‚tracker çš„ URL åœ°å€ï¼Œä»…èƒ½å®šä¹‰ä¸€ä¸ª Trackerã€‚</li>\n<li><strong>info</strong>ï¼šå­—å…¸ã€‚ä¹Ÿå°±æ˜¯èµ„æºçš„å…ƒæ•°æ®ï¼š<ul>\n<li><strong>length</strong>ï¼šæ•´å‹ã€‚å¦‚æœæœ‰è¯¥å­—æ®µï¼Œåˆ™ä»£è¡¨ç§å­ä¸ºå•æ–‡ä»¶ç§å­ï¼Œä»£è¡¨è¯¥æ–‡ä»¶çš„å¤§å°ã€‚</li>\n<li><strong>files</strong>ï¼šåˆ—è¡¨ï¼Œå­é¡¹ç±»å‹ä¸ºå­—å…¸ã€‚å¦‚æœæœ‰è¯¥å­—æ®µï¼Œåˆ™ä»£è¡¨ç§å­ä¸ºå¤šæ–‡ä»¶ç§å­ã€‚ä¸€ä¸ªç§å­åªèƒ½ä¸ºå•æ–‡ä»¶ç§å­æˆ–è€…å¤šæ–‡ä»¶ç§å­ï¼Œå› æ­¤ <strong>files å­—æ®µå’Œä¸Šè¿° length å­—æ®µåªèƒ½é€‰å…¶ä¸­ä¹‹ä¸€</strong>ã€‚files å­—å…¸çš„å­—æ®µåŒ…æ‹¬ï¼š<ul>\n<li><strong>length</strong>ï¼šæ•´å‹ã€‚ä»£è¡¨è¯¥æ–‡ä»¶çš„å¤§å°ã€‚</li>\n<li><strong>path</strong>ï¼šåˆ—è¡¨ï¼Œå­é¡¹ç±»å‹ä¸ºå­—ç¬¦ä¸²ã€‚å­ç›®å½•åç§°åˆ—è¡¨ï¼Œæœ€åä¸€é¡¹ä¸ºæ–‡ä»¶åï¼Œå› æ­¤è¯¥åˆ—è¡¨é•¿åº¦è‡³å°‘éœ€è¦ä¸º 1ã€‚</li>\n</ul>\n</li>\n<li><strong>name</strong>ï¼šå­—ç¬¦ä¸²ã€‚å¦‚æœæ˜¯å•ä¸ªæ–‡ä»¶çš„ç§å­ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—æ®µè¡¨ç¤ºè¯¥æ–‡ä»¶çš„æ–‡ä»¶åï¼Œå¦åˆ™è¡¨ç¤ºå¤šä¸ªæ–‡ä»¶å­˜å‚¨çš„æ ¹ç›®å½•ã€‚</li>\n<li><strong>piece length</strong>ï¼šæ•´å‹ã€‚ä¸ºäº†æ–¹ä¾¿ä¼ è¾“ä¸èŠ‚ç‚¹é—´äº¤æ¢æ•°æ®ï¼Œæ–‡ä»¶è¢«åˆ†ç‰‡ï¼Œè¿™ä¸ªå­—æ®µä»£è¡¨æ¯ä¸ªç‰‡æ®µçš„å¤§å°ï¼Œé™¤äº†æœ€åä¸€ç‰‡å¯èƒ½ä¼šè¢«æˆªæ–­ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬ä¸º 2 çš„å¹‚æ¬¡ã€‚</li>\n<li><strong>pieces</strong>ï¼šè¢«ç¼–ç æˆå­—ç¬¦ä¸²ï¼Œä½†æ˜¯éœ€è¦è¢«è§£ææˆ SHA1 å€¼ã€‚ä»£è¡¨æ‰€æœ‰ç‰‡æ®µçš„ SHA1 å€¼ï¼ˆæ¯ä¸ªå€¼å ç”¨ 160 æ¯”ç‰¹ï¼‰ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä¸¾ä¾‹\"><a href=\"#ä¸¾ä¾‹\" class=\"headerlink\" title=\"ä¸¾ä¾‹\"></a>ä¸¾ä¾‹</h3><h4 id=\"å•æ–‡ä»¶ç§å­\"><a href=\"#å•æ–‡ä»¶ç§å­\" class=\"headerlink\" title=\"å•æ–‡ä»¶ç§å­\"></a>å•æ–‡ä»¶ç§å­</h4><p>è¿™æ˜¯ä¸€ä¸ªå•æ–‡ä»¶ç§å­æ–‡ä»¶çš„ JSON åŒ–ç»“æ„ç¤ºæ„ï¼Œæ–‡ä»¶ debian-503-amd64-CD-1.iso è¢«åˆ†æˆå¤§å°ä¸º 256 KiB çš„ $\\left(\\lceil\\frac{length}{piece length}\\rceil = 2588\\right)$ ç‰‡ã€‚</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"announce\"</span>: <span class=\"string\">\"http://bttracker.debian.org:6969/announce\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"info\"</span>:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"debian-503-amd64-CD-1.iso\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"piece length\"</span>: <span class=\"number\">262144</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"length\"</span>: <span class=\"number\">678301696</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"pieces\"</span>: &lt;binary SHA1 hashes&gt;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"å¤šæ–‡ä»¶ç§å­\"><a href=\"#å¤šæ–‡ä»¶ç§å­\" class=\"headerlink\" title=\"å¤šæ–‡ä»¶ç§å­\"></a>å¤šæ–‡ä»¶ç§å­</h4><p>è¿™ä¸ªä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ–‡ä»¶çš„ç§å­çš„ç¤ºä¾‹ã€‚ç›¸å¯¹äºå•æ–‡ä»¶ç§å­ï¼Œå®ƒä½¿ç”¨äº† files å­—æ®µå–ä»£äº† length å­—æ®µã€‚</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"announce\"</span>: <span class=\"string\">\"http://tracker.site1.com/announce\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"info\"</span>:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"directoryName\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"piece length\"</span>: <span class=\"number\">262144</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"files\"</span>:</span><br><span class=\"line\">        [</span><br><span class=\"line\">            &#123;<span class=\"attr\">\"path\"</span>: [<span class=\"string\">\"111.txt\"</span>], <span class=\"attr\">\"length\"</span>: <span class=\"number\">111</span>&#125;,</span><br><span class=\"line\">            &#123;<span class=\"attr\">\"path\"</span>: [<span class=\"string\">\"222.txt\"</span>], <span class=\"attr\">\"length\"</span>: <span class=\"number\">222</span>&#125;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"attr\">\"pieces\"</span>: &lt;binary SHA1 hashes&gt;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Magnet\"><a href=\"#Magnet\" class=\"headerlink\" title=\"Magnet\"></a>Magnet</h2><h3 id=\"MAGNET-URI-Project\"><a href=\"#MAGNET-URI-Project\" class=\"headerlink\" title=\"MAGNET-URI Project\"></a>MAGNET-URI Project</h3><p>æåˆ° Magnetï¼ˆç£åŠ›é“¾æ¥ï¼‰å¤§å®¶éƒ½ä¼šæƒ³åˆ° BTï¼Œä½†æ˜¯ç£åŠ›é“¾æ¥ä¸æ˜¯å› ä¸º BT è€Œè¯ç”Ÿçš„ï¼Œä¹Ÿä¸æ­¢ç”¨äº BTï¼Œäº‹å®ä¸Šç£åŠ›é“¾æ¥çš„æ¥è‡ª <a href=\"http://magnet-uri.sourceforge.net/\" target=\"_blank\" rel=\"noopener\">MAGNET-URI Project</a> è¿™ä¸ªé¡¹ç›®ï¼š</p>\n<blockquote><p>MAGNET is a work-in-progress URI specification, and collection of standard practices/implementing code to allow a website to seamlessly integrate with features made available by local utility programs. In one way, it could be thought of as a vendor- and project-neutral generalization of the â€œfreenet:â€ and â€œed2k:â€ URI-schemes used by the Freenet and EDonkey2000 peer-to-peer networks, respectively.</p>\n<footer><strong>Gordon Mohr</strong><cite><a href=\"http://magnet-uri.sourceforge.net/magnet-draft-overview.txt\" target=\"_blank\" rel=\"noopener\">magnet-uri.sourceforge.net/magnet-draft-overview.txt</a></cite></footer></blockquote>\n\n<p>ç£åŠ›é“¾æ¥æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒï¼Œå®ƒå¸Œæœ›è¿™ç§ p2p çš„é“¾æ¥éƒ½å¯ä»¥ä»¥æŒ‰ç…§è¿™ä¸ªè§„èŒƒå±•ç¤ºï¼Œè¿™æ ·çš„è¯å½“ç”¨æˆ·åœ¨ç½‘é¡µä¸Šç‚¹å‡»ç£åŠ›é“¾æ¥çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç£åŠ›é“¾æ¥çš„å‚æ•°ï¼ˆ<code>xt</code>ï¼Œä¸‹æ–‡ä¼šæåŠï¼‰â€œå¬å”¤â€åˆé€‚çš„å®¢æˆ·ç«¯ã€‚å®ƒå…ˆè¢« eDonkeyï¼ˆç”µé©´ï¼‰æ¨åŠ¨ï¼Œç”µé©´é“¾æ¥ç†è®ºä¸Šå¯ä»¥è¢«è½¬æ¢æˆç£åŠ›é“¾æ¥ã€‚è½¬æ¢è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ed2k://|file|&lt;name&gt;|&lt;file-size&gt;|&lt;ed2k-hash&gt;|/</span><br><span class=\"line\">magnet:?xt=urn:ed2k:&lt;ed2k-hash&gt;&amp;xl=&lt;file-size&gt;&amp;dn=&lt;name&gt;</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶è€Œï¼Œè¿™ä¸ª MAGNET-URI Project åæ¥åº”è¯¥æ²¡æœ‰è¢«æ¨åŠ¨ä¸‹å»ï¼Œå¯¼è‡´ç”šè‡³è¿ç”µé©´è‡ªå·±çš„å®¢æˆ·ç«¯éƒ½æ²¡æœ‰æ”¯æŒ ed2k çš„ magnet æ ¼å¼ã€‚ç›´åˆ°åæ¥åœ¨ BT ä¸­å¤§æ”¾å¼‚å½©ï¼Œå¯¼è‡´ç°åœ¨ç‹­ä¹‰ä¸Šçš„ç£åŠ›é“¾æ¥å°±æ˜¯æŒ‡ BT ä¸­ä½¿ç”¨çš„ç£åŠ›é“¾æ¥ã€‚</p>\n<h3 id=\"BT-ä¸­çš„ç£åŠ›é“¾æ¥\"><a href=\"#BT-ä¸­çš„ç£åŠ›é“¾æ¥\" class=\"headerlink\" title=\"BT ä¸­çš„ç£åŠ›é“¾æ¥\"></a>BT ä¸­çš„ç£åŠ›é“¾æ¥</h3><p>BT ä¸­çš„ç£åŠ›é“¾æ¥å¤§æ¦‚æœ‰è¿™ä¸¤ç§æ ¼å¼ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v1: magnet:?xt=urn:btih:&lt;info-hash&gt;&amp;dn=&lt;name&gt;&amp;tr=&lt;tracker-url&gt;&amp;x.pe=&lt;peer-address&gt;</span><br><span class=\"line\">v2: magnet:?xt=urn:btmh:&lt;tagged-info-hash&gt;&amp;dn=&lt;name&gt;&amp;tr=&lt;tracker-url&gt;&amp;x.pe=&lt;peer-address&gt;</span><br></pre></td></tr></table></figure>\n\n<p>æ ¹æ® <a href=\"https://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E5%AE%9A%E4%BD%8D%E7%AC%A6\" target=\"_blank\" rel=\"noopener\">URL çš„å®šä¹‰</a>ï¼Œ<code>magnet</code> å‰ç¼€è¡¨ç¤ºè¿™ä¸ªé“¾æ¥æ˜¯ç£åŠ›é“¾æ¥ï¼Œ<code>ï¼Ÿ</code> åè¡¨ç¤ºä¸º GET æ¨¡å¼æŸ¥è¯¢å‚æ•°åˆ—è¡¨ï¼Œå‚æ•°ä½¿ç”¨ <code>&amp;</code> ç¬¦å·éš”å¼€ã€‚BT ç£åŠ›é“¾æ¥çš„å‚æ•°å¦‚ä¸‹:</p>\n<ul>\n<li><strong>xt</strong>ï¼šè¡¨ç¤ºåŒ…å«æ–‡ä»¶æ•£åˆ—å‡½æ•°å€¼çš„ URNï¼Œè¿™æ˜¯å”¯ä¸€ä¸€ä¸ªå¿…é€‰å‚æ•°ï¼Œå¯èƒ½çš„ URN ç±»å‹æœ‰ï¼š<ul>\n<li><strong>btih</strong>ï¼šè¡¨ç¤º Torrent æ–‡ä»¶ info éƒ¨åˆ†çš„ SHA1 å€¼ï¼Œå¯ä»¥æ˜¯ Hex ç¼–ç æˆ–è€… Base32 ç¼–ç å½¢å¼ã€‚</li>\n<li><strong>btmh</strong>ï¼šè¡¨ç¤º Torrent æ–‡ä»¶ info éƒ¨åˆ†çš„ HEX ç¼–ç  <a href=\"https://github.com/multiformats/multihash\" target=\"_blank\" rel=\"noopener\">multihash</a> å€¼ï¼Œmultihash æ˜¯ç”±åˆ›é€  IPFS  çš„ Protocal Lab çš„é¡¹ç›®ï¼Œç”¨äºç¼–ç å¤šç§ hash å‡½æ•°çš„ hash ç»“æœã€‚<strong>btmh å¯ä»¥å’Œ btih åŒæ—¶å­˜åœ¨ï¼Œè¿™ä¸ªåº”è¯¥å’Œ <a href=\"https://security.googleblog.com/2017/02/announcing-first-sha1-collision.html\" target=\"_blank\" rel=\"noopener\">SHA1 è¢«ç ´è§£</a>ç›¸å…³â€”â€”æœ‰ btmh ä¸­ä½¿ç”¨å…¶ä»– hash å‡½æ•°å¾—åˆ°çš„ hash å€¼åŠ ä¸ŠåŸæ¥çš„ SHA1 å€¼å°±å¯ä»¥åšåˆ°å…¼å®¹ï¼ŒåŒæ—¶æ£€æµ‹ç¢°æ’ã€‚</strong></li>\n</ul>\n</li>\n<li><strong>dn</strong>ï¼šè¡¨ç¤ºå»ºè®®æ˜¾ç¤ºçš„æ–‡ä»¶åã€‚</li>\n<li><strong>tr</strong>ï¼šè¡¨ç¤º Trackerçš„ URLï¼Œå¦‚æœæœ‰å¤šä¸ª Tracker,åˆ™ä¼šæœ‰å¤šä¸ª <code>tr</code> å‚æ•°ã€‚</li>\n<li><strong>x.pe</strong>ï¼šè¡¨ç¤º Peer çš„ï¼Œæ ¼å¼ä¸º <code>hostname:port</code>ï¼Œ<code>ipv4-literal:port</code> æˆ–è€… <code>[ipv6-literal]:port</code>ï¼Œè¿™äº› peer å¯ä»¥è¢«æ·»åŠ åˆ° peer åˆ—è¡¨ä¸­ç”¨äºè·å–å…ƒæ•°æ®ä»¥åŠåç»­çš„æ–‡ä»¶ç‰‡æ®µè·å–ã€‚å®é™…ä¸Š Magnet é“¾æ¥ä¸­å®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„å‚æ•° <code>xt</code> ç”¨äºæŒ‡å®šç±»ä¼¼ <code>x.pe</code> æ‰€è¡¨ç¤ºçš„ p2p è¿æ¥ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰åˆé€‚çš„ URI æ ‡è¯†ç¬¦åˆ†é…ç»™ BTï¼ˆæ¯”å¦‚ç”µé©´æœ‰ ed2kï¼‰ï¼Œæ‰€ä»¥ BT ä½¿ç”¨äº†è¿™ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯ <code>xt</code>ã€‚</li>\n<li><strong>so</strong>ï¼šå®šä¹‰åœ¨ <a href=\"http://www.bittorrent.org/beps/bep_0053.html\" target=\"_blank\" rel=\"noopener\">BEP53 - Magnet URI extension - Select specific file indices for download</a> ä¸­ï¼Œç”¨äºæŒ‡å®šä¸‹è½½ç‰¹å®šæ–‡ä»¶ï¼Œæ¯”å¦‚ <code>so=0,2,4,6-8</code> è¡¨ç¤ºä¸‹è½½ files åˆ—è¡¨ä¸­ç´¢å¼•ä¸º 0,2,4,6,7,8 çš„è¿™å…­ä¸ªæ–‡ä»¶ã€‚</li>\n</ul>\n<p>æœ‰äº†ç£åŠ›é“¾æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥å‘ peer è¯·æ±‚ Torrent æ–‡ä»¶çš„ info éƒ¨åˆ†äº†ï¼Œè·å–å®Œæˆåå°±ç›¸å½“äºæ‹¥æœ‰äº† Torrent æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æœ‰äº†å®Œæ•´çš„å…ƒæ•°æ®ï¼Œç»§è€Œå¯ä»¥ä¸‹è½½èµ„æºã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://en.wikipedia.org/wiki/Torrent_file#Draft_extensions\" target=\"_blank\" rel=\"noopener\">Wikipedia - Torrent file</a></li>\n<li><a href=\"http://marquisdegeek.com/code_bencode.php\" target=\"_blank\" rel=\"noopener\">Online Torrent File Decoder</a></li>\n<li><a href=\"http://magnet2torrent.me/\" target=\"_blank\" rel=\"noopener\">Online Magnet Link to Torrent File converter</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Magnet_URI_scheme\" target=\"_blank\" rel=\"noopener\">Wikipedia - Magnet URI scheme</a></li>\n<li><a href=\"https://stackoverflow.com/questions/4913343/what-is-the-difference-between-uri-url-and-urn\" target=\"_blank\" rel=\"noopener\">Stack Overflow - What is the difference between URI, URL and URN?</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p>æœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» Tracker æœåŠ¡å™¨çš„å·¥ä½œåŸç†ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡<a href=\"/2018/08/26/bt-overview/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\">BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°</a>ã€‚</p>\n<p>åœ¨ç£åŠ›é“¾æ¥å‡ºç°å‰ï¼ŒBT ä¸‹è½½çš„ç¬¬ä¸€æ­¥å°±æ˜¯è·å– Torrentï¼ˆç§å­ï¼‰æ–‡ä»¶ã€‚ç§å­æ–‡ä»¶ä¸­åŒ…å«äº†èµ„æºçš„æœ€å…³é”®ä¿¡æ¯ â€”â€” Metadataï¼ˆå…ƒæ•°æ®ï¼‰ã€‚Magnetï¼ˆç£åŠ›é“¾æ¥ï¼‰çš„å¼•å…¥åˆ™çœå»äº†è·å–ç§å­æ–‡ä»¶è¿™ä¸€æ­¥ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦å…ƒæ•°æ®ï¼Œåªæ˜¯æ”¹ä¸ºä» peer å¤„è·å–ã€‚æœ‰äº†å…ƒæ•°æ®åï¼Œæ‰èƒ½çŸ¥é“æ•´ä¸ªèµ„æºçš„æ¦‚å†µï¼Œç»§è€Œè¿›è¡Œä¸‹è½½ã€‚</p>\n<h2 id=\"Torrent\"><a href=\"#Torrent\" class=\"headerlink\" title=\"Torrent\"></a>Torrent</h2><h3 id=\"æ–‡ä»¶ç»“æ„\"><a href=\"#æ–‡ä»¶ç»“æ„\" class=\"headerlink\" title=\"æ–‡ä»¶ç»“æ„\"></a>æ–‡ä»¶ç»“æ„</h3><p>ç§å­æ–‡ä»¶ä½¿ç”¨ bencode è¿›è¡Œç¼–ç ï¼Œæ•´ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå­—å…¸ã€‚æœ‰ä¸‹åˆ—ä¸»è¦çš„ keyï¼ˆvalue ä¸­ï¼Œæ•´å‹å€¼çš„å•ä½å‡ä¸ºå­—èŠ‚ï¼Œå­—ç¬¦ä¸²é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç ï¼‰ï¼š</p>\n<ul>\n<li><strong>announce</strong>ï¼šå­—ç¬¦ä¸²ã€‚tracker çš„ URL åœ°å€ï¼Œä»…èƒ½å®šä¹‰ä¸€ä¸ª Trackerã€‚</li>\n<li><strong>info</strong>ï¼šå­—å…¸ã€‚ä¹Ÿå°±æ˜¯èµ„æºçš„å…ƒæ•°æ®ï¼š<ul>\n<li><strong>length</strong>ï¼šæ•´å‹ã€‚å¦‚æœæœ‰è¯¥å­—æ®µï¼Œåˆ™ä»£è¡¨ç§å­ä¸ºå•æ–‡ä»¶ç§å­ï¼Œä»£è¡¨è¯¥æ–‡ä»¶çš„å¤§å°ã€‚</li>\n<li><strong>files</strong>ï¼šåˆ—è¡¨ï¼Œå­é¡¹ç±»å‹ä¸ºå­—å…¸ã€‚å¦‚æœæœ‰è¯¥å­—æ®µï¼Œåˆ™ä»£è¡¨ç§å­ä¸ºå¤šæ–‡ä»¶ç§å­ã€‚ä¸€ä¸ªç§å­åªèƒ½ä¸ºå•æ–‡ä»¶ç§å­æˆ–è€…å¤šæ–‡ä»¶ç§å­ï¼Œå› æ­¤ <strong>files å­—æ®µå’Œä¸Šè¿° length å­—æ®µåªèƒ½é€‰å…¶ä¸­ä¹‹ä¸€</strong>ã€‚files å­—å…¸çš„å­—æ®µåŒ…æ‹¬ï¼š<ul>\n<li><strong>length</strong>ï¼šæ•´å‹ã€‚ä»£è¡¨è¯¥æ–‡ä»¶çš„å¤§å°ã€‚</li>\n<li><strong>path</strong>ï¼šåˆ—è¡¨ï¼Œå­é¡¹ç±»å‹ä¸ºå­—ç¬¦ä¸²ã€‚å­ç›®å½•åç§°åˆ—è¡¨ï¼Œæœ€åä¸€é¡¹ä¸ºæ–‡ä»¶åï¼Œå› æ­¤è¯¥åˆ—è¡¨é•¿åº¦è‡³å°‘éœ€è¦ä¸º 1ã€‚</li>\n</ul>\n</li>\n<li><strong>name</strong>ï¼šå­—ç¬¦ä¸²ã€‚å¦‚æœæ˜¯å•ä¸ªæ–‡ä»¶çš„ç§å­ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—æ®µè¡¨ç¤ºè¯¥æ–‡ä»¶çš„æ–‡ä»¶åï¼Œå¦åˆ™è¡¨ç¤ºå¤šä¸ªæ–‡ä»¶å­˜å‚¨çš„æ ¹ç›®å½•ã€‚</li>\n<li><strong>piece length</strong>ï¼šæ•´å‹ã€‚ä¸ºäº†æ–¹ä¾¿ä¼ è¾“ä¸èŠ‚ç‚¹é—´äº¤æ¢æ•°æ®ï¼Œæ–‡ä»¶è¢«åˆ†ç‰‡ï¼Œè¿™ä¸ªå­—æ®µä»£è¡¨æ¯ä¸ªç‰‡æ®µçš„å¤§å°ï¼Œé™¤äº†æœ€åä¸€ç‰‡å¯èƒ½ä¼šè¢«æˆªæ–­ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬ä¸º 2 çš„å¹‚æ¬¡ã€‚</li>\n<li><strong>pieces</strong>ï¼šè¢«ç¼–ç æˆå­—ç¬¦ä¸²ï¼Œä½†æ˜¯éœ€è¦è¢«è§£ææˆ SHA1 å€¼ã€‚ä»£è¡¨æ‰€æœ‰ç‰‡æ®µçš„ SHA1 å€¼ï¼ˆæ¯ä¸ªå€¼å ç”¨ 160 æ¯”ç‰¹ï¼‰ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"ä¸¾ä¾‹\"><a href=\"#ä¸¾ä¾‹\" class=\"headerlink\" title=\"ä¸¾ä¾‹\"></a>ä¸¾ä¾‹</h3><h4 id=\"å•æ–‡ä»¶ç§å­\"><a href=\"#å•æ–‡ä»¶ç§å­\" class=\"headerlink\" title=\"å•æ–‡ä»¶ç§å­\"></a>å•æ–‡ä»¶ç§å­</h4><p>è¿™æ˜¯ä¸€ä¸ªå•æ–‡ä»¶ç§å­æ–‡ä»¶çš„ JSON åŒ–ç»“æ„ç¤ºæ„ï¼Œæ–‡ä»¶ debian-503-amd64-CD-1.iso è¢«åˆ†æˆå¤§å°ä¸º 256 KiB çš„ $\\left(\\lceil\\frac{length}{piece length}\\rceil = 2588\\right)$ ç‰‡ã€‚</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"announce\"</span>: <span class=\"string\">\"http://bttracker.debian.org:6969/announce\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"info\"</span>:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"debian-503-amd64-CD-1.iso\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"piece length\"</span>: <span class=\"number\">262144</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"length\"</span>: <span class=\"number\">678301696</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"pieces\"</span>: &lt;binary SHA1 hashes&gt;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"å¤šæ–‡ä»¶ç§å­\"><a href=\"#å¤šæ–‡ä»¶ç§å­\" class=\"headerlink\" title=\"å¤šæ–‡ä»¶ç§å­\"></a>å¤šæ–‡ä»¶ç§å­</h4><p>è¿™ä¸ªä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ–‡ä»¶çš„ç§å­çš„ç¤ºä¾‹ã€‚ç›¸å¯¹äºå•æ–‡ä»¶ç§å­ï¼Œå®ƒä½¿ç”¨äº† files å­—æ®µå–ä»£äº† length å­—æ®µã€‚</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"attr\">\"announce\"</span>: <span class=\"string\">\"http://tracker.site1.com/announce\"</span>,</span><br><span class=\"line\">    <span class=\"attr\">\"info\"</span>:</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"attr\">\"name\"</span>: <span class=\"string\">\"directoryName\"</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"piece length\"</span>: <span class=\"number\">262144</span>,</span><br><span class=\"line\">        <span class=\"attr\">\"files\"</span>:</span><br><span class=\"line\">        [</span><br><span class=\"line\">            &#123;<span class=\"attr\">\"path\"</span>: [<span class=\"string\">\"111.txt\"</span>], <span class=\"attr\">\"length\"</span>: <span class=\"number\">111</span>&#125;,</span><br><span class=\"line\">            &#123;<span class=\"attr\">\"path\"</span>: [<span class=\"string\">\"222.txt\"</span>], <span class=\"attr\">\"length\"</span>: <span class=\"number\">222</span>&#125;</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"attr\">\"pieces\"</span>: &lt;binary SHA1 hashes&gt;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Magnet\"><a href=\"#Magnet\" class=\"headerlink\" title=\"Magnet\"></a>Magnet</h2><h3 id=\"MAGNET-URI-Project\"><a href=\"#MAGNET-URI-Project\" class=\"headerlink\" title=\"MAGNET-URI Project\"></a>MAGNET-URI Project</h3><p>æåˆ° Magnetï¼ˆç£åŠ›é“¾æ¥ï¼‰å¤§å®¶éƒ½ä¼šæƒ³åˆ° BTï¼Œä½†æ˜¯ç£åŠ›é“¾æ¥ä¸æ˜¯å› ä¸º BT è€Œè¯ç”Ÿçš„ï¼Œä¹Ÿä¸æ­¢ç”¨äº BTï¼Œäº‹å®ä¸Šç£åŠ›é“¾æ¥çš„æ¥è‡ª <a href=\"http://magnet-uri.sourceforge.net/\" target=\"_blank\" rel=\"noopener\">MAGNET-URI Project</a> è¿™ä¸ªé¡¹ç›®ï¼š</p>\n<blockquote><p>MAGNET is a work-in-progress URI specification, and collection of standard practices/implementing code to allow a website to seamlessly integrate with features made available by local utility programs. In one way, it could be thought of as a vendor- and project-neutral generalization of the â€œfreenet:â€ and â€œed2k:â€ URI-schemes used by the Freenet and EDonkey2000 peer-to-peer networks, respectively.</p>\n<footer><strong>Gordon Mohr</strong><cite><a href=\"http://magnet-uri.sourceforge.net/magnet-draft-overview.txt\" target=\"_blank\" rel=\"noopener\">magnet-uri.sourceforge.net/magnet-draft-overview.txt</a></cite></footer></blockquote>\n\n<p>ç£åŠ›é“¾æ¥æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„è§„èŒƒï¼Œå®ƒå¸Œæœ›è¿™ç§ p2p çš„é“¾æ¥éƒ½å¯ä»¥ä»¥æŒ‰ç…§è¿™ä¸ªè§„èŒƒå±•ç¤ºï¼Œè¿™æ ·çš„è¯å½“ç”¨æˆ·åœ¨ç½‘é¡µä¸Šç‚¹å‡»ç£åŠ›é“¾æ¥çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç£åŠ›é“¾æ¥çš„å‚æ•°ï¼ˆ<code>xt</code>ï¼Œä¸‹æ–‡ä¼šæåŠï¼‰â€œå¬å”¤â€åˆé€‚çš„å®¢æˆ·ç«¯ã€‚å®ƒå…ˆè¢« eDonkeyï¼ˆç”µé©´ï¼‰æ¨åŠ¨ï¼Œç”µé©´é“¾æ¥ç†è®ºä¸Šå¯ä»¥è¢«è½¬æ¢æˆç£åŠ›é“¾æ¥ã€‚è½¬æ¢è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ed2k://|file|&lt;name&gt;|&lt;file-size&gt;|&lt;ed2k-hash&gt;|/</span><br><span class=\"line\">magnet:?xt=urn:ed2k:&lt;ed2k-hash&gt;&amp;xl=&lt;file-size&gt;&amp;dn=&lt;name&gt;</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶è€Œï¼Œè¿™ä¸ª MAGNET-URI Project åæ¥åº”è¯¥æ²¡æœ‰è¢«æ¨åŠ¨ä¸‹å»ï¼Œå¯¼è‡´ç”šè‡³è¿ç”µé©´è‡ªå·±çš„å®¢æˆ·ç«¯éƒ½æ²¡æœ‰æ”¯æŒ ed2k çš„ magnet æ ¼å¼ã€‚ç›´åˆ°åæ¥åœ¨ BT ä¸­å¤§æ”¾å¼‚å½©ï¼Œå¯¼è‡´ç°åœ¨ç‹­ä¹‰ä¸Šçš„ç£åŠ›é“¾æ¥å°±æ˜¯æŒ‡ BT ä¸­ä½¿ç”¨çš„ç£åŠ›é“¾æ¥ã€‚</p>\n<h3 id=\"BT-ä¸­çš„ç£åŠ›é“¾æ¥\"><a href=\"#BT-ä¸­çš„ç£åŠ›é“¾æ¥\" class=\"headerlink\" title=\"BT ä¸­çš„ç£åŠ›é“¾æ¥\"></a>BT ä¸­çš„ç£åŠ›é“¾æ¥</h3><p>BT ä¸­çš„ç£åŠ›é“¾æ¥å¤§æ¦‚æœ‰è¿™ä¸¤ç§æ ¼å¼ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">v1: magnet:?xt=urn:btih:&lt;info-hash&gt;&amp;dn=&lt;name&gt;&amp;tr=&lt;tracker-url&gt;&amp;x.pe=&lt;peer-address&gt;</span><br><span class=\"line\">v2: magnet:?xt=urn:btmh:&lt;tagged-info-hash&gt;&amp;dn=&lt;name&gt;&amp;tr=&lt;tracker-url&gt;&amp;x.pe=&lt;peer-address&gt;</span><br></pre></td></tr></table></figure>\n\n<p>æ ¹æ® <a href=\"https://zh.wikipedia.org/wiki/%E7%BB%9F%E4%B8%80%E8%B5%84%E6%BA%90%E5%AE%9A%E4%BD%8D%E7%AC%A6\" target=\"_blank\" rel=\"noopener\">URL çš„å®šä¹‰</a>ï¼Œ<code>magnet</code> å‰ç¼€è¡¨ç¤ºè¿™ä¸ªé“¾æ¥æ˜¯ç£åŠ›é“¾æ¥ï¼Œ<code>ï¼Ÿ</code> åè¡¨ç¤ºä¸º GET æ¨¡å¼æŸ¥è¯¢å‚æ•°åˆ—è¡¨ï¼Œå‚æ•°ä½¿ç”¨ <code>&amp;</code> ç¬¦å·éš”å¼€ã€‚BT ç£åŠ›é“¾æ¥çš„å‚æ•°å¦‚ä¸‹:</p>\n<ul>\n<li><strong>xt</strong>ï¼šè¡¨ç¤ºåŒ…å«æ–‡ä»¶æ•£åˆ—å‡½æ•°å€¼çš„ URNï¼Œè¿™æ˜¯å”¯ä¸€ä¸€ä¸ªå¿…é€‰å‚æ•°ï¼Œå¯èƒ½çš„ URN ç±»å‹æœ‰ï¼š<ul>\n<li><strong>btih</strong>ï¼šè¡¨ç¤º Torrent æ–‡ä»¶ info éƒ¨åˆ†çš„ SHA1 å€¼ï¼Œå¯ä»¥æ˜¯ Hex ç¼–ç æˆ–è€… Base32 ç¼–ç å½¢å¼ã€‚</li>\n<li><strong>btmh</strong>ï¼šè¡¨ç¤º Torrent æ–‡ä»¶ info éƒ¨åˆ†çš„ HEX ç¼–ç  <a href=\"https://github.com/multiformats/multihash\" target=\"_blank\" rel=\"noopener\">multihash</a> å€¼ï¼Œmultihash æ˜¯ç”±åˆ›é€  IPFS  çš„ Protocal Lab çš„é¡¹ç›®ï¼Œç”¨äºç¼–ç å¤šç§ hash å‡½æ•°çš„ hash ç»“æœã€‚<strong>btmh å¯ä»¥å’Œ btih åŒæ—¶å­˜åœ¨ï¼Œè¿™ä¸ªåº”è¯¥å’Œ <a href=\"https://security.googleblog.com/2017/02/announcing-first-sha1-collision.html\" target=\"_blank\" rel=\"noopener\">SHA1 è¢«ç ´è§£</a>ç›¸å…³â€”â€”æœ‰ btmh ä¸­ä½¿ç”¨å…¶ä»– hash å‡½æ•°å¾—åˆ°çš„ hash å€¼åŠ ä¸ŠåŸæ¥çš„ SHA1 å€¼å°±å¯ä»¥åšåˆ°å…¼å®¹ï¼ŒåŒæ—¶æ£€æµ‹ç¢°æ’ã€‚</strong></li>\n</ul>\n</li>\n<li><strong>dn</strong>ï¼šè¡¨ç¤ºå»ºè®®æ˜¾ç¤ºçš„æ–‡ä»¶åã€‚</li>\n<li><strong>tr</strong>ï¼šè¡¨ç¤º Trackerçš„ URLï¼Œå¦‚æœæœ‰å¤šä¸ª Tracker,åˆ™ä¼šæœ‰å¤šä¸ª <code>tr</code> å‚æ•°ã€‚</li>\n<li><strong>x.pe</strong>ï¼šè¡¨ç¤º Peer çš„ï¼Œæ ¼å¼ä¸º <code>hostname:port</code>ï¼Œ<code>ipv4-literal:port</code> æˆ–è€… <code>[ipv6-literal]:port</code>ï¼Œè¿™äº› peer å¯ä»¥è¢«æ·»åŠ åˆ° peer åˆ—è¡¨ä¸­ç”¨äºè·å–å…ƒæ•°æ®ä»¥åŠåç»­çš„æ–‡ä»¶ç‰‡æ®µè·å–ã€‚å®é™…ä¸Š Magnet é“¾æ¥ä¸­å®šä¹‰äº†ä¸€ä¸ªé€šç”¨çš„å‚æ•° <code>xt</code> ç”¨äºæŒ‡å®šç±»ä¼¼ <code>x.pe</code> æ‰€è¡¨ç¤ºçš„ p2p è¿æ¥ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰åˆé€‚çš„ URI æ ‡è¯†ç¬¦åˆ†é…ç»™ BTï¼ˆæ¯”å¦‚ç”µé©´æœ‰ ed2kï¼‰ï¼Œæ‰€ä»¥ BT ä½¿ç”¨äº†è¿™ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯ <code>xt</code>ã€‚</li>\n<li><strong>so</strong>ï¼šå®šä¹‰åœ¨ <a href=\"http://www.bittorrent.org/beps/bep_0053.html\" target=\"_blank\" rel=\"noopener\">BEP53 - Magnet URI extension - Select specific file indices for download</a> ä¸­ï¼Œç”¨äºæŒ‡å®šä¸‹è½½ç‰¹å®šæ–‡ä»¶ï¼Œæ¯”å¦‚ <code>so=0,2,4,6-8</code> è¡¨ç¤ºä¸‹è½½ files åˆ—è¡¨ä¸­ç´¢å¼•ä¸º 0,2,4,6,7,8 çš„è¿™å…­ä¸ªæ–‡ä»¶ã€‚</li>\n</ul>\n<p>æœ‰äº†ç£åŠ›é“¾æ¥ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥å‘ peer è¯·æ±‚ Torrent æ–‡ä»¶çš„ info éƒ¨åˆ†äº†ï¼Œè·å–å®Œæˆåå°±ç›¸å½“äºæ‹¥æœ‰äº† Torrent æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯æœ‰äº†å®Œæ•´çš„å…ƒæ•°æ®ï¼Œç»§è€Œå¯ä»¥ä¸‹è½½èµ„æºã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://en.wikipedia.org/wiki/Torrent_file#Draft_extensions\" target=\"_blank\" rel=\"noopener\">Wikipedia - Torrent file</a></li>\n<li><a href=\"http://marquisdegeek.com/code_bencode.php\" target=\"_blank\" rel=\"noopener\">Online Torrent File Decoder</a></li>\n<li><a href=\"http://magnet2torrent.me/\" target=\"_blank\" rel=\"noopener\">Online Magnet Link to Torrent File converter</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Magnet_URI_scheme\" target=\"_blank\" rel=\"noopener\">Wikipedia - Magnet URI scheme</a></li>\n<li><a href=\"https://stackoverflow.com/questions/4913343/what-is-the-difference-between-uri-url-and-urn\" target=\"_blank\" rel=\"noopener\">Stack Overflow - What is the difference between URI, URL and URN?</a></li>\n</ol>\n"},{"title":"BT å¢å¼ºå»ºè®®ä¹‹ Peer","date":"2018-08-30T11:14:00.000Z","_content":"\næœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» Peer ä»¥åŠ Peer é—´çš„é€šä¿¡ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡ {% post_link bt-overview %}ã€‚\n\n## Peer æ¥æº\nåœ¨è®² Peer é—´çš„é€šä¿¡å‰ï¼Œå…ˆæ€»ç»“ä¸€ä¸‹ Peer çš„æ¥æºã€‚\n1. **Magnet**ï¼šç£åŠ›è¿æ¥ä¸­æœ‰ **x.pe** å‚æ•°å¯ä»¥é¢„è®¾ä¸€äº› Peerï¼›\n2. **Tracker**ï¼šTracker æœåŠ¡å™¨çš„ä½œç”¨å°±æ˜¯æä¾› Peerï¼›\n4. **Local Service Discovery**ï¼ˆ[BEP14](http://bittorrent.org/beps/bep_0014.html)ï¼‰:é€šè¿‡å¯¹æœ¬åœ°ç»„æ’­åœ°å€ `239.192.152.143:6771` å’Œ `[ff15::efc0:988f]:6771` å‘å‡º info_hash å®£å‘Šæ¥å°è¯•è·å¾—å“åº”ï¼Œå¦‚æœæœ‰å“åº”ï¼Œåˆ™æ·»åŠ ä¸º Peerï¼›\n5. **Peer Exchange**ï¼šé€šè¿‡ Peer é—´çš„ **Peer Exchange** æ‰©å±•æ¶ˆæ¯æ¥ä¸å…¶ä»– Peer äº¤æ¢ Peerï¼Œåé¢ä¼šè¯¦ç»†æåˆ°ï¼›\n3. **DHT**ï¼šé€šè¿‡ DHT ç½‘ç»œè·å–ï¼›\n\n## åè®®æ¦‚è¿°\nPeer é—´çš„é€šä¿¡å±äºåº”ç”¨å±‚åè®®ï¼Œå®ƒä½¿ç”¨çš„åº”ç”¨å±‚åè®®å¯ä»¥æ˜¯ TCP æˆ–è€… ÂµTPã€‚\n\nPeer é—´æŒ‰ç…§å…ƒæ•°æ®ä¸­æè¿°çš„æ–‡ä»¶ç‰‡æ®µç´¢å¼•ï¼ˆèµ·å§‹ç´¢å¼•ä¸º 0ï¼‰è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œå½“ä¸€ä¸ª peer ä¸‹è½½å®Œæˆä¸€ä¸ªåˆ†ç‰‡è€Œä¸”ç»è¿‡äº†é€šè¿‡äº† hash å€¼çš„æ ¡éªŒï¼Œå®ƒä¼šé€šçŸ¥å®ƒçš„æ‰€æœ‰ peer è‡ªå·±æ‹¥æœ‰äº†è¿™ä¸ªç‰‡æ®µã€‚\n\nPeer è¿æ¥çš„ Peer ä¼šæœ‰ä¸€å®šä¸Šé™æ•°é‡ï¼Œæ‰€æœ‰çš„ Peer æŒ‰ç…§ [BEP40 - Canonical Peer Priority](http://bittorrent.org/beps/bep_0040.html) ä¸­å®šä¹‰çš„åŸºäºåŒæ–¹ IP çš„ crc32-c å€¼çš„ç®—æ³•è¿›è¡Œæ’åºï¼Œé€‰æ‹©è¿™ä¸ªå€¼æ›´å°çš„è‹¥å¹² Peer è¿›è¡Œè¿æ¥ã€‚\n\næ¯ä¸ªè¿æ¥ä¼šåŒ…å«ä¸¤ä¸ªçŠ¶æ€ä½ï¼Œchoked or notï¼ˆè¡¨ç¤ºæ˜¯å¦å¯¹å¯¹æ–¹ chokedï¼‰ï¼Œinterested or notï¼ˆè¡¨ç¤ºæ˜¯å¦å¯¹å¯¹æ–¹çš„æ•°æ®æ„Ÿå…´è¶£ï¼‰ï¼ŒçŠ¶æ€åœ¨è¿æ¥å»ºç«‹æ—¶çš„åˆå§‹å€¼ä¸º choked ä»¥åŠ not interestedã€‚å› ä¸ºäº¤äº’æ˜¯åŒæ–¹çš„ï¼Œä¸€æ–¹ä¸ä»…è¦å­˜å‚¨è‡ªå·±ç»™å¯¹æ–¹è®¾å®šçš„çŠ¶æ€ï¼Œä¹Ÿè¦å­˜å‚¨å¯¹æ–¹ç»™è‡ªå·±è®¾å®šçš„çŠ¶æ€ï¼Œå› æ­¤å®é™…ä¸Šä¼šæœ‰å››ä¸ªçŠ¶æ€ä½ï¼ˆBEP ä¸­è¡¨ç¤ºåªæœ‰ä¸¤ä¸ªçŠ¶æ€ä½ï¼Œä½†æ˜¯ç”±äºä¸»åŠ¨ä¸è¢«åŠ¨è¯­æ€çš„å¤æ‚æ€§ä»¥åŠè€ƒè™‘åˆ°å®é™…æºç çš„å®ç°ï¼Œè¿™é‡Œå¼•å…¥æˆå››ä¸ªçŠ¶æ€ä½ï¼Œå¢åŠ äº†ä¸€å®šçš„å†—ä½™ï¼Œä½†ä¾¿äºå†™ä½œï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¾¿äºç†è§£ï¼‰ã€‚\n\nå‡è®¾ Aï¼ŒB æ˜¯åœ¨ä¸‹è½½åŒä¸€ä¸ªèµ„æºçš„å¯¹ç­‰ä½“ã€‚ç”¨ A.B è¡¨ç¤º peer A ä¸­ A ä¸ B çš„è¿æ¥ã€‚æ‰€ä»¥ A ä¸ B è¿æ¥å»ºç«‹æ—¶ï¼Œåœ¨ A çš„å†…å­˜ç©ºé—´ä¸­çš„ä¿å­˜çš„å¯¹äº B çš„è¿æ¥ä¼šæœ‰å¦‚ä¸‹çš„çŠ¶æ€ï¼š\n``` c\nchoked = true;\ninterested = false;\npeer_choked = true;\npeer_interested = false;\n```\nåŒæ ·é“ç†ï¼ŒB ä¸­ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„è¿™æ ·å››ä¸ªçŠ¶æ€ã€‚ä¸”åˆå§‹çŠ¶æ€ç›¸åŒã€‚åªæœ‰å½“ A çš„ `interested == true` è€Œä¸” `peer_choked == false` æ—¶ï¼ŒA æ‰èƒ½å‘ B ç´¢è¦æ•°æ®ã€‚\n\nå¯¹äº A è€Œè¨€ï¼Œæœ‰ä¸‹é¢å››ä¸ªæ—¶æœºæ›´æ–°è¿™ä¸€ç»„çŠ¶æ€ï¼š\n - åœ¨æ”¶åˆ° B å‘æ¥çš„ **choke**/**unchoke** æ¶ˆæ¯æ—¶ï¼Œä¼šæ›´æ–° `peer_choked` çŠ¶æ€ç½®ä¸º true/falseï¼›\n - åœ¨æ”¶åˆ° B å‘æ¥çš„ **interested**ï¼Œ**not interested** æ¶ˆæ¯æ—¶ï¼Œä¼šæ›´æ–° `peer_interested` çŠ¶æ€ç½®ä¸º true/falseï¼›\n - ä¸æ–­æ ¹æ®è‡ªå·±æ‰€æ‹¥æœ‰çš„åˆ†ç‰‡ä¸ B æ‹¥æœ‰åˆ†ç‰‡çš„çŠ¶æ€ï¼ˆB é€šè¿‡ **bitfield** æ¶ˆæ¯å‘ŠçŸ¥ Aï¼‰æ›´æ–° `interested` çŠ¶æ€ï¼Œå¹¶é€šè¿‡å‘é€ **interested**/**not interested** æ¶ˆæ¯ç»™ Bï¼›\n\n## æ¶ˆæ¯ç±»å‹\n**handshake** æ˜¯è¿æ¥ peer é—´è¿æ¥å»ºç«‹åå‘é€çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼Œä¸»è¦ç”¨äºé€šå‘Š info_hash ä¸ peer_idï¼š\n```\n| 19 (1) | \"BitTorrent protocol\" (19) | reserved_byte (8) | info_hash (20) | peer_id (20) |\n```\n**keepalive**ï¼Œç¬¬ä¸€ä¸ªå­—æ®µä¸ºæ¶ˆæ¯ä½“é•¿åº¦ï¼Œkeepalive æ¶ˆæ¯é•¿åº¦ä½“ä¸º 0ï¼š\n```\n| len (4) |\n```\n\né™¤åŸºç¡€æ¶ˆæ¯å¤–çš„å…¶ä»–æ¶ˆæ¯å‡æœ‰å›ºå®šçš„æ ¼å¼å¦‚ä¸‹ï¼šæ¶ˆæ¯ä½“é•¿åº¦ + ç±»å‹ + è´Ÿè½½ã€‚\n```\n| len (4) | type (1) | payload |\n```\nå¯èƒ½çš„ç±»å‹å€¼æœ‰ï¼š\n - 0 - choke\n - 1 - unchoke\n - 2 - interested\n - 3 - not interested\n - 4 - have\n - 5 - bitfield\n - 6 - request\n - 7 - piece\n - 8 - cancel\n - 20 - extend message\n\nå…¶ä¸­ **choke**ï¼Œ**unchoke**ï¼Œ**interested**ï¼Œ**not interested** æ¶ˆæ¯æ²¡æœ‰è´Ÿè½½ã€‚\n\n**bitfield** æ¶ˆæ¯ä»…åœ¨ handshake ååŒæ–¹å„å‘é€ä¸€æ¬¡ï¼Œæ¯ä¸ªæ¯”ç‰¹è¡¨ç¤ºå¯¹åº”çš„åˆ†ç‰‡æ˜¯å¦å®Œæ•´ã€‚\n```\n| len (4) | 5 (1) | bitfield |\n```\n\n**have** æ¶ˆæ¯çš„è´Ÿè½½æ˜¯ä¸€ä¸ªæ•´å‹æ•°å­—ï¼Œpeer åœ¨ä¸€ä¸ªåˆ†ç‰‡ä¸‹è½½å®Œæˆå¹¶æ ¡éªŒé€šè¿‡åå‘é€è¯¥é™„å¸¦åˆšä¸‹è½½å®Œæˆåˆ†ç‰‡çš„ç´¢å¼•çš„æ¶ˆæ¯ç»™å…¶ä»– peerã€‚\n```\n| len (4) | 4 (1) | index (4) |\n```\n\n**request** æ¶ˆæ¯ç»“æ„å¦‚ä¸‹ï¼Œç”¨äºè¯·æ±‚æŒ‡å®šåˆ†ç‰‡ï¼ˆindexï¼‰çš„èŒƒå›´ä¸º `[ offset, offset + length )` çš„å­—èŠ‚ï¼Œlength ä¸€èˆ¬ä¸º 2^14 (16 kiB)ï¼Œè¶…è¿‡åˆ™ä¼šå…³é—­è¿æ¥ã€‚\n```\n| len (4) | 6 (1) | index (4) | offset (4) | length (4) |\n```\n\n**piece** æ¶ˆæ¯ç”¨äºå›å¤ request æ¶ˆæ¯ï¼Œå³è¿”å›è‡ªèº«åˆ†ç‰‡ï¼ˆindexï¼‰çš„èŒƒå›´ä¸º `[ offset, offset + length )` çš„å­—èŠ‚\n```\n| len (4) | 7 (1) | index (4) | offset (4) | block (length) |\n```\n\n**cancel** æ¶ˆæ¯é™¤äº†ç±»å‹å’Œ request æ¶ˆæ¯ä¸åŒå¤–ï¼Œå…¶ä»–å‡ä¸ request ä¸€è‡´ï¼Œç”¨äºå‘ peer å–æ¶ˆä¹‹å‰å‘å‡ºçš„ request è¯·æ±‚ã€‚è¿™æ˜¯ç”±äºä¸ºäº†åŠ å¿«æœ€åè‹¥å¹²åˆ†ç‰‡çš„ä¸‹è½½é€Ÿåº¦ï¼Œå®¢æˆ·ç«¯ä¼šå¯ç”¨ **Endgame** æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œpeer ä¼šå‘æ‰€æœ‰çš„ peer è¯·æ±‚ç›¸åŒçš„åˆ†ç‰‡ç‰‡æ®µï¼Œå½“ peer ä»æŸä¸ª peer è·å¾—æ‰€éœ€çš„åˆ†ç‰‡ç‰‡æ®µåï¼Œéœ€è¦å‘å‰©ä½™çš„ peer å‘é€ cancel æ¶ˆæ¯ä»¥å‡å°‘ä¸å¿…è¦çš„ä¼ è¾“ã€‚\n```\n| len (4) | 8 (1) | index (4) | offset (4) | length (4) |\n```\n\nç±»å‹ä¸º 20 çš„æ˜¯æ‰©å±•æ¶ˆæ¯ã€‚\n\n## æ‰©å±•æ¶ˆæ¯\n[BEP10 - Extension Protocol](http://bittorrent.org/beps/bep_0010.html) ä¸­å®šä¹‰äº†æ‰©å±•æ¶ˆæ¯ã€‚peer é€šè¿‡å°† handshake æ¶ˆæ¯çš„ä¿ç•™å­—èŠ‚çš„å³æ•°ç¬¬ 20 ä¸ªæ¯”ç‰¹ç½®ä¸º 1 æ¥é€šå‘Šå…¶ä»– peer è‡ªèº«æ”¯æŒæ‰©å±•æ¶ˆæ¯ã€‚å³å¯ä»¥é€šè¿‡åˆ¤æ–­è¡¨è¾¾å¼ `reserved_byte[5] & 0x10` æ¥åˆ¤æ–­ peer æ˜¯å¦æ”¯æŒæ‰©å±•æ¶ˆæ¯ã€‚\n\næ‰©å±•æ¶ˆæ¯çš„åŸºç¡€ç»“æ„å¦‚ä¸‹ï¼Œå®é™…ä¸Šç›¸å½“äºæ˜¯ç±»å‹ä¸º 20 çš„æ™®é€šæ¶ˆæ¯ã€‚\n\n```\n| len (4) | 20 (1) | extended_messag_id (1) | payload |\n```\n\nextended_messag_id ä¸º 0 çš„æ¶ˆæ¯æ˜¯ **Extend Handshake** æ¶ˆæ¯ã€‚\n\n### Extend Handshake\n\nExtend Handshake æ¶ˆæ¯çš„æœ‰æ•ˆè½½è·æ˜¯ä¸€ä¸ª bencode å­—å…¸ã€‚å­—å…¸ä¸­çš„æ‰€æœ‰é”®éƒ½æ˜¯å¯é€‰çš„ï¼Œpeer éœ€è¦å¿½ç•¥æ‰€æœ‰è‡ªå·±ä¸æ”¯æŒçš„é”®ã€‚å¯é€‰çš„é”®ï¼ˆè¿˜å¯ä»¥æœ‰æ›´å¤šï¼‰å¦‚ä¸‹:\n\n- **m**ï¼šå­—å…¸ï¼Œè¡¨ç¤ºæ”¯æŒçš„æ‰©å±•æ¶ˆæ¯ï¼Œé”®æ˜¯æ‰©å±•æ¶ˆæ¯åç§°ï¼Œå€¼æ˜¯æ‰©å±•æ¶ˆæ¯çš„ idï¼ˆä¸ extended_messag_id å¯¹åº”ï¼‰ã€‚peer é€šè¿‡è¿™ä¸ªé”®é€šå‘Šå…¶ä»– peer è‡ªå·±æ”¯æŒçš„æ¶ˆæ¯ç±»å‹ï¼Œä¸”è¯¥ peer ä¹‹åå‘é€å…¶ä»–çš„æ‰©å±•æ¶ˆæ¯å°±ä¼šä½¿ç”¨åœ¨è¿™é‡Œå¯¹åº”çš„ extended_messag_idã€‚æ‰©å±•æ¶ˆæ¯åç§°çš„æ ¼å¼ä¸€èˆ¬ä¸º `å®¢æˆ·ç«¯ç¼©å†™_æ¶ˆæ¯åç§°`ï¼Œè¿™æ ·å¯ä»¥å®ç°å…¨ç½‘å…¨å±€æ¶ˆæ¯ç±»å‹å”¯ä¸€ï¼ˆä¾§é‡å®ç°ï¼‰ï¼›è€Œ extended_messag_id åˆ™æ˜¯è‡ªå·±å®¢æˆ·ç«¯è‡ªå·±å®šä¹‰ï¼Œåœ¨ m å­—å…¸ä¸­ä¸é‡å¤å³å¯ï¼ˆä¾§é‡ç´¢å¼•ï¼‰ï¼Œè¿™æ ·ä¾¿å¯ä»¥åšåˆ°å•å‘é€šä¿¡å”¯ä¸€ã€‚\n- **p**ï¼šæ•´å‹ï¼Œè¡¨ç¤ºæœ¬åœ°ç›‘å¬ç«¯å£ã€‚å¸®åŠ©å¦ä¸€æ–¹äº†è§£è‡ªå·±çš„ç«¯å£ä¿¡æ¯ã€‚è¿æ¥çš„æ¥æ”¶æ–¹æ˜¯ä¸éœ€è¦å‘é€è¿™ä¸ªæ‰©å±•æ¶ˆæ¯çš„ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„ç«¯å£æ˜¯å·²çŸ¥çš„ã€‚ï¼ˆå®é™…ä¸Š peer é—´é€šä¿¡æ— è®ºæ˜¯åŸºäº TCP è¿˜æ˜¯ ÂµTPï¼ˆUDPï¼‰ï¼Œæ¥æ”¶æ–¹ç†è®ºä¸Šéƒ½å¯ä»¥ä»ä¼ è¾“å±‚è·å¾—ç«¯å£æ•°æ®ï¼‰ã€‚\n- **v**ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„åç§°ä¸ç‰ˆæœ¬ï¼Œè¿™ä¸ªæ¯” peer id æ›´å¯é ä¸€äº›ã€‚\n- **yourip**ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºåœ¨ peer è§†è§’ä¸­å¯¹æ–¹ peer çš„ IPï¼Œä¸€èˆ¬å®¢æˆ·ç«¯é€šè¿‡æ­¤è·å–è‡ªå·±çš„å…¬ç½‘ IPã€‚\n- **ipv6**ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè‡ªèº«å‹ç¼©æ ¼å¼çš„ IPv6 åœ°å€ã€‚å¯èƒ½å¯¹æ–¹ peer æ›´å–œæ¬¢ä½¿ç”¨ IPv6 åœ°å€ã€‚ \n- **ipv4**ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè‡ªèº«å‹ç¼©æ ¼å¼çš„ IPv4 åœ°å€ã€‚å¯èƒ½å¯¹æ–¹ peer æ›´å–œæ¬¢ä½¿ç”¨ IPv4 åœ°å€ã€‚\n- **reqq**ï¼šæ•´å‹ï¼Œè¡¨ç¤ºè‡ªèº«çš„åœ¨ä¸ä¸¢å¼ƒæ¶ˆæ¯æƒ…å†µä¸‹å¯ä»¥ä¿ç•™çš„æœªå¤„ç†çš„æ¶ˆæ¯æ•°é‡ã€‚åœ¨ libtorrent ä¸­è¿™ä¸ªå€¼æ˜¯ 250ã€‚\n\nè¿™ä¸ªæ¶ˆæ¯éœ€è¦åœ¨æ™®é€š handshake æˆåŠŸåç«‹å³å‘é€ï¼Œåœ¨è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸå†…è¿™ä¸ª Extend Handshake å¤šæ¬¡å‘é€éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä½†å®é™…å®ç°ä¸­æœ‰å¯èƒ½è¢«å¿½ç•¥ã€‚å¦‚æœåç»­çš„ Extend Handshake æ¶ˆæ¯æŒ‡å®š m å­—å…¸ä¸­æŸäº›æ‰©å±•çš„æ‰©å±• id ä¸º 0ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨è¿™äº›æ‰©å±•ã€‚\n\n### Metadata Request(ut_metadata)\n\n[BEP9 - Extension for Peers to Send Metadata Files](http://bittorrent.org/beps/bep_0009.html) ä¸­å®šä¹‰äº†ç£åŠ›é“¾æ¥ï¼ŒåŒæ—¶ä¹Ÿå®šä¹‰äº†ç”¨äºä» Peer è·å–å…ƒæ•°æ®çš„æ‰©å±•æ¶ˆæ¯ **UT Metadata**ã€‚\n\nå¦‚æœä¸€ä¸ª peer çš„å®¢æˆ·ç«¯æ”¯æŒ **UT Metadata** æ¶ˆæ¯ï¼Œé‚£ä¹ˆåœ¨è¯¥ peer å‘å…¶ä»– peer å‘é€ Extend Handshake æ¶ˆæ¯æ—¶ï¼Œéœ€è¦åœ¨å­—å…¸ m ä¸­åŠ å…¥ **ut_metadata** è¿™ä¸ªé”®ï¼ŒåŒæ—¶ä¿æŒå…¶å¯¹åº”çš„æ¶ˆæ¯ id åœ¨ m å­—å…¸ä¸­å”¯ä¸€ã€‚ç‰¹æ®Šçš„æ˜¯å¯¹äºè¿™ä¸ªæ¶ˆæ¯çš„æ”¯æŒè¿˜éœ€è¦åœ¨ Extend Handshake æ¶ˆæ¯è´Ÿè½½å­—å…¸ä¸­åŠ å…¥ä¸€ä¸ªé”® **metadata_size**ï¼Œè¡¨ç¤ºå…ƒæ•°æ®çš„å­—èŠ‚æ•°ã€‚\n\n**UT Metadata** æ¶ˆæ¯çš„è´Ÿè½½ä¹Ÿæ˜¯ä¸€ä¸ª bencode å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š\n\n- **msg_type**ï¼šæ•´å‹ï¼Œä»£è¡¨æ¶ˆæ¯ç±»å‹ï¼Œå¯èƒ½çš„ç±»å‹æœ‰ï¼š\n    - **request**ï¼š0ã€‚è¯·æ±‚ç±»å‹ï¼Œå³è¯·æ±‚åºå·ä¸º **piece** çš„ metadata ç‰‡æ®µã€‚è¯·æ±‚ç±»å‹çš„è¿”å›ç±»å‹ä¸º **data** æˆ–è€… **reject**ï¼›\n    - **data**ï¼š1ã€‚æ­£å¸¸è¿”å›åºå·ä¸º **piece** çš„ metadata ç‰‡æ®µã€‚å…ƒæ•°æ®ä¼šæŒ‰ç…§ 16 kiB å¤§å°åˆ‡åˆ†ï¼Œé™¤äº†æœ€åä¸€ç‰‡æ®µï¼Œå…¶ä½™çš„éƒ½åº”è¯¥ä¸º 16 kiB å¤§å°ï¼Œåºå·ä¹Ÿç”±æ­¤åˆ†å‰²å¤§å°å¾—æ¥ã€‚å…ƒæ•°æ®ç‰‡æ®µä½œä¸ºè´Ÿè½½çš„ä¸€éƒ¨åˆ†è·Ÿåœ¨æ•´ä¸ªå­—å…¸åé¢ï¼Œå…¶å¹¶ä¸ä½¿ç”¨ bencode ç¼–ç ï¼Œä½†æ˜¯é•¿åº¦éœ€è¦è®¡ç®—åœ¨ **len** ä¸­ã€‚\n    - **reject**ï¼š2ã€‚è¡¨ç¤ºè¢«è¯·æ±‚çš„ peer æ²¡æœ‰åºå·ä¸º **piece** çš„ metadata ç‰‡æ®µã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€å®šæ—¶é—´å†…è¯·æ±‚è¶…è¿‡æ•°é‡é™åˆ¶ï¼Œä¸ºäº†é˜²æ­¢æ´ªæ³›æ”»å‡»ï¼Œç›´æ¥è¡¨ç¤ºæ‹’ç»ã€‚\n- **piece**ï¼šæŒ‡å®šå…ƒæ•°æ®çš„åˆ†ç‰‡åºå·ã€‚\n- **total_size**ï¼šä»…åœ¨ **data** ç±»å‹æ¶ˆæ¯ä¸­å‡ºç°ï¼Œå’Œæ¡æ‰‹æ¶ˆæ¯ä¸­çš„ **metadata_size** è¯­ä¹‰ä¸€è‡´ã€‚\n\n### Partial Seeds\nè¿™ä¸ªæ‰©å±•æ˜¯ä¸ºäº†è®© BT æ”¯æŒå¯¹ Partial Seedsï¼ˆéƒ¨åˆ†ç§å­ï¼Œ[BEP21 - Extension for partial seeds](http://bittorrent.org/beps/bep_0021.html)ï¼‰çš„è¯†åˆ«ä¸è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚éƒ¨åˆ†ç§å­å°±æ˜¯èµ„æºä¸å®Œæ•´ä½†æ˜¯ä¹Ÿä¸å†è¿›è¡Œä¸‹è½½çš„ peerã€‚è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨å¤šæ–‡ä»¶ç§å­ä¸­ï¼Œç”¨æˆ·åªè®¾å®šä¸‹è½½ä¸€éƒ¨åˆ†æ–‡ä»¶ã€‚\n\nè¿™ä¸ªæ‰©å±•ä¸å®šä¹‰é¢å¤–çš„æ‰©å±•æ¶ˆæ¯ï¼Œä½†æ˜¯åœ¨æ‰©å±•æ¡æ‰‹æ¶ˆæ¯çš„å­—å…¸ä¸­åŠ å…¥ä¸€ä¸ªé”® **upload_only**ï¼Œå€¼ä¸ºæ•´å‹ï¼Œå¦‚æœ peer å¯¹ä¸‹è½½ä¸æ„Ÿå…´è¶£åˆ™éœ€è¦è®²æ­¤å€¼ç½®ä¸º 1ã€‚\n\nåœ¨ Tracker çš„ Scrape è¯·æ±‚å›å¤ä¸­ï¼Œå®šä¹‰äº† **complete**, **incomplete** ä»¥åŠ **downloaded** ä¸‰ç§çŠ¶æ€çš„ peerã€‚ä¸ºäº†è®©å…¶ä»– peer å¯ä»¥é€šè¿‡ Tracker çŸ¥æ™“ Partial Seeds çš„æƒ…å†µï¼Œæ‰©å±•å®šä¹‰äº†åœ¨ Scrape å›å¤ä¸­åŠ å…¥ç±»å‹ **downloaders**ï¼Œè¡¨ç¤ºå¤„äºæ´»è·ƒçŠ¶æ€ï¼Œæœªå®Œæˆä¸‹è½½ä¸”ä»ç„¶éœ€è¦ç»§ç»­ä¸‹è½½çš„ peer æ•°é‡ï¼ŒPartial Seed çš„æ•°é‡å¯ä»¥é€šè¿‡ `incomplete - downloaders` å¾—åˆ°ã€‚åŒæ—¶è®© Tracker çŸ¥æ™“ peer è‡ªèº«å¤„äº Partial Seed çŠ¶æ€ï¼Œåˆ™éœ€è¦é€šè¿‡ `event=paused` äº‹ä»¶è¿›è¡Œå‘ŠçŸ¥ï¼Œä¸”æ¯æ¬¡é€šå‘Šæ—¶éƒ½è¦å‘é€è¯¥äº‹ä»¶ã€‚\n\n### Peer Exchange(ut_pex)\n\nPeer Exchange(PEX) ç”¨äºåœ¨ peer é—´äº¤æ¢ peer åˆ—è¡¨ã€‚é€šè¿‡åœ¨ Extend Handshake æ¶ˆæ¯çš„ å­—å…¸ m ä¸­åŠ å…¥ **ut_pex** è¿™ä¸ªæ¶ˆæ¯åç§°æ¥è¡¨æ˜æ”¯æŒï¼ŒåŒæ ·é“ç†ï¼Œæ¶ˆæ¯ id åœ¨ m å­—å…¸ä¸­ä¿æŒå”¯ä¸€å³å¯ã€‚\n\nPEX æ¶ˆæ¯çš„è´Ÿè½½ä¹Ÿæ˜¯ä¸€ä¸ª bencode å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š\n\n- **added**ï¼šå½“å‰è¿æ¥çš„ IPv4 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œæ·»åŠ \n- **added.f**ï¼šå½“å‰è¿æ¥çš„ IPv4 peer æ ‡å¿—ä½ï¼Œæ¯ä¸ª peer ä¸€ä¸ªå­—èŠ‚\n- **added6**ï¼šå½“å‰è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œæ·»åŠ \n- **added6.f**ï¼šå½“å‰è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨æ ‡å¿—ä½\n- **dropped**ï¼šè¿‡å»æ–­å¼€è¿æ¥çš„ IPv4 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œåˆ é™¤\n- **dropped6**ï¼šè¿‡å»æ–­å¼€è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œåˆ é™¤\n\næ ‡å¿—ä½å®šä¹‰å¦‚ä¸‹ï¼š\n\n- 0x02ï¼šå±äº seed æˆ–è€… partial seed\n- 0x04ï¼šæ”¯æŒ uTP\n- 0x01ï¼šprefers encryption, as indicated by e field in extension handshake\n- 0x08ï¼špeer indicated ut_holepunch support in extension handshake\n- 0x10ï¼šoutgoing connection, peer is reachable\n\n#### å‘é€è§„åˆ™\n\n- å¦‚æœ peer ä¸æŸäº› peer æ–­å¼€è¿æ¥ï¼Œåˆ™éœ€è¦éœ€è¦åœ¨é€‚å½“æ—¶å€™å‘é€ PEX æ¶ˆæ¯ï¼Œå°†æ–­å¼€è¿æ¥çš„ peer æ”¾åœ¨ dropped ä¸­ï¼›\n- æ¯åˆ†é’Ÿå‘é€çš„ PEX æ¶ˆæ¯ä¸èƒ½è¶…è¿‡ä¸€æ¡ï¼›\n- ä¸éœ€è¦åœ¨æ¡æ‰‹åç«‹å³å‘é€ PEX æ¶ˆæ¯ï¼Œåœ¨æ”¶é›†æ»¡ä¸€å®šçš„ peer ä¹‹åå†å‘é€æ•ˆæœæ›´å¥½ï¼›\n- æ·»åŠ æˆ–åˆ é™¤çš„ peer åˆ—è¡¨ä¸­ä¸èƒ½åŒ…æ‹¬é‡å¤é¡¹ï¼Œä¹Ÿä¸èƒ½åœ¨åŒä¸€ä¸ª PEX æ¶ˆæ¯ä¸­åˆ é™¤æ·»åŠ çš„ peerï¼›\n- é™¤äº†æœ€åˆçš„ PEX æ¶ˆæ¯ä¹‹å¤–ï¼Œæ¯æ¡æ¶ˆæ¯ä¸­æ·»åŠ çš„ peer æ•°é‡æˆ–è€… åˆ é™¤çš„ peer æ•°é‡å‡ä¸èƒ½è¶…è¿‡ 50 æ¡ï¼›\n- added, added6, dropped, dropped6 å››ä¸ªé”®ä¸­è‡³å°‘éœ€è¦æœ‰ä¸€ä¸ªï¼›\n- peer å¯èƒ½ä¼šä¸ä¸¥é‡è¿åè¿™äº›è§„åˆ™çš„ peer æ–­å¼€è¿æ¥ï¼›\n\n#### æ‰©å…… seed\næ¯ä¸ª peer ä¼šæ‰§è¡Œå¦‚ä¸‹çš„æ‰§è¡Œä¸€äº›è§„åˆ™æ¥æ–­å¼€ä¸éƒ¨åˆ† peer çš„è¿æ¥ã€‚æ¯”å¦‚\n1. åœ¨ä½œç§çš„æ—¶å€™ä¼šæ–­å¼€ä¸ seed å’Œ partial seed çš„è¿æ¥ï¼›\n2. æ ¹æ® peer id æ–­å¼€ IPv4 ä»¥åŠ IPv6 åœ°å€å®é™…ä¸Šå±äºåŒä¸€ä¸ª peer çš„ä¸€ä¸ªè¿æ¥ï¼Œä¿ç•™è‡ªå·±åçˆ±çš„åœ°å€å®¶æ—è¿æ¥ï¼›\n\nè¿™æ ·çš„ç­–ç•¥ä¸‹ï¼Œåœ¨ seed å ä¸»å¯¼åœ°ä½çš„ swarm ä¸­é€šè¿‡ PEX ä¼ æ’­çš„æ´»è·ƒ peer ä¼šä¸è¶³ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨ IPv4 å ä¸»å¯¼çš„ swarm ä¸­ï¼Œåªæ”¯æŒ IPv6 çš„ peer å°†å¾ˆéš¾è·å¾— IPv6 çš„ peerã€‚è¿™å¾ˆå¤§ç¨‹åº¦é™ä½äº† PEX æ¶ˆæ¯çš„æœ‰æ•ˆæ€§ã€‚\n\nä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¦‚æœä¸€ä¸ª peer è¿æ¥åˆ°ä¸€ä¸ªç‰¹å®šåœ°å€å®¶æ—çš„ peer å°‘äº25ä¸ªï¼Œæ´»è·ƒåº¦çš„è¦æ±‚å°±ä¼šæ”¾å®½ã€‚å› ä¸ºä¸€ä¸‹åŸå› å¯¼è‡´è¿æ¥æ–­å¼€çš„ peer ä¹Ÿä¼šè¢«ä¿å­˜ä¸‹æ¥ï¼Œå¹¶æœ‰èµ„æ ¼è¢«å‘åœ¨ PEX æ¶ˆæ¯çš„ added ä¸­ï¼š\n1. å› ä¸º peer id ç›¸åŒè€Œè¢«æ–­å¼€çš„å¦ä¸€ä¸ªåœ°å€å®¶æ—çš„è¿æ¥ï¼›\n2. å› ç¼ºä¹å…´è¶£è€Œæ–­å¼€è¿æ¥çš„ peerï¼Œæ¯”å¦‚å¯¹æ–¹æ˜¯ seed/partial seed æˆ–è€…å¯¹æ–¹æ‹¥æœ‰çš„åˆ†ç‰‡ä¸æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ï¼›\n3. å› ä¸ºè¶…è¿‡æœ¬åœ°èµ„æºé™åˆ¶è€Œæ–­å¼€çš„è¿æ¥ï¼Œæ¯”å¦‚å…¨å±€çš„è¿æ¥ä¸Šé™ï¼›\n\nä¸ºäº†ä¿è¯ peer çš„æœ‰æ•ˆæ€§ï¼Œå› ä¸ºè¿™äº›åŸå› æ·»åŠ åˆ° added ä¸­çš„ peer åªèƒ½é€šè¿‡ PEX æ¶ˆæ¯å‘é€ä¸€æ¬¡ï¼Œå‘é€å®Œåå¿…é¡»ä»ç­‰å¾…å‘é€åˆ—è¡¨ä¸­åˆ é™¤ã€‚\n\n#### å®‰å…¨æ€§\né€šè¿‡ PEX è·å¾—çš„ peer åº”è¯¥è§†ä¸ºä¸å¯ä¿¡çš„ã€‚æ”»å‡»è€…å¯èƒ½é€šå¤šä¼ªé€  PEX æ¶ˆæ¯æ¥æ”»å‡»è¿™ä¸ª swarmã€‚æ”»å‡»è€…ä¹Ÿå¯èƒ½é€šè¿‡ PEX æ¶ˆæ¯è¯±å¯¼ BT å®¢æˆ·ç«¯å¯¹ç‰¹å®š IP è¿›è¡Œå°è¯•è¿æ¥è€Œå¼•å‘ DDoS æ”»å‡»ã€‚\n\nä¸ºäº†ç¼“è§£è¿™äº›é—®é¢˜ï¼Œpeer åº”è¯¥é¿å…ä»å•ä¸ª PEX æºè·å–å…¶æ‰€æœ‰è¿æ¥ä½œä¸ºå€™é€‰è¿æ¥ã€‚åº”å¿½ç•¥å…·æœ‰ä¸åŒçš„ç«¯å£çš„é‡å¤ IPï¼Œè¿˜å¯ä»¥æ ¹æ® peer çš„ä¼˜å…ˆçº§æ¥è¿›è¡Œï¼ˆåè®®æ¦‚è¿°ä¸­æåˆ°ï¼‰æ’åºã€‚\n\n## å¿«é€Ÿæ‰©å±•ï¼ˆFast Extensionï¼‰\n\nå¦å¤–è¿˜æœ‰ç±»ä¼¼æ‰©å±•æ¶ˆæ¯çš„å¿«é€Ÿæ‰©å±•æ¶ˆæ¯ï¼Œé€šè¿‡å°†æ¡æ‰‹æ¶ˆæ¯çš„ `reserved_byte[7] |= 0x04` æ¥é€šå‘Šæ”¯æŒå¿«é€Ÿæ‰©å±•ï¼Œè¿™é‡Œåªåˆ—å‡ºå¿«é€Ÿæ‰©å±•æ¶ˆæ¯çš„ç§ç±»ï¼Œå…·ä½“åè®®æ ¼å¼å¯å‚è§ [BEP06 - Fast Extension](http://bittorrent.org/beps/bep_0006.html)ã€‚\n\n- **Have All/Have None**ï¼šæ¥è¡¨ç¤ºæ‹¥æœ‰æ‰€æœ‰åˆ†ç‰‡æˆ–è€…æœªæ‹¥æœ‰ä»»ä½•åˆ†ç‰‡ï¼Œæ˜¯ **bitfield** æ¶ˆæ¯çš„å¿«é€Ÿç‰ˆæœ¬ï¼›\n- **Suggest Piece**ï¼šå»ºè®®å…¶ä»– peer ä¸‹è½½æŸåˆ†ç‰‡ï¼›\n- **Reject Request**ï¼šæ‹’ç» peer å¯¹æŸä¸ªç‰‡æ®µçš„è¯·æ±‚ï¼›\n- **Allowed Fast**ï¼šè¡¨ç¤ºå¦‚æœ peer è¯·æ±‚è¿™ä¸ªåˆ†ç‰‡ï¼Œå³ä½¿å®ƒå¤„äº choked çŠ¶æ€ä¹Ÿä¼šç»™å®ƒï¼›\n- **lt Dont Have**ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚èµ„æºçŸ­ç¼ºï¼ŒLRU Cache è¿‡æœŸï¼‰ä¼šå¯¼è‡´ peer ä¸å†æ‹¥æœ‰æŸä¸ªç‰‡æ®µï¼Œåˆ™å¯ä»¥é€šè¿‡æ­¤æ¶ˆæ¯å‘ŠçŸ¥å…¶ä»– peerï¼Œè¯¥æ‰©å±•å®šä¹‰åœ¨ [BEP54 - The lt_donthave extension](http://bittorrent.org/beps/bep_0054.html) ä¸­ï¼›\n\n\n## åˆ†ç‰‡é€‰æ‹©ç­–ç•¥\né€‰æ‹©ä¸€ä¸ªå¥½çš„åˆ†ç‰‡ä¸‹è½½é¡ºåºä¸å¦å¯¹ä¸‹è½½æ€§èƒ½æœ‰è¿™å¾ˆå¤§å½±å“ã€‚å¦‚æœé€‰æ‹©äº†ä¸€ä¸ªå·®çš„åˆ†ç‰‡ä¸‹è½½é€‰æ‹©ç®—æ³•ï¼Œåˆ™æŸä¸€æ—¶åˆ»å¯èƒ½æ‰€æœ‰åˆ†ç‰‡ä½ éƒ½å¯ä»¥ä¸‹è½½ï¼Œä½†æ˜¯ä¹‹åå°±æ²¡æœ‰ä½ æƒ³ä¸‹è½½çš„åˆ†ç‰‡äº†ã€‚BT ä¸­æ‰§è¡Œä¸€ä¸‹ç­–ç•¥ï¼š\n\n### Strict Priorityï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰\nä¸€æ—¦è¯·æ±‚äº†æŸä¸ªåˆ†ç‰‡çš„å­ç‰‡æ®µï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¯·æ±‚å…¶ä»–å­ç‰‡æ®µä¹‹å‰è¯·æ±‚è¯¥ç‰¹å®šåˆ†ç‰‡çš„å‰©ä½™å­ç‰‡æ®µï¼Œä»¥å°½é‡ä¼˜å…ˆè·å¾—è¿™ä¸ªå®Œæ•´çš„åˆ†ç‰‡ã€‚\n\n### Rarest Firstï¼ˆç¨€æœ‰ä¼˜å…ˆï¼‰\nåœ¨é€‰æ‹©æ¥ä¸‹æ¥ä¸‹è½½å“ªä¸ªåˆ†ç‰‡æ—¶ï¼Œpeer ä¼šé€‰æ‹©æœ€ç¨€æœ‰çš„åˆ†ç‰‡ï¼ˆè‡ªå·±æ²¡æœ‰è¿™ä¸ªåˆ†ç‰‡ï¼ŒåŒæ—¶å…¶ä»– peer æœ‰ï¼Œä½†æ˜¯æœ‰è¿™ä¸ªåˆ†ç‰‡çš„ peer æ•°é‡ç›¸å¯¹å…¶ä»–åˆ†ç‰‡æœ€å°‘ï¼‰è¿›è¡Œä¸‹è½½ã€‚è¿™ä¸ªç®—æ³•ä¿è¯äº†ä¸ç¨€æœ‰çš„åˆ†ç‰‡åœ¨ä¹‹åä»ç„¶èƒ½è¢«ä¸‹è½½åˆ°ï¼ŒåŒæ—¶ç¨€æœ‰çš„åˆ†ç‰‡åœ¨é€æ¸å˜å¤šã€‚é€šè¿‡å°½å¿«å¤åˆ¶æœ€ç¨€æœ‰çš„åˆ†ç‰‡ï¼Œå‡å°äº†ç¨€æœ‰åˆ†ç‰‡åœ¨å½“å‰è¿æ¥çš„ peer ä¸­å®Œå…¨æ¶ˆå¤±çš„å¯èƒ½æ€§ã€‚\n\n### Random First Pieceï¼ˆéšæœºé¦–åˆ†ç‰‡ï¼‰\nå½“ä¸‹è½½å¼€å§‹æ—¶ï¼Œä¸ä¼šä½¿ç”¨ç¨€æœ‰ä¼˜å…ˆç®—æ³•ã€‚å¼€å§‹æ—¶ peer æ²¡æœ‰åˆ†ç‰‡å¯ä»¥ç”¨äºä¸Šä¼ ï¼Œæ‰€ä»¥æœ€é‡è¦çš„æ˜¯å°½å¿«å¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„åˆ†ç‰‡ã€‚ç¨€æœ‰çš„åˆ†ç‰‡å¾€å¾€åªè¢«æŸä¸€ä¸ª peer æ‹¥æœ‰ï¼Œä»è¿™ä¸ª peer å¤„ä¸‹è½½è¿™ä¸ªåˆ†ç‰‡ï¼ˆåˆ†æˆå¤šä¸ªå­ç‰‡æ®µï¼‰å°†ä¼šæ…¢äºä»å¤šä¸ª peer å¤„ä¸‹è½½ç›¸åŒåˆ†ç‰‡çš„ä¸åŒå­ç‰‡æ®µã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåˆšå¼€å§‹ä¸‹è½½æ—¶ï¼Œä¼šéšæœºé€‰æ‹©ä¸€ä¸ªåˆ†ç‰‡è¿›è¡Œä¸‹è½½ï¼Œéšåç­–ç•¥è½¬ä¸ºç¨€æœ‰ä¼˜å…ˆã€‚\n\n### Endgame Mode\næœ‰æ—¶ä»ä¸€ä¸ª peer è¯·æ±‚æŸä¸ªåˆ†ç‰‡ä¼šå¾ˆæ…¢ï¼Œè¿™åœ¨ä¸‹è½½æ•´ä¸ªèµ„æºä½ çš„ä¸­é€”ä¸ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼ˆå› ä¸ºä¸­é€”åŒæ—¶å‘ç”Ÿä¸å°‘è¯·æ±‚ï¼‰ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µå¯èƒ½ä¼šå½±å“æœ€ç»ˆçš„å³å°†ä¸‹è½½å®Œæˆé˜¶æ®µã€‚å½“æ‰€æœ‰å‰©ä½™çš„å­ç‰‡æ®µéƒ½å·²ç»åœ¨å‘å…¶ä»– peer è¯·æ±‚æ—¶ï¼Œå®ƒä¼šåŒæ—¶å‘æ‰€æœ‰çš„ peer è¯·æ±‚è¿™äº›å­ç‰‡æ®µã€‚å½“æŸä¸€ä¸ª peer è¿”å›äº†ä¸€ä¸ªå­ç‰‡æ®µï¼Œå°±å‘å‰©ä½™çš„ peer å‘é€ cancel æ¶ˆæ¯ä»¥èŠ‚çº¦å¸¦å®½ã€‚åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼ŒEndgame æ¨¡å¼æŒç»­æ—¶é—´éå¸¸çŸ­ï¼Œæ‰€ä»¥æµªè´¹çš„å¸¦å®½ä¸å¤šï¼Œè€Œä¸”ä½¿å¾—èµ„æºçš„æœ€åä¸€éƒ¨åˆ†ä¸‹è½½éå¸¸å¿«ã€‚\n\n## Choking ç®—æ³•\nBT æ²¡æœ‰ä¸­å¿ƒåŒ–çš„èµ„æºåˆ†é…ï¼Œæ¯ä¸ª peer æœ‰è´£ä»»å»æœ€å¤§åŒ–è‡ªå·±çš„ä¸‹è½½é€Ÿç‡ã€‚Peer æ‰§è¡Œä¸€ç§å˜ç§ tit-fot-tat ç­–ç•¥ï¼Œä»ä¸è‡ªå·±ç›¸è¿çš„ peer å¤„ä¸‹è½½åˆ†ç‰‡ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ peer è¿›è¡Œä¸Šä¼ ï¼Œå¯¹å…¶ä»– peer è¿›è¡Œ chokeã€‚choke è¡¨ç°ä¸ºæ‹’ç»ä¸Šä¼ ï¼Œä½†ä¸‹è½½ä»å¯ç»§ç»­ï¼ŒåŒæ—¶è¿æ¥è¢«ä¿æŒä¸é”€æ¯ï¼Œåœ¨ choke ç»“æŸåè¿æ¥ä¸éœ€è¦é‡å»ºã€‚Choking ç®—æ³•å¯¹äº BT æ¥è¯´ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å¦‚æœéœ€è¦æœ‰ä¸€ä¸ªå¥½çš„ä¸‹è½½æ€§èƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚ä¸€ä¸ªå¥½çš„ choking ç®—æ³•éœ€è¦åˆ©ç”¨å¥½æ‰€æœ‰çš„èµ„æºï¼Œæä¾›å¥½çš„ä¸Šä¼ ç»™å…¶ä»– peerï¼ŒåŒæ—¶æƒ©ç½šé‚£äº›åªä¸‹è½½ä¸ä¸Šä¼ çš„ peerã€‚\n\nBT ä¸­ä½¿ç”¨çš„å˜ç§ tit-fot-tat ç­–ç•¥æ˜¯å›šå¾’å›°å¢ƒçš„åº”ç”¨ï¼Œåšä¸» youxu çš„æ–‡ç«  [P2På®¢æˆ·ç«¯çš„ç­–ç•¥å’Œå¥‡å¦™çš„å¯¹ç­–è®º](https://blog.youxu.info/2008/12/31/tit-for-tac-and-p2p-software/) å¯¹è¿™æ­¤æœ‰ç€å¾ˆé€šä¿—æ˜“æ‡‚çš„è§£é‡Šã€‚\n\nå¯¹äºæŸä¸ª peer çš„ Choking ç®—æ³• å¯ä»¥æè¿°å¦‚ä¸‹ï¼š \n1. **Choking Algorithm**ï¼šæ¯ T æ—¶é—´é€‰æ‹©åˆé€‚çš„ k ä¸ª peer è¿›è¡Œ unchokeï¼Œé€‰æ‹©çš„æ ‡å‡†ä¸ºè¿‡å» S æ—¶é—´ peer çš„ä¸‹è½½é€Ÿç‡ï¼›\n2. **Optimistic Unchoking**ï¼šæ¯ nT æ—¶é—´ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª peer è¿›è¡Œ unchokeï¼Œä»¥å°è¯•å‘ç°æ›´ä¼˜è´¨çš„ peerï¼›\n3. **Anti-snubbing**ï¼šå¦‚æœ mT æ—¶é—´å†…æ²¡æœ‰ä»æŸä¸ª peer å¤„è·å–åˆ°ä¸€ä¸ªåˆ†ç‰‡ï¼Œåˆ™è®¤ä¸ºè¢« **snubbed** äº†ï¼Œå¯¹å…¶è¿›è¡Œ chokeï¼›\n4. **Upload Only**ï¼šå½“ä¸€ä¸ª peer ä¸‹è½½å®Œæˆäº†ï¼Œå³æˆä¸ºäº†ä¸€ä¸ª seedï¼Œåˆ™åªè¿›è¡Œä¸Šä¼ ï¼Œä¸å†ä¸‹è½½ã€‚peer ä¼šé€‰æ‹©é‚£äº›è¯¥ peer å¯¹å…¶æœ‰è¾ƒé«˜ä¸Šä¼ é€Ÿç‡çš„ peer è¿›è¡Œä¸Šä¼ ã€‚\n\nå®é™…å®ç°ä¸­ T = 10s, k = 7, S = 20s, n = 3, m = 6ã€‚\n\n\n## å‚è€ƒèµ„æ–™\n1. [Question About Canonical Peer Priority](https://forum.utorrent.com/topic/90069-question-about-canonical-peer-priority/)","source":"_posts/bt-peer.md","raw":"---\ntitle: BT å¢å¼ºå»ºè®®ä¹‹ Peer\ntags:\n  - BT\ndate: 2018-08-30 19:14:00\ncategories:\n---\n\næœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» Peer ä»¥åŠ Peer é—´çš„é€šä¿¡ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡ {% post_link bt-overview %}ã€‚\n\n## Peer æ¥æº\nåœ¨è®² Peer é—´çš„é€šä¿¡å‰ï¼Œå…ˆæ€»ç»“ä¸€ä¸‹ Peer çš„æ¥æºã€‚\n1. **Magnet**ï¼šç£åŠ›è¿æ¥ä¸­æœ‰ **x.pe** å‚æ•°å¯ä»¥é¢„è®¾ä¸€äº› Peerï¼›\n2. **Tracker**ï¼šTracker æœåŠ¡å™¨çš„ä½œç”¨å°±æ˜¯æä¾› Peerï¼›\n4. **Local Service Discovery**ï¼ˆ[BEP14](http://bittorrent.org/beps/bep_0014.html)ï¼‰:é€šè¿‡å¯¹æœ¬åœ°ç»„æ’­åœ°å€ `239.192.152.143:6771` å’Œ `[ff15::efc0:988f]:6771` å‘å‡º info_hash å®£å‘Šæ¥å°è¯•è·å¾—å“åº”ï¼Œå¦‚æœæœ‰å“åº”ï¼Œåˆ™æ·»åŠ ä¸º Peerï¼›\n5. **Peer Exchange**ï¼šé€šè¿‡ Peer é—´çš„ **Peer Exchange** æ‰©å±•æ¶ˆæ¯æ¥ä¸å…¶ä»– Peer äº¤æ¢ Peerï¼Œåé¢ä¼šè¯¦ç»†æåˆ°ï¼›\n3. **DHT**ï¼šé€šè¿‡ DHT ç½‘ç»œè·å–ï¼›\n\n## åè®®æ¦‚è¿°\nPeer é—´çš„é€šä¿¡å±äºåº”ç”¨å±‚åè®®ï¼Œå®ƒä½¿ç”¨çš„åº”ç”¨å±‚åè®®å¯ä»¥æ˜¯ TCP æˆ–è€… ÂµTPã€‚\n\nPeer é—´æŒ‰ç…§å…ƒæ•°æ®ä¸­æè¿°çš„æ–‡ä»¶ç‰‡æ®µç´¢å¼•ï¼ˆèµ·å§‹ç´¢å¼•ä¸º 0ï¼‰è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œå½“ä¸€ä¸ª peer ä¸‹è½½å®Œæˆä¸€ä¸ªåˆ†ç‰‡è€Œä¸”ç»è¿‡äº†é€šè¿‡äº† hash å€¼çš„æ ¡éªŒï¼Œå®ƒä¼šé€šçŸ¥å®ƒçš„æ‰€æœ‰ peer è‡ªå·±æ‹¥æœ‰äº†è¿™ä¸ªç‰‡æ®µã€‚\n\nPeer è¿æ¥çš„ Peer ä¼šæœ‰ä¸€å®šä¸Šé™æ•°é‡ï¼Œæ‰€æœ‰çš„ Peer æŒ‰ç…§ [BEP40 - Canonical Peer Priority](http://bittorrent.org/beps/bep_0040.html) ä¸­å®šä¹‰çš„åŸºäºåŒæ–¹ IP çš„ crc32-c å€¼çš„ç®—æ³•è¿›è¡Œæ’åºï¼Œé€‰æ‹©è¿™ä¸ªå€¼æ›´å°çš„è‹¥å¹² Peer è¿›è¡Œè¿æ¥ã€‚\n\næ¯ä¸ªè¿æ¥ä¼šåŒ…å«ä¸¤ä¸ªçŠ¶æ€ä½ï¼Œchoked or notï¼ˆè¡¨ç¤ºæ˜¯å¦å¯¹å¯¹æ–¹ chokedï¼‰ï¼Œinterested or notï¼ˆè¡¨ç¤ºæ˜¯å¦å¯¹å¯¹æ–¹çš„æ•°æ®æ„Ÿå…´è¶£ï¼‰ï¼ŒçŠ¶æ€åœ¨è¿æ¥å»ºç«‹æ—¶çš„åˆå§‹å€¼ä¸º choked ä»¥åŠ not interestedã€‚å› ä¸ºäº¤äº’æ˜¯åŒæ–¹çš„ï¼Œä¸€æ–¹ä¸ä»…è¦å­˜å‚¨è‡ªå·±ç»™å¯¹æ–¹è®¾å®šçš„çŠ¶æ€ï¼Œä¹Ÿè¦å­˜å‚¨å¯¹æ–¹ç»™è‡ªå·±è®¾å®šçš„çŠ¶æ€ï¼Œå› æ­¤å®é™…ä¸Šä¼šæœ‰å››ä¸ªçŠ¶æ€ä½ï¼ˆBEP ä¸­è¡¨ç¤ºåªæœ‰ä¸¤ä¸ªçŠ¶æ€ä½ï¼Œä½†æ˜¯ç”±äºä¸»åŠ¨ä¸è¢«åŠ¨è¯­æ€çš„å¤æ‚æ€§ä»¥åŠè€ƒè™‘åˆ°å®é™…æºç çš„å®ç°ï¼Œè¿™é‡Œå¼•å…¥æˆå››ä¸ªçŠ¶æ€ä½ï¼Œå¢åŠ äº†ä¸€å®šçš„å†—ä½™ï¼Œä½†ä¾¿äºå†™ä½œï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¾¿äºç†è§£ï¼‰ã€‚\n\nå‡è®¾ Aï¼ŒB æ˜¯åœ¨ä¸‹è½½åŒä¸€ä¸ªèµ„æºçš„å¯¹ç­‰ä½“ã€‚ç”¨ A.B è¡¨ç¤º peer A ä¸­ A ä¸ B çš„è¿æ¥ã€‚æ‰€ä»¥ A ä¸ B è¿æ¥å»ºç«‹æ—¶ï¼Œåœ¨ A çš„å†…å­˜ç©ºé—´ä¸­çš„ä¿å­˜çš„å¯¹äº B çš„è¿æ¥ä¼šæœ‰å¦‚ä¸‹çš„çŠ¶æ€ï¼š\n``` c\nchoked = true;\ninterested = false;\npeer_choked = true;\npeer_interested = false;\n```\nåŒæ ·é“ç†ï¼ŒB ä¸­ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„è¿™æ ·å››ä¸ªçŠ¶æ€ã€‚ä¸”åˆå§‹çŠ¶æ€ç›¸åŒã€‚åªæœ‰å½“ A çš„ `interested == true` è€Œä¸” `peer_choked == false` æ—¶ï¼ŒA æ‰èƒ½å‘ B ç´¢è¦æ•°æ®ã€‚\n\nå¯¹äº A è€Œè¨€ï¼Œæœ‰ä¸‹é¢å››ä¸ªæ—¶æœºæ›´æ–°è¿™ä¸€ç»„çŠ¶æ€ï¼š\n - åœ¨æ”¶åˆ° B å‘æ¥çš„ **choke**/**unchoke** æ¶ˆæ¯æ—¶ï¼Œä¼šæ›´æ–° `peer_choked` çŠ¶æ€ç½®ä¸º true/falseï¼›\n - åœ¨æ”¶åˆ° B å‘æ¥çš„ **interested**ï¼Œ**not interested** æ¶ˆæ¯æ—¶ï¼Œä¼šæ›´æ–° `peer_interested` çŠ¶æ€ç½®ä¸º true/falseï¼›\n - ä¸æ–­æ ¹æ®è‡ªå·±æ‰€æ‹¥æœ‰çš„åˆ†ç‰‡ä¸ B æ‹¥æœ‰åˆ†ç‰‡çš„çŠ¶æ€ï¼ˆB é€šè¿‡ **bitfield** æ¶ˆæ¯å‘ŠçŸ¥ Aï¼‰æ›´æ–° `interested` çŠ¶æ€ï¼Œå¹¶é€šè¿‡å‘é€ **interested**/**not interested** æ¶ˆæ¯ç»™ Bï¼›\n\n## æ¶ˆæ¯ç±»å‹\n**handshake** æ˜¯è¿æ¥ peer é—´è¿æ¥å»ºç«‹åå‘é€çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼Œä¸»è¦ç”¨äºé€šå‘Š info_hash ä¸ peer_idï¼š\n```\n| 19 (1) | \"BitTorrent protocol\" (19) | reserved_byte (8) | info_hash (20) | peer_id (20) |\n```\n**keepalive**ï¼Œç¬¬ä¸€ä¸ªå­—æ®µä¸ºæ¶ˆæ¯ä½“é•¿åº¦ï¼Œkeepalive æ¶ˆæ¯é•¿åº¦ä½“ä¸º 0ï¼š\n```\n| len (4) |\n```\n\né™¤åŸºç¡€æ¶ˆæ¯å¤–çš„å…¶ä»–æ¶ˆæ¯å‡æœ‰å›ºå®šçš„æ ¼å¼å¦‚ä¸‹ï¼šæ¶ˆæ¯ä½“é•¿åº¦ + ç±»å‹ + è´Ÿè½½ã€‚\n```\n| len (4) | type (1) | payload |\n```\nå¯èƒ½çš„ç±»å‹å€¼æœ‰ï¼š\n - 0 - choke\n - 1 - unchoke\n - 2 - interested\n - 3 - not interested\n - 4 - have\n - 5 - bitfield\n - 6 - request\n - 7 - piece\n - 8 - cancel\n - 20 - extend message\n\nå…¶ä¸­ **choke**ï¼Œ**unchoke**ï¼Œ**interested**ï¼Œ**not interested** æ¶ˆæ¯æ²¡æœ‰è´Ÿè½½ã€‚\n\n**bitfield** æ¶ˆæ¯ä»…åœ¨ handshake ååŒæ–¹å„å‘é€ä¸€æ¬¡ï¼Œæ¯ä¸ªæ¯”ç‰¹è¡¨ç¤ºå¯¹åº”çš„åˆ†ç‰‡æ˜¯å¦å®Œæ•´ã€‚\n```\n| len (4) | 5 (1) | bitfield |\n```\n\n**have** æ¶ˆæ¯çš„è´Ÿè½½æ˜¯ä¸€ä¸ªæ•´å‹æ•°å­—ï¼Œpeer åœ¨ä¸€ä¸ªåˆ†ç‰‡ä¸‹è½½å®Œæˆå¹¶æ ¡éªŒé€šè¿‡åå‘é€è¯¥é™„å¸¦åˆšä¸‹è½½å®Œæˆåˆ†ç‰‡çš„ç´¢å¼•çš„æ¶ˆæ¯ç»™å…¶ä»– peerã€‚\n```\n| len (4) | 4 (1) | index (4) |\n```\n\n**request** æ¶ˆæ¯ç»“æ„å¦‚ä¸‹ï¼Œç”¨äºè¯·æ±‚æŒ‡å®šåˆ†ç‰‡ï¼ˆindexï¼‰çš„èŒƒå›´ä¸º `[ offset, offset + length )` çš„å­—èŠ‚ï¼Œlength ä¸€èˆ¬ä¸º 2^14 (16 kiB)ï¼Œè¶…è¿‡åˆ™ä¼šå…³é—­è¿æ¥ã€‚\n```\n| len (4) | 6 (1) | index (4) | offset (4) | length (4) |\n```\n\n**piece** æ¶ˆæ¯ç”¨äºå›å¤ request æ¶ˆæ¯ï¼Œå³è¿”å›è‡ªèº«åˆ†ç‰‡ï¼ˆindexï¼‰çš„èŒƒå›´ä¸º `[ offset, offset + length )` çš„å­—èŠ‚\n```\n| len (4) | 7 (1) | index (4) | offset (4) | block (length) |\n```\n\n**cancel** æ¶ˆæ¯é™¤äº†ç±»å‹å’Œ request æ¶ˆæ¯ä¸åŒå¤–ï¼Œå…¶ä»–å‡ä¸ request ä¸€è‡´ï¼Œç”¨äºå‘ peer å–æ¶ˆä¹‹å‰å‘å‡ºçš„ request è¯·æ±‚ã€‚è¿™æ˜¯ç”±äºä¸ºäº†åŠ å¿«æœ€åè‹¥å¹²åˆ†ç‰‡çš„ä¸‹è½½é€Ÿåº¦ï¼Œå®¢æˆ·ç«¯ä¼šå¯ç”¨ **Endgame** æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œpeer ä¼šå‘æ‰€æœ‰çš„ peer è¯·æ±‚ç›¸åŒçš„åˆ†ç‰‡ç‰‡æ®µï¼Œå½“ peer ä»æŸä¸ª peer è·å¾—æ‰€éœ€çš„åˆ†ç‰‡ç‰‡æ®µåï¼Œéœ€è¦å‘å‰©ä½™çš„ peer å‘é€ cancel æ¶ˆæ¯ä»¥å‡å°‘ä¸å¿…è¦çš„ä¼ è¾“ã€‚\n```\n| len (4) | 8 (1) | index (4) | offset (4) | length (4) |\n```\n\nç±»å‹ä¸º 20 çš„æ˜¯æ‰©å±•æ¶ˆæ¯ã€‚\n\n## æ‰©å±•æ¶ˆæ¯\n[BEP10 - Extension Protocol](http://bittorrent.org/beps/bep_0010.html) ä¸­å®šä¹‰äº†æ‰©å±•æ¶ˆæ¯ã€‚peer é€šè¿‡å°† handshake æ¶ˆæ¯çš„ä¿ç•™å­—èŠ‚çš„å³æ•°ç¬¬ 20 ä¸ªæ¯”ç‰¹ç½®ä¸º 1 æ¥é€šå‘Šå…¶ä»– peer è‡ªèº«æ”¯æŒæ‰©å±•æ¶ˆæ¯ã€‚å³å¯ä»¥é€šè¿‡åˆ¤æ–­è¡¨è¾¾å¼ `reserved_byte[5] & 0x10` æ¥åˆ¤æ–­ peer æ˜¯å¦æ”¯æŒæ‰©å±•æ¶ˆæ¯ã€‚\n\næ‰©å±•æ¶ˆæ¯çš„åŸºç¡€ç»“æ„å¦‚ä¸‹ï¼Œå®é™…ä¸Šç›¸å½“äºæ˜¯ç±»å‹ä¸º 20 çš„æ™®é€šæ¶ˆæ¯ã€‚\n\n```\n| len (4) | 20 (1) | extended_messag_id (1) | payload |\n```\n\nextended_messag_id ä¸º 0 çš„æ¶ˆæ¯æ˜¯ **Extend Handshake** æ¶ˆæ¯ã€‚\n\n### Extend Handshake\n\nExtend Handshake æ¶ˆæ¯çš„æœ‰æ•ˆè½½è·æ˜¯ä¸€ä¸ª bencode å­—å…¸ã€‚å­—å…¸ä¸­çš„æ‰€æœ‰é”®éƒ½æ˜¯å¯é€‰çš„ï¼Œpeer éœ€è¦å¿½ç•¥æ‰€æœ‰è‡ªå·±ä¸æ”¯æŒçš„é”®ã€‚å¯é€‰çš„é”®ï¼ˆè¿˜å¯ä»¥æœ‰æ›´å¤šï¼‰å¦‚ä¸‹:\n\n- **m**ï¼šå­—å…¸ï¼Œè¡¨ç¤ºæ”¯æŒçš„æ‰©å±•æ¶ˆæ¯ï¼Œé”®æ˜¯æ‰©å±•æ¶ˆæ¯åç§°ï¼Œå€¼æ˜¯æ‰©å±•æ¶ˆæ¯çš„ idï¼ˆä¸ extended_messag_id å¯¹åº”ï¼‰ã€‚peer é€šè¿‡è¿™ä¸ªé”®é€šå‘Šå…¶ä»– peer è‡ªå·±æ”¯æŒçš„æ¶ˆæ¯ç±»å‹ï¼Œä¸”è¯¥ peer ä¹‹åå‘é€å…¶ä»–çš„æ‰©å±•æ¶ˆæ¯å°±ä¼šä½¿ç”¨åœ¨è¿™é‡Œå¯¹åº”çš„ extended_messag_idã€‚æ‰©å±•æ¶ˆæ¯åç§°çš„æ ¼å¼ä¸€èˆ¬ä¸º `å®¢æˆ·ç«¯ç¼©å†™_æ¶ˆæ¯åç§°`ï¼Œè¿™æ ·å¯ä»¥å®ç°å…¨ç½‘å…¨å±€æ¶ˆæ¯ç±»å‹å”¯ä¸€ï¼ˆä¾§é‡å®ç°ï¼‰ï¼›è€Œ extended_messag_id åˆ™æ˜¯è‡ªå·±å®¢æˆ·ç«¯è‡ªå·±å®šä¹‰ï¼Œåœ¨ m å­—å…¸ä¸­ä¸é‡å¤å³å¯ï¼ˆä¾§é‡ç´¢å¼•ï¼‰ï¼Œè¿™æ ·ä¾¿å¯ä»¥åšåˆ°å•å‘é€šä¿¡å”¯ä¸€ã€‚\n- **p**ï¼šæ•´å‹ï¼Œè¡¨ç¤ºæœ¬åœ°ç›‘å¬ç«¯å£ã€‚å¸®åŠ©å¦ä¸€æ–¹äº†è§£è‡ªå·±çš„ç«¯å£ä¿¡æ¯ã€‚è¿æ¥çš„æ¥æ”¶æ–¹æ˜¯ä¸éœ€è¦å‘é€è¿™ä¸ªæ‰©å±•æ¶ˆæ¯çš„ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„ç«¯å£æ˜¯å·²çŸ¥çš„ã€‚ï¼ˆå®é™…ä¸Š peer é—´é€šä¿¡æ— è®ºæ˜¯åŸºäº TCP è¿˜æ˜¯ ÂµTPï¼ˆUDPï¼‰ï¼Œæ¥æ”¶æ–¹ç†è®ºä¸Šéƒ½å¯ä»¥ä»ä¼ è¾“å±‚è·å¾—ç«¯å£æ•°æ®ï¼‰ã€‚\n- **v**ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„åç§°ä¸ç‰ˆæœ¬ï¼Œè¿™ä¸ªæ¯” peer id æ›´å¯é ä¸€äº›ã€‚\n- **yourip**ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºåœ¨ peer è§†è§’ä¸­å¯¹æ–¹ peer çš„ IPï¼Œä¸€èˆ¬å®¢æˆ·ç«¯é€šè¿‡æ­¤è·å–è‡ªå·±çš„å…¬ç½‘ IPã€‚\n- **ipv6**ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè‡ªèº«å‹ç¼©æ ¼å¼çš„ IPv6 åœ°å€ã€‚å¯èƒ½å¯¹æ–¹ peer æ›´å–œæ¬¢ä½¿ç”¨ IPv6 åœ°å€ã€‚ \n- **ipv4**ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè‡ªèº«å‹ç¼©æ ¼å¼çš„ IPv4 åœ°å€ã€‚å¯èƒ½å¯¹æ–¹ peer æ›´å–œæ¬¢ä½¿ç”¨ IPv4 åœ°å€ã€‚\n- **reqq**ï¼šæ•´å‹ï¼Œè¡¨ç¤ºè‡ªèº«çš„åœ¨ä¸ä¸¢å¼ƒæ¶ˆæ¯æƒ…å†µä¸‹å¯ä»¥ä¿ç•™çš„æœªå¤„ç†çš„æ¶ˆæ¯æ•°é‡ã€‚åœ¨ libtorrent ä¸­è¿™ä¸ªå€¼æ˜¯ 250ã€‚\n\nè¿™ä¸ªæ¶ˆæ¯éœ€è¦åœ¨æ™®é€š handshake æˆåŠŸåç«‹å³å‘é€ï¼Œåœ¨è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸå†…è¿™ä¸ª Extend Handshake å¤šæ¬¡å‘é€éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä½†å®é™…å®ç°ä¸­æœ‰å¯èƒ½è¢«å¿½ç•¥ã€‚å¦‚æœåç»­çš„ Extend Handshake æ¶ˆæ¯æŒ‡å®š m å­—å…¸ä¸­æŸäº›æ‰©å±•çš„æ‰©å±• id ä¸º 0ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨è¿™äº›æ‰©å±•ã€‚\n\n### Metadata Request(ut_metadata)\n\n[BEP9 - Extension for Peers to Send Metadata Files](http://bittorrent.org/beps/bep_0009.html) ä¸­å®šä¹‰äº†ç£åŠ›é“¾æ¥ï¼ŒåŒæ—¶ä¹Ÿå®šä¹‰äº†ç”¨äºä» Peer è·å–å…ƒæ•°æ®çš„æ‰©å±•æ¶ˆæ¯ **UT Metadata**ã€‚\n\nå¦‚æœä¸€ä¸ª peer çš„å®¢æˆ·ç«¯æ”¯æŒ **UT Metadata** æ¶ˆæ¯ï¼Œé‚£ä¹ˆåœ¨è¯¥ peer å‘å…¶ä»– peer å‘é€ Extend Handshake æ¶ˆæ¯æ—¶ï¼Œéœ€è¦åœ¨å­—å…¸ m ä¸­åŠ å…¥ **ut_metadata** è¿™ä¸ªé”®ï¼ŒåŒæ—¶ä¿æŒå…¶å¯¹åº”çš„æ¶ˆæ¯ id åœ¨ m å­—å…¸ä¸­å”¯ä¸€ã€‚ç‰¹æ®Šçš„æ˜¯å¯¹äºè¿™ä¸ªæ¶ˆæ¯çš„æ”¯æŒè¿˜éœ€è¦åœ¨ Extend Handshake æ¶ˆæ¯è´Ÿè½½å­—å…¸ä¸­åŠ å…¥ä¸€ä¸ªé”® **metadata_size**ï¼Œè¡¨ç¤ºå…ƒæ•°æ®çš„å­—èŠ‚æ•°ã€‚\n\n**UT Metadata** æ¶ˆæ¯çš„è´Ÿè½½ä¹Ÿæ˜¯ä¸€ä¸ª bencode å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š\n\n- **msg_type**ï¼šæ•´å‹ï¼Œä»£è¡¨æ¶ˆæ¯ç±»å‹ï¼Œå¯èƒ½çš„ç±»å‹æœ‰ï¼š\n    - **request**ï¼š0ã€‚è¯·æ±‚ç±»å‹ï¼Œå³è¯·æ±‚åºå·ä¸º **piece** çš„ metadata ç‰‡æ®µã€‚è¯·æ±‚ç±»å‹çš„è¿”å›ç±»å‹ä¸º **data** æˆ–è€… **reject**ï¼›\n    - **data**ï¼š1ã€‚æ­£å¸¸è¿”å›åºå·ä¸º **piece** çš„ metadata ç‰‡æ®µã€‚å…ƒæ•°æ®ä¼šæŒ‰ç…§ 16 kiB å¤§å°åˆ‡åˆ†ï¼Œé™¤äº†æœ€åä¸€ç‰‡æ®µï¼Œå…¶ä½™çš„éƒ½åº”è¯¥ä¸º 16 kiB å¤§å°ï¼Œåºå·ä¹Ÿç”±æ­¤åˆ†å‰²å¤§å°å¾—æ¥ã€‚å…ƒæ•°æ®ç‰‡æ®µä½œä¸ºè´Ÿè½½çš„ä¸€éƒ¨åˆ†è·Ÿåœ¨æ•´ä¸ªå­—å…¸åé¢ï¼Œå…¶å¹¶ä¸ä½¿ç”¨ bencode ç¼–ç ï¼Œä½†æ˜¯é•¿åº¦éœ€è¦è®¡ç®—åœ¨ **len** ä¸­ã€‚\n    - **reject**ï¼š2ã€‚è¡¨ç¤ºè¢«è¯·æ±‚çš„ peer æ²¡æœ‰åºå·ä¸º **piece** çš„ metadata ç‰‡æ®µã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€å®šæ—¶é—´å†…è¯·æ±‚è¶…è¿‡æ•°é‡é™åˆ¶ï¼Œä¸ºäº†é˜²æ­¢æ´ªæ³›æ”»å‡»ï¼Œç›´æ¥è¡¨ç¤ºæ‹’ç»ã€‚\n- **piece**ï¼šæŒ‡å®šå…ƒæ•°æ®çš„åˆ†ç‰‡åºå·ã€‚\n- **total_size**ï¼šä»…åœ¨ **data** ç±»å‹æ¶ˆæ¯ä¸­å‡ºç°ï¼Œå’Œæ¡æ‰‹æ¶ˆæ¯ä¸­çš„ **metadata_size** è¯­ä¹‰ä¸€è‡´ã€‚\n\n### Partial Seeds\nè¿™ä¸ªæ‰©å±•æ˜¯ä¸ºäº†è®© BT æ”¯æŒå¯¹ Partial Seedsï¼ˆéƒ¨åˆ†ç§å­ï¼Œ[BEP21 - Extension for partial seeds](http://bittorrent.org/beps/bep_0021.html)ï¼‰çš„è¯†åˆ«ä¸è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚éƒ¨åˆ†ç§å­å°±æ˜¯èµ„æºä¸å®Œæ•´ä½†æ˜¯ä¹Ÿä¸å†è¿›è¡Œä¸‹è½½çš„ peerã€‚è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨å¤šæ–‡ä»¶ç§å­ä¸­ï¼Œç”¨æˆ·åªè®¾å®šä¸‹è½½ä¸€éƒ¨åˆ†æ–‡ä»¶ã€‚\n\nè¿™ä¸ªæ‰©å±•ä¸å®šä¹‰é¢å¤–çš„æ‰©å±•æ¶ˆæ¯ï¼Œä½†æ˜¯åœ¨æ‰©å±•æ¡æ‰‹æ¶ˆæ¯çš„å­—å…¸ä¸­åŠ å…¥ä¸€ä¸ªé”® **upload_only**ï¼Œå€¼ä¸ºæ•´å‹ï¼Œå¦‚æœ peer å¯¹ä¸‹è½½ä¸æ„Ÿå…´è¶£åˆ™éœ€è¦è®²æ­¤å€¼ç½®ä¸º 1ã€‚\n\nåœ¨ Tracker çš„ Scrape è¯·æ±‚å›å¤ä¸­ï¼Œå®šä¹‰äº† **complete**, **incomplete** ä»¥åŠ **downloaded** ä¸‰ç§çŠ¶æ€çš„ peerã€‚ä¸ºäº†è®©å…¶ä»– peer å¯ä»¥é€šè¿‡ Tracker çŸ¥æ™“ Partial Seeds çš„æƒ…å†µï¼Œæ‰©å±•å®šä¹‰äº†åœ¨ Scrape å›å¤ä¸­åŠ å…¥ç±»å‹ **downloaders**ï¼Œè¡¨ç¤ºå¤„äºæ´»è·ƒçŠ¶æ€ï¼Œæœªå®Œæˆä¸‹è½½ä¸”ä»ç„¶éœ€è¦ç»§ç»­ä¸‹è½½çš„ peer æ•°é‡ï¼ŒPartial Seed çš„æ•°é‡å¯ä»¥é€šè¿‡ `incomplete - downloaders` å¾—åˆ°ã€‚åŒæ—¶è®© Tracker çŸ¥æ™“ peer è‡ªèº«å¤„äº Partial Seed çŠ¶æ€ï¼Œåˆ™éœ€è¦é€šè¿‡ `event=paused` äº‹ä»¶è¿›è¡Œå‘ŠçŸ¥ï¼Œä¸”æ¯æ¬¡é€šå‘Šæ—¶éƒ½è¦å‘é€è¯¥äº‹ä»¶ã€‚\n\n### Peer Exchange(ut_pex)\n\nPeer Exchange(PEX) ç”¨äºåœ¨ peer é—´äº¤æ¢ peer åˆ—è¡¨ã€‚é€šè¿‡åœ¨ Extend Handshake æ¶ˆæ¯çš„ å­—å…¸ m ä¸­åŠ å…¥ **ut_pex** è¿™ä¸ªæ¶ˆæ¯åç§°æ¥è¡¨æ˜æ”¯æŒï¼ŒåŒæ ·é“ç†ï¼Œæ¶ˆæ¯ id åœ¨ m å­—å…¸ä¸­ä¿æŒå”¯ä¸€å³å¯ã€‚\n\nPEX æ¶ˆæ¯çš„è´Ÿè½½ä¹Ÿæ˜¯ä¸€ä¸ª bencode å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š\n\n- **added**ï¼šå½“å‰è¿æ¥çš„ IPv4 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œæ·»åŠ \n- **added.f**ï¼šå½“å‰è¿æ¥çš„ IPv4 peer æ ‡å¿—ä½ï¼Œæ¯ä¸ª peer ä¸€ä¸ªå­—èŠ‚\n- **added6**ï¼šå½“å‰è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œæ·»åŠ \n- **added6.f**ï¼šå½“å‰è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨æ ‡å¿—ä½\n- **dropped**ï¼šè¿‡å»æ–­å¼€è¿æ¥çš„ IPv4 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œåˆ é™¤\n- **dropped6**ï¼šè¿‡å»æ–­å¼€è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œåˆ é™¤\n\næ ‡å¿—ä½å®šä¹‰å¦‚ä¸‹ï¼š\n\n- 0x02ï¼šå±äº seed æˆ–è€… partial seed\n- 0x04ï¼šæ”¯æŒ uTP\n- 0x01ï¼šprefers encryption, as indicated by e field in extension handshake\n- 0x08ï¼špeer indicated ut_holepunch support in extension handshake\n- 0x10ï¼šoutgoing connection, peer is reachable\n\n#### å‘é€è§„åˆ™\n\n- å¦‚æœ peer ä¸æŸäº› peer æ–­å¼€è¿æ¥ï¼Œåˆ™éœ€è¦éœ€è¦åœ¨é€‚å½“æ—¶å€™å‘é€ PEX æ¶ˆæ¯ï¼Œå°†æ–­å¼€è¿æ¥çš„ peer æ”¾åœ¨ dropped ä¸­ï¼›\n- æ¯åˆ†é’Ÿå‘é€çš„ PEX æ¶ˆæ¯ä¸èƒ½è¶…è¿‡ä¸€æ¡ï¼›\n- ä¸éœ€è¦åœ¨æ¡æ‰‹åç«‹å³å‘é€ PEX æ¶ˆæ¯ï¼Œåœ¨æ”¶é›†æ»¡ä¸€å®šçš„ peer ä¹‹åå†å‘é€æ•ˆæœæ›´å¥½ï¼›\n- æ·»åŠ æˆ–åˆ é™¤çš„ peer åˆ—è¡¨ä¸­ä¸èƒ½åŒ…æ‹¬é‡å¤é¡¹ï¼Œä¹Ÿä¸èƒ½åœ¨åŒä¸€ä¸ª PEX æ¶ˆæ¯ä¸­åˆ é™¤æ·»åŠ çš„ peerï¼›\n- é™¤äº†æœ€åˆçš„ PEX æ¶ˆæ¯ä¹‹å¤–ï¼Œæ¯æ¡æ¶ˆæ¯ä¸­æ·»åŠ çš„ peer æ•°é‡æˆ–è€… åˆ é™¤çš„ peer æ•°é‡å‡ä¸èƒ½è¶…è¿‡ 50 æ¡ï¼›\n- added, added6, dropped, dropped6 å››ä¸ªé”®ä¸­è‡³å°‘éœ€è¦æœ‰ä¸€ä¸ªï¼›\n- peer å¯èƒ½ä¼šä¸ä¸¥é‡è¿åè¿™äº›è§„åˆ™çš„ peer æ–­å¼€è¿æ¥ï¼›\n\n#### æ‰©å…… seed\næ¯ä¸ª peer ä¼šæ‰§è¡Œå¦‚ä¸‹çš„æ‰§è¡Œä¸€äº›è§„åˆ™æ¥æ–­å¼€ä¸éƒ¨åˆ† peer çš„è¿æ¥ã€‚æ¯”å¦‚\n1. åœ¨ä½œç§çš„æ—¶å€™ä¼šæ–­å¼€ä¸ seed å’Œ partial seed çš„è¿æ¥ï¼›\n2. æ ¹æ® peer id æ–­å¼€ IPv4 ä»¥åŠ IPv6 åœ°å€å®é™…ä¸Šå±äºåŒä¸€ä¸ª peer çš„ä¸€ä¸ªè¿æ¥ï¼Œä¿ç•™è‡ªå·±åçˆ±çš„åœ°å€å®¶æ—è¿æ¥ï¼›\n\nè¿™æ ·çš„ç­–ç•¥ä¸‹ï¼Œåœ¨ seed å ä¸»å¯¼åœ°ä½çš„ swarm ä¸­é€šè¿‡ PEX ä¼ æ’­çš„æ´»è·ƒ peer ä¼šä¸è¶³ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨ IPv4 å ä¸»å¯¼çš„ swarm ä¸­ï¼Œåªæ”¯æŒ IPv6 çš„ peer å°†å¾ˆéš¾è·å¾— IPv6 çš„ peerã€‚è¿™å¾ˆå¤§ç¨‹åº¦é™ä½äº† PEX æ¶ˆæ¯çš„æœ‰æ•ˆæ€§ã€‚\n\nä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¦‚æœä¸€ä¸ª peer è¿æ¥åˆ°ä¸€ä¸ªç‰¹å®šåœ°å€å®¶æ—çš„ peer å°‘äº25ä¸ªï¼Œæ´»è·ƒåº¦çš„è¦æ±‚å°±ä¼šæ”¾å®½ã€‚å› ä¸ºä¸€ä¸‹åŸå› å¯¼è‡´è¿æ¥æ–­å¼€çš„ peer ä¹Ÿä¼šè¢«ä¿å­˜ä¸‹æ¥ï¼Œå¹¶æœ‰èµ„æ ¼è¢«å‘åœ¨ PEX æ¶ˆæ¯çš„ added ä¸­ï¼š\n1. å› ä¸º peer id ç›¸åŒè€Œè¢«æ–­å¼€çš„å¦ä¸€ä¸ªåœ°å€å®¶æ—çš„è¿æ¥ï¼›\n2. å› ç¼ºä¹å…´è¶£è€Œæ–­å¼€è¿æ¥çš„ peerï¼Œæ¯”å¦‚å¯¹æ–¹æ˜¯ seed/partial seed æˆ–è€…å¯¹æ–¹æ‹¥æœ‰çš„åˆ†ç‰‡ä¸æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ï¼›\n3. å› ä¸ºè¶…è¿‡æœ¬åœ°èµ„æºé™åˆ¶è€Œæ–­å¼€çš„è¿æ¥ï¼Œæ¯”å¦‚å…¨å±€çš„è¿æ¥ä¸Šé™ï¼›\n\nä¸ºäº†ä¿è¯ peer çš„æœ‰æ•ˆæ€§ï¼Œå› ä¸ºè¿™äº›åŸå› æ·»åŠ åˆ° added ä¸­çš„ peer åªèƒ½é€šè¿‡ PEX æ¶ˆæ¯å‘é€ä¸€æ¬¡ï¼Œå‘é€å®Œåå¿…é¡»ä»ç­‰å¾…å‘é€åˆ—è¡¨ä¸­åˆ é™¤ã€‚\n\n#### å®‰å…¨æ€§\né€šè¿‡ PEX è·å¾—çš„ peer åº”è¯¥è§†ä¸ºä¸å¯ä¿¡çš„ã€‚æ”»å‡»è€…å¯èƒ½é€šå¤šä¼ªé€  PEX æ¶ˆæ¯æ¥æ”»å‡»è¿™ä¸ª swarmã€‚æ”»å‡»è€…ä¹Ÿå¯èƒ½é€šè¿‡ PEX æ¶ˆæ¯è¯±å¯¼ BT å®¢æˆ·ç«¯å¯¹ç‰¹å®š IP è¿›è¡Œå°è¯•è¿æ¥è€Œå¼•å‘ DDoS æ”»å‡»ã€‚\n\nä¸ºäº†ç¼“è§£è¿™äº›é—®é¢˜ï¼Œpeer åº”è¯¥é¿å…ä»å•ä¸ª PEX æºè·å–å…¶æ‰€æœ‰è¿æ¥ä½œä¸ºå€™é€‰è¿æ¥ã€‚åº”å¿½ç•¥å…·æœ‰ä¸åŒçš„ç«¯å£çš„é‡å¤ IPï¼Œè¿˜å¯ä»¥æ ¹æ® peer çš„ä¼˜å…ˆçº§æ¥è¿›è¡Œï¼ˆåè®®æ¦‚è¿°ä¸­æåˆ°ï¼‰æ’åºã€‚\n\n## å¿«é€Ÿæ‰©å±•ï¼ˆFast Extensionï¼‰\n\nå¦å¤–è¿˜æœ‰ç±»ä¼¼æ‰©å±•æ¶ˆæ¯çš„å¿«é€Ÿæ‰©å±•æ¶ˆæ¯ï¼Œé€šè¿‡å°†æ¡æ‰‹æ¶ˆæ¯çš„ `reserved_byte[7] |= 0x04` æ¥é€šå‘Šæ”¯æŒå¿«é€Ÿæ‰©å±•ï¼Œè¿™é‡Œåªåˆ—å‡ºå¿«é€Ÿæ‰©å±•æ¶ˆæ¯çš„ç§ç±»ï¼Œå…·ä½“åè®®æ ¼å¼å¯å‚è§ [BEP06 - Fast Extension](http://bittorrent.org/beps/bep_0006.html)ã€‚\n\n- **Have All/Have None**ï¼šæ¥è¡¨ç¤ºæ‹¥æœ‰æ‰€æœ‰åˆ†ç‰‡æˆ–è€…æœªæ‹¥æœ‰ä»»ä½•åˆ†ç‰‡ï¼Œæ˜¯ **bitfield** æ¶ˆæ¯çš„å¿«é€Ÿç‰ˆæœ¬ï¼›\n- **Suggest Piece**ï¼šå»ºè®®å…¶ä»– peer ä¸‹è½½æŸåˆ†ç‰‡ï¼›\n- **Reject Request**ï¼šæ‹’ç» peer å¯¹æŸä¸ªç‰‡æ®µçš„è¯·æ±‚ï¼›\n- **Allowed Fast**ï¼šè¡¨ç¤ºå¦‚æœ peer è¯·æ±‚è¿™ä¸ªåˆ†ç‰‡ï¼Œå³ä½¿å®ƒå¤„äº choked çŠ¶æ€ä¹Ÿä¼šç»™å®ƒï¼›\n- **lt Dont Have**ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚èµ„æºçŸ­ç¼ºï¼ŒLRU Cache è¿‡æœŸï¼‰ä¼šå¯¼è‡´ peer ä¸å†æ‹¥æœ‰æŸä¸ªç‰‡æ®µï¼Œåˆ™å¯ä»¥é€šè¿‡æ­¤æ¶ˆæ¯å‘ŠçŸ¥å…¶ä»– peerï¼Œè¯¥æ‰©å±•å®šä¹‰åœ¨ [BEP54 - The lt_donthave extension](http://bittorrent.org/beps/bep_0054.html) ä¸­ï¼›\n\n\n## åˆ†ç‰‡é€‰æ‹©ç­–ç•¥\né€‰æ‹©ä¸€ä¸ªå¥½çš„åˆ†ç‰‡ä¸‹è½½é¡ºåºä¸å¦å¯¹ä¸‹è½½æ€§èƒ½æœ‰è¿™å¾ˆå¤§å½±å“ã€‚å¦‚æœé€‰æ‹©äº†ä¸€ä¸ªå·®çš„åˆ†ç‰‡ä¸‹è½½é€‰æ‹©ç®—æ³•ï¼Œåˆ™æŸä¸€æ—¶åˆ»å¯èƒ½æ‰€æœ‰åˆ†ç‰‡ä½ éƒ½å¯ä»¥ä¸‹è½½ï¼Œä½†æ˜¯ä¹‹åå°±æ²¡æœ‰ä½ æƒ³ä¸‹è½½çš„åˆ†ç‰‡äº†ã€‚BT ä¸­æ‰§è¡Œä¸€ä¸‹ç­–ç•¥ï¼š\n\n### Strict Priorityï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰\nä¸€æ—¦è¯·æ±‚äº†æŸä¸ªåˆ†ç‰‡çš„å­ç‰‡æ®µï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¯·æ±‚å…¶ä»–å­ç‰‡æ®µä¹‹å‰è¯·æ±‚è¯¥ç‰¹å®šåˆ†ç‰‡çš„å‰©ä½™å­ç‰‡æ®µï¼Œä»¥å°½é‡ä¼˜å…ˆè·å¾—è¿™ä¸ªå®Œæ•´çš„åˆ†ç‰‡ã€‚\n\n### Rarest Firstï¼ˆç¨€æœ‰ä¼˜å…ˆï¼‰\nåœ¨é€‰æ‹©æ¥ä¸‹æ¥ä¸‹è½½å“ªä¸ªåˆ†ç‰‡æ—¶ï¼Œpeer ä¼šé€‰æ‹©æœ€ç¨€æœ‰çš„åˆ†ç‰‡ï¼ˆè‡ªå·±æ²¡æœ‰è¿™ä¸ªåˆ†ç‰‡ï¼ŒåŒæ—¶å…¶ä»– peer æœ‰ï¼Œä½†æ˜¯æœ‰è¿™ä¸ªåˆ†ç‰‡çš„ peer æ•°é‡ç›¸å¯¹å…¶ä»–åˆ†ç‰‡æœ€å°‘ï¼‰è¿›è¡Œä¸‹è½½ã€‚è¿™ä¸ªç®—æ³•ä¿è¯äº†ä¸ç¨€æœ‰çš„åˆ†ç‰‡åœ¨ä¹‹åä»ç„¶èƒ½è¢«ä¸‹è½½åˆ°ï¼ŒåŒæ—¶ç¨€æœ‰çš„åˆ†ç‰‡åœ¨é€æ¸å˜å¤šã€‚é€šè¿‡å°½å¿«å¤åˆ¶æœ€ç¨€æœ‰çš„åˆ†ç‰‡ï¼Œå‡å°äº†ç¨€æœ‰åˆ†ç‰‡åœ¨å½“å‰è¿æ¥çš„ peer ä¸­å®Œå…¨æ¶ˆå¤±çš„å¯èƒ½æ€§ã€‚\n\n### Random First Pieceï¼ˆéšæœºé¦–åˆ†ç‰‡ï¼‰\nå½“ä¸‹è½½å¼€å§‹æ—¶ï¼Œä¸ä¼šä½¿ç”¨ç¨€æœ‰ä¼˜å…ˆç®—æ³•ã€‚å¼€å§‹æ—¶ peer æ²¡æœ‰åˆ†ç‰‡å¯ä»¥ç”¨äºä¸Šä¼ ï¼Œæ‰€ä»¥æœ€é‡è¦çš„æ˜¯å°½å¿«å¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„åˆ†ç‰‡ã€‚ç¨€æœ‰çš„åˆ†ç‰‡å¾€å¾€åªè¢«æŸä¸€ä¸ª peer æ‹¥æœ‰ï¼Œä»è¿™ä¸ª peer å¤„ä¸‹è½½è¿™ä¸ªåˆ†ç‰‡ï¼ˆåˆ†æˆå¤šä¸ªå­ç‰‡æ®µï¼‰å°†ä¼šæ…¢äºä»å¤šä¸ª peer å¤„ä¸‹è½½ç›¸åŒåˆ†ç‰‡çš„ä¸åŒå­ç‰‡æ®µã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåˆšå¼€å§‹ä¸‹è½½æ—¶ï¼Œä¼šéšæœºé€‰æ‹©ä¸€ä¸ªåˆ†ç‰‡è¿›è¡Œä¸‹è½½ï¼Œéšåç­–ç•¥è½¬ä¸ºç¨€æœ‰ä¼˜å…ˆã€‚\n\n### Endgame Mode\næœ‰æ—¶ä»ä¸€ä¸ª peer è¯·æ±‚æŸä¸ªåˆ†ç‰‡ä¼šå¾ˆæ…¢ï¼Œè¿™åœ¨ä¸‹è½½æ•´ä¸ªèµ„æºä½ çš„ä¸­é€”ä¸ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼ˆå› ä¸ºä¸­é€”åŒæ—¶å‘ç”Ÿä¸å°‘è¯·æ±‚ï¼‰ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µå¯èƒ½ä¼šå½±å“æœ€ç»ˆçš„å³å°†ä¸‹è½½å®Œæˆé˜¶æ®µã€‚å½“æ‰€æœ‰å‰©ä½™çš„å­ç‰‡æ®µéƒ½å·²ç»åœ¨å‘å…¶ä»– peer è¯·æ±‚æ—¶ï¼Œå®ƒä¼šåŒæ—¶å‘æ‰€æœ‰çš„ peer è¯·æ±‚è¿™äº›å­ç‰‡æ®µã€‚å½“æŸä¸€ä¸ª peer è¿”å›äº†ä¸€ä¸ªå­ç‰‡æ®µï¼Œå°±å‘å‰©ä½™çš„ peer å‘é€ cancel æ¶ˆæ¯ä»¥èŠ‚çº¦å¸¦å®½ã€‚åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼ŒEndgame æ¨¡å¼æŒç»­æ—¶é—´éå¸¸çŸ­ï¼Œæ‰€ä»¥æµªè´¹çš„å¸¦å®½ä¸å¤šï¼Œè€Œä¸”ä½¿å¾—èµ„æºçš„æœ€åä¸€éƒ¨åˆ†ä¸‹è½½éå¸¸å¿«ã€‚\n\n## Choking ç®—æ³•\nBT æ²¡æœ‰ä¸­å¿ƒåŒ–çš„èµ„æºåˆ†é…ï¼Œæ¯ä¸ª peer æœ‰è´£ä»»å»æœ€å¤§åŒ–è‡ªå·±çš„ä¸‹è½½é€Ÿç‡ã€‚Peer æ‰§è¡Œä¸€ç§å˜ç§ tit-fot-tat ç­–ç•¥ï¼Œä»ä¸è‡ªå·±ç›¸è¿çš„ peer å¤„ä¸‹è½½åˆ†ç‰‡ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ peer è¿›è¡Œä¸Šä¼ ï¼Œå¯¹å…¶ä»– peer è¿›è¡Œ chokeã€‚choke è¡¨ç°ä¸ºæ‹’ç»ä¸Šä¼ ï¼Œä½†ä¸‹è½½ä»å¯ç»§ç»­ï¼ŒåŒæ—¶è¿æ¥è¢«ä¿æŒä¸é”€æ¯ï¼Œåœ¨ choke ç»“æŸåè¿æ¥ä¸éœ€è¦é‡å»ºã€‚Choking ç®—æ³•å¯¹äº BT æ¥è¯´ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å¦‚æœéœ€è¦æœ‰ä¸€ä¸ªå¥½çš„ä¸‹è½½æ€§èƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚ä¸€ä¸ªå¥½çš„ choking ç®—æ³•éœ€è¦åˆ©ç”¨å¥½æ‰€æœ‰çš„èµ„æºï¼Œæä¾›å¥½çš„ä¸Šä¼ ç»™å…¶ä»– peerï¼ŒåŒæ—¶æƒ©ç½šé‚£äº›åªä¸‹è½½ä¸ä¸Šä¼ çš„ peerã€‚\n\nBT ä¸­ä½¿ç”¨çš„å˜ç§ tit-fot-tat ç­–ç•¥æ˜¯å›šå¾’å›°å¢ƒçš„åº”ç”¨ï¼Œåšä¸» youxu çš„æ–‡ç«  [P2På®¢æˆ·ç«¯çš„ç­–ç•¥å’Œå¥‡å¦™çš„å¯¹ç­–è®º](https://blog.youxu.info/2008/12/31/tit-for-tac-and-p2p-software/) å¯¹è¿™æ­¤æœ‰ç€å¾ˆé€šä¿—æ˜“æ‡‚çš„è§£é‡Šã€‚\n\nå¯¹äºæŸä¸ª peer çš„ Choking ç®—æ³• å¯ä»¥æè¿°å¦‚ä¸‹ï¼š \n1. **Choking Algorithm**ï¼šæ¯ T æ—¶é—´é€‰æ‹©åˆé€‚çš„ k ä¸ª peer è¿›è¡Œ unchokeï¼Œé€‰æ‹©çš„æ ‡å‡†ä¸ºè¿‡å» S æ—¶é—´ peer çš„ä¸‹è½½é€Ÿç‡ï¼›\n2. **Optimistic Unchoking**ï¼šæ¯ nT æ—¶é—´ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª peer è¿›è¡Œ unchokeï¼Œä»¥å°è¯•å‘ç°æ›´ä¼˜è´¨çš„ peerï¼›\n3. **Anti-snubbing**ï¼šå¦‚æœ mT æ—¶é—´å†…æ²¡æœ‰ä»æŸä¸ª peer å¤„è·å–åˆ°ä¸€ä¸ªåˆ†ç‰‡ï¼Œåˆ™è®¤ä¸ºè¢« **snubbed** äº†ï¼Œå¯¹å…¶è¿›è¡Œ chokeï¼›\n4. **Upload Only**ï¼šå½“ä¸€ä¸ª peer ä¸‹è½½å®Œæˆäº†ï¼Œå³æˆä¸ºäº†ä¸€ä¸ª seedï¼Œåˆ™åªè¿›è¡Œä¸Šä¼ ï¼Œä¸å†ä¸‹è½½ã€‚peer ä¼šé€‰æ‹©é‚£äº›è¯¥ peer å¯¹å…¶æœ‰è¾ƒé«˜ä¸Šä¼ é€Ÿç‡çš„ peer è¿›è¡Œä¸Šä¼ ã€‚\n\nå®é™…å®ç°ä¸­ T = 10s, k = 7, S = 20s, n = 3, m = 6ã€‚\n\n\n## å‚è€ƒèµ„æ–™\n1. [Question About Canonical Peer Priority](https://forum.utorrent.com/topic/90069-question-about-canonical-peer-priority/)","slug":"bt-peer","published":1,"updated":"2020-07-18T06:30:19.514Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuhe0006w80vx7k2g6iq","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>æœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» Peer ä»¥åŠ Peer é—´çš„é€šä¿¡ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡ <a href=\"/2018/08/26/bt-overview/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\">BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°</a>ã€‚</p>\n<h2 id=\"Peer-æ¥æº\"><a href=\"#Peer-æ¥æº\" class=\"headerlink\" title=\"Peer æ¥æº\"></a>Peer æ¥æº</h2><p>åœ¨è®² Peer é—´çš„é€šä¿¡å‰ï¼Œå…ˆæ€»ç»“ä¸€ä¸‹ Peer çš„æ¥æºã€‚</p>\n<ol>\n<li><strong>Magnet</strong>ï¼šç£åŠ›è¿æ¥ä¸­æœ‰ <strong>x.pe</strong> å‚æ•°å¯ä»¥é¢„è®¾ä¸€äº› Peerï¼›</li>\n<li><strong>Tracker</strong>ï¼šTracker æœåŠ¡å™¨çš„ä½œç”¨å°±æ˜¯æä¾› Peerï¼›</li>\n<li><strong>Local Service Discovery</strong>ï¼ˆ<a href=\"http://bittorrent.org/beps/bep_0014.html\" target=\"_blank\" rel=\"noopener\">BEP14</a>ï¼‰:é€šè¿‡å¯¹æœ¬åœ°ç»„æ’­åœ°å€ <code>239.192.152.143:6771</code> å’Œ <code>[ff15::efc0:988f]:6771</code> å‘å‡º info_hash å®£å‘Šæ¥å°è¯•è·å¾—å“åº”ï¼Œå¦‚æœæœ‰å“åº”ï¼Œåˆ™æ·»åŠ ä¸º Peerï¼›</li>\n<li><strong>Peer Exchange</strong>ï¼šé€šè¿‡ Peer é—´çš„ <strong>Peer Exchange</strong> æ‰©å±•æ¶ˆæ¯æ¥ä¸å…¶ä»– Peer äº¤æ¢ Peerï¼Œåé¢ä¼šè¯¦ç»†æåˆ°ï¼›</li>\n<li><strong>DHT</strong>ï¼šé€šè¿‡ DHT ç½‘ç»œè·å–ï¼›</li>\n</ol>\n<h2 id=\"åè®®æ¦‚è¿°\"><a href=\"#åè®®æ¦‚è¿°\" class=\"headerlink\" title=\"åè®®æ¦‚è¿°\"></a>åè®®æ¦‚è¿°</h2><p>Peer é—´çš„é€šä¿¡å±äºåº”ç”¨å±‚åè®®ï¼Œå®ƒä½¿ç”¨çš„åº”ç”¨å±‚åè®®å¯ä»¥æ˜¯ TCP æˆ–è€… ÂµTPã€‚</p>\n<p>Peer é—´æŒ‰ç…§å…ƒæ•°æ®ä¸­æè¿°çš„æ–‡ä»¶ç‰‡æ®µç´¢å¼•ï¼ˆèµ·å§‹ç´¢å¼•ä¸º 0ï¼‰è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œå½“ä¸€ä¸ª peer ä¸‹è½½å®Œæˆä¸€ä¸ªåˆ†ç‰‡è€Œä¸”ç»è¿‡äº†é€šè¿‡äº† hash å€¼çš„æ ¡éªŒï¼Œå®ƒä¼šé€šçŸ¥å®ƒçš„æ‰€æœ‰ peer è‡ªå·±æ‹¥æœ‰äº†è¿™ä¸ªç‰‡æ®µã€‚</p>\n<p>Peer è¿æ¥çš„ Peer ä¼šæœ‰ä¸€å®šä¸Šé™æ•°é‡ï¼Œæ‰€æœ‰çš„ Peer æŒ‰ç…§ <a href=\"http://bittorrent.org/beps/bep_0040.html\" target=\"_blank\" rel=\"noopener\">BEP40 - Canonical Peer Priority</a> ä¸­å®šä¹‰çš„åŸºäºåŒæ–¹ IP çš„ crc32-c å€¼çš„ç®—æ³•è¿›è¡Œæ’åºï¼Œé€‰æ‹©è¿™ä¸ªå€¼æ›´å°çš„è‹¥å¹² Peer è¿›è¡Œè¿æ¥ã€‚</p>\n<p>æ¯ä¸ªè¿æ¥ä¼šåŒ…å«ä¸¤ä¸ªçŠ¶æ€ä½ï¼Œchoked or notï¼ˆè¡¨ç¤ºæ˜¯å¦å¯¹å¯¹æ–¹ chokedï¼‰ï¼Œinterested or notï¼ˆè¡¨ç¤ºæ˜¯å¦å¯¹å¯¹æ–¹çš„æ•°æ®æ„Ÿå…´è¶£ï¼‰ï¼ŒçŠ¶æ€åœ¨è¿æ¥å»ºç«‹æ—¶çš„åˆå§‹å€¼ä¸º choked ä»¥åŠ not interestedã€‚å› ä¸ºäº¤äº’æ˜¯åŒæ–¹çš„ï¼Œä¸€æ–¹ä¸ä»…è¦å­˜å‚¨è‡ªå·±ç»™å¯¹æ–¹è®¾å®šçš„çŠ¶æ€ï¼Œä¹Ÿè¦å­˜å‚¨å¯¹æ–¹ç»™è‡ªå·±è®¾å®šçš„çŠ¶æ€ï¼Œå› æ­¤å®é™…ä¸Šä¼šæœ‰å››ä¸ªçŠ¶æ€ä½ï¼ˆBEP ä¸­è¡¨ç¤ºåªæœ‰ä¸¤ä¸ªçŠ¶æ€ä½ï¼Œä½†æ˜¯ç”±äºä¸»åŠ¨ä¸è¢«åŠ¨è¯­æ€çš„å¤æ‚æ€§ä»¥åŠè€ƒè™‘åˆ°å®é™…æºç çš„å®ç°ï¼Œè¿™é‡Œå¼•å…¥æˆå››ä¸ªçŠ¶æ€ä½ï¼Œå¢åŠ äº†ä¸€å®šçš„å†—ä½™ï¼Œä½†ä¾¿äºå†™ä½œï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¾¿äºç†è§£ï¼‰ã€‚</p>\n<p>å‡è®¾ Aï¼ŒB æ˜¯åœ¨ä¸‹è½½åŒä¸€ä¸ªèµ„æºçš„å¯¹ç­‰ä½“ã€‚ç”¨ A.B è¡¨ç¤º peer A ä¸­ A ä¸ B çš„è¿æ¥ã€‚æ‰€ä»¥ A ä¸ B è¿æ¥å»ºç«‹æ—¶ï¼Œåœ¨ A çš„å†…å­˜ç©ºé—´ä¸­çš„ä¿å­˜çš„å¯¹äº B çš„è¿æ¥ä¼šæœ‰å¦‚ä¸‹çš„çŠ¶æ€ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">choked = <span class=\"literal\">true</span>;</span><br><span class=\"line\">interested = <span class=\"literal\">false</span>;</span><br><span class=\"line\">peer_choked = <span class=\"literal\">true</span>;</span><br><span class=\"line\">peer_interested = <span class=\"literal\">false</span>;</span><br></pre></td></tr></table></figure>\n\n<p>åŒæ ·é“ç†ï¼ŒB ä¸­ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„è¿™æ ·å››ä¸ªçŠ¶æ€ã€‚ä¸”åˆå§‹çŠ¶æ€ç›¸åŒã€‚åªæœ‰å½“ A çš„ <code>interested == true</code> è€Œä¸” <code>peer_choked == false</code> æ—¶ï¼ŒA æ‰èƒ½å‘ B ç´¢è¦æ•°æ®ã€‚</p>\n<p>å¯¹äº A è€Œè¨€ï¼Œæœ‰ä¸‹é¢å››ä¸ªæ—¶æœºæ›´æ–°è¿™ä¸€ç»„çŠ¶æ€ï¼š</p>\n<ul>\n<li>åœ¨æ”¶åˆ° B å‘æ¥çš„ <strong>choke</strong>/<strong>unchoke</strong> æ¶ˆæ¯æ—¶ï¼Œä¼šæ›´æ–° <code>peer_choked</code> çŠ¶æ€ç½®ä¸º true/falseï¼›</li>\n<li>åœ¨æ”¶åˆ° B å‘æ¥çš„ <strong>interested</strong>ï¼Œ<strong>not interested</strong> æ¶ˆæ¯æ—¶ï¼Œä¼šæ›´æ–° <code>peer_interested</code> çŠ¶æ€ç½®ä¸º true/falseï¼›</li>\n<li>ä¸æ–­æ ¹æ®è‡ªå·±æ‰€æ‹¥æœ‰çš„åˆ†ç‰‡ä¸ B æ‹¥æœ‰åˆ†ç‰‡çš„çŠ¶æ€ï¼ˆB é€šè¿‡ <strong>bitfield</strong> æ¶ˆæ¯å‘ŠçŸ¥ Aï¼‰æ›´æ–° <code>interested</code> çŠ¶æ€ï¼Œå¹¶é€šè¿‡å‘é€ <strong>interested</strong>/<strong>not interested</strong> æ¶ˆæ¯ç»™ Bï¼›</li>\n</ul>\n<h2 id=\"æ¶ˆæ¯ç±»å‹\"><a href=\"#æ¶ˆæ¯ç±»å‹\" class=\"headerlink\" title=\"æ¶ˆæ¯ç±»å‹\"></a>æ¶ˆæ¯ç±»å‹</h2><p><strong>handshake</strong> æ˜¯è¿æ¥ peer é—´è¿æ¥å»ºç«‹åå‘é€çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼Œä¸»è¦ç”¨äºé€šå‘Š info_hash ä¸ peer_idï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| 19 (1) | &quot;BitTorrent protocol&quot; (19) | reserved_byte (8) | info_hash (20) | peer_id (20) |</span><br></pre></td></tr></table></figure>\n\n<p><strong>keepalive</strong>ï¼Œç¬¬ä¸€ä¸ªå­—æ®µä¸ºæ¶ˆæ¯ä½“é•¿åº¦ï¼Œkeepalive æ¶ˆæ¯é•¿åº¦ä½“ä¸º 0ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) |</span><br></pre></td></tr></table></figure>\n\n<p>é™¤åŸºç¡€æ¶ˆæ¯å¤–çš„å…¶ä»–æ¶ˆæ¯å‡æœ‰å›ºå®šçš„æ ¼å¼å¦‚ä¸‹ï¼šæ¶ˆæ¯ä½“é•¿åº¦ + ç±»å‹ + è´Ÿè½½ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | type (1) | payload |</span><br></pre></td></tr></table></figure>\n\n<p>å¯èƒ½çš„ç±»å‹å€¼æœ‰ï¼š</p>\n<ul>\n<li>0 - choke</li>\n<li>1 - unchoke</li>\n<li>2 - interested</li>\n<li>3 - not interested</li>\n<li>4 - have</li>\n<li>5 - bitfield</li>\n<li>6 - request</li>\n<li>7 - piece</li>\n<li>8 - cancel</li>\n<li>20 - extend message</li>\n</ul>\n<p>å…¶ä¸­ <strong>choke</strong>ï¼Œ<strong>unchoke</strong>ï¼Œ<strong>interested</strong>ï¼Œ<strong>not interested</strong> æ¶ˆæ¯æ²¡æœ‰è´Ÿè½½ã€‚</p>\n<p><strong>bitfield</strong> æ¶ˆæ¯ä»…åœ¨ handshake ååŒæ–¹å„å‘é€ä¸€æ¬¡ï¼Œæ¯ä¸ªæ¯”ç‰¹è¡¨ç¤ºå¯¹åº”çš„åˆ†ç‰‡æ˜¯å¦å®Œæ•´ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 5 (1) | bitfield |</span><br></pre></td></tr></table></figure>\n\n<p><strong>have</strong> æ¶ˆæ¯çš„è´Ÿè½½æ˜¯ä¸€ä¸ªæ•´å‹æ•°å­—ï¼Œpeer åœ¨ä¸€ä¸ªåˆ†ç‰‡ä¸‹è½½å®Œæˆå¹¶æ ¡éªŒé€šè¿‡åå‘é€è¯¥é™„å¸¦åˆšä¸‹è½½å®Œæˆåˆ†ç‰‡çš„ç´¢å¼•çš„æ¶ˆæ¯ç»™å…¶ä»– peerã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 4 (1) | index (4) |</span><br></pre></td></tr></table></figure>\n\n<p><strong>request</strong> æ¶ˆæ¯ç»“æ„å¦‚ä¸‹ï¼Œç”¨äºè¯·æ±‚æŒ‡å®šåˆ†ç‰‡ï¼ˆindexï¼‰çš„èŒƒå›´ä¸º <code>[ offset, offset + length )</code> çš„å­—èŠ‚ï¼Œlength ä¸€èˆ¬ä¸º 2^14 (16 kiB)ï¼Œè¶…è¿‡åˆ™ä¼šå…³é—­è¿æ¥ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 6 (1) | index (4) | offset (4) | length (4) |</span><br></pre></td></tr></table></figure>\n\n<p><strong>piece</strong> æ¶ˆæ¯ç”¨äºå›å¤ request æ¶ˆæ¯ï¼Œå³è¿”å›è‡ªèº«åˆ†ç‰‡ï¼ˆindexï¼‰çš„èŒƒå›´ä¸º <code>[ offset, offset + length )</code> çš„å­—èŠ‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 7 (1) | index (4) | offset (4) | block (length) |</span><br></pre></td></tr></table></figure>\n\n<p><strong>cancel</strong> æ¶ˆæ¯é™¤äº†ç±»å‹å’Œ request æ¶ˆæ¯ä¸åŒå¤–ï¼Œå…¶ä»–å‡ä¸ request ä¸€è‡´ï¼Œç”¨äºå‘ peer å–æ¶ˆä¹‹å‰å‘å‡ºçš„ request è¯·æ±‚ã€‚è¿™æ˜¯ç”±äºä¸ºäº†åŠ å¿«æœ€åè‹¥å¹²åˆ†ç‰‡çš„ä¸‹è½½é€Ÿåº¦ï¼Œå®¢æˆ·ç«¯ä¼šå¯ç”¨ <strong>Endgame</strong> æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œpeer ä¼šå‘æ‰€æœ‰çš„ peer è¯·æ±‚ç›¸åŒçš„åˆ†ç‰‡ç‰‡æ®µï¼Œå½“ peer ä»æŸä¸ª peer è·å¾—æ‰€éœ€çš„åˆ†ç‰‡ç‰‡æ®µåï¼Œéœ€è¦å‘å‰©ä½™çš„ peer å‘é€ cancel æ¶ˆæ¯ä»¥å‡å°‘ä¸å¿…è¦çš„ä¼ è¾“ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 8 (1) | index (4) | offset (4) | length (4) |</span><br></pre></td></tr></table></figure>\n\n<p>ç±»å‹ä¸º 20 çš„æ˜¯æ‰©å±•æ¶ˆæ¯ã€‚</p>\n<h2 id=\"æ‰©å±•æ¶ˆæ¯\"><a href=\"#æ‰©å±•æ¶ˆæ¯\" class=\"headerlink\" title=\"æ‰©å±•æ¶ˆæ¯\"></a>æ‰©å±•æ¶ˆæ¯</h2><p><a href=\"http://bittorrent.org/beps/bep_0010.html\" target=\"_blank\" rel=\"noopener\">BEP10 - Extension Protocol</a> ä¸­å®šä¹‰äº†æ‰©å±•æ¶ˆæ¯ã€‚peer é€šè¿‡å°† handshake æ¶ˆæ¯çš„ä¿ç•™å­—èŠ‚çš„å³æ•°ç¬¬ 20 ä¸ªæ¯”ç‰¹ç½®ä¸º 1 æ¥é€šå‘Šå…¶ä»– peer è‡ªèº«æ”¯æŒæ‰©å±•æ¶ˆæ¯ã€‚å³å¯ä»¥é€šè¿‡åˆ¤æ–­è¡¨è¾¾å¼ <code>reserved_byte[5] &amp; 0x10</code> æ¥åˆ¤æ–­ peer æ˜¯å¦æ”¯æŒæ‰©å±•æ¶ˆæ¯ã€‚</p>\n<p>æ‰©å±•æ¶ˆæ¯çš„åŸºç¡€ç»“æ„å¦‚ä¸‹ï¼Œå®é™…ä¸Šç›¸å½“äºæ˜¯ç±»å‹ä¸º 20 çš„æ™®é€šæ¶ˆæ¯ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 20 (1) | extended_messag_id (1) | payload |</span><br></pre></td></tr></table></figure>\n\n<p>extended_messag_id ä¸º 0 çš„æ¶ˆæ¯æ˜¯ <strong>Extend Handshake</strong> æ¶ˆæ¯ã€‚</p>\n<h3 id=\"Extend-Handshake\"><a href=\"#Extend-Handshake\" class=\"headerlink\" title=\"Extend Handshake\"></a>Extend Handshake</h3><p>Extend Handshake æ¶ˆæ¯çš„æœ‰æ•ˆè½½è·æ˜¯ä¸€ä¸ª bencode å­—å…¸ã€‚å­—å…¸ä¸­çš„æ‰€æœ‰é”®éƒ½æ˜¯å¯é€‰çš„ï¼Œpeer éœ€è¦å¿½ç•¥æ‰€æœ‰è‡ªå·±ä¸æ”¯æŒçš„é”®ã€‚å¯é€‰çš„é”®ï¼ˆè¿˜å¯ä»¥æœ‰æ›´å¤šï¼‰å¦‚ä¸‹:</p>\n<ul>\n<li><strong>m</strong>ï¼šå­—å…¸ï¼Œè¡¨ç¤ºæ”¯æŒçš„æ‰©å±•æ¶ˆæ¯ï¼Œé”®æ˜¯æ‰©å±•æ¶ˆæ¯åç§°ï¼Œå€¼æ˜¯æ‰©å±•æ¶ˆæ¯çš„ idï¼ˆä¸ extended_messag_id å¯¹åº”ï¼‰ã€‚peer é€šè¿‡è¿™ä¸ªé”®é€šå‘Šå…¶ä»– peer è‡ªå·±æ”¯æŒçš„æ¶ˆæ¯ç±»å‹ï¼Œä¸”è¯¥ peer ä¹‹åå‘é€å…¶ä»–çš„æ‰©å±•æ¶ˆæ¯å°±ä¼šä½¿ç”¨åœ¨è¿™é‡Œå¯¹åº”çš„ extended_messag_idã€‚æ‰©å±•æ¶ˆæ¯åç§°çš„æ ¼å¼ä¸€èˆ¬ä¸º <code>å®¢æˆ·ç«¯ç¼©å†™_æ¶ˆæ¯åç§°</code>ï¼Œè¿™æ ·å¯ä»¥å®ç°å…¨ç½‘å…¨å±€æ¶ˆæ¯ç±»å‹å”¯ä¸€ï¼ˆä¾§é‡å®ç°ï¼‰ï¼›è€Œ extended_messag_id åˆ™æ˜¯è‡ªå·±å®¢æˆ·ç«¯è‡ªå·±å®šä¹‰ï¼Œåœ¨ m å­—å…¸ä¸­ä¸é‡å¤å³å¯ï¼ˆä¾§é‡ç´¢å¼•ï¼‰ï¼Œè¿™æ ·ä¾¿å¯ä»¥åšåˆ°å•å‘é€šä¿¡å”¯ä¸€ã€‚</li>\n<li><strong>p</strong>ï¼šæ•´å‹ï¼Œè¡¨ç¤ºæœ¬åœ°ç›‘å¬ç«¯å£ã€‚å¸®åŠ©å¦ä¸€æ–¹äº†è§£è‡ªå·±çš„ç«¯å£ä¿¡æ¯ã€‚è¿æ¥çš„æ¥æ”¶æ–¹æ˜¯ä¸éœ€è¦å‘é€è¿™ä¸ªæ‰©å±•æ¶ˆæ¯çš„ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„ç«¯å£æ˜¯å·²çŸ¥çš„ã€‚ï¼ˆå®é™…ä¸Š peer é—´é€šä¿¡æ— è®ºæ˜¯åŸºäº TCP è¿˜æ˜¯ ÂµTPï¼ˆUDPï¼‰ï¼Œæ¥æ”¶æ–¹ç†è®ºä¸Šéƒ½å¯ä»¥ä»ä¼ è¾“å±‚è·å¾—ç«¯å£æ•°æ®ï¼‰ã€‚</li>\n<li><strong>v</strong>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„åç§°ä¸ç‰ˆæœ¬ï¼Œè¿™ä¸ªæ¯” peer id æ›´å¯é ä¸€äº›ã€‚</li>\n<li><strong>yourip</strong>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºåœ¨ peer è§†è§’ä¸­å¯¹æ–¹ peer çš„ IPï¼Œä¸€èˆ¬å®¢æˆ·ç«¯é€šè¿‡æ­¤è·å–è‡ªå·±çš„å…¬ç½‘ IPã€‚</li>\n<li><strong>ipv6</strong>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè‡ªèº«å‹ç¼©æ ¼å¼çš„ IPv6 åœ°å€ã€‚å¯èƒ½å¯¹æ–¹ peer æ›´å–œæ¬¢ä½¿ç”¨ IPv6 åœ°å€ã€‚ </li>\n<li><strong>ipv4</strong>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè‡ªèº«å‹ç¼©æ ¼å¼çš„ IPv4 åœ°å€ã€‚å¯èƒ½å¯¹æ–¹ peer æ›´å–œæ¬¢ä½¿ç”¨ IPv4 åœ°å€ã€‚</li>\n<li><strong>reqq</strong>ï¼šæ•´å‹ï¼Œè¡¨ç¤ºè‡ªèº«çš„åœ¨ä¸ä¸¢å¼ƒæ¶ˆæ¯æƒ…å†µä¸‹å¯ä»¥ä¿ç•™çš„æœªå¤„ç†çš„æ¶ˆæ¯æ•°é‡ã€‚åœ¨ libtorrent ä¸­è¿™ä¸ªå€¼æ˜¯ 250ã€‚</li>\n</ul>\n<p>è¿™ä¸ªæ¶ˆæ¯éœ€è¦åœ¨æ™®é€š handshake æˆåŠŸåç«‹å³å‘é€ï¼Œåœ¨è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸå†…è¿™ä¸ª Extend Handshake å¤šæ¬¡å‘é€éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä½†å®é™…å®ç°ä¸­æœ‰å¯èƒ½è¢«å¿½ç•¥ã€‚å¦‚æœåç»­çš„ Extend Handshake æ¶ˆæ¯æŒ‡å®š m å­—å…¸ä¸­æŸäº›æ‰©å±•çš„æ‰©å±• id ä¸º 0ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨è¿™äº›æ‰©å±•ã€‚</p>\n<h3 id=\"Metadata-Request-ut-metadata\"><a href=\"#Metadata-Request-ut-metadata\" class=\"headerlink\" title=\"Metadata Request(ut_metadata)\"></a>Metadata Request(ut_metadata)</h3><p><a href=\"http://bittorrent.org/beps/bep_0009.html\" target=\"_blank\" rel=\"noopener\">BEP9 - Extension for Peers to Send Metadata Files</a> ä¸­å®šä¹‰äº†ç£åŠ›é“¾æ¥ï¼ŒåŒæ—¶ä¹Ÿå®šä¹‰äº†ç”¨äºä» Peer è·å–å…ƒæ•°æ®çš„æ‰©å±•æ¶ˆæ¯ <strong>UT Metadata</strong>ã€‚</p>\n<p>å¦‚æœä¸€ä¸ª peer çš„å®¢æˆ·ç«¯æ”¯æŒ <strong>UT Metadata</strong> æ¶ˆæ¯ï¼Œé‚£ä¹ˆåœ¨è¯¥ peer å‘å…¶ä»– peer å‘é€ Extend Handshake æ¶ˆæ¯æ—¶ï¼Œéœ€è¦åœ¨å­—å…¸ m ä¸­åŠ å…¥ <strong>ut_metadata</strong> è¿™ä¸ªé”®ï¼ŒåŒæ—¶ä¿æŒå…¶å¯¹åº”çš„æ¶ˆæ¯ id åœ¨ m å­—å…¸ä¸­å”¯ä¸€ã€‚ç‰¹æ®Šçš„æ˜¯å¯¹äºè¿™ä¸ªæ¶ˆæ¯çš„æ”¯æŒè¿˜éœ€è¦åœ¨ Extend Handshake æ¶ˆæ¯è´Ÿè½½å­—å…¸ä¸­åŠ å…¥ä¸€ä¸ªé”® <strong>metadata_size</strong>ï¼Œè¡¨ç¤ºå…ƒæ•°æ®çš„å­—èŠ‚æ•°ã€‚</p>\n<p><strong>UT Metadata</strong> æ¶ˆæ¯çš„è´Ÿè½½ä¹Ÿæ˜¯ä¸€ä¸ª bencode å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š</p>\n<ul>\n<li><strong>msg_type</strong>ï¼šæ•´å‹ï¼Œä»£è¡¨æ¶ˆæ¯ç±»å‹ï¼Œå¯èƒ½çš„ç±»å‹æœ‰ï¼š<ul>\n<li><strong>request</strong>ï¼š0ã€‚è¯·æ±‚ç±»å‹ï¼Œå³è¯·æ±‚åºå·ä¸º <strong>piece</strong> çš„ metadata ç‰‡æ®µã€‚è¯·æ±‚ç±»å‹çš„è¿”å›ç±»å‹ä¸º <strong>data</strong> æˆ–è€… <strong>reject</strong>ï¼›</li>\n<li><strong>data</strong>ï¼š1ã€‚æ­£å¸¸è¿”å›åºå·ä¸º <strong>piece</strong> çš„ metadata ç‰‡æ®µã€‚å…ƒæ•°æ®ä¼šæŒ‰ç…§ 16 kiB å¤§å°åˆ‡åˆ†ï¼Œé™¤äº†æœ€åä¸€ç‰‡æ®µï¼Œå…¶ä½™çš„éƒ½åº”è¯¥ä¸º 16 kiB å¤§å°ï¼Œåºå·ä¹Ÿç”±æ­¤åˆ†å‰²å¤§å°å¾—æ¥ã€‚å…ƒæ•°æ®ç‰‡æ®µä½œä¸ºè´Ÿè½½çš„ä¸€éƒ¨åˆ†è·Ÿåœ¨æ•´ä¸ªå­—å…¸åé¢ï¼Œå…¶å¹¶ä¸ä½¿ç”¨ bencode ç¼–ç ï¼Œä½†æ˜¯é•¿åº¦éœ€è¦è®¡ç®—åœ¨ <strong>len</strong> ä¸­ã€‚</li>\n<li><strong>reject</strong>ï¼š2ã€‚è¡¨ç¤ºè¢«è¯·æ±‚çš„ peer æ²¡æœ‰åºå·ä¸º <strong>piece</strong> çš„ metadata ç‰‡æ®µã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€å®šæ—¶é—´å†…è¯·æ±‚è¶…è¿‡æ•°é‡é™åˆ¶ï¼Œä¸ºäº†é˜²æ­¢æ´ªæ³›æ”»å‡»ï¼Œç›´æ¥è¡¨ç¤ºæ‹’ç»ã€‚</li>\n</ul>\n</li>\n<li><strong>piece</strong>ï¼šæŒ‡å®šå…ƒæ•°æ®çš„åˆ†ç‰‡åºå·ã€‚</li>\n<li><strong>total_size</strong>ï¼šä»…åœ¨ <strong>data</strong> ç±»å‹æ¶ˆæ¯ä¸­å‡ºç°ï¼Œå’Œæ¡æ‰‹æ¶ˆæ¯ä¸­çš„ <strong>metadata_size</strong> è¯­ä¹‰ä¸€è‡´ã€‚</li>\n</ul>\n<h3 id=\"Partial-Seeds\"><a href=\"#Partial-Seeds\" class=\"headerlink\" title=\"Partial Seeds\"></a>Partial Seeds</h3><p>è¿™ä¸ªæ‰©å±•æ˜¯ä¸ºäº†è®© BT æ”¯æŒå¯¹ Partial Seedsï¼ˆéƒ¨åˆ†ç§å­ï¼Œ<a href=\"http://bittorrent.org/beps/bep_0021.html\" target=\"_blank\" rel=\"noopener\">BEP21 - Extension for partial seeds</a>ï¼‰çš„è¯†åˆ«ä¸è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚éƒ¨åˆ†ç§å­å°±æ˜¯èµ„æºä¸å®Œæ•´ä½†æ˜¯ä¹Ÿä¸å†è¿›è¡Œä¸‹è½½çš„ peerã€‚è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨å¤šæ–‡ä»¶ç§å­ä¸­ï¼Œç”¨æˆ·åªè®¾å®šä¸‹è½½ä¸€éƒ¨åˆ†æ–‡ä»¶ã€‚</p>\n<p>è¿™ä¸ªæ‰©å±•ä¸å®šä¹‰é¢å¤–çš„æ‰©å±•æ¶ˆæ¯ï¼Œä½†æ˜¯åœ¨æ‰©å±•æ¡æ‰‹æ¶ˆæ¯çš„å­—å…¸ä¸­åŠ å…¥ä¸€ä¸ªé”® <strong>upload_only</strong>ï¼Œå€¼ä¸ºæ•´å‹ï¼Œå¦‚æœ peer å¯¹ä¸‹è½½ä¸æ„Ÿå…´è¶£åˆ™éœ€è¦è®²æ­¤å€¼ç½®ä¸º 1ã€‚</p>\n<p>åœ¨ Tracker çš„ Scrape è¯·æ±‚å›å¤ä¸­ï¼Œå®šä¹‰äº† <strong>complete</strong>, <strong>incomplete</strong> ä»¥åŠ <strong>downloaded</strong> ä¸‰ç§çŠ¶æ€çš„ peerã€‚ä¸ºäº†è®©å…¶ä»– peer å¯ä»¥é€šè¿‡ Tracker çŸ¥æ™“ Partial Seeds çš„æƒ…å†µï¼Œæ‰©å±•å®šä¹‰äº†åœ¨ Scrape å›å¤ä¸­åŠ å…¥ç±»å‹ <strong>downloaders</strong>ï¼Œè¡¨ç¤ºå¤„äºæ´»è·ƒçŠ¶æ€ï¼Œæœªå®Œæˆä¸‹è½½ä¸”ä»ç„¶éœ€è¦ç»§ç»­ä¸‹è½½çš„ peer æ•°é‡ï¼ŒPartial Seed çš„æ•°é‡å¯ä»¥é€šè¿‡ <code>incomplete - downloaders</code> å¾—åˆ°ã€‚åŒæ—¶è®© Tracker çŸ¥æ™“ peer è‡ªèº«å¤„äº Partial Seed çŠ¶æ€ï¼Œåˆ™éœ€è¦é€šè¿‡ <code>event=paused</code> äº‹ä»¶è¿›è¡Œå‘ŠçŸ¥ï¼Œä¸”æ¯æ¬¡é€šå‘Šæ—¶éƒ½è¦å‘é€è¯¥äº‹ä»¶ã€‚</p>\n<h3 id=\"Peer-Exchange-ut-pex\"><a href=\"#Peer-Exchange-ut-pex\" class=\"headerlink\" title=\"Peer Exchange(ut_pex)\"></a>Peer Exchange(ut_pex)</h3><p>Peer Exchange(PEX) ç”¨äºåœ¨ peer é—´äº¤æ¢ peer åˆ—è¡¨ã€‚é€šè¿‡åœ¨ Extend Handshake æ¶ˆæ¯çš„ å­—å…¸ m ä¸­åŠ å…¥ <strong>ut_pex</strong> è¿™ä¸ªæ¶ˆæ¯åç§°æ¥è¡¨æ˜æ”¯æŒï¼ŒåŒæ ·é“ç†ï¼Œæ¶ˆæ¯ id åœ¨ m å­—å…¸ä¸­ä¿æŒå”¯ä¸€å³å¯ã€‚</p>\n<p>PEX æ¶ˆæ¯çš„è´Ÿè½½ä¹Ÿæ˜¯ä¸€ä¸ª bencode å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š</p>\n<ul>\n<li><strong>added</strong>ï¼šå½“å‰è¿æ¥çš„ IPv4 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œæ·»åŠ </li>\n<li><strong>added.f</strong>ï¼šå½“å‰è¿æ¥çš„ IPv4 peer æ ‡å¿—ä½ï¼Œæ¯ä¸ª peer ä¸€ä¸ªå­—èŠ‚</li>\n<li><strong>added6</strong>ï¼šå½“å‰è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œæ·»åŠ </li>\n<li><strong>added6.f</strong>ï¼šå½“å‰è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨æ ‡å¿—ä½</li>\n<li><strong>dropped</strong>ï¼šè¿‡å»æ–­å¼€è¿æ¥çš„ IPv4 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œåˆ é™¤</li>\n<li><strong>dropped6</strong>ï¼šè¿‡å»æ–­å¼€è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œåˆ é™¤</li>\n</ul>\n<p>æ ‡å¿—ä½å®šä¹‰å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>0x02ï¼šå±äº seed æˆ–è€… partial seed</li>\n<li>0x04ï¼šæ”¯æŒ uTP</li>\n<li>0x01ï¼šprefers encryption, as indicated by e field in extension handshake</li>\n<li>0x08ï¼špeer indicated ut_holepunch support in extension handshake</li>\n<li>0x10ï¼šoutgoing connection, peer is reachable</li>\n</ul>\n<h4 id=\"å‘é€è§„åˆ™\"><a href=\"#å‘é€è§„åˆ™\" class=\"headerlink\" title=\"å‘é€è§„åˆ™\"></a>å‘é€è§„åˆ™</h4><ul>\n<li>å¦‚æœ peer ä¸æŸäº› peer æ–­å¼€è¿æ¥ï¼Œåˆ™éœ€è¦éœ€è¦åœ¨é€‚å½“æ—¶å€™å‘é€ PEX æ¶ˆæ¯ï¼Œå°†æ–­å¼€è¿æ¥çš„ peer æ”¾åœ¨ dropped ä¸­ï¼›</li>\n<li>æ¯åˆ†é’Ÿå‘é€çš„ PEX æ¶ˆæ¯ä¸èƒ½è¶…è¿‡ä¸€æ¡ï¼›</li>\n<li>ä¸éœ€è¦åœ¨æ¡æ‰‹åç«‹å³å‘é€ PEX æ¶ˆæ¯ï¼Œåœ¨æ”¶é›†æ»¡ä¸€å®šçš„ peer ä¹‹åå†å‘é€æ•ˆæœæ›´å¥½ï¼›</li>\n<li>æ·»åŠ æˆ–åˆ é™¤çš„ peer åˆ—è¡¨ä¸­ä¸èƒ½åŒ…æ‹¬é‡å¤é¡¹ï¼Œä¹Ÿä¸èƒ½åœ¨åŒä¸€ä¸ª PEX æ¶ˆæ¯ä¸­åˆ é™¤æ·»åŠ çš„ peerï¼›</li>\n<li>é™¤äº†æœ€åˆçš„ PEX æ¶ˆæ¯ä¹‹å¤–ï¼Œæ¯æ¡æ¶ˆæ¯ä¸­æ·»åŠ çš„ peer æ•°é‡æˆ–è€… åˆ é™¤çš„ peer æ•°é‡å‡ä¸èƒ½è¶…è¿‡ 50 æ¡ï¼›</li>\n<li>added, added6, dropped, dropped6 å››ä¸ªé”®ä¸­è‡³å°‘éœ€è¦æœ‰ä¸€ä¸ªï¼›</li>\n<li>peer å¯èƒ½ä¼šä¸ä¸¥é‡è¿åè¿™äº›è§„åˆ™çš„ peer æ–­å¼€è¿æ¥ï¼›</li>\n</ul>\n<h4 id=\"æ‰©å……-seed\"><a href=\"#æ‰©å……-seed\" class=\"headerlink\" title=\"æ‰©å…… seed\"></a>æ‰©å…… seed</h4><p>æ¯ä¸ª peer ä¼šæ‰§è¡Œå¦‚ä¸‹çš„æ‰§è¡Œä¸€äº›è§„åˆ™æ¥æ–­å¼€ä¸éƒ¨åˆ† peer çš„è¿æ¥ã€‚æ¯”å¦‚</p>\n<ol>\n<li>åœ¨ä½œç§çš„æ—¶å€™ä¼šæ–­å¼€ä¸ seed å’Œ partial seed çš„è¿æ¥ï¼›</li>\n<li>æ ¹æ® peer id æ–­å¼€ IPv4 ä»¥åŠ IPv6 åœ°å€å®é™…ä¸Šå±äºåŒä¸€ä¸ª peer çš„ä¸€ä¸ªè¿æ¥ï¼Œä¿ç•™è‡ªå·±åçˆ±çš„åœ°å€å®¶æ—è¿æ¥ï¼›</li>\n</ol>\n<p>è¿™æ ·çš„ç­–ç•¥ä¸‹ï¼Œåœ¨ seed å ä¸»å¯¼åœ°ä½çš„ swarm ä¸­é€šè¿‡ PEX ä¼ æ’­çš„æ´»è·ƒ peer ä¼šä¸è¶³ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨ IPv4 å ä¸»å¯¼çš„ swarm ä¸­ï¼Œåªæ”¯æŒ IPv6 çš„ peer å°†å¾ˆéš¾è·å¾— IPv6 çš„ peerã€‚è¿™å¾ˆå¤§ç¨‹åº¦é™ä½äº† PEX æ¶ˆæ¯çš„æœ‰æ•ˆæ€§ã€‚</p>\n<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¦‚æœä¸€ä¸ª peer è¿æ¥åˆ°ä¸€ä¸ªç‰¹å®šåœ°å€å®¶æ—çš„ peer å°‘äº25ä¸ªï¼Œæ´»è·ƒåº¦çš„è¦æ±‚å°±ä¼šæ”¾å®½ã€‚å› ä¸ºä¸€ä¸‹åŸå› å¯¼è‡´è¿æ¥æ–­å¼€çš„ peer ä¹Ÿä¼šè¢«ä¿å­˜ä¸‹æ¥ï¼Œå¹¶æœ‰èµ„æ ¼è¢«å‘åœ¨ PEX æ¶ˆæ¯çš„ added ä¸­ï¼š</p>\n<ol>\n<li>å› ä¸º peer id ç›¸åŒè€Œè¢«æ–­å¼€çš„å¦ä¸€ä¸ªåœ°å€å®¶æ—çš„è¿æ¥ï¼›</li>\n<li>å› ç¼ºä¹å…´è¶£è€Œæ–­å¼€è¿æ¥çš„ peerï¼Œæ¯”å¦‚å¯¹æ–¹æ˜¯ seed/partial seed æˆ–è€…å¯¹æ–¹æ‹¥æœ‰çš„åˆ†ç‰‡ä¸æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ï¼›</li>\n<li>å› ä¸ºè¶…è¿‡æœ¬åœ°èµ„æºé™åˆ¶è€Œæ–­å¼€çš„è¿æ¥ï¼Œæ¯”å¦‚å…¨å±€çš„è¿æ¥ä¸Šé™ï¼›</li>\n</ol>\n<p>ä¸ºäº†ä¿è¯ peer çš„æœ‰æ•ˆæ€§ï¼Œå› ä¸ºè¿™äº›åŸå› æ·»åŠ åˆ° added ä¸­çš„ peer åªèƒ½é€šè¿‡ PEX æ¶ˆæ¯å‘é€ä¸€æ¬¡ï¼Œå‘é€å®Œåå¿…é¡»ä»ç­‰å¾…å‘é€åˆ—è¡¨ä¸­åˆ é™¤ã€‚</p>\n<h4 id=\"å®‰å…¨æ€§\"><a href=\"#å®‰å…¨æ€§\" class=\"headerlink\" title=\"å®‰å…¨æ€§\"></a>å®‰å…¨æ€§</h4><p>é€šè¿‡ PEX è·å¾—çš„ peer åº”è¯¥è§†ä¸ºä¸å¯ä¿¡çš„ã€‚æ”»å‡»è€…å¯èƒ½é€šå¤šä¼ªé€  PEX æ¶ˆæ¯æ¥æ”»å‡»è¿™ä¸ª swarmã€‚æ”»å‡»è€…ä¹Ÿå¯èƒ½é€šè¿‡ PEX æ¶ˆæ¯è¯±å¯¼ BT å®¢æˆ·ç«¯å¯¹ç‰¹å®š IP è¿›è¡Œå°è¯•è¿æ¥è€Œå¼•å‘ DDoS æ”»å‡»ã€‚</p>\n<p>ä¸ºäº†ç¼“è§£è¿™äº›é—®é¢˜ï¼Œpeer åº”è¯¥é¿å…ä»å•ä¸ª PEX æºè·å–å…¶æ‰€æœ‰è¿æ¥ä½œä¸ºå€™é€‰è¿æ¥ã€‚åº”å¿½ç•¥å…·æœ‰ä¸åŒçš„ç«¯å£çš„é‡å¤ IPï¼Œè¿˜å¯ä»¥æ ¹æ® peer çš„ä¼˜å…ˆçº§æ¥è¿›è¡Œï¼ˆåè®®æ¦‚è¿°ä¸­æåˆ°ï¼‰æ’åºã€‚</p>\n<h2 id=\"å¿«é€Ÿæ‰©å±•ï¼ˆFast-Extensionï¼‰\"><a href=\"#å¿«é€Ÿæ‰©å±•ï¼ˆFast-Extensionï¼‰\" class=\"headerlink\" title=\"å¿«é€Ÿæ‰©å±•ï¼ˆFast Extensionï¼‰\"></a>å¿«é€Ÿæ‰©å±•ï¼ˆFast Extensionï¼‰</h2><p>å¦å¤–è¿˜æœ‰ç±»ä¼¼æ‰©å±•æ¶ˆæ¯çš„å¿«é€Ÿæ‰©å±•æ¶ˆæ¯ï¼Œé€šè¿‡å°†æ¡æ‰‹æ¶ˆæ¯çš„ <code>reserved_byte[7] |= 0x04</code> æ¥é€šå‘Šæ”¯æŒå¿«é€Ÿæ‰©å±•ï¼Œè¿™é‡Œåªåˆ—å‡ºå¿«é€Ÿæ‰©å±•æ¶ˆæ¯çš„ç§ç±»ï¼Œå…·ä½“åè®®æ ¼å¼å¯å‚è§ <a href=\"http://bittorrent.org/beps/bep_0006.html\" target=\"_blank\" rel=\"noopener\">BEP06 - Fast Extension</a>ã€‚</p>\n<ul>\n<li><strong>Have All/Have None</strong>ï¼šæ¥è¡¨ç¤ºæ‹¥æœ‰æ‰€æœ‰åˆ†ç‰‡æˆ–è€…æœªæ‹¥æœ‰ä»»ä½•åˆ†ç‰‡ï¼Œæ˜¯ <strong>bitfield</strong> æ¶ˆæ¯çš„å¿«é€Ÿç‰ˆæœ¬ï¼›</li>\n<li><strong>Suggest Piece</strong>ï¼šå»ºè®®å…¶ä»– peer ä¸‹è½½æŸåˆ†ç‰‡ï¼›</li>\n<li><strong>Reject Request</strong>ï¼šæ‹’ç» peer å¯¹æŸä¸ªç‰‡æ®µçš„è¯·æ±‚ï¼›</li>\n<li><strong>Allowed Fast</strong>ï¼šè¡¨ç¤ºå¦‚æœ peer è¯·æ±‚è¿™ä¸ªåˆ†ç‰‡ï¼Œå³ä½¿å®ƒå¤„äº choked çŠ¶æ€ä¹Ÿä¼šç»™å®ƒï¼›</li>\n<li><strong>lt Dont Have</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚èµ„æºçŸ­ç¼ºï¼ŒLRU Cache è¿‡æœŸï¼‰ä¼šå¯¼è‡´ peer ä¸å†æ‹¥æœ‰æŸä¸ªç‰‡æ®µï¼Œåˆ™å¯ä»¥é€šè¿‡æ­¤æ¶ˆæ¯å‘ŠçŸ¥å…¶ä»– peerï¼Œè¯¥æ‰©å±•å®šä¹‰åœ¨ <a href=\"http://bittorrent.org/beps/bep_0054.html\" target=\"_blank\" rel=\"noopener\">BEP54 - The lt_donthave extension</a> ä¸­ï¼›</li>\n</ul>\n<h2 id=\"åˆ†ç‰‡é€‰æ‹©ç­–ç•¥\"><a href=\"#åˆ†ç‰‡é€‰æ‹©ç­–ç•¥\" class=\"headerlink\" title=\"åˆ†ç‰‡é€‰æ‹©ç­–ç•¥\"></a>åˆ†ç‰‡é€‰æ‹©ç­–ç•¥</h2><p>é€‰æ‹©ä¸€ä¸ªå¥½çš„åˆ†ç‰‡ä¸‹è½½é¡ºåºä¸å¦å¯¹ä¸‹è½½æ€§èƒ½æœ‰è¿™å¾ˆå¤§å½±å“ã€‚å¦‚æœé€‰æ‹©äº†ä¸€ä¸ªå·®çš„åˆ†ç‰‡ä¸‹è½½é€‰æ‹©ç®—æ³•ï¼Œåˆ™æŸä¸€æ—¶åˆ»å¯èƒ½æ‰€æœ‰åˆ†ç‰‡ä½ éƒ½å¯ä»¥ä¸‹è½½ï¼Œä½†æ˜¯ä¹‹åå°±æ²¡æœ‰ä½ æƒ³ä¸‹è½½çš„åˆ†ç‰‡äº†ã€‚BT ä¸­æ‰§è¡Œä¸€ä¸‹ç­–ç•¥ï¼š</p>\n<h3 id=\"Strict-Priorityï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰\"><a href=\"#Strict-Priorityï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰\" class=\"headerlink\" title=\"Strict Priorityï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰\"></a>Strict Priorityï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰</h3><p>ä¸€æ—¦è¯·æ±‚äº†æŸä¸ªåˆ†ç‰‡çš„å­ç‰‡æ®µï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¯·æ±‚å…¶ä»–å­ç‰‡æ®µä¹‹å‰è¯·æ±‚è¯¥ç‰¹å®šåˆ†ç‰‡çš„å‰©ä½™å­ç‰‡æ®µï¼Œä»¥å°½é‡ä¼˜å…ˆè·å¾—è¿™ä¸ªå®Œæ•´çš„åˆ†ç‰‡ã€‚</p>\n<h3 id=\"Rarest-Firstï¼ˆç¨€æœ‰ä¼˜å…ˆï¼‰\"><a href=\"#Rarest-Firstï¼ˆç¨€æœ‰ä¼˜å…ˆï¼‰\" class=\"headerlink\" title=\"Rarest Firstï¼ˆç¨€æœ‰ä¼˜å…ˆï¼‰\"></a>Rarest Firstï¼ˆç¨€æœ‰ä¼˜å…ˆï¼‰</h3><p>åœ¨é€‰æ‹©æ¥ä¸‹æ¥ä¸‹è½½å“ªä¸ªåˆ†ç‰‡æ—¶ï¼Œpeer ä¼šé€‰æ‹©æœ€ç¨€æœ‰çš„åˆ†ç‰‡ï¼ˆè‡ªå·±æ²¡æœ‰è¿™ä¸ªåˆ†ç‰‡ï¼ŒåŒæ—¶å…¶ä»– peer æœ‰ï¼Œä½†æ˜¯æœ‰è¿™ä¸ªåˆ†ç‰‡çš„ peer æ•°é‡ç›¸å¯¹å…¶ä»–åˆ†ç‰‡æœ€å°‘ï¼‰è¿›è¡Œä¸‹è½½ã€‚è¿™ä¸ªç®—æ³•ä¿è¯äº†ä¸ç¨€æœ‰çš„åˆ†ç‰‡åœ¨ä¹‹åä»ç„¶èƒ½è¢«ä¸‹è½½åˆ°ï¼ŒåŒæ—¶ç¨€æœ‰çš„åˆ†ç‰‡åœ¨é€æ¸å˜å¤šã€‚é€šè¿‡å°½å¿«å¤åˆ¶æœ€ç¨€æœ‰çš„åˆ†ç‰‡ï¼Œå‡å°äº†ç¨€æœ‰åˆ†ç‰‡åœ¨å½“å‰è¿æ¥çš„ peer ä¸­å®Œå…¨æ¶ˆå¤±çš„å¯èƒ½æ€§ã€‚</p>\n<h3 id=\"Random-First-Pieceï¼ˆéšæœºé¦–åˆ†ç‰‡ï¼‰\"><a href=\"#Random-First-Pieceï¼ˆéšæœºé¦–åˆ†ç‰‡ï¼‰\" class=\"headerlink\" title=\"Random First Pieceï¼ˆéšæœºé¦–åˆ†ç‰‡ï¼‰\"></a>Random First Pieceï¼ˆéšæœºé¦–åˆ†ç‰‡ï¼‰</h3><p>å½“ä¸‹è½½å¼€å§‹æ—¶ï¼Œä¸ä¼šä½¿ç”¨ç¨€æœ‰ä¼˜å…ˆç®—æ³•ã€‚å¼€å§‹æ—¶ peer æ²¡æœ‰åˆ†ç‰‡å¯ä»¥ç”¨äºä¸Šä¼ ï¼Œæ‰€ä»¥æœ€é‡è¦çš„æ˜¯å°½å¿«å¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„åˆ†ç‰‡ã€‚ç¨€æœ‰çš„åˆ†ç‰‡å¾€å¾€åªè¢«æŸä¸€ä¸ª peer æ‹¥æœ‰ï¼Œä»è¿™ä¸ª peer å¤„ä¸‹è½½è¿™ä¸ªåˆ†ç‰‡ï¼ˆåˆ†æˆå¤šä¸ªå­ç‰‡æ®µï¼‰å°†ä¼šæ…¢äºä»å¤šä¸ª peer å¤„ä¸‹è½½ç›¸åŒåˆ†ç‰‡çš„ä¸åŒå­ç‰‡æ®µã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåˆšå¼€å§‹ä¸‹è½½æ—¶ï¼Œä¼šéšæœºé€‰æ‹©ä¸€ä¸ªåˆ†ç‰‡è¿›è¡Œä¸‹è½½ï¼Œéšåç­–ç•¥è½¬ä¸ºç¨€æœ‰ä¼˜å…ˆã€‚</p>\n<h3 id=\"Endgame-Mode\"><a href=\"#Endgame-Mode\" class=\"headerlink\" title=\"Endgame Mode\"></a>Endgame Mode</h3><p>æœ‰æ—¶ä»ä¸€ä¸ª peer è¯·æ±‚æŸä¸ªåˆ†ç‰‡ä¼šå¾ˆæ…¢ï¼Œè¿™åœ¨ä¸‹è½½æ•´ä¸ªèµ„æºä½ çš„ä¸­é€”ä¸ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼ˆå› ä¸ºä¸­é€”åŒæ—¶å‘ç”Ÿä¸å°‘è¯·æ±‚ï¼‰ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µå¯èƒ½ä¼šå½±å“æœ€ç»ˆçš„å³å°†ä¸‹è½½å®Œæˆé˜¶æ®µã€‚å½“æ‰€æœ‰å‰©ä½™çš„å­ç‰‡æ®µéƒ½å·²ç»åœ¨å‘å…¶ä»– peer è¯·æ±‚æ—¶ï¼Œå®ƒä¼šåŒæ—¶å‘æ‰€æœ‰çš„ peer è¯·æ±‚è¿™äº›å­ç‰‡æ®µã€‚å½“æŸä¸€ä¸ª peer è¿”å›äº†ä¸€ä¸ªå­ç‰‡æ®µï¼Œå°±å‘å‰©ä½™çš„ peer å‘é€ cancel æ¶ˆæ¯ä»¥èŠ‚çº¦å¸¦å®½ã€‚åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼ŒEndgame æ¨¡å¼æŒç»­æ—¶é—´éå¸¸çŸ­ï¼Œæ‰€ä»¥æµªè´¹çš„å¸¦å®½ä¸å¤šï¼Œè€Œä¸”ä½¿å¾—èµ„æºçš„æœ€åä¸€éƒ¨åˆ†ä¸‹è½½éå¸¸å¿«ã€‚</p>\n<h2 id=\"Choking-ç®—æ³•\"><a href=\"#Choking-ç®—æ³•\" class=\"headerlink\" title=\"Choking ç®—æ³•\"></a>Choking ç®—æ³•</h2><p>BT æ²¡æœ‰ä¸­å¿ƒåŒ–çš„èµ„æºåˆ†é…ï¼Œæ¯ä¸ª peer æœ‰è´£ä»»å»æœ€å¤§åŒ–è‡ªå·±çš„ä¸‹è½½é€Ÿç‡ã€‚Peer æ‰§è¡Œä¸€ç§å˜ç§ tit-fot-tat ç­–ç•¥ï¼Œä»ä¸è‡ªå·±ç›¸è¿çš„ peer å¤„ä¸‹è½½åˆ†ç‰‡ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ peer è¿›è¡Œä¸Šä¼ ï¼Œå¯¹å…¶ä»– peer è¿›è¡Œ chokeã€‚choke è¡¨ç°ä¸ºæ‹’ç»ä¸Šä¼ ï¼Œä½†ä¸‹è½½ä»å¯ç»§ç»­ï¼ŒåŒæ—¶è¿æ¥è¢«ä¿æŒä¸é”€æ¯ï¼Œåœ¨ choke ç»“æŸåè¿æ¥ä¸éœ€è¦é‡å»ºã€‚Choking ç®—æ³•å¯¹äº BT æ¥è¯´ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å¦‚æœéœ€è¦æœ‰ä¸€ä¸ªå¥½çš„ä¸‹è½½æ€§èƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚ä¸€ä¸ªå¥½çš„ choking ç®—æ³•éœ€è¦åˆ©ç”¨å¥½æ‰€æœ‰çš„èµ„æºï¼Œæä¾›å¥½çš„ä¸Šä¼ ç»™å…¶ä»– peerï¼ŒåŒæ—¶æƒ©ç½šé‚£äº›åªä¸‹è½½ä¸ä¸Šä¼ çš„ peerã€‚</p>\n<p>BT ä¸­ä½¿ç”¨çš„å˜ç§ tit-fot-tat ç­–ç•¥æ˜¯å›šå¾’å›°å¢ƒçš„åº”ç”¨ï¼Œåšä¸» youxu çš„æ–‡ç«  <a href=\"https://blog.youxu.info/2008/12/31/tit-for-tac-and-p2p-software/\" target=\"_blank\" rel=\"noopener\">P2På®¢æˆ·ç«¯çš„ç­–ç•¥å’Œå¥‡å¦™çš„å¯¹ç­–è®º</a> å¯¹è¿™æ­¤æœ‰ç€å¾ˆé€šä¿—æ˜“æ‡‚çš„è§£é‡Šã€‚</p>\n<p>å¯¹äºæŸä¸ª peer çš„ Choking ç®—æ³• å¯ä»¥æè¿°å¦‚ä¸‹ï¼š </p>\n<ol>\n<li><strong>Choking Algorithm</strong>ï¼šæ¯ T æ—¶é—´é€‰æ‹©åˆé€‚çš„ k ä¸ª peer è¿›è¡Œ unchokeï¼Œé€‰æ‹©çš„æ ‡å‡†ä¸ºè¿‡å» S æ—¶é—´ peer çš„ä¸‹è½½é€Ÿç‡ï¼›</li>\n<li><strong>Optimistic Unchoking</strong>ï¼šæ¯ nT æ—¶é—´ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª peer è¿›è¡Œ unchokeï¼Œä»¥å°è¯•å‘ç°æ›´ä¼˜è´¨çš„ peerï¼›</li>\n<li><strong>Anti-snubbing</strong>ï¼šå¦‚æœ mT æ—¶é—´å†…æ²¡æœ‰ä»æŸä¸ª peer å¤„è·å–åˆ°ä¸€ä¸ªåˆ†ç‰‡ï¼Œåˆ™è®¤ä¸ºè¢« <strong>snubbed</strong> äº†ï¼Œå¯¹å…¶è¿›è¡Œ chokeï¼›</li>\n<li><strong>Upload Only</strong>ï¼šå½“ä¸€ä¸ª peer ä¸‹è½½å®Œæˆäº†ï¼Œå³æˆä¸ºäº†ä¸€ä¸ª seedï¼Œåˆ™åªè¿›è¡Œä¸Šä¼ ï¼Œä¸å†ä¸‹è½½ã€‚peer ä¼šé€‰æ‹©é‚£äº›è¯¥ peer å¯¹å…¶æœ‰è¾ƒé«˜ä¸Šä¼ é€Ÿç‡çš„ peer è¿›è¡Œä¸Šä¼ ã€‚</li>\n</ol>\n<p>å®é™…å®ç°ä¸­ T = 10s, k = 7, S = 20s, n = 3, m = 6ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://forum.utorrent.com/topic/90069-question-about-canonical-peer-priority/\" target=\"_blank\" rel=\"noopener\">Question About Canonical Peer Priority</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p>æœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç» Peer ä»¥åŠ Peer é—´çš„é€šä¿¡ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡ <a href=\"/2018/08/26/bt-overview/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\">BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°</a>ã€‚</p>\n<h2 id=\"Peer-æ¥æº\"><a href=\"#Peer-æ¥æº\" class=\"headerlink\" title=\"Peer æ¥æº\"></a>Peer æ¥æº</h2><p>åœ¨è®² Peer é—´çš„é€šä¿¡å‰ï¼Œå…ˆæ€»ç»“ä¸€ä¸‹ Peer çš„æ¥æºã€‚</p>\n<ol>\n<li><strong>Magnet</strong>ï¼šç£åŠ›è¿æ¥ä¸­æœ‰ <strong>x.pe</strong> å‚æ•°å¯ä»¥é¢„è®¾ä¸€äº› Peerï¼›</li>\n<li><strong>Tracker</strong>ï¼šTracker æœåŠ¡å™¨çš„ä½œç”¨å°±æ˜¯æä¾› Peerï¼›</li>\n<li><strong>Local Service Discovery</strong>ï¼ˆ<a href=\"http://bittorrent.org/beps/bep_0014.html\" target=\"_blank\" rel=\"noopener\">BEP14</a>ï¼‰:é€šè¿‡å¯¹æœ¬åœ°ç»„æ’­åœ°å€ <code>239.192.152.143:6771</code> å’Œ <code>[ff15::efc0:988f]:6771</code> å‘å‡º info_hash å®£å‘Šæ¥å°è¯•è·å¾—å“åº”ï¼Œå¦‚æœæœ‰å“åº”ï¼Œåˆ™æ·»åŠ ä¸º Peerï¼›</li>\n<li><strong>Peer Exchange</strong>ï¼šé€šè¿‡ Peer é—´çš„ <strong>Peer Exchange</strong> æ‰©å±•æ¶ˆæ¯æ¥ä¸å…¶ä»– Peer äº¤æ¢ Peerï¼Œåé¢ä¼šè¯¦ç»†æåˆ°ï¼›</li>\n<li><strong>DHT</strong>ï¼šé€šè¿‡ DHT ç½‘ç»œè·å–ï¼›</li>\n</ol>\n<h2 id=\"åè®®æ¦‚è¿°\"><a href=\"#åè®®æ¦‚è¿°\" class=\"headerlink\" title=\"åè®®æ¦‚è¿°\"></a>åè®®æ¦‚è¿°</h2><p>Peer é—´çš„é€šä¿¡å±äºåº”ç”¨å±‚åè®®ï¼Œå®ƒä½¿ç”¨çš„åº”ç”¨å±‚åè®®å¯ä»¥æ˜¯ TCP æˆ–è€… ÂµTPã€‚</p>\n<p>Peer é—´æŒ‰ç…§å…ƒæ•°æ®ä¸­æè¿°çš„æ–‡ä»¶ç‰‡æ®µç´¢å¼•ï¼ˆèµ·å§‹ç´¢å¼•ä¸º 0ï¼‰è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œå½“ä¸€ä¸ª peer ä¸‹è½½å®Œæˆä¸€ä¸ªåˆ†ç‰‡è€Œä¸”ç»è¿‡äº†é€šè¿‡äº† hash å€¼çš„æ ¡éªŒï¼Œå®ƒä¼šé€šçŸ¥å®ƒçš„æ‰€æœ‰ peer è‡ªå·±æ‹¥æœ‰äº†è¿™ä¸ªç‰‡æ®µã€‚</p>\n<p>Peer è¿æ¥çš„ Peer ä¼šæœ‰ä¸€å®šä¸Šé™æ•°é‡ï¼Œæ‰€æœ‰çš„ Peer æŒ‰ç…§ <a href=\"http://bittorrent.org/beps/bep_0040.html\" target=\"_blank\" rel=\"noopener\">BEP40 - Canonical Peer Priority</a> ä¸­å®šä¹‰çš„åŸºäºåŒæ–¹ IP çš„ crc32-c å€¼çš„ç®—æ³•è¿›è¡Œæ’åºï¼Œé€‰æ‹©è¿™ä¸ªå€¼æ›´å°çš„è‹¥å¹² Peer è¿›è¡Œè¿æ¥ã€‚</p>\n<p>æ¯ä¸ªè¿æ¥ä¼šåŒ…å«ä¸¤ä¸ªçŠ¶æ€ä½ï¼Œchoked or notï¼ˆè¡¨ç¤ºæ˜¯å¦å¯¹å¯¹æ–¹ chokedï¼‰ï¼Œinterested or notï¼ˆè¡¨ç¤ºæ˜¯å¦å¯¹å¯¹æ–¹çš„æ•°æ®æ„Ÿå…´è¶£ï¼‰ï¼ŒçŠ¶æ€åœ¨è¿æ¥å»ºç«‹æ—¶çš„åˆå§‹å€¼ä¸º choked ä»¥åŠ not interestedã€‚å› ä¸ºäº¤äº’æ˜¯åŒæ–¹çš„ï¼Œä¸€æ–¹ä¸ä»…è¦å­˜å‚¨è‡ªå·±ç»™å¯¹æ–¹è®¾å®šçš„çŠ¶æ€ï¼Œä¹Ÿè¦å­˜å‚¨å¯¹æ–¹ç»™è‡ªå·±è®¾å®šçš„çŠ¶æ€ï¼Œå› æ­¤å®é™…ä¸Šä¼šæœ‰å››ä¸ªçŠ¶æ€ä½ï¼ˆBEP ä¸­è¡¨ç¤ºåªæœ‰ä¸¤ä¸ªçŠ¶æ€ä½ï¼Œä½†æ˜¯ç”±äºä¸»åŠ¨ä¸è¢«åŠ¨è¯­æ€çš„å¤æ‚æ€§ä»¥åŠè€ƒè™‘åˆ°å®é™…æºç çš„å®ç°ï¼Œè¿™é‡Œå¼•å…¥æˆå››ä¸ªçŠ¶æ€ä½ï¼Œå¢åŠ äº†ä¸€å®šçš„å†—ä½™ï¼Œä½†ä¾¿äºå†™ä½œï¼Œä¸€å®šç¨‹åº¦ä¸Šä¹Ÿä¾¿äºç†è§£ï¼‰ã€‚</p>\n<p>å‡è®¾ Aï¼ŒB æ˜¯åœ¨ä¸‹è½½åŒä¸€ä¸ªèµ„æºçš„å¯¹ç­‰ä½“ã€‚ç”¨ A.B è¡¨ç¤º peer A ä¸­ A ä¸ B çš„è¿æ¥ã€‚æ‰€ä»¥ A ä¸ B è¿æ¥å»ºç«‹æ—¶ï¼Œåœ¨ A çš„å†…å­˜ç©ºé—´ä¸­çš„ä¿å­˜çš„å¯¹äº B çš„è¿æ¥ä¼šæœ‰å¦‚ä¸‹çš„çŠ¶æ€ï¼š</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">choked = <span class=\"literal\">true</span>;</span><br><span class=\"line\">interested = <span class=\"literal\">false</span>;</span><br><span class=\"line\">peer_choked = <span class=\"literal\">true</span>;</span><br><span class=\"line\">peer_interested = <span class=\"literal\">false</span>;</span><br></pre></td></tr></table></figure>\n\n<p>åŒæ ·é“ç†ï¼ŒB ä¸­ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„è¿™æ ·å››ä¸ªçŠ¶æ€ã€‚ä¸”åˆå§‹çŠ¶æ€ç›¸åŒã€‚åªæœ‰å½“ A çš„ <code>interested == true</code> è€Œä¸” <code>peer_choked == false</code> æ—¶ï¼ŒA æ‰èƒ½å‘ B ç´¢è¦æ•°æ®ã€‚</p>\n<p>å¯¹äº A è€Œè¨€ï¼Œæœ‰ä¸‹é¢å››ä¸ªæ—¶æœºæ›´æ–°è¿™ä¸€ç»„çŠ¶æ€ï¼š</p>\n<ul>\n<li>åœ¨æ”¶åˆ° B å‘æ¥çš„ <strong>choke</strong>/<strong>unchoke</strong> æ¶ˆæ¯æ—¶ï¼Œä¼šæ›´æ–° <code>peer_choked</code> çŠ¶æ€ç½®ä¸º true/falseï¼›</li>\n<li>åœ¨æ”¶åˆ° B å‘æ¥çš„ <strong>interested</strong>ï¼Œ<strong>not interested</strong> æ¶ˆæ¯æ—¶ï¼Œä¼šæ›´æ–° <code>peer_interested</code> çŠ¶æ€ç½®ä¸º true/falseï¼›</li>\n<li>ä¸æ–­æ ¹æ®è‡ªå·±æ‰€æ‹¥æœ‰çš„åˆ†ç‰‡ä¸ B æ‹¥æœ‰åˆ†ç‰‡çš„çŠ¶æ€ï¼ˆB é€šè¿‡ <strong>bitfield</strong> æ¶ˆæ¯å‘ŠçŸ¥ Aï¼‰æ›´æ–° <code>interested</code> çŠ¶æ€ï¼Œå¹¶é€šè¿‡å‘é€ <strong>interested</strong>/<strong>not interested</strong> æ¶ˆæ¯ç»™ Bï¼›</li>\n</ul>\n<h2 id=\"æ¶ˆæ¯ç±»å‹\"><a href=\"#æ¶ˆæ¯ç±»å‹\" class=\"headerlink\" title=\"æ¶ˆæ¯ç±»å‹\"></a>æ¶ˆæ¯ç±»å‹</h2><p><strong>handshake</strong> æ˜¯è¿æ¥ peer é—´è¿æ¥å»ºç«‹åå‘é€çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼Œä¸»è¦ç”¨äºé€šå‘Š info_hash ä¸ peer_idï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| 19 (1) | &quot;BitTorrent protocol&quot; (19) | reserved_byte (8) | info_hash (20) | peer_id (20) |</span><br></pre></td></tr></table></figure>\n\n<p><strong>keepalive</strong>ï¼Œç¬¬ä¸€ä¸ªå­—æ®µä¸ºæ¶ˆæ¯ä½“é•¿åº¦ï¼Œkeepalive æ¶ˆæ¯é•¿åº¦ä½“ä¸º 0ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) |</span><br></pre></td></tr></table></figure>\n\n<p>é™¤åŸºç¡€æ¶ˆæ¯å¤–çš„å…¶ä»–æ¶ˆæ¯å‡æœ‰å›ºå®šçš„æ ¼å¼å¦‚ä¸‹ï¼šæ¶ˆæ¯ä½“é•¿åº¦ + ç±»å‹ + è´Ÿè½½ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | type (1) | payload |</span><br></pre></td></tr></table></figure>\n\n<p>å¯èƒ½çš„ç±»å‹å€¼æœ‰ï¼š</p>\n<ul>\n<li>0 - choke</li>\n<li>1 - unchoke</li>\n<li>2 - interested</li>\n<li>3 - not interested</li>\n<li>4 - have</li>\n<li>5 - bitfield</li>\n<li>6 - request</li>\n<li>7 - piece</li>\n<li>8 - cancel</li>\n<li>20 - extend message</li>\n</ul>\n<p>å…¶ä¸­ <strong>choke</strong>ï¼Œ<strong>unchoke</strong>ï¼Œ<strong>interested</strong>ï¼Œ<strong>not interested</strong> æ¶ˆæ¯æ²¡æœ‰è´Ÿè½½ã€‚</p>\n<p><strong>bitfield</strong> æ¶ˆæ¯ä»…åœ¨ handshake ååŒæ–¹å„å‘é€ä¸€æ¬¡ï¼Œæ¯ä¸ªæ¯”ç‰¹è¡¨ç¤ºå¯¹åº”çš„åˆ†ç‰‡æ˜¯å¦å®Œæ•´ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 5 (1) | bitfield |</span><br></pre></td></tr></table></figure>\n\n<p><strong>have</strong> æ¶ˆæ¯çš„è´Ÿè½½æ˜¯ä¸€ä¸ªæ•´å‹æ•°å­—ï¼Œpeer åœ¨ä¸€ä¸ªåˆ†ç‰‡ä¸‹è½½å®Œæˆå¹¶æ ¡éªŒé€šè¿‡åå‘é€è¯¥é™„å¸¦åˆšä¸‹è½½å®Œæˆåˆ†ç‰‡çš„ç´¢å¼•çš„æ¶ˆæ¯ç»™å…¶ä»– peerã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 4 (1) | index (4) |</span><br></pre></td></tr></table></figure>\n\n<p><strong>request</strong> æ¶ˆæ¯ç»“æ„å¦‚ä¸‹ï¼Œç”¨äºè¯·æ±‚æŒ‡å®šåˆ†ç‰‡ï¼ˆindexï¼‰çš„èŒƒå›´ä¸º <code>[ offset, offset + length )</code> çš„å­—èŠ‚ï¼Œlength ä¸€èˆ¬ä¸º 2^14 (16 kiB)ï¼Œè¶…è¿‡åˆ™ä¼šå…³é—­è¿æ¥ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 6 (1) | index (4) | offset (4) | length (4) |</span><br></pre></td></tr></table></figure>\n\n<p><strong>piece</strong> æ¶ˆæ¯ç”¨äºå›å¤ request æ¶ˆæ¯ï¼Œå³è¿”å›è‡ªèº«åˆ†ç‰‡ï¼ˆindexï¼‰çš„èŒƒå›´ä¸º <code>[ offset, offset + length )</code> çš„å­—èŠ‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 7 (1) | index (4) | offset (4) | block (length) |</span><br></pre></td></tr></table></figure>\n\n<p><strong>cancel</strong> æ¶ˆæ¯é™¤äº†ç±»å‹å’Œ request æ¶ˆæ¯ä¸åŒå¤–ï¼Œå…¶ä»–å‡ä¸ request ä¸€è‡´ï¼Œç”¨äºå‘ peer å–æ¶ˆä¹‹å‰å‘å‡ºçš„ request è¯·æ±‚ã€‚è¿™æ˜¯ç”±äºä¸ºäº†åŠ å¿«æœ€åè‹¥å¹²åˆ†ç‰‡çš„ä¸‹è½½é€Ÿåº¦ï¼Œå®¢æˆ·ç«¯ä¼šå¯ç”¨ <strong>Endgame</strong> æ¨¡å¼ï¼Œè¿™ä¸ªæ¨¡å¼ä¸‹ï¼Œpeer ä¼šå‘æ‰€æœ‰çš„ peer è¯·æ±‚ç›¸åŒçš„åˆ†ç‰‡ç‰‡æ®µï¼Œå½“ peer ä»æŸä¸ª peer è·å¾—æ‰€éœ€çš„åˆ†ç‰‡ç‰‡æ®µåï¼Œéœ€è¦å‘å‰©ä½™çš„ peer å‘é€ cancel æ¶ˆæ¯ä»¥å‡å°‘ä¸å¿…è¦çš„ä¼ è¾“ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 8 (1) | index (4) | offset (4) | length (4) |</span><br></pre></td></tr></table></figure>\n\n<p>ç±»å‹ä¸º 20 çš„æ˜¯æ‰©å±•æ¶ˆæ¯ã€‚</p>\n<h2 id=\"æ‰©å±•æ¶ˆæ¯\"><a href=\"#æ‰©å±•æ¶ˆæ¯\" class=\"headerlink\" title=\"æ‰©å±•æ¶ˆæ¯\"></a>æ‰©å±•æ¶ˆæ¯</h2><p><a href=\"http://bittorrent.org/beps/bep_0010.html\" target=\"_blank\" rel=\"noopener\">BEP10 - Extension Protocol</a> ä¸­å®šä¹‰äº†æ‰©å±•æ¶ˆæ¯ã€‚peer é€šè¿‡å°† handshake æ¶ˆæ¯çš„ä¿ç•™å­—èŠ‚çš„å³æ•°ç¬¬ 20 ä¸ªæ¯”ç‰¹ç½®ä¸º 1 æ¥é€šå‘Šå…¶ä»– peer è‡ªèº«æ”¯æŒæ‰©å±•æ¶ˆæ¯ã€‚å³å¯ä»¥é€šè¿‡åˆ¤æ–­è¡¨è¾¾å¼ <code>reserved_byte[5] &amp; 0x10</code> æ¥åˆ¤æ–­ peer æ˜¯å¦æ”¯æŒæ‰©å±•æ¶ˆæ¯ã€‚</p>\n<p>æ‰©å±•æ¶ˆæ¯çš„åŸºç¡€ç»“æ„å¦‚ä¸‹ï¼Œå®é™…ä¸Šç›¸å½“äºæ˜¯ç±»å‹ä¸º 20 çš„æ™®é€šæ¶ˆæ¯ã€‚</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">| len (4) | 20 (1) | extended_messag_id (1) | payload |</span><br></pre></td></tr></table></figure>\n\n<p>extended_messag_id ä¸º 0 çš„æ¶ˆæ¯æ˜¯ <strong>Extend Handshake</strong> æ¶ˆæ¯ã€‚</p>\n<h3 id=\"Extend-Handshake\"><a href=\"#Extend-Handshake\" class=\"headerlink\" title=\"Extend Handshake\"></a>Extend Handshake</h3><p>Extend Handshake æ¶ˆæ¯çš„æœ‰æ•ˆè½½è·æ˜¯ä¸€ä¸ª bencode å­—å…¸ã€‚å­—å…¸ä¸­çš„æ‰€æœ‰é”®éƒ½æ˜¯å¯é€‰çš„ï¼Œpeer éœ€è¦å¿½ç•¥æ‰€æœ‰è‡ªå·±ä¸æ”¯æŒçš„é”®ã€‚å¯é€‰çš„é”®ï¼ˆè¿˜å¯ä»¥æœ‰æ›´å¤šï¼‰å¦‚ä¸‹:</p>\n<ul>\n<li><strong>m</strong>ï¼šå­—å…¸ï¼Œè¡¨ç¤ºæ”¯æŒçš„æ‰©å±•æ¶ˆæ¯ï¼Œé”®æ˜¯æ‰©å±•æ¶ˆæ¯åç§°ï¼Œå€¼æ˜¯æ‰©å±•æ¶ˆæ¯çš„ idï¼ˆä¸ extended_messag_id å¯¹åº”ï¼‰ã€‚peer é€šè¿‡è¿™ä¸ªé”®é€šå‘Šå…¶ä»– peer è‡ªå·±æ”¯æŒçš„æ¶ˆæ¯ç±»å‹ï¼Œä¸”è¯¥ peer ä¹‹åå‘é€å…¶ä»–çš„æ‰©å±•æ¶ˆæ¯å°±ä¼šä½¿ç”¨åœ¨è¿™é‡Œå¯¹åº”çš„ extended_messag_idã€‚æ‰©å±•æ¶ˆæ¯åç§°çš„æ ¼å¼ä¸€èˆ¬ä¸º <code>å®¢æˆ·ç«¯ç¼©å†™_æ¶ˆæ¯åç§°</code>ï¼Œè¿™æ ·å¯ä»¥å®ç°å…¨ç½‘å…¨å±€æ¶ˆæ¯ç±»å‹å”¯ä¸€ï¼ˆä¾§é‡å®ç°ï¼‰ï¼›è€Œ extended_messag_id åˆ™æ˜¯è‡ªå·±å®¢æˆ·ç«¯è‡ªå·±å®šä¹‰ï¼Œåœ¨ m å­—å…¸ä¸­ä¸é‡å¤å³å¯ï¼ˆä¾§é‡ç´¢å¼•ï¼‰ï¼Œè¿™æ ·ä¾¿å¯ä»¥åšåˆ°å•å‘é€šä¿¡å”¯ä¸€ã€‚</li>\n<li><strong>p</strong>ï¼šæ•´å‹ï¼Œè¡¨ç¤ºæœ¬åœ°ç›‘å¬ç«¯å£ã€‚å¸®åŠ©å¦ä¸€æ–¹äº†è§£è‡ªå·±çš„ç«¯å£ä¿¡æ¯ã€‚è¿æ¥çš„æ¥æ”¶æ–¹æ˜¯ä¸éœ€è¦å‘é€è¿™ä¸ªæ‰©å±•æ¶ˆæ¯çš„ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„ç«¯å£æ˜¯å·²çŸ¥çš„ã€‚ï¼ˆå®é™…ä¸Š peer é—´é€šä¿¡æ— è®ºæ˜¯åŸºäº TCP è¿˜æ˜¯ ÂµTPï¼ˆUDPï¼‰ï¼Œæ¥æ”¶æ–¹ç†è®ºä¸Šéƒ½å¯ä»¥ä»ä¼ è¾“å±‚è·å¾—ç«¯å£æ•°æ®ï¼‰ã€‚</li>\n<li><strong>v</strong>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„åç§°ä¸ç‰ˆæœ¬ï¼Œè¿™ä¸ªæ¯” peer id æ›´å¯é ä¸€äº›ã€‚</li>\n<li><strong>yourip</strong>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºåœ¨ peer è§†è§’ä¸­å¯¹æ–¹ peer çš„ IPï¼Œä¸€èˆ¬å®¢æˆ·ç«¯é€šè¿‡æ­¤è·å–è‡ªå·±çš„å…¬ç½‘ IPã€‚</li>\n<li><strong>ipv6</strong>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè‡ªèº«å‹ç¼©æ ¼å¼çš„ IPv6 åœ°å€ã€‚å¯èƒ½å¯¹æ–¹ peer æ›´å–œæ¬¢ä½¿ç”¨ IPv6 åœ°å€ã€‚ </li>\n<li><strong>ipv4</strong>ï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè‡ªèº«å‹ç¼©æ ¼å¼çš„ IPv4 åœ°å€ã€‚å¯èƒ½å¯¹æ–¹ peer æ›´å–œæ¬¢ä½¿ç”¨ IPv4 åœ°å€ã€‚</li>\n<li><strong>reqq</strong>ï¼šæ•´å‹ï¼Œè¡¨ç¤ºè‡ªèº«çš„åœ¨ä¸ä¸¢å¼ƒæ¶ˆæ¯æƒ…å†µä¸‹å¯ä»¥ä¿ç•™çš„æœªå¤„ç†çš„æ¶ˆæ¯æ•°é‡ã€‚åœ¨ libtorrent ä¸­è¿™ä¸ªå€¼æ˜¯ 250ã€‚</li>\n</ul>\n<p>è¿™ä¸ªæ¶ˆæ¯éœ€è¦åœ¨æ™®é€š handshake æˆåŠŸåç«‹å³å‘é€ï¼Œåœ¨è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸå†…è¿™ä¸ª Extend Handshake å¤šæ¬¡å‘é€éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œä½†å®é™…å®ç°ä¸­æœ‰å¯èƒ½è¢«å¿½ç•¥ã€‚å¦‚æœåç»­çš„ Extend Handshake æ¶ˆæ¯æŒ‡å®š m å­—å…¸ä¸­æŸäº›æ‰©å±•çš„æ‰©å±• id ä¸º 0ï¼Œåˆ™è¡¨ç¤ºç¦ç”¨è¿™äº›æ‰©å±•ã€‚</p>\n<h3 id=\"Metadata-Request-ut-metadata\"><a href=\"#Metadata-Request-ut-metadata\" class=\"headerlink\" title=\"Metadata Request(ut_metadata)\"></a>Metadata Request(ut_metadata)</h3><p><a href=\"http://bittorrent.org/beps/bep_0009.html\" target=\"_blank\" rel=\"noopener\">BEP9 - Extension for Peers to Send Metadata Files</a> ä¸­å®šä¹‰äº†ç£åŠ›é“¾æ¥ï¼ŒåŒæ—¶ä¹Ÿå®šä¹‰äº†ç”¨äºä» Peer è·å–å…ƒæ•°æ®çš„æ‰©å±•æ¶ˆæ¯ <strong>UT Metadata</strong>ã€‚</p>\n<p>å¦‚æœä¸€ä¸ª peer çš„å®¢æˆ·ç«¯æ”¯æŒ <strong>UT Metadata</strong> æ¶ˆæ¯ï¼Œé‚£ä¹ˆåœ¨è¯¥ peer å‘å…¶ä»– peer å‘é€ Extend Handshake æ¶ˆæ¯æ—¶ï¼Œéœ€è¦åœ¨å­—å…¸ m ä¸­åŠ å…¥ <strong>ut_metadata</strong> è¿™ä¸ªé”®ï¼ŒåŒæ—¶ä¿æŒå…¶å¯¹åº”çš„æ¶ˆæ¯ id åœ¨ m å­—å…¸ä¸­å”¯ä¸€ã€‚ç‰¹æ®Šçš„æ˜¯å¯¹äºè¿™ä¸ªæ¶ˆæ¯çš„æ”¯æŒè¿˜éœ€è¦åœ¨ Extend Handshake æ¶ˆæ¯è´Ÿè½½å­—å…¸ä¸­åŠ å…¥ä¸€ä¸ªé”® <strong>metadata_size</strong>ï¼Œè¡¨ç¤ºå…ƒæ•°æ®çš„å­—èŠ‚æ•°ã€‚</p>\n<p><strong>UT Metadata</strong> æ¶ˆæ¯çš„è´Ÿè½½ä¹Ÿæ˜¯ä¸€ä¸ª bencode å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š</p>\n<ul>\n<li><strong>msg_type</strong>ï¼šæ•´å‹ï¼Œä»£è¡¨æ¶ˆæ¯ç±»å‹ï¼Œå¯èƒ½çš„ç±»å‹æœ‰ï¼š<ul>\n<li><strong>request</strong>ï¼š0ã€‚è¯·æ±‚ç±»å‹ï¼Œå³è¯·æ±‚åºå·ä¸º <strong>piece</strong> çš„ metadata ç‰‡æ®µã€‚è¯·æ±‚ç±»å‹çš„è¿”å›ç±»å‹ä¸º <strong>data</strong> æˆ–è€… <strong>reject</strong>ï¼›</li>\n<li><strong>data</strong>ï¼š1ã€‚æ­£å¸¸è¿”å›åºå·ä¸º <strong>piece</strong> çš„ metadata ç‰‡æ®µã€‚å…ƒæ•°æ®ä¼šæŒ‰ç…§ 16 kiB å¤§å°åˆ‡åˆ†ï¼Œé™¤äº†æœ€åä¸€ç‰‡æ®µï¼Œå…¶ä½™çš„éƒ½åº”è¯¥ä¸º 16 kiB å¤§å°ï¼Œåºå·ä¹Ÿç”±æ­¤åˆ†å‰²å¤§å°å¾—æ¥ã€‚å…ƒæ•°æ®ç‰‡æ®µä½œä¸ºè´Ÿè½½çš„ä¸€éƒ¨åˆ†è·Ÿåœ¨æ•´ä¸ªå­—å…¸åé¢ï¼Œå…¶å¹¶ä¸ä½¿ç”¨ bencode ç¼–ç ï¼Œä½†æ˜¯é•¿åº¦éœ€è¦è®¡ç®—åœ¨ <strong>len</strong> ä¸­ã€‚</li>\n<li><strong>reject</strong>ï¼š2ã€‚è¡¨ç¤ºè¢«è¯·æ±‚çš„ peer æ²¡æœ‰åºå·ä¸º <strong>piece</strong> çš„ metadata ç‰‡æ®µã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯ä¸€å®šæ—¶é—´å†…è¯·æ±‚è¶…è¿‡æ•°é‡é™åˆ¶ï¼Œä¸ºäº†é˜²æ­¢æ´ªæ³›æ”»å‡»ï¼Œç›´æ¥è¡¨ç¤ºæ‹’ç»ã€‚</li>\n</ul>\n</li>\n<li><strong>piece</strong>ï¼šæŒ‡å®šå…ƒæ•°æ®çš„åˆ†ç‰‡åºå·ã€‚</li>\n<li><strong>total_size</strong>ï¼šä»…åœ¨ <strong>data</strong> ç±»å‹æ¶ˆæ¯ä¸­å‡ºç°ï¼Œå’Œæ¡æ‰‹æ¶ˆæ¯ä¸­çš„ <strong>metadata_size</strong> è¯­ä¹‰ä¸€è‡´ã€‚</li>\n</ul>\n<h3 id=\"Partial-Seeds\"><a href=\"#Partial-Seeds\" class=\"headerlink\" title=\"Partial Seeds\"></a>Partial Seeds</h3><p>è¿™ä¸ªæ‰©å±•æ˜¯ä¸ºäº†è®© BT æ”¯æŒå¯¹ Partial Seedsï¼ˆéƒ¨åˆ†ç§å­ï¼Œ<a href=\"http://bittorrent.org/beps/bep_0021.html\" target=\"_blank\" rel=\"noopener\">BEP21 - Extension for partial seeds</a>ï¼‰çš„è¯†åˆ«ä¸è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚éƒ¨åˆ†ç§å­å°±æ˜¯èµ„æºä¸å®Œæ•´ä½†æ˜¯ä¹Ÿä¸å†è¿›è¡Œä¸‹è½½çš„ peerã€‚è¿™ç§æƒ…å†µå‘ç”Ÿåœ¨å¤šæ–‡ä»¶ç§å­ä¸­ï¼Œç”¨æˆ·åªè®¾å®šä¸‹è½½ä¸€éƒ¨åˆ†æ–‡ä»¶ã€‚</p>\n<p>è¿™ä¸ªæ‰©å±•ä¸å®šä¹‰é¢å¤–çš„æ‰©å±•æ¶ˆæ¯ï¼Œä½†æ˜¯åœ¨æ‰©å±•æ¡æ‰‹æ¶ˆæ¯çš„å­—å…¸ä¸­åŠ å…¥ä¸€ä¸ªé”® <strong>upload_only</strong>ï¼Œå€¼ä¸ºæ•´å‹ï¼Œå¦‚æœ peer å¯¹ä¸‹è½½ä¸æ„Ÿå…´è¶£åˆ™éœ€è¦è®²æ­¤å€¼ç½®ä¸º 1ã€‚</p>\n<p>åœ¨ Tracker çš„ Scrape è¯·æ±‚å›å¤ä¸­ï¼Œå®šä¹‰äº† <strong>complete</strong>, <strong>incomplete</strong> ä»¥åŠ <strong>downloaded</strong> ä¸‰ç§çŠ¶æ€çš„ peerã€‚ä¸ºäº†è®©å…¶ä»– peer å¯ä»¥é€šè¿‡ Tracker çŸ¥æ™“ Partial Seeds çš„æƒ…å†µï¼Œæ‰©å±•å®šä¹‰äº†åœ¨ Scrape å›å¤ä¸­åŠ å…¥ç±»å‹ <strong>downloaders</strong>ï¼Œè¡¨ç¤ºå¤„äºæ´»è·ƒçŠ¶æ€ï¼Œæœªå®Œæˆä¸‹è½½ä¸”ä»ç„¶éœ€è¦ç»§ç»­ä¸‹è½½çš„ peer æ•°é‡ï¼ŒPartial Seed çš„æ•°é‡å¯ä»¥é€šè¿‡ <code>incomplete - downloaders</code> å¾—åˆ°ã€‚åŒæ—¶è®© Tracker çŸ¥æ™“ peer è‡ªèº«å¤„äº Partial Seed çŠ¶æ€ï¼Œåˆ™éœ€è¦é€šè¿‡ <code>event=paused</code> äº‹ä»¶è¿›è¡Œå‘ŠçŸ¥ï¼Œä¸”æ¯æ¬¡é€šå‘Šæ—¶éƒ½è¦å‘é€è¯¥äº‹ä»¶ã€‚</p>\n<h3 id=\"Peer-Exchange-ut-pex\"><a href=\"#Peer-Exchange-ut-pex\" class=\"headerlink\" title=\"Peer Exchange(ut_pex)\"></a>Peer Exchange(ut_pex)</h3><p>Peer Exchange(PEX) ç”¨äºåœ¨ peer é—´äº¤æ¢ peer åˆ—è¡¨ã€‚é€šè¿‡åœ¨ Extend Handshake æ¶ˆæ¯çš„ å­—å…¸ m ä¸­åŠ å…¥ <strong>ut_pex</strong> è¿™ä¸ªæ¶ˆæ¯åç§°æ¥è¡¨æ˜æ”¯æŒï¼ŒåŒæ ·é“ç†ï¼Œæ¶ˆæ¯ id åœ¨ m å­—å…¸ä¸­ä¿æŒå”¯ä¸€å³å¯ã€‚</p>\n<p>PEX æ¶ˆæ¯çš„è´Ÿè½½ä¹Ÿæ˜¯ä¸€ä¸ª bencode å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š</p>\n<ul>\n<li><strong>added</strong>ï¼šå½“å‰è¿æ¥çš„ IPv4 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œæ·»åŠ </li>\n<li><strong>added.f</strong>ï¼šå½“å‰è¿æ¥çš„ IPv4 peer æ ‡å¿—ä½ï¼Œæ¯ä¸ª peer ä¸€ä¸ªå­—èŠ‚</li>\n<li><strong>added6</strong>ï¼šå½“å‰è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œæ·»åŠ </li>\n<li><strong>added6.f</strong>ï¼šå½“å‰è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨æ ‡å¿—ä½</li>\n<li><strong>dropped</strong>ï¼šè¿‡å»æ–­å¼€è¿æ¥çš„ IPv4 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œåˆ é™¤</li>\n<li><strong>dropped6</strong>ï¼šè¿‡å»æ–­å¼€è¿æ¥çš„ IPv6 peer å‹ç¼©æ ¼å¼åˆ—è¡¨ï¼Œå‘ŠçŸ¥å¯¹æ–¹è¿›è¡Œåˆ é™¤</li>\n</ul>\n<p>æ ‡å¿—ä½å®šä¹‰å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>0x02ï¼šå±äº seed æˆ–è€… partial seed</li>\n<li>0x04ï¼šæ”¯æŒ uTP</li>\n<li>0x01ï¼šprefers encryption, as indicated by e field in extension handshake</li>\n<li>0x08ï¼špeer indicated ut_holepunch support in extension handshake</li>\n<li>0x10ï¼šoutgoing connection, peer is reachable</li>\n</ul>\n<h4 id=\"å‘é€è§„åˆ™\"><a href=\"#å‘é€è§„åˆ™\" class=\"headerlink\" title=\"å‘é€è§„åˆ™\"></a>å‘é€è§„åˆ™</h4><ul>\n<li>å¦‚æœ peer ä¸æŸäº› peer æ–­å¼€è¿æ¥ï¼Œåˆ™éœ€è¦éœ€è¦åœ¨é€‚å½“æ—¶å€™å‘é€ PEX æ¶ˆæ¯ï¼Œå°†æ–­å¼€è¿æ¥çš„ peer æ”¾åœ¨ dropped ä¸­ï¼›</li>\n<li>æ¯åˆ†é’Ÿå‘é€çš„ PEX æ¶ˆæ¯ä¸èƒ½è¶…è¿‡ä¸€æ¡ï¼›</li>\n<li>ä¸éœ€è¦åœ¨æ¡æ‰‹åç«‹å³å‘é€ PEX æ¶ˆæ¯ï¼Œåœ¨æ”¶é›†æ»¡ä¸€å®šçš„ peer ä¹‹åå†å‘é€æ•ˆæœæ›´å¥½ï¼›</li>\n<li>æ·»åŠ æˆ–åˆ é™¤çš„ peer åˆ—è¡¨ä¸­ä¸èƒ½åŒ…æ‹¬é‡å¤é¡¹ï¼Œä¹Ÿä¸èƒ½åœ¨åŒä¸€ä¸ª PEX æ¶ˆæ¯ä¸­åˆ é™¤æ·»åŠ çš„ peerï¼›</li>\n<li>é™¤äº†æœ€åˆçš„ PEX æ¶ˆæ¯ä¹‹å¤–ï¼Œæ¯æ¡æ¶ˆæ¯ä¸­æ·»åŠ çš„ peer æ•°é‡æˆ–è€… åˆ é™¤çš„ peer æ•°é‡å‡ä¸èƒ½è¶…è¿‡ 50 æ¡ï¼›</li>\n<li>added, added6, dropped, dropped6 å››ä¸ªé”®ä¸­è‡³å°‘éœ€è¦æœ‰ä¸€ä¸ªï¼›</li>\n<li>peer å¯èƒ½ä¼šä¸ä¸¥é‡è¿åè¿™äº›è§„åˆ™çš„ peer æ–­å¼€è¿æ¥ï¼›</li>\n</ul>\n<h4 id=\"æ‰©å……-seed\"><a href=\"#æ‰©å……-seed\" class=\"headerlink\" title=\"æ‰©å…… seed\"></a>æ‰©å…… seed</h4><p>æ¯ä¸ª peer ä¼šæ‰§è¡Œå¦‚ä¸‹çš„æ‰§è¡Œä¸€äº›è§„åˆ™æ¥æ–­å¼€ä¸éƒ¨åˆ† peer çš„è¿æ¥ã€‚æ¯”å¦‚</p>\n<ol>\n<li>åœ¨ä½œç§çš„æ—¶å€™ä¼šæ–­å¼€ä¸ seed å’Œ partial seed çš„è¿æ¥ï¼›</li>\n<li>æ ¹æ® peer id æ–­å¼€ IPv4 ä»¥åŠ IPv6 åœ°å€å®é™…ä¸Šå±äºåŒä¸€ä¸ª peer çš„ä¸€ä¸ªè¿æ¥ï¼Œä¿ç•™è‡ªå·±åçˆ±çš„åœ°å€å®¶æ—è¿æ¥ï¼›</li>\n</ol>\n<p>è¿™æ ·çš„ç­–ç•¥ä¸‹ï¼Œåœ¨ seed å ä¸»å¯¼åœ°ä½çš„ swarm ä¸­é€šè¿‡ PEX ä¼ æ’­çš„æ´»è·ƒ peer ä¼šä¸è¶³ã€‚ç±»ä¼¼åœ°ï¼Œåœ¨ IPv4 å ä¸»å¯¼çš„ swarm ä¸­ï¼Œåªæ”¯æŒ IPv6 çš„ peer å°†å¾ˆéš¾è·å¾— IPv6 çš„ peerã€‚è¿™å¾ˆå¤§ç¨‹åº¦é™ä½äº† PEX æ¶ˆæ¯çš„æœ‰æ•ˆæ€§ã€‚</p>\n<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œå¦‚æœä¸€ä¸ª peer è¿æ¥åˆ°ä¸€ä¸ªç‰¹å®šåœ°å€å®¶æ—çš„ peer å°‘äº25ä¸ªï¼Œæ´»è·ƒåº¦çš„è¦æ±‚å°±ä¼šæ”¾å®½ã€‚å› ä¸ºä¸€ä¸‹åŸå› å¯¼è‡´è¿æ¥æ–­å¼€çš„ peer ä¹Ÿä¼šè¢«ä¿å­˜ä¸‹æ¥ï¼Œå¹¶æœ‰èµ„æ ¼è¢«å‘åœ¨ PEX æ¶ˆæ¯çš„ added ä¸­ï¼š</p>\n<ol>\n<li>å› ä¸º peer id ç›¸åŒè€Œè¢«æ–­å¼€çš„å¦ä¸€ä¸ªåœ°å€å®¶æ—çš„è¿æ¥ï¼›</li>\n<li>å› ç¼ºä¹å…´è¶£è€Œæ–­å¼€è¿æ¥çš„ peerï¼Œæ¯”å¦‚å¯¹æ–¹æ˜¯ seed/partial seed æˆ–è€…å¯¹æ–¹æ‹¥æœ‰çš„åˆ†ç‰‡ä¸æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ï¼›</li>\n<li>å› ä¸ºè¶…è¿‡æœ¬åœ°èµ„æºé™åˆ¶è€Œæ–­å¼€çš„è¿æ¥ï¼Œæ¯”å¦‚å…¨å±€çš„è¿æ¥ä¸Šé™ï¼›</li>\n</ol>\n<p>ä¸ºäº†ä¿è¯ peer çš„æœ‰æ•ˆæ€§ï¼Œå› ä¸ºè¿™äº›åŸå› æ·»åŠ åˆ° added ä¸­çš„ peer åªèƒ½é€šè¿‡ PEX æ¶ˆæ¯å‘é€ä¸€æ¬¡ï¼Œå‘é€å®Œåå¿…é¡»ä»ç­‰å¾…å‘é€åˆ—è¡¨ä¸­åˆ é™¤ã€‚</p>\n<h4 id=\"å®‰å…¨æ€§\"><a href=\"#å®‰å…¨æ€§\" class=\"headerlink\" title=\"å®‰å…¨æ€§\"></a>å®‰å…¨æ€§</h4><p>é€šè¿‡ PEX è·å¾—çš„ peer åº”è¯¥è§†ä¸ºä¸å¯ä¿¡çš„ã€‚æ”»å‡»è€…å¯èƒ½é€šå¤šä¼ªé€  PEX æ¶ˆæ¯æ¥æ”»å‡»è¿™ä¸ª swarmã€‚æ”»å‡»è€…ä¹Ÿå¯èƒ½é€šè¿‡ PEX æ¶ˆæ¯è¯±å¯¼ BT å®¢æˆ·ç«¯å¯¹ç‰¹å®š IP è¿›è¡Œå°è¯•è¿æ¥è€Œå¼•å‘ DDoS æ”»å‡»ã€‚</p>\n<p>ä¸ºäº†ç¼“è§£è¿™äº›é—®é¢˜ï¼Œpeer åº”è¯¥é¿å…ä»å•ä¸ª PEX æºè·å–å…¶æ‰€æœ‰è¿æ¥ä½œä¸ºå€™é€‰è¿æ¥ã€‚åº”å¿½ç•¥å…·æœ‰ä¸åŒçš„ç«¯å£çš„é‡å¤ IPï¼Œè¿˜å¯ä»¥æ ¹æ® peer çš„ä¼˜å…ˆçº§æ¥è¿›è¡Œï¼ˆåè®®æ¦‚è¿°ä¸­æåˆ°ï¼‰æ’åºã€‚</p>\n<h2 id=\"å¿«é€Ÿæ‰©å±•ï¼ˆFast-Extensionï¼‰\"><a href=\"#å¿«é€Ÿæ‰©å±•ï¼ˆFast-Extensionï¼‰\" class=\"headerlink\" title=\"å¿«é€Ÿæ‰©å±•ï¼ˆFast Extensionï¼‰\"></a>å¿«é€Ÿæ‰©å±•ï¼ˆFast Extensionï¼‰</h2><p>å¦å¤–è¿˜æœ‰ç±»ä¼¼æ‰©å±•æ¶ˆæ¯çš„å¿«é€Ÿæ‰©å±•æ¶ˆæ¯ï¼Œé€šè¿‡å°†æ¡æ‰‹æ¶ˆæ¯çš„ <code>reserved_byte[7] |= 0x04</code> æ¥é€šå‘Šæ”¯æŒå¿«é€Ÿæ‰©å±•ï¼Œè¿™é‡Œåªåˆ—å‡ºå¿«é€Ÿæ‰©å±•æ¶ˆæ¯çš„ç§ç±»ï¼Œå…·ä½“åè®®æ ¼å¼å¯å‚è§ <a href=\"http://bittorrent.org/beps/bep_0006.html\" target=\"_blank\" rel=\"noopener\">BEP06 - Fast Extension</a>ã€‚</p>\n<ul>\n<li><strong>Have All/Have None</strong>ï¼šæ¥è¡¨ç¤ºæ‹¥æœ‰æ‰€æœ‰åˆ†ç‰‡æˆ–è€…æœªæ‹¥æœ‰ä»»ä½•åˆ†ç‰‡ï¼Œæ˜¯ <strong>bitfield</strong> æ¶ˆæ¯çš„å¿«é€Ÿç‰ˆæœ¬ï¼›</li>\n<li><strong>Suggest Piece</strong>ï¼šå»ºè®®å…¶ä»– peer ä¸‹è½½æŸåˆ†ç‰‡ï¼›</li>\n<li><strong>Reject Request</strong>ï¼šæ‹’ç» peer å¯¹æŸä¸ªç‰‡æ®µçš„è¯·æ±‚ï¼›</li>\n<li><strong>Allowed Fast</strong>ï¼šè¡¨ç¤ºå¦‚æœ peer è¯·æ±‚è¿™ä¸ªåˆ†ç‰‡ï¼Œå³ä½¿å®ƒå¤„äº choked çŠ¶æ€ä¹Ÿä¼šç»™å®ƒï¼›</li>\n<li><strong>lt Dont Have</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚èµ„æºçŸ­ç¼ºï¼ŒLRU Cache è¿‡æœŸï¼‰ä¼šå¯¼è‡´ peer ä¸å†æ‹¥æœ‰æŸä¸ªç‰‡æ®µï¼Œåˆ™å¯ä»¥é€šè¿‡æ­¤æ¶ˆæ¯å‘ŠçŸ¥å…¶ä»– peerï¼Œè¯¥æ‰©å±•å®šä¹‰åœ¨ <a href=\"http://bittorrent.org/beps/bep_0054.html\" target=\"_blank\" rel=\"noopener\">BEP54 - The lt_donthave extension</a> ä¸­ï¼›</li>\n</ul>\n<h2 id=\"åˆ†ç‰‡é€‰æ‹©ç­–ç•¥\"><a href=\"#åˆ†ç‰‡é€‰æ‹©ç­–ç•¥\" class=\"headerlink\" title=\"åˆ†ç‰‡é€‰æ‹©ç­–ç•¥\"></a>åˆ†ç‰‡é€‰æ‹©ç­–ç•¥</h2><p>é€‰æ‹©ä¸€ä¸ªå¥½çš„åˆ†ç‰‡ä¸‹è½½é¡ºåºä¸å¦å¯¹ä¸‹è½½æ€§èƒ½æœ‰è¿™å¾ˆå¤§å½±å“ã€‚å¦‚æœé€‰æ‹©äº†ä¸€ä¸ªå·®çš„åˆ†ç‰‡ä¸‹è½½é€‰æ‹©ç®—æ³•ï¼Œåˆ™æŸä¸€æ—¶åˆ»å¯èƒ½æ‰€æœ‰åˆ†ç‰‡ä½ éƒ½å¯ä»¥ä¸‹è½½ï¼Œä½†æ˜¯ä¹‹åå°±æ²¡æœ‰ä½ æƒ³ä¸‹è½½çš„åˆ†ç‰‡äº†ã€‚BT ä¸­æ‰§è¡Œä¸€ä¸‹ç­–ç•¥ï¼š</p>\n<h3 id=\"Strict-Priorityï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰\"><a href=\"#Strict-Priorityï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰\" class=\"headerlink\" title=\"Strict Priorityï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰\"></a>Strict Priorityï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰</h3><p>ä¸€æ—¦è¯·æ±‚äº†æŸä¸ªåˆ†ç‰‡çš„å­ç‰‡æ®µï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¯·æ±‚å…¶ä»–å­ç‰‡æ®µä¹‹å‰è¯·æ±‚è¯¥ç‰¹å®šåˆ†ç‰‡çš„å‰©ä½™å­ç‰‡æ®µï¼Œä»¥å°½é‡ä¼˜å…ˆè·å¾—è¿™ä¸ªå®Œæ•´çš„åˆ†ç‰‡ã€‚</p>\n<h3 id=\"Rarest-Firstï¼ˆç¨€æœ‰ä¼˜å…ˆï¼‰\"><a href=\"#Rarest-Firstï¼ˆç¨€æœ‰ä¼˜å…ˆï¼‰\" class=\"headerlink\" title=\"Rarest Firstï¼ˆç¨€æœ‰ä¼˜å…ˆï¼‰\"></a>Rarest Firstï¼ˆç¨€æœ‰ä¼˜å…ˆï¼‰</h3><p>åœ¨é€‰æ‹©æ¥ä¸‹æ¥ä¸‹è½½å“ªä¸ªåˆ†ç‰‡æ—¶ï¼Œpeer ä¼šé€‰æ‹©æœ€ç¨€æœ‰çš„åˆ†ç‰‡ï¼ˆè‡ªå·±æ²¡æœ‰è¿™ä¸ªåˆ†ç‰‡ï¼ŒåŒæ—¶å…¶ä»– peer æœ‰ï¼Œä½†æ˜¯æœ‰è¿™ä¸ªåˆ†ç‰‡çš„ peer æ•°é‡ç›¸å¯¹å…¶ä»–åˆ†ç‰‡æœ€å°‘ï¼‰è¿›è¡Œä¸‹è½½ã€‚è¿™ä¸ªç®—æ³•ä¿è¯äº†ä¸ç¨€æœ‰çš„åˆ†ç‰‡åœ¨ä¹‹åä»ç„¶èƒ½è¢«ä¸‹è½½åˆ°ï¼ŒåŒæ—¶ç¨€æœ‰çš„åˆ†ç‰‡åœ¨é€æ¸å˜å¤šã€‚é€šè¿‡å°½å¿«å¤åˆ¶æœ€ç¨€æœ‰çš„åˆ†ç‰‡ï¼Œå‡å°äº†ç¨€æœ‰åˆ†ç‰‡åœ¨å½“å‰è¿æ¥çš„ peer ä¸­å®Œå…¨æ¶ˆå¤±çš„å¯èƒ½æ€§ã€‚</p>\n<h3 id=\"Random-First-Pieceï¼ˆéšæœºé¦–åˆ†ç‰‡ï¼‰\"><a href=\"#Random-First-Pieceï¼ˆéšæœºé¦–åˆ†ç‰‡ï¼‰\" class=\"headerlink\" title=\"Random First Pieceï¼ˆéšæœºé¦–åˆ†ç‰‡ï¼‰\"></a>Random First Pieceï¼ˆéšæœºé¦–åˆ†ç‰‡ï¼‰</h3><p>å½“ä¸‹è½½å¼€å§‹æ—¶ï¼Œä¸ä¼šä½¿ç”¨ç¨€æœ‰ä¼˜å…ˆç®—æ³•ã€‚å¼€å§‹æ—¶ peer æ²¡æœ‰åˆ†ç‰‡å¯ä»¥ç”¨äºä¸Šä¼ ï¼Œæ‰€ä»¥æœ€é‡è¦çš„æ˜¯å°½å¿«å¾—åˆ°ä¸€ä¸ªå®Œæ•´çš„åˆ†ç‰‡ã€‚ç¨€æœ‰çš„åˆ†ç‰‡å¾€å¾€åªè¢«æŸä¸€ä¸ª peer æ‹¥æœ‰ï¼Œä»è¿™ä¸ª peer å¤„ä¸‹è½½è¿™ä¸ªåˆ†ç‰‡ï¼ˆåˆ†æˆå¤šä¸ªå­ç‰‡æ®µï¼‰å°†ä¼šæ…¢äºä»å¤šä¸ª peer å¤„ä¸‹è½½ç›¸åŒåˆ†ç‰‡çš„ä¸åŒå­ç‰‡æ®µã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåˆšå¼€å§‹ä¸‹è½½æ—¶ï¼Œä¼šéšæœºé€‰æ‹©ä¸€ä¸ªåˆ†ç‰‡è¿›è¡Œä¸‹è½½ï¼Œéšåç­–ç•¥è½¬ä¸ºç¨€æœ‰ä¼˜å…ˆã€‚</p>\n<h3 id=\"Endgame-Mode\"><a href=\"#Endgame-Mode\" class=\"headerlink\" title=\"Endgame Mode\"></a>Endgame Mode</h3><p>æœ‰æ—¶ä»ä¸€ä¸ª peer è¯·æ±‚æŸä¸ªåˆ†ç‰‡ä¼šå¾ˆæ…¢ï¼Œè¿™åœ¨ä¸‹è½½æ•´ä¸ªèµ„æºä½ çš„ä¸­é€”ä¸ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ï¼ˆå› ä¸ºä¸­é€”åŒæ—¶å‘ç”Ÿä¸å°‘è¯·æ±‚ï¼‰ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µå¯èƒ½ä¼šå½±å“æœ€ç»ˆçš„å³å°†ä¸‹è½½å®Œæˆé˜¶æ®µã€‚å½“æ‰€æœ‰å‰©ä½™çš„å­ç‰‡æ®µéƒ½å·²ç»åœ¨å‘å…¶ä»– peer è¯·æ±‚æ—¶ï¼Œå®ƒä¼šåŒæ—¶å‘æ‰€æœ‰çš„ peer è¯·æ±‚è¿™äº›å­ç‰‡æ®µã€‚å½“æŸä¸€ä¸ª peer è¿”å›äº†ä¸€ä¸ªå­ç‰‡æ®µï¼Œå°±å‘å‰©ä½™çš„ peer å‘é€ cancel æ¶ˆæ¯ä»¥èŠ‚çº¦å¸¦å®½ã€‚åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼ŒEndgame æ¨¡å¼æŒç»­æ—¶é—´éå¸¸çŸ­ï¼Œæ‰€ä»¥æµªè´¹çš„å¸¦å®½ä¸å¤šï¼Œè€Œä¸”ä½¿å¾—èµ„æºçš„æœ€åä¸€éƒ¨åˆ†ä¸‹è½½éå¸¸å¿«ã€‚</p>\n<h2 id=\"Choking-ç®—æ³•\"><a href=\"#Choking-ç®—æ³•\" class=\"headerlink\" title=\"Choking ç®—æ³•\"></a>Choking ç®—æ³•</h2><p>BT æ²¡æœ‰ä¸­å¿ƒåŒ–çš„èµ„æºåˆ†é…ï¼Œæ¯ä¸ª peer æœ‰è´£ä»»å»æœ€å¤§åŒ–è‡ªå·±çš„ä¸‹è½½é€Ÿç‡ã€‚Peer æ‰§è¡Œä¸€ç§å˜ç§ tit-fot-tat ç­–ç•¥ï¼Œä»ä¸è‡ªå·±ç›¸è¿çš„ peer å¤„ä¸‹è½½åˆ†ç‰‡ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„ peer è¿›è¡Œä¸Šä¼ ï¼Œå¯¹å…¶ä»– peer è¿›è¡Œ chokeã€‚choke è¡¨ç°ä¸ºæ‹’ç»ä¸Šä¼ ï¼Œä½†ä¸‹è½½ä»å¯ç»§ç»­ï¼ŒåŒæ—¶è¿æ¥è¢«ä¿æŒä¸é”€æ¯ï¼Œåœ¨ choke ç»“æŸåè¿æ¥ä¸éœ€è¦é‡å»ºã€‚Choking ç®—æ³•å¯¹äº BT æ¥è¯´ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å¦‚æœéœ€è¦æœ‰ä¸€ä¸ªå¥½çš„ä¸‹è½½æ€§èƒ½æ˜¯éå¸¸é‡è¦çš„ã€‚ä¸€ä¸ªå¥½çš„ choking ç®—æ³•éœ€è¦åˆ©ç”¨å¥½æ‰€æœ‰çš„èµ„æºï¼Œæä¾›å¥½çš„ä¸Šä¼ ç»™å…¶ä»– peerï¼ŒåŒæ—¶æƒ©ç½šé‚£äº›åªä¸‹è½½ä¸ä¸Šä¼ çš„ peerã€‚</p>\n<p>BT ä¸­ä½¿ç”¨çš„å˜ç§ tit-fot-tat ç­–ç•¥æ˜¯å›šå¾’å›°å¢ƒçš„åº”ç”¨ï¼Œåšä¸» youxu çš„æ–‡ç«  <a href=\"https://blog.youxu.info/2008/12/31/tit-for-tac-and-p2p-software/\" target=\"_blank\" rel=\"noopener\">P2På®¢æˆ·ç«¯çš„ç­–ç•¥å’Œå¥‡å¦™çš„å¯¹ç­–è®º</a> å¯¹è¿™æ­¤æœ‰ç€å¾ˆé€šä¿—æ˜“æ‡‚çš„è§£é‡Šã€‚</p>\n<p>å¯¹äºæŸä¸ª peer çš„ Choking ç®—æ³• å¯ä»¥æè¿°å¦‚ä¸‹ï¼š </p>\n<ol>\n<li><strong>Choking Algorithm</strong>ï¼šæ¯ T æ—¶é—´é€‰æ‹©åˆé€‚çš„ k ä¸ª peer è¿›è¡Œ unchokeï¼Œé€‰æ‹©çš„æ ‡å‡†ä¸ºè¿‡å» S æ—¶é—´ peer çš„ä¸‹è½½é€Ÿç‡ï¼›</li>\n<li><strong>Optimistic Unchoking</strong>ï¼šæ¯ nT æ—¶é—´ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª peer è¿›è¡Œ unchokeï¼Œä»¥å°è¯•å‘ç°æ›´ä¼˜è´¨çš„ peerï¼›</li>\n<li><strong>Anti-snubbing</strong>ï¼šå¦‚æœ mT æ—¶é—´å†…æ²¡æœ‰ä»æŸä¸ª peer å¤„è·å–åˆ°ä¸€ä¸ªåˆ†ç‰‡ï¼Œåˆ™è®¤ä¸ºè¢« <strong>snubbed</strong> äº†ï¼Œå¯¹å…¶è¿›è¡Œ chokeï¼›</li>\n<li><strong>Upload Only</strong>ï¼šå½“ä¸€ä¸ª peer ä¸‹è½½å®Œæˆäº†ï¼Œå³æˆä¸ºäº†ä¸€ä¸ª seedï¼Œåˆ™åªè¿›è¡Œä¸Šä¼ ï¼Œä¸å†ä¸‹è½½ã€‚peer ä¼šé€‰æ‹©é‚£äº›è¯¥ peer å¯¹å…¶æœ‰è¾ƒé«˜ä¸Šä¼ é€Ÿç‡çš„ peer è¿›è¡Œä¸Šä¼ ã€‚</li>\n</ol>\n<p>å®é™…å®ç°ä¸­ T = 10s, k = 7, S = 20s, n = 3, m = 6ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://forum.utorrent.com/topic/90069-question-about-canonical-peer-priority/\" target=\"_blank\" rel=\"noopener\">Question About Canonical Peer Priority</a></li>\n</ol>\n"},{"title":"BT å¢å¼ºå»ºè®®ä¹‹ Tracker","date":"2018-08-26T16:00:00.000Z","_content":"\næœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç»ç§å­æ–‡ä»¶ç»“æ„ä¸ç£åŠ›é“¾æ¥çš„åŸç†ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡{% post_link bt-overview %}ã€‚\n\np2p æ˜¯ peer-to-peer çš„ç¼©å†™ï¼Œä¸ºäº†è®©ç½‘ç»œä¸­çš„ä¸€ä¸ª peer å¦‚ä½•æ‰èƒ½æ‰¾åˆ°å¦å¤–å¿—åŒé“åˆçš„ peerï¼ŒTracker æ‰®æ¼”ç€è‡³å…³é‡è¦çš„æœˆè€ä½œç”¨ã€‚Tracker æ˜¯ä¸€ä¸ª HTTP æˆ–è€… UDP æœåŠ¡å™¨ï¼Œä½œç”¨æ˜¯å¸®åŠ© peer æ‰¾åˆ°å…¶ä»–æ‹¥æœ‰ç›¸åŒèµ„æºçš„ peerã€‚\n\nåæ¥æœ‰äº† DHT ç½‘ç»œä¹‹åï¼ŒTracker çš„ä½œç”¨é€æ¸å¼±åŒ–ï¼Œä½†æ˜¯ Tracker ä»£è¡¨çš„è¿™ç§ä¸­å¿ƒåŒ–ä¸€å®šç¨‹åº¦ä¸Šç›¸å¯¹ DHT ä»£è¡¨çš„å»ä¸­å¿ƒåŒ–æ•ˆç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚å¦‚åŒåœ¨æ¦‚è¿°å‰è¨€ä¸­æ‰€è¯´çš„ä¸€æ ·ï¼Œâ€è¿‡æ—¶â€œçš„æŠ€æœ¯æŸäº›æƒ…å†µä¸‹æ˜¯ä¼šâ€œå¤æ´»\"çš„ï¼Œæ‰€ä»¥äº†è§£ä¸€ä¸‹ Tracker çš„å·¥ä½œåŸç†å¹¶ä¸æ˜¯åäº‹ã€‚\n\n## HTTP Tracker\nHTTP Tracker å¤„ç†çš„æ¥è‡ª peer çš„ GET è¯·æ±‚åŒ…æ‹¬ä»¥ä¸‹å‚æ•°ï¼š\n - **info_hash**ï¼šå³éœ€è¦ä¸‹è½½çš„èµ„æºçš„ torrent æ–‡ä»¶çš„ info éƒ¨åˆ†çš„ SHA1 å€¼ï¼Œæˆ–è€…ç£åŠ›é“¾æ¥ä¸­çš„ xt å€¼ã€‚\n - **peer_id**ï¼šæ ‡ç¤ºè¿™ä¸ªå®¢æˆ·ç«¯çš„å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ä¼šåŒ…å«å®¢æˆ·ç«¯çš„ç‰ˆæœ¬ä¿¡æ¯ä»¥åŠéšæœºæ•°æ®ï¼ˆ[BEP20 - Peer ID Conventions](http://www.bittorrent.org/beps/bep_0020.html)ï¼‰ã€‚\n - **ip**ï¼šå¯é€‰ï¼Œpeer çš„ IPã€‚\n - **port**ï¼šå¯é€‰ï¼Œpeer ç›‘å¬çš„ç«¯å£ï¼Œä¸€èˆ¬æ˜¯ 6881ã€‚ç†è®ºä¸Š Tracker åº”è¯¥éœ€è¦å¯¹è¿™ä¸ª ip å’Œ port çš„ç»„åˆè¿›è¡Œ NAT æ£€æŸ¥ã€‚\n - **uploaded**ï¼šè¯¥èµ„æºè‡³ä»Šä¸ºæ­¢çš„ä¸Šä¼ å­—èŠ‚æ•°ã€‚\n - **downloaded**ï¼šè¯¥èµ„æºè‡³ä»Šä¸ºæ­¢çš„ä¸‹è½½å­—èŠ‚æ•°ã€‚\n - **left**ï¼šè¯¥èµ„æºå‰©ä½™æœªå®Œæˆä¸‹è½½çš„å­—èŠ‚æ•°ã€‚\n - **event**ï¼šå¯é€‰ï¼Œå½“å‰èµ„æºä¸‹è½½çŠ¶æ€ï¼Œå¯ä»¥æ˜¯`started`ï¼Œ`completed`ï¼Œ`stopped`ï¼Œæ¯æ¬¡å‘ç”ŸçŠ¶æ€å˜åŒ–æ—¶è¿›è¡Œé€šå‘Šã€‚\n\nè¿™ä¸ªè¯·æ±‚çš„å›å¤æ˜¯ä½¿ç”¨ bencode ç¼–ç çš„å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š\n - **failure reason**ï¼šå­—ç¬¦ä¸²ï¼Œå¦‚æœè¯·æ±‚å¤±è´¥å°±ä¼šæœ‰è¿™ä¸ªé”®ï¼Œè¡¨ç¤ºå¤±è´¥çš„åŸå› ï¼Œå¦å¤– [BEP31 - Failure Retry Extension](http://www.bittorrent.org/beps/bep_0031.html) ä¸­å®šä¹‰äº†ä¸€ä¸ª **retry in** å­—æ®µæ¥å‘ŠçŸ¥å‘èµ·è¯·æ±‚çš„ peer é‡è¯•é—´éš”åˆ†é’Ÿæ•°ï¼Œæˆ–è€…æ°¸è¿œä¸è¿›è¡Œé‡è¯•ã€‚å¦‚æœæˆåŠŸå°±ä¼šæœ‰ä»¥ä¸‹ä¸¤ä¸ªé”®ã€‚\n - **interval**ï¼šæ•´å‹ï¼Œå‘ŠçŸ¥ peer ä¹‹åè¿›è¡Œ GET è¯·æ±‚çš„æ—¶é—´é—´éš”ï¼Œä½†æ˜¯å¦‚æœ peer çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æˆ–è€…éœ€è¦ä» Tracker è·å–æ›´å¤šçš„ peer å°±ä¼šä¸ç®¡è¿™ä¸ªæ—¶é—´é—´éš”é™åˆ¶è€Œç›´æ¥é‡æ–°è¯·æ±‚ã€‚\n - **peers**ï¼šåˆ—è¡¨ï¼Œæ¯ä¸ªå­é¡¹éƒ½æ˜¯å­—å…¸ï¼Œå­—å…¸çš„é”®åˆ†åˆ«ä¸º **id**ï¼Œ**ip**ï¼Œ**port**ï¼Œåˆ†åˆ«ä¸ GET è¯·æ±‚ä¸­çš„ peer_idï¼Œipï¼Œport å«ä¹‰ä¸€è‡´ï¼Œç”¨äºå”¯ä¸€ç¡®å®šæ¯ä¸ªå…¶ä»– peerã€‚\n\nåœ¨ HTTP Tracker çš„ URL ä¸Šè¿›è¡Œé€‚å½“çš„æ”¹é€ å¯ä»¥å¾—åˆ° Scrape URLï¼ˆåœ¨ [BEP48 - Tracker Protocol Extension: Scrape](http://www.bittorrent.org/beps/bep_0048.html) ä¸­æå‡ºï¼‰ã€‚é€šè¿‡è¯·æ±‚ Scrape URL å¯ä»¥å¾—åˆ°æŒ‡å®š info_hash çš„å½“å‰ peers çš„å¤§è‡´ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤„äºæ´»è·ƒçŠ¶æ€ä¸”å·²å®Œæˆä¸‹è½½ï¼ˆ**complete**ï¼‰çš„ peer æ•°é‡ã€å¤„äºæ´»è·ƒçŠ¶æ€ä½†æœªå®Œæˆä¸‹è½½ï¼ˆ**incomplete**ï¼‰çš„ peer æ•°é‡ã€æ›¾ç»å®Œæˆè¿‡ä¸‹è½½ï¼ˆ**downloaded**ï¼‰çš„ peer æ•°é‡ã€‚æ”¯æŒåŒæ—¶è¯·æ±‚å¤šä¸ª info_hash ã€‚è¿™äº›æ•°æ®å¸®åŠ© peer å†³å®šæ˜¯å¦åº”è¯¥æ‰§è¡Œ Tracker GET è¯·æ±‚ï¼Œä»è€Œä¸€å®šç¨‹åº¦ä¸Šå‡å° HTTP Tracker æœåŠ¡å™¨çš„å‹åŠ›ã€‚\n\nè€Œ UDP æœ¬èº«æ¯” HTTP æ¶ˆè€—æ›´å°äº›ï¼Œä¸”ç›´æ¥å®ç°äº† Scrape è¯·æ±‚ã€‚\n\n## UDP Tracker\nç”±äº HTTP æ˜¯åŸºäº TCP çš„ï¼Œè¿æ¥çš„æ‰“å¼€å’Œå…³é—­ä¼šå¸¦æ¥ä¸€å®šæŸè€—ã€‚è¿™ç§ç±»ä¼¼çš„å‘ç°æœåŠ¡ä½¿ç”¨ UDP å¯ä»¥å¤§å¤§é™ä½ Tracker æœåŠ¡å™¨çš„å‹åŠ›ã€‚[BEP15 - UDP Tracker Protocol](http://www.bittorrent.org/beps/bep_0015.html) æå‡ºäº†åŸºäº UDP çš„ Tracker æ–¹æ¡ˆã€‚\n\nä¸ºäº†é˜²æ­¢ UDP Flood æ”»å‡»ï¼Œpeer ä¸ UDP Tracker çš„é€šä¿¡ä¼šé¦–å…ˆé€šè¿‡ **connect** åŠ¨ä½œè¿›è¡Œç±»ä¼¼ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œçº¦å®šä¸€ä¸ª connection_idï¼Œä¹‹åæ‰€æœ‰çš„åŠ¨ä½œéƒ½ä¼šä½¿ç”¨è¿™ä¸ª connection_idã€‚**announce** åŠ¨ä½œå¯ä»¥å‘ UDP Tracker å®Œæˆç±»ä¼¼å¯¹ HTTP Tracker çš„ GET è¯·æ±‚ã€‚ä½¿ç”¨ **scrape** åŠ¨ä½œå®Œæˆç±»ä¼¼å¯¹ HTTP Tracker çš„ Scrape è¯·æ±‚ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼ŒTracker ä¼šè§¦å‘ **error** åŠ¨ä½œã€‚\n\nGET è¯·æ±‚å¦‚æœéœ€è¦æ‰©å±•å‚æ•°åªéœ€è¦åœ¨è¯·æ±‚çš„ URL ä¸­å¢åŠ ç›¸å…³çš„å‚æ•°å³å¯ï¼Œåœ¨ UDP Tracker ä¸­ï¼Œå®ç°è¿™ç§å¢åŠ å‚æ•°çš„å¯æ‰©å±•æ€§åˆ™éœ€è¦å¦å¤–æƒ³åŠæ³•ã€‚[BEP41 - UDP Tracker Protocol Extensions](http://www.bittorrent.org/beps/bep_0041.html) å¯¹äºå…¶å®ç°æ–¹æ¡ˆä¸¾äº†ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼šä¸€ä¸ª Tracker æœåŠ¡å™¨æƒ³è¦æé«˜å®ƒçš„è¿è¡Œæ•ˆç‡è€Œé™åˆ¶å…¶æ‰€èƒ½æœåŠ¡çš„ info_hashï¼Œä»–ä»¬è€ƒè™‘åœ¨åœ¨ peer å¯¹ Tracker çš„ URL ä¸­åŠ å…¥ä¸€ä¸ª auth å­—æ®µï¼Œå³è¯¥ info_hash çš„ç­¾åï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼ŒTracker å¯ä»¥é€šè¿‡ Torrent æˆ–è€… Magnet å‘å¸ƒè¿™ä¸ªå¸¦æœ‰ info_hash ç­¾åçš„ Tracker URLï¼Œpeer å¯¹è¯¥ Tracker çš„è¯·æ±‚æ—¶å¸¦ä¸Šè¯¥ç­¾åï¼ŒTracker å°±å¯ä»¥éªŒè¯è¿™ä¸ªç­¾åæ˜¯å¦ä¸ info_hash ç›¸åŒ¹é…ä»¥åŠè¿™ä¸ª info_hash æ˜¯å¦åœ¨å…¶æœåŠ¡çš„èŒƒå›´ï¼Œä»è€Œå®ç°é™åˆ¶ã€‚\n\næ¯”å¦‚ Tracker åœ¨ä¸€ä¸ª Magnet ä¸­é™„åŠ çš„ tr å‚æ•°å¦‚ä¸‹ï¼Œauth å­—æ®µå°±æ˜¯æŒ‡çš„ info_hash çš„ç¤ºä¾‹ç­¾åï¼š\n```\nudp://tracker.example.com:80/?auth=0xA0B1C\n```\nå®ç° BEP41 æ–¹æ¡ˆåçš„å®¢æˆ·ç«¯åœ¨å¯¹ UDP Tracker å‘èµ· **announce** è¯·æ±‚åŠ¨ä½œæ—¶ï¼Œä¼šåœ¨åŒ…ä½“å°¾éƒ¨æ·»åŠ å¦‚ä¸‹å­—èŠ‚ï¼š\n```\n0x2, 0xC, '/', 'ï¼Ÿ', 'a', 'u', 't', 'h', '=', 'A', '0', 'B', '1', 'C', 0x1, 0x1, 0x0\n```\n`0x2` è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ **URLData**ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šç´§è·Ÿç€ä¸¤ä¸ªå‚æ•°ï¼Œ`0xC` è¡¨ç¤ºåé¢çš„å†…å®¹é•¿åº¦ä¸º 12ï¼Œåç»­çš„ 12 å­—èŠ‚å°±æ˜¯ URLData çš„å†…å®¹ï¼›`0x1` è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ **NOP** ,å³å¡«å……å­—èŠ‚ï¼Œè¿ç»­ä¸¤ä¸ª `0x1` è¡¨ç¤ºå¡«å……ä¸¤ä¸ªå­—èŠ‚ï¼Œ`0x0` è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ **EndOfOptions**ï¼Œå³ç»“æŸæ ‡å¿—ã€‚æœ€åä¸‰ä¸ªé€‰é¡¹ä¸æ˜¯å¿…é¡»çš„ï¼Œè¿™é‡ŒåŠ å…¥ä»–ä»¬åªæ˜¯è¯´æ˜æœ‰è¿™äº›é€‰é¡¹ã€‚\n\nå½“ç„¶è¿™é‡Œä¾‹å­åœ¨ HTTP Tracker ä¸­ä¹Ÿå®¹æ˜“å®ç°ï¼Œä½†æ˜¯ UDP Tracker æœ‰ç€æ›´å¥½çš„ç½‘ç»œä¼˜åŒ–ã€‚\n\n## Tracker ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\nBEP ä¸­è¿˜æœ‰ä¸å°‘æ”¹è¿›ææ¡ˆæ˜¯é’ˆå¯¹ Tracker çš„ï¼š\n### Torrent æ–‡ä»¶å¤š Tracker æ”¯æŒ\nTorrent æ–‡ä»¶ä¸­ **announce** å­—æ®µåªæ”¯æŒå®šä¹‰ä¸€ä¸ª Trackerï¼Œ[BEP12 - Multitracker Metadata Extension](http://www.bittorrent.org/beps/bep_0012.html) ä¸­æå‡ºäº†è®© Torrent æºå¸¦å¤šä¸ª Tracker çš„æ–¹æ¡ˆã€‚\nåœ¨ Torrent æ–‡ä»¶æ ¹èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªé”® **announce-list**ï¼Œè¿™é‡Œç®€æ˜“çš„è¡¨ç¤ºä¸º **/announce-list**ï¼Œä¹‹ååœ¨ Torrent ä¸­å¢åŠ é”®æ—¶ä¹Ÿä¼šç®€æ˜“åœ°è¡¨ç¤ºæˆè¿™æ ·ã€‚å¦‚æœ Torrent æ–‡ä»¶ä¸­æœ‰ **announce-list**ï¼Œåˆ™ä¼šå¿½ç•¥ **announce**ã€‚**announce-list** æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œ***åˆ—è¡¨çš„æ¯ä¸ªå­é¡¹æ˜¯éƒ½æ˜¯ä¸€ä¸ªå­é¡¹æ˜¯ Tracker URL çš„åˆ—è¡¨***ã€‚ä¹‹æ‰€ä»¥æ˜¯ä¸€ä¸ªå­é¡¹ä¸ºåˆ—è¡¨çš„åˆ—è¡¨çš„åŸå› åœ¨ BEP12 ä¸­æœ‰è¯¦ç»†çš„ä»‹ç»ä¸ä¸¾ä¾‹ã€‚æ­¤å¤„ä¸è¯¦ç»†å±•å¼€ã€‚\n\n### DNS è¾…åŠ©çº æ­£ Tracker åœ°å€\nè€ƒè™‘åˆ°éƒ¨åˆ†ç§å­ä¸­çš„ Tracker æœåŠ¡å™¨å¯èƒ½å˜æ›´æœåŠ¡ç«¯å£æˆ–è€…è®² HTTP æœåŠ¡æ”¹ä¸º UDP æœåŠ¡ã€‚[BEP34 - DNS Tracker Preferences](http://www.bittorrent.org/beps/bep_0034.html) ä¸€ç§åŸºäº DNS çš„è§£å†³æ–¹æ¡ˆã€‚\nå¦‚æœå®¢æˆ·ç«¯å‘ç°è‡ªå·±æ‰€è¯·æ±‚çš„ Tracker æ²¡æœ‰ç›¸åº”ï¼Œåˆ™å¯ä»¥æŸ¥è¯¢ç›¸åº”åŸŸåçš„ DNS TXT è®°å½•ã€‚å¦‚æœæœ‰ TXT è®°å½•æ˜¯ä»¥ â€BITTORRENTâ€œ å¼€å¤´ï¼Œåˆ™å¯ä»¥å¯¹è¿™ä¸ª Tracker åœ°å€è¿›è¡Œçº æ­£ã€‚è¿™ç±» TXT è®°å½•æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š\n - \"BITTORRENT\"ï¼šè¡¨æ˜è¯¥ä¸»æœºä¸å†è¿è¡Œä»»ä½• Tracker æœåŠ¡ã€‚\n - \"BITTORRENT DENY ALL\"ï¼šå’Œå‰ä¸€ä¸ªä¸€è‡´ï¼Œä½†æ˜¯è¡¨æ„æ›´åŠ æ˜æ˜¾ã€‚\n - \"BITTORRENT UDP:1337 TCP:80\"ï¼šè¡¨ç¤ºè¿™ä¸ªä¸»æœºè¿è¡Œä¸¤ä¸ª Tracker æœåŠ¡ï¼Œåˆ†åˆ«æ—¶åœ¨ UDP ç«¯å£ 1337 å’Œ TCP ç«¯å£ 80 ä¸Šï¼Œä¸”ä¼˜å…ˆå»ºè®®ä½¿ç”¨ UDP ç«¯å£ã€‚\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç›¸å…³çš„ TXT è®°å½•æŸ¥è¯¢è¿‡ç¨‹ï¼Œè¿™ä¸ªä¸»æœºåœ¨å¤šä¸ª UDP ç«¯å£ä¸Šè¿è¡Œäº† Tracker æœåŠ¡ï¼š\n{% include_code dig txt lang:shell bt_dig_dns_txt.txt %}\n\n### Tracker è¿”å›å…¬ç½‘ IP\n[BEP24 - Tracker Returns External IP](http://www.bittorrent.org/beps/bep_0024.html) é€šè¿‡åœ¨ GET è¯·æ±‚çš„è¿”å›ä¸­ï¼ˆUDP ä¹Ÿé€‚ç”¨ï¼Œä¸‹åŒï¼‰å¢åŠ ä¸€ä¸ª **external ip** å­—æ®µæ¥å‘ŠçŸ¥å‘èµ·è¯·æ±‚çš„ peer è‡ªèº«çš„å…¬ç½‘ IPã€‚[Todo:å®¢æˆ·ç«¯éœ€è¦çŸ¥é“è‡ªå·±çš„å…¬ç½‘ IP åšä»€ä¹ˆç”¨æš‚æ—¶è¿˜ä¸å¤ªæ¸…æ¥š......ff]\né€šè¿‡ peer é—´çš„ yourip æ‰©å±•æ¶ˆæ¯ä¹Ÿå¯ä»¥è·å¾—è‡ªèº«çš„å…¬ç½‘ IPã€‚\n\n### Tracker è¿”å›å‹ç¼© peer åˆ—è¡¨\n[BEP23 - Tracker Returns Compact Peer Lists](http://www.bittorrent.org/beps/bep_0023.html) æå‡ºäº†ä¸€ç§å‹ç¼© GET è¯·æ±‚è¿”å›ä¸­ peers å­—æ®µå€¼çš„æ–¹å¼ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å° Tracker æœåŠ¡å™¨çš„æµé‡å‹åŠ›ã€‚\nè¿™ç§æ–¹æ¡ˆçš„è¿”å›å€¼ä¸­ peers å­—æ®µä¸å†æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç”±ä»£è¡¨æ¯ä¸ª peer çš„å…­ä¸ªå­—èŠ‚ï¼ˆ4 ä¸ªå­—èŠ‚ç”¨äº IP åœ°å€ï¼Œ2 ä¸ªå­—èŠ‚ç”¨äºç«¯å£ï¼‰æ‹¼æ¥è€Œæˆã€‚å»é™¤äº† peer_id è¿™ä¸ªå­—æ®µï¼Œäº‹å®è¯æ˜æ²¡æœ‰è¿™ä¸ªå­—æ®µä¹Ÿæ²¡ä»€ä¹ˆå…³ç³»ã€‚\nPeer é€šè¿‡åœ¨ GET è¯·æ±‚ä¸­å¢åŠ  **compact** å‚æ•°æ¥å‘ŠçŸ¥ Tracker æœåŠ¡å™¨è‡ªå·±æ›´å–œæ¬¢ä»€ä¹ˆæ ¼å¼ï¼Œ0 ä¸ºåŸå§‹æ ¼å¼ï¼Œ1 ä¸ºå‹ç¼©æ ¼å¼ã€‚ä½†æ˜¯ Tracker ä¸ä¸€å®šä¼šæ¥å—è¿™ä¸ªå‚æ•°çš„å»ºè®®ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä»ç„¶éœ€è¦åŒæ—¶æ”¯æŒä¸¤ç§æ ¼å¼ã€‚\n\n### IPv6 æ”¯æŒ\n[BEP7 - IPv6 Tracker Extension](http://www.bittorrent.org/beps/bep_0007.html) æä¾›äº†ä¼˜åŒ– Tracker å¯¹ IPv6 æ”¯æŒçš„æ–¹æ¡ˆã€‚\né€šè¿‡åœ¨ GET è¯·æ±‚ä¸­å¢åŠ  **ipv6** å‚æ•°æˆ–è€… **ipv4** å‚æ•°æ¥å‘ŠçŸ¥ Tracker æœåŠ¡å™¨è‡ªå·±çš„ç›¸åº” IP ç‰ˆæœ¬çš„åœ°å€ï¼Œå¦‚æœåœ¨è¿™ä¸¤ä¸ªå­—æ®µä¸­æ²¡æœ‰ç«¯å£ä¿¡æ¯ï¼Œé‚£ä¹ˆå°† **port** å­—æ®µä½œä¸ºç«¯å£ã€‚å¦‚æœ Tracker compact æ ¼å¼è¿”å› peer åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨å›å¤ä¸­å¢åŠ  **peers6** å­—æ®µä»¥è¿”å›ä½¿ç”¨ IPv6 çš„ peerï¼Œæ¯ä¸ª peer å ç”¨ 18 å­—èŠ‚ã€‚ç¼–ç æ–¹å¼ä¸ peers å­—æ®µä¸€è‡´ã€‚\n\n## å‚è€ƒèµ„æ–™","source":"_posts/bt-tracker.md","raw":"---\ntitle: BT å¢å¼ºå»ºè®®ä¹‹ Tracker\ntags:\n  - BT\ndate: 2018-08-27 00:00:00\ncategories:\n---\n\næœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç»ç§å­æ–‡ä»¶ç»“æ„ä¸ç£åŠ›é“¾æ¥çš„åŸç†ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡{% post_link bt-overview %}ã€‚\n\np2p æ˜¯ peer-to-peer çš„ç¼©å†™ï¼Œä¸ºäº†è®©ç½‘ç»œä¸­çš„ä¸€ä¸ª peer å¦‚ä½•æ‰èƒ½æ‰¾åˆ°å¦å¤–å¿—åŒé“åˆçš„ peerï¼ŒTracker æ‰®æ¼”ç€è‡³å…³é‡è¦çš„æœˆè€ä½œç”¨ã€‚Tracker æ˜¯ä¸€ä¸ª HTTP æˆ–è€… UDP æœåŠ¡å™¨ï¼Œä½œç”¨æ˜¯å¸®åŠ© peer æ‰¾åˆ°å…¶ä»–æ‹¥æœ‰ç›¸åŒèµ„æºçš„ peerã€‚\n\nåæ¥æœ‰äº† DHT ç½‘ç»œä¹‹åï¼ŒTracker çš„ä½œç”¨é€æ¸å¼±åŒ–ï¼Œä½†æ˜¯ Tracker ä»£è¡¨çš„è¿™ç§ä¸­å¿ƒåŒ–ä¸€å®šç¨‹åº¦ä¸Šç›¸å¯¹ DHT ä»£è¡¨çš„å»ä¸­å¿ƒåŒ–æ•ˆç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚å¦‚åŒåœ¨æ¦‚è¿°å‰è¨€ä¸­æ‰€è¯´çš„ä¸€æ ·ï¼Œâ€è¿‡æ—¶â€œçš„æŠ€æœ¯æŸäº›æƒ…å†µä¸‹æ˜¯ä¼šâ€œå¤æ´»\"çš„ï¼Œæ‰€ä»¥äº†è§£ä¸€ä¸‹ Tracker çš„å·¥ä½œåŸç†å¹¶ä¸æ˜¯åäº‹ã€‚\n\n## HTTP Tracker\nHTTP Tracker å¤„ç†çš„æ¥è‡ª peer çš„ GET è¯·æ±‚åŒ…æ‹¬ä»¥ä¸‹å‚æ•°ï¼š\n - **info_hash**ï¼šå³éœ€è¦ä¸‹è½½çš„èµ„æºçš„ torrent æ–‡ä»¶çš„ info éƒ¨åˆ†çš„ SHA1 å€¼ï¼Œæˆ–è€…ç£åŠ›é“¾æ¥ä¸­çš„ xt å€¼ã€‚\n - **peer_id**ï¼šæ ‡ç¤ºè¿™ä¸ªå®¢æˆ·ç«¯çš„å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ä¼šåŒ…å«å®¢æˆ·ç«¯çš„ç‰ˆæœ¬ä¿¡æ¯ä»¥åŠéšæœºæ•°æ®ï¼ˆ[BEP20 - Peer ID Conventions](http://www.bittorrent.org/beps/bep_0020.html)ï¼‰ã€‚\n - **ip**ï¼šå¯é€‰ï¼Œpeer çš„ IPã€‚\n - **port**ï¼šå¯é€‰ï¼Œpeer ç›‘å¬çš„ç«¯å£ï¼Œä¸€èˆ¬æ˜¯ 6881ã€‚ç†è®ºä¸Š Tracker åº”è¯¥éœ€è¦å¯¹è¿™ä¸ª ip å’Œ port çš„ç»„åˆè¿›è¡Œ NAT æ£€æŸ¥ã€‚\n - **uploaded**ï¼šè¯¥èµ„æºè‡³ä»Šä¸ºæ­¢çš„ä¸Šä¼ å­—èŠ‚æ•°ã€‚\n - **downloaded**ï¼šè¯¥èµ„æºè‡³ä»Šä¸ºæ­¢çš„ä¸‹è½½å­—èŠ‚æ•°ã€‚\n - **left**ï¼šè¯¥èµ„æºå‰©ä½™æœªå®Œæˆä¸‹è½½çš„å­—èŠ‚æ•°ã€‚\n - **event**ï¼šå¯é€‰ï¼Œå½“å‰èµ„æºä¸‹è½½çŠ¶æ€ï¼Œå¯ä»¥æ˜¯`started`ï¼Œ`completed`ï¼Œ`stopped`ï¼Œæ¯æ¬¡å‘ç”ŸçŠ¶æ€å˜åŒ–æ—¶è¿›è¡Œé€šå‘Šã€‚\n\nè¿™ä¸ªè¯·æ±‚çš„å›å¤æ˜¯ä½¿ç”¨ bencode ç¼–ç çš„å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š\n - **failure reason**ï¼šå­—ç¬¦ä¸²ï¼Œå¦‚æœè¯·æ±‚å¤±è´¥å°±ä¼šæœ‰è¿™ä¸ªé”®ï¼Œè¡¨ç¤ºå¤±è´¥çš„åŸå› ï¼Œå¦å¤– [BEP31 - Failure Retry Extension](http://www.bittorrent.org/beps/bep_0031.html) ä¸­å®šä¹‰äº†ä¸€ä¸ª **retry in** å­—æ®µæ¥å‘ŠçŸ¥å‘èµ·è¯·æ±‚çš„ peer é‡è¯•é—´éš”åˆ†é’Ÿæ•°ï¼Œæˆ–è€…æ°¸è¿œä¸è¿›è¡Œé‡è¯•ã€‚å¦‚æœæˆåŠŸå°±ä¼šæœ‰ä»¥ä¸‹ä¸¤ä¸ªé”®ã€‚\n - **interval**ï¼šæ•´å‹ï¼Œå‘ŠçŸ¥ peer ä¹‹åè¿›è¡Œ GET è¯·æ±‚çš„æ—¶é—´é—´éš”ï¼Œä½†æ˜¯å¦‚æœ peer çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æˆ–è€…éœ€è¦ä» Tracker è·å–æ›´å¤šçš„ peer å°±ä¼šä¸ç®¡è¿™ä¸ªæ—¶é—´é—´éš”é™åˆ¶è€Œç›´æ¥é‡æ–°è¯·æ±‚ã€‚\n - **peers**ï¼šåˆ—è¡¨ï¼Œæ¯ä¸ªå­é¡¹éƒ½æ˜¯å­—å…¸ï¼Œå­—å…¸çš„é”®åˆ†åˆ«ä¸º **id**ï¼Œ**ip**ï¼Œ**port**ï¼Œåˆ†åˆ«ä¸ GET è¯·æ±‚ä¸­çš„ peer_idï¼Œipï¼Œport å«ä¹‰ä¸€è‡´ï¼Œç”¨äºå”¯ä¸€ç¡®å®šæ¯ä¸ªå…¶ä»– peerã€‚\n\nåœ¨ HTTP Tracker çš„ URL ä¸Šè¿›è¡Œé€‚å½“çš„æ”¹é€ å¯ä»¥å¾—åˆ° Scrape URLï¼ˆåœ¨ [BEP48 - Tracker Protocol Extension: Scrape](http://www.bittorrent.org/beps/bep_0048.html) ä¸­æå‡ºï¼‰ã€‚é€šè¿‡è¯·æ±‚ Scrape URL å¯ä»¥å¾—åˆ°æŒ‡å®š info_hash çš„å½“å‰ peers çš„å¤§è‡´ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤„äºæ´»è·ƒçŠ¶æ€ä¸”å·²å®Œæˆä¸‹è½½ï¼ˆ**complete**ï¼‰çš„ peer æ•°é‡ã€å¤„äºæ´»è·ƒçŠ¶æ€ä½†æœªå®Œæˆä¸‹è½½ï¼ˆ**incomplete**ï¼‰çš„ peer æ•°é‡ã€æ›¾ç»å®Œæˆè¿‡ä¸‹è½½ï¼ˆ**downloaded**ï¼‰çš„ peer æ•°é‡ã€‚æ”¯æŒåŒæ—¶è¯·æ±‚å¤šä¸ª info_hash ã€‚è¿™äº›æ•°æ®å¸®åŠ© peer å†³å®šæ˜¯å¦åº”è¯¥æ‰§è¡Œ Tracker GET è¯·æ±‚ï¼Œä»è€Œä¸€å®šç¨‹åº¦ä¸Šå‡å° HTTP Tracker æœåŠ¡å™¨çš„å‹åŠ›ã€‚\n\nè€Œ UDP æœ¬èº«æ¯” HTTP æ¶ˆè€—æ›´å°äº›ï¼Œä¸”ç›´æ¥å®ç°äº† Scrape è¯·æ±‚ã€‚\n\n## UDP Tracker\nç”±äº HTTP æ˜¯åŸºäº TCP çš„ï¼Œè¿æ¥çš„æ‰“å¼€å’Œå…³é—­ä¼šå¸¦æ¥ä¸€å®šæŸè€—ã€‚è¿™ç§ç±»ä¼¼çš„å‘ç°æœåŠ¡ä½¿ç”¨ UDP å¯ä»¥å¤§å¤§é™ä½ Tracker æœåŠ¡å™¨çš„å‹åŠ›ã€‚[BEP15 - UDP Tracker Protocol](http://www.bittorrent.org/beps/bep_0015.html) æå‡ºäº†åŸºäº UDP çš„ Tracker æ–¹æ¡ˆã€‚\n\nä¸ºäº†é˜²æ­¢ UDP Flood æ”»å‡»ï¼Œpeer ä¸ UDP Tracker çš„é€šä¿¡ä¼šé¦–å…ˆé€šè¿‡ **connect** åŠ¨ä½œè¿›è¡Œç±»ä¼¼ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œçº¦å®šä¸€ä¸ª connection_idï¼Œä¹‹åæ‰€æœ‰çš„åŠ¨ä½œéƒ½ä¼šä½¿ç”¨è¿™ä¸ª connection_idã€‚**announce** åŠ¨ä½œå¯ä»¥å‘ UDP Tracker å®Œæˆç±»ä¼¼å¯¹ HTTP Tracker çš„ GET è¯·æ±‚ã€‚ä½¿ç”¨ **scrape** åŠ¨ä½œå®Œæˆç±»ä¼¼å¯¹ HTTP Tracker çš„ Scrape è¯·æ±‚ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼ŒTracker ä¼šè§¦å‘ **error** åŠ¨ä½œã€‚\n\nGET è¯·æ±‚å¦‚æœéœ€è¦æ‰©å±•å‚æ•°åªéœ€è¦åœ¨è¯·æ±‚çš„ URL ä¸­å¢åŠ ç›¸å…³çš„å‚æ•°å³å¯ï¼Œåœ¨ UDP Tracker ä¸­ï¼Œå®ç°è¿™ç§å¢åŠ å‚æ•°çš„å¯æ‰©å±•æ€§åˆ™éœ€è¦å¦å¤–æƒ³åŠæ³•ã€‚[BEP41 - UDP Tracker Protocol Extensions](http://www.bittorrent.org/beps/bep_0041.html) å¯¹äºå…¶å®ç°æ–¹æ¡ˆä¸¾äº†ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼šä¸€ä¸ª Tracker æœåŠ¡å™¨æƒ³è¦æé«˜å®ƒçš„è¿è¡Œæ•ˆç‡è€Œé™åˆ¶å…¶æ‰€èƒ½æœåŠ¡çš„ info_hashï¼Œä»–ä»¬è€ƒè™‘åœ¨åœ¨ peer å¯¹ Tracker çš„ URL ä¸­åŠ å…¥ä¸€ä¸ª auth å­—æ®µï¼Œå³è¯¥ info_hash çš„ç­¾åï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼ŒTracker å¯ä»¥é€šè¿‡ Torrent æˆ–è€… Magnet å‘å¸ƒè¿™ä¸ªå¸¦æœ‰ info_hash ç­¾åçš„ Tracker URLï¼Œpeer å¯¹è¯¥ Tracker çš„è¯·æ±‚æ—¶å¸¦ä¸Šè¯¥ç­¾åï¼ŒTracker å°±å¯ä»¥éªŒè¯è¿™ä¸ªç­¾åæ˜¯å¦ä¸ info_hash ç›¸åŒ¹é…ä»¥åŠè¿™ä¸ª info_hash æ˜¯å¦åœ¨å…¶æœåŠ¡çš„èŒƒå›´ï¼Œä»è€Œå®ç°é™åˆ¶ã€‚\n\næ¯”å¦‚ Tracker åœ¨ä¸€ä¸ª Magnet ä¸­é™„åŠ çš„ tr å‚æ•°å¦‚ä¸‹ï¼Œauth å­—æ®µå°±æ˜¯æŒ‡çš„ info_hash çš„ç¤ºä¾‹ç­¾åï¼š\n```\nudp://tracker.example.com:80/?auth=0xA0B1C\n```\nå®ç° BEP41 æ–¹æ¡ˆåçš„å®¢æˆ·ç«¯åœ¨å¯¹ UDP Tracker å‘èµ· **announce** è¯·æ±‚åŠ¨ä½œæ—¶ï¼Œä¼šåœ¨åŒ…ä½“å°¾éƒ¨æ·»åŠ å¦‚ä¸‹å­—èŠ‚ï¼š\n```\n0x2, 0xC, '/', 'ï¼Ÿ', 'a', 'u', 't', 'h', '=', 'A', '0', 'B', '1', 'C', 0x1, 0x1, 0x0\n```\n`0x2` è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ **URLData**ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šç´§è·Ÿç€ä¸¤ä¸ªå‚æ•°ï¼Œ`0xC` è¡¨ç¤ºåé¢çš„å†…å®¹é•¿åº¦ä¸º 12ï¼Œåç»­çš„ 12 å­—èŠ‚å°±æ˜¯ URLData çš„å†…å®¹ï¼›`0x1` è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ **NOP** ,å³å¡«å……å­—èŠ‚ï¼Œè¿ç»­ä¸¤ä¸ª `0x1` è¡¨ç¤ºå¡«å……ä¸¤ä¸ªå­—èŠ‚ï¼Œ`0x0` è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ **EndOfOptions**ï¼Œå³ç»“æŸæ ‡å¿—ã€‚æœ€åä¸‰ä¸ªé€‰é¡¹ä¸æ˜¯å¿…é¡»çš„ï¼Œè¿™é‡ŒåŠ å…¥ä»–ä»¬åªæ˜¯è¯´æ˜æœ‰è¿™äº›é€‰é¡¹ã€‚\n\nå½“ç„¶è¿™é‡Œä¾‹å­åœ¨ HTTP Tracker ä¸­ä¹Ÿå®¹æ˜“å®ç°ï¼Œä½†æ˜¯ UDP Tracker æœ‰ç€æ›´å¥½çš„ç½‘ç»œä¼˜åŒ–ã€‚\n\n## Tracker ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\nBEP ä¸­è¿˜æœ‰ä¸å°‘æ”¹è¿›ææ¡ˆæ˜¯é’ˆå¯¹ Tracker çš„ï¼š\n### Torrent æ–‡ä»¶å¤š Tracker æ”¯æŒ\nTorrent æ–‡ä»¶ä¸­ **announce** å­—æ®µåªæ”¯æŒå®šä¹‰ä¸€ä¸ª Trackerï¼Œ[BEP12 - Multitracker Metadata Extension](http://www.bittorrent.org/beps/bep_0012.html) ä¸­æå‡ºäº†è®© Torrent æºå¸¦å¤šä¸ª Tracker çš„æ–¹æ¡ˆã€‚\nåœ¨ Torrent æ–‡ä»¶æ ¹èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªé”® **announce-list**ï¼Œè¿™é‡Œç®€æ˜“çš„è¡¨ç¤ºä¸º **/announce-list**ï¼Œä¹‹ååœ¨ Torrent ä¸­å¢åŠ é”®æ—¶ä¹Ÿä¼šç®€æ˜“åœ°è¡¨ç¤ºæˆè¿™æ ·ã€‚å¦‚æœ Torrent æ–‡ä»¶ä¸­æœ‰ **announce-list**ï¼Œåˆ™ä¼šå¿½ç•¥ **announce**ã€‚**announce-list** æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œ***åˆ—è¡¨çš„æ¯ä¸ªå­é¡¹æ˜¯éƒ½æ˜¯ä¸€ä¸ªå­é¡¹æ˜¯ Tracker URL çš„åˆ—è¡¨***ã€‚ä¹‹æ‰€ä»¥æ˜¯ä¸€ä¸ªå­é¡¹ä¸ºåˆ—è¡¨çš„åˆ—è¡¨çš„åŸå› åœ¨ BEP12 ä¸­æœ‰è¯¦ç»†çš„ä»‹ç»ä¸ä¸¾ä¾‹ã€‚æ­¤å¤„ä¸è¯¦ç»†å±•å¼€ã€‚\n\n### DNS è¾…åŠ©çº æ­£ Tracker åœ°å€\nè€ƒè™‘åˆ°éƒ¨åˆ†ç§å­ä¸­çš„ Tracker æœåŠ¡å™¨å¯èƒ½å˜æ›´æœåŠ¡ç«¯å£æˆ–è€…è®² HTTP æœåŠ¡æ”¹ä¸º UDP æœåŠ¡ã€‚[BEP34 - DNS Tracker Preferences](http://www.bittorrent.org/beps/bep_0034.html) ä¸€ç§åŸºäº DNS çš„è§£å†³æ–¹æ¡ˆã€‚\nå¦‚æœå®¢æˆ·ç«¯å‘ç°è‡ªå·±æ‰€è¯·æ±‚çš„ Tracker æ²¡æœ‰ç›¸åº”ï¼Œåˆ™å¯ä»¥æŸ¥è¯¢ç›¸åº”åŸŸåçš„ DNS TXT è®°å½•ã€‚å¦‚æœæœ‰ TXT è®°å½•æ˜¯ä»¥ â€BITTORRENTâ€œ å¼€å¤´ï¼Œåˆ™å¯ä»¥å¯¹è¿™ä¸ª Tracker åœ°å€è¿›è¡Œçº æ­£ã€‚è¿™ç±» TXT è®°å½•æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š\n - \"BITTORRENT\"ï¼šè¡¨æ˜è¯¥ä¸»æœºä¸å†è¿è¡Œä»»ä½• Tracker æœåŠ¡ã€‚\n - \"BITTORRENT DENY ALL\"ï¼šå’Œå‰ä¸€ä¸ªä¸€è‡´ï¼Œä½†æ˜¯è¡¨æ„æ›´åŠ æ˜æ˜¾ã€‚\n - \"BITTORRENT UDP:1337 TCP:80\"ï¼šè¡¨ç¤ºè¿™ä¸ªä¸»æœºè¿è¡Œä¸¤ä¸ª Tracker æœåŠ¡ï¼Œåˆ†åˆ«æ—¶åœ¨ UDP ç«¯å£ 1337 å’Œ TCP ç«¯å£ 80 ä¸Šï¼Œä¸”ä¼˜å…ˆå»ºè®®ä½¿ç”¨ UDP ç«¯å£ã€‚\n\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç›¸å…³çš„ TXT è®°å½•æŸ¥è¯¢è¿‡ç¨‹ï¼Œè¿™ä¸ªä¸»æœºåœ¨å¤šä¸ª UDP ç«¯å£ä¸Šè¿è¡Œäº† Tracker æœåŠ¡ï¼š\n{% include_code dig txt lang:shell bt_dig_dns_txt.txt %}\n\n### Tracker è¿”å›å…¬ç½‘ IP\n[BEP24 - Tracker Returns External IP](http://www.bittorrent.org/beps/bep_0024.html) é€šè¿‡åœ¨ GET è¯·æ±‚çš„è¿”å›ä¸­ï¼ˆUDP ä¹Ÿé€‚ç”¨ï¼Œä¸‹åŒï¼‰å¢åŠ ä¸€ä¸ª **external ip** å­—æ®µæ¥å‘ŠçŸ¥å‘èµ·è¯·æ±‚çš„ peer è‡ªèº«çš„å…¬ç½‘ IPã€‚[Todo:å®¢æˆ·ç«¯éœ€è¦çŸ¥é“è‡ªå·±çš„å…¬ç½‘ IP åšä»€ä¹ˆç”¨æš‚æ—¶è¿˜ä¸å¤ªæ¸…æ¥š......ff]\né€šè¿‡ peer é—´çš„ yourip æ‰©å±•æ¶ˆæ¯ä¹Ÿå¯ä»¥è·å¾—è‡ªèº«çš„å…¬ç½‘ IPã€‚\n\n### Tracker è¿”å›å‹ç¼© peer åˆ—è¡¨\n[BEP23 - Tracker Returns Compact Peer Lists](http://www.bittorrent.org/beps/bep_0023.html) æå‡ºäº†ä¸€ç§å‹ç¼© GET è¯·æ±‚è¿”å›ä¸­ peers å­—æ®µå€¼çš„æ–¹å¼ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å° Tracker æœåŠ¡å™¨çš„æµé‡å‹åŠ›ã€‚\nè¿™ç§æ–¹æ¡ˆçš„è¿”å›å€¼ä¸­ peers å­—æ®µä¸å†æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç”±ä»£è¡¨æ¯ä¸ª peer çš„å…­ä¸ªå­—èŠ‚ï¼ˆ4 ä¸ªå­—èŠ‚ç”¨äº IP åœ°å€ï¼Œ2 ä¸ªå­—èŠ‚ç”¨äºç«¯å£ï¼‰æ‹¼æ¥è€Œæˆã€‚å»é™¤äº† peer_id è¿™ä¸ªå­—æ®µï¼Œäº‹å®è¯æ˜æ²¡æœ‰è¿™ä¸ªå­—æ®µä¹Ÿæ²¡ä»€ä¹ˆå…³ç³»ã€‚\nPeer é€šè¿‡åœ¨ GET è¯·æ±‚ä¸­å¢åŠ  **compact** å‚æ•°æ¥å‘ŠçŸ¥ Tracker æœåŠ¡å™¨è‡ªå·±æ›´å–œæ¬¢ä»€ä¹ˆæ ¼å¼ï¼Œ0 ä¸ºåŸå§‹æ ¼å¼ï¼Œ1 ä¸ºå‹ç¼©æ ¼å¼ã€‚ä½†æ˜¯ Tracker ä¸ä¸€å®šä¼šæ¥å—è¿™ä¸ªå‚æ•°çš„å»ºè®®ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä»ç„¶éœ€è¦åŒæ—¶æ”¯æŒä¸¤ç§æ ¼å¼ã€‚\n\n### IPv6 æ”¯æŒ\n[BEP7 - IPv6 Tracker Extension](http://www.bittorrent.org/beps/bep_0007.html) æä¾›äº†ä¼˜åŒ– Tracker å¯¹ IPv6 æ”¯æŒçš„æ–¹æ¡ˆã€‚\né€šè¿‡åœ¨ GET è¯·æ±‚ä¸­å¢åŠ  **ipv6** å‚æ•°æˆ–è€… **ipv4** å‚æ•°æ¥å‘ŠçŸ¥ Tracker æœåŠ¡å™¨è‡ªå·±çš„ç›¸åº” IP ç‰ˆæœ¬çš„åœ°å€ï¼Œå¦‚æœåœ¨è¿™ä¸¤ä¸ªå­—æ®µä¸­æ²¡æœ‰ç«¯å£ä¿¡æ¯ï¼Œé‚£ä¹ˆå°† **port** å­—æ®µä½œä¸ºç«¯å£ã€‚å¦‚æœ Tracker compact æ ¼å¼è¿”å› peer åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨å›å¤ä¸­å¢åŠ  **peers6** å­—æ®µä»¥è¿”å›ä½¿ç”¨ IPv6 çš„ peerï¼Œæ¯ä¸ª peer å ç”¨ 18 å­—èŠ‚ã€‚ç¼–ç æ–¹å¼ä¸ peers å­—æ®µä¸€è‡´ã€‚\n\n## å‚è€ƒèµ„æ–™","slug":"bt-tracker","published":1,"updated":"2020-07-18T06:30:19.514Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuhf0007w80vo0hn8sqj","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>æœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç»ç§å­æ–‡ä»¶ç»“æ„ä¸ç£åŠ›é“¾æ¥çš„åŸç†ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡<a href=\"/2018/08/26/bt-overview/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\">BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°</a>ã€‚</p>\n<p>p2p æ˜¯ peer-to-peer çš„ç¼©å†™ï¼Œä¸ºäº†è®©ç½‘ç»œä¸­çš„ä¸€ä¸ª peer å¦‚ä½•æ‰èƒ½æ‰¾åˆ°å¦å¤–å¿—åŒé“åˆçš„ peerï¼ŒTracker æ‰®æ¼”ç€è‡³å…³é‡è¦çš„æœˆè€ä½œç”¨ã€‚Tracker æ˜¯ä¸€ä¸ª HTTP æˆ–è€… UDP æœåŠ¡å™¨ï¼Œä½œç”¨æ˜¯å¸®åŠ© peer æ‰¾åˆ°å…¶ä»–æ‹¥æœ‰ç›¸åŒèµ„æºçš„ peerã€‚</p>\n<p>åæ¥æœ‰äº† DHT ç½‘ç»œä¹‹åï¼ŒTracker çš„ä½œç”¨é€æ¸å¼±åŒ–ï¼Œä½†æ˜¯ Tracker ä»£è¡¨çš„è¿™ç§ä¸­å¿ƒåŒ–ä¸€å®šç¨‹åº¦ä¸Šç›¸å¯¹ DHT ä»£è¡¨çš„å»ä¸­å¿ƒåŒ–æ•ˆç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚å¦‚åŒåœ¨æ¦‚è¿°å‰è¨€ä¸­æ‰€è¯´çš„ä¸€æ ·ï¼Œâ€è¿‡æ—¶â€œçš„æŠ€æœ¯æŸäº›æƒ…å†µä¸‹æ˜¯ä¼šâ€œå¤æ´»â€çš„ï¼Œæ‰€ä»¥äº†è§£ä¸€ä¸‹ Tracker çš„å·¥ä½œåŸç†å¹¶ä¸æ˜¯åäº‹ã€‚</p>\n<h2 id=\"HTTP-Tracker\"><a href=\"#HTTP-Tracker\" class=\"headerlink\" title=\"HTTP Tracker\"></a>HTTP Tracker</h2><p>HTTP Tracker å¤„ç†çš„æ¥è‡ª peer çš„ GET è¯·æ±‚åŒ…æ‹¬ä»¥ä¸‹å‚æ•°ï¼š</p>\n<ul>\n<li><strong>info_hash</strong>ï¼šå³éœ€è¦ä¸‹è½½çš„èµ„æºçš„ torrent æ–‡ä»¶çš„ info éƒ¨åˆ†çš„ SHA1 å€¼ï¼Œæˆ–è€…ç£åŠ›é“¾æ¥ä¸­çš„ xt å€¼ã€‚</li>\n<li><strong>peer_id</strong>ï¼šæ ‡ç¤ºè¿™ä¸ªå®¢æˆ·ç«¯çš„å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ä¼šåŒ…å«å®¢æˆ·ç«¯çš„ç‰ˆæœ¬ä¿¡æ¯ä»¥åŠéšæœºæ•°æ®ï¼ˆ<a href=\"http://www.bittorrent.org/beps/bep_0020.html\" target=\"_blank\" rel=\"noopener\">BEP20 - Peer ID Conventions</a>ï¼‰ã€‚</li>\n<li><strong>ip</strong>ï¼šå¯é€‰ï¼Œpeer çš„ IPã€‚</li>\n<li><strong>port</strong>ï¼šå¯é€‰ï¼Œpeer ç›‘å¬çš„ç«¯å£ï¼Œä¸€èˆ¬æ˜¯ 6881ã€‚ç†è®ºä¸Š Tracker åº”è¯¥éœ€è¦å¯¹è¿™ä¸ª ip å’Œ port çš„ç»„åˆè¿›è¡Œ NAT æ£€æŸ¥ã€‚</li>\n<li><strong>uploaded</strong>ï¼šè¯¥èµ„æºè‡³ä»Šä¸ºæ­¢çš„ä¸Šä¼ å­—èŠ‚æ•°ã€‚</li>\n<li><strong>downloaded</strong>ï¼šè¯¥èµ„æºè‡³ä»Šä¸ºæ­¢çš„ä¸‹è½½å­—èŠ‚æ•°ã€‚</li>\n<li><strong>left</strong>ï¼šè¯¥èµ„æºå‰©ä½™æœªå®Œæˆä¸‹è½½çš„å­—èŠ‚æ•°ã€‚</li>\n<li><strong>event</strong>ï¼šå¯é€‰ï¼Œå½“å‰èµ„æºä¸‹è½½çŠ¶æ€ï¼Œå¯ä»¥æ˜¯<code>started</code>ï¼Œ<code>completed</code>ï¼Œ<code>stopped</code>ï¼Œæ¯æ¬¡å‘ç”ŸçŠ¶æ€å˜åŒ–æ—¶è¿›è¡Œé€šå‘Šã€‚</li>\n</ul>\n<p>è¿™ä¸ªè¯·æ±‚çš„å›å¤æ˜¯ä½¿ç”¨ bencode ç¼–ç çš„å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š</p>\n<ul>\n<li><strong>failure reason</strong>ï¼šå­—ç¬¦ä¸²ï¼Œå¦‚æœè¯·æ±‚å¤±è´¥å°±ä¼šæœ‰è¿™ä¸ªé”®ï¼Œè¡¨ç¤ºå¤±è´¥çš„åŸå› ï¼Œå¦å¤– <a href=\"http://www.bittorrent.org/beps/bep_0031.html\" target=\"_blank\" rel=\"noopener\">BEP31 - Failure Retry Extension</a> ä¸­å®šä¹‰äº†ä¸€ä¸ª <strong>retry in</strong> å­—æ®µæ¥å‘ŠçŸ¥å‘èµ·è¯·æ±‚çš„ peer é‡è¯•é—´éš”åˆ†é’Ÿæ•°ï¼Œæˆ–è€…æ°¸è¿œä¸è¿›è¡Œé‡è¯•ã€‚å¦‚æœæˆåŠŸå°±ä¼šæœ‰ä»¥ä¸‹ä¸¤ä¸ªé”®ã€‚</li>\n<li><strong>interval</strong>ï¼šæ•´å‹ï¼Œå‘ŠçŸ¥ peer ä¹‹åè¿›è¡Œ GET è¯·æ±‚çš„æ—¶é—´é—´éš”ï¼Œä½†æ˜¯å¦‚æœ peer çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æˆ–è€…éœ€è¦ä» Tracker è·å–æ›´å¤šçš„ peer å°±ä¼šä¸ç®¡è¿™ä¸ªæ—¶é—´é—´éš”é™åˆ¶è€Œç›´æ¥é‡æ–°è¯·æ±‚ã€‚</li>\n<li><strong>peers</strong>ï¼šåˆ—è¡¨ï¼Œæ¯ä¸ªå­é¡¹éƒ½æ˜¯å­—å…¸ï¼Œå­—å…¸çš„é”®åˆ†åˆ«ä¸º <strong>id</strong>ï¼Œ<strong>ip</strong>ï¼Œ<strong>port</strong>ï¼Œåˆ†åˆ«ä¸ GET è¯·æ±‚ä¸­çš„ peer_idï¼Œipï¼Œport å«ä¹‰ä¸€è‡´ï¼Œç”¨äºå”¯ä¸€ç¡®å®šæ¯ä¸ªå…¶ä»– peerã€‚</li>\n</ul>\n<p>åœ¨ HTTP Tracker çš„ URL ä¸Šè¿›è¡Œé€‚å½“çš„æ”¹é€ å¯ä»¥å¾—åˆ° Scrape URLï¼ˆåœ¨ <a href=\"http://www.bittorrent.org/beps/bep_0048.html\" target=\"_blank\" rel=\"noopener\">BEP48 - Tracker Protocol Extension: Scrape</a> ä¸­æå‡ºï¼‰ã€‚é€šè¿‡è¯·æ±‚ Scrape URL å¯ä»¥å¾—åˆ°æŒ‡å®š info_hash çš„å½“å‰ peers çš„å¤§è‡´ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤„äºæ´»è·ƒçŠ¶æ€ä¸”å·²å®Œæˆä¸‹è½½ï¼ˆ<strong>complete</strong>ï¼‰çš„ peer æ•°é‡ã€å¤„äºæ´»è·ƒçŠ¶æ€ä½†æœªå®Œæˆä¸‹è½½ï¼ˆ<strong>incomplete</strong>ï¼‰çš„ peer æ•°é‡ã€æ›¾ç»å®Œæˆè¿‡ä¸‹è½½ï¼ˆ<strong>downloaded</strong>ï¼‰çš„ peer æ•°é‡ã€‚æ”¯æŒåŒæ—¶è¯·æ±‚å¤šä¸ª info_hash ã€‚è¿™äº›æ•°æ®å¸®åŠ© peer å†³å®šæ˜¯å¦åº”è¯¥æ‰§è¡Œ Tracker GET è¯·æ±‚ï¼Œä»è€Œä¸€å®šç¨‹åº¦ä¸Šå‡å° HTTP Tracker æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p>\n<p>è€Œ UDP æœ¬èº«æ¯” HTTP æ¶ˆè€—æ›´å°äº›ï¼Œä¸”ç›´æ¥å®ç°äº† Scrape è¯·æ±‚ã€‚</p>\n<h2 id=\"UDP-Tracker\"><a href=\"#UDP-Tracker\" class=\"headerlink\" title=\"UDP Tracker\"></a>UDP Tracker</h2><p>ç”±äº HTTP æ˜¯åŸºäº TCP çš„ï¼Œè¿æ¥çš„æ‰“å¼€å’Œå…³é—­ä¼šå¸¦æ¥ä¸€å®šæŸè€—ã€‚è¿™ç§ç±»ä¼¼çš„å‘ç°æœåŠ¡ä½¿ç”¨ UDP å¯ä»¥å¤§å¤§é™ä½ Tracker æœåŠ¡å™¨çš„å‹åŠ›ã€‚<a href=\"http://www.bittorrent.org/beps/bep_0015.html\" target=\"_blank\" rel=\"noopener\">BEP15 - UDP Tracker Protocol</a> æå‡ºäº†åŸºäº UDP çš„ Tracker æ–¹æ¡ˆã€‚</p>\n<p>ä¸ºäº†é˜²æ­¢ UDP Flood æ”»å‡»ï¼Œpeer ä¸ UDP Tracker çš„é€šä¿¡ä¼šé¦–å…ˆé€šè¿‡ <strong>connect</strong> åŠ¨ä½œè¿›è¡Œç±»ä¼¼ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œçº¦å®šä¸€ä¸ª connection_idï¼Œä¹‹åæ‰€æœ‰çš„åŠ¨ä½œéƒ½ä¼šä½¿ç”¨è¿™ä¸ª connection_idã€‚<strong>announce</strong> åŠ¨ä½œå¯ä»¥å‘ UDP Tracker å®Œæˆç±»ä¼¼å¯¹ HTTP Tracker çš„ GET è¯·æ±‚ã€‚ä½¿ç”¨ <strong>scrape</strong> åŠ¨ä½œå®Œæˆç±»ä¼¼å¯¹ HTTP Tracker çš„ Scrape è¯·æ±‚ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼ŒTracker ä¼šè§¦å‘ <strong>error</strong> åŠ¨ä½œã€‚</p>\n<p>GET è¯·æ±‚å¦‚æœéœ€è¦æ‰©å±•å‚æ•°åªéœ€è¦åœ¨è¯·æ±‚çš„ URL ä¸­å¢åŠ ç›¸å…³çš„å‚æ•°å³å¯ï¼Œåœ¨ UDP Tracker ä¸­ï¼Œå®ç°è¿™ç§å¢åŠ å‚æ•°çš„å¯æ‰©å±•æ€§åˆ™éœ€è¦å¦å¤–æƒ³åŠæ³•ã€‚<a href=\"http://www.bittorrent.org/beps/bep_0041.html\" target=\"_blank\" rel=\"noopener\">BEP41 - UDP Tracker Protocol Extensions</a> å¯¹äºå…¶å®ç°æ–¹æ¡ˆä¸¾äº†ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼šä¸€ä¸ª Tracker æœåŠ¡å™¨æƒ³è¦æé«˜å®ƒçš„è¿è¡Œæ•ˆç‡è€Œé™åˆ¶å…¶æ‰€èƒ½æœåŠ¡çš„ info_hashï¼Œä»–ä»¬è€ƒè™‘åœ¨åœ¨ peer å¯¹ Tracker çš„ URL ä¸­åŠ å…¥ä¸€ä¸ª auth å­—æ®µï¼Œå³è¯¥ info_hash çš„ç­¾åï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼ŒTracker å¯ä»¥é€šè¿‡ Torrent æˆ–è€… Magnet å‘å¸ƒè¿™ä¸ªå¸¦æœ‰ info_hash ç­¾åçš„ Tracker URLï¼Œpeer å¯¹è¯¥ Tracker çš„è¯·æ±‚æ—¶å¸¦ä¸Šè¯¥ç­¾åï¼ŒTracker å°±å¯ä»¥éªŒè¯è¿™ä¸ªç­¾åæ˜¯å¦ä¸ info_hash ç›¸åŒ¹é…ä»¥åŠè¿™ä¸ª info_hash æ˜¯å¦åœ¨å…¶æœåŠ¡çš„èŒƒå›´ï¼Œä»è€Œå®ç°é™åˆ¶ã€‚</p>\n<p>æ¯”å¦‚ Tracker åœ¨ä¸€ä¸ª Magnet ä¸­é™„åŠ çš„ tr å‚æ•°å¦‚ä¸‹ï¼Œauth å­—æ®µå°±æ˜¯æŒ‡çš„ info_hash çš„ç¤ºä¾‹ç­¾åï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">udp://tracker.example.com:80/?auth=0xA0B1C</span><br></pre></td></tr></table></figure>\n\n<p>å®ç° BEP41 æ–¹æ¡ˆåçš„å®¢æˆ·ç«¯åœ¨å¯¹ UDP Tracker å‘èµ· <strong>announce</strong> è¯·æ±‚åŠ¨ä½œæ—¶ï¼Œä¼šåœ¨åŒ…ä½“å°¾éƒ¨æ·»åŠ å¦‚ä¸‹å­—èŠ‚ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0x2, 0xC, &apos;/&apos;, &apos;ï¼Ÿ&apos;, &apos;a&apos;, &apos;u&apos;, &apos;t&apos;, &apos;h&apos;, &apos;=&apos;, &apos;A&apos;, &apos;0&apos;, &apos;B&apos;, &apos;1&apos;, &apos;C&apos;, 0x1, 0x1, 0x0</span><br></pre></td></tr></table></figure>\n\n<p><code>0x2</code> è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ <strong>URLData</strong>ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šç´§è·Ÿç€ä¸¤ä¸ªå‚æ•°ï¼Œ<code>0xC</code> è¡¨ç¤ºåé¢çš„å†…å®¹é•¿åº¦ä¸º 12ï¼Œåç»­çš„ 12 å­—èŠ‚å°±æ˜¯ URLData çš„å†…å®¹ï¼›<code>0x1</code> è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ <strong>NOP</strong> ,å³å¡«å……å­—èŠ‚ï¼Œè¿ç»­ä¸¤ä¸ª <code>0x1</code> è¡¨ç¤ºå¡«å……ä¸¤ä¸ªå­—èŠ‚ï¼Œ<code>0x0</code> è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ <strong>EndOfOptions</strong>ï¼Œå³ç»“æŸæ ‡å¿—ã€‚æœ€åä¸‰ä¸ªé€‰é¡¹ä¸æ˜¯å¿…é¡»çš„ï¼Œè¿™é‡ŒåŠ å…¥ä»–ä»¬åªæ˜¯è¯´æ˜æœ‰è¿™äº›é€‰é¡¹ã€‚</p>\n<p>å½“ç„¶è¿™é‡Œä¾‹å­åœ¨ HTTP Tracker ä¸­ä¹Ÿå®¹æ˜“å®ç°ï¼Œä½†æ˜¯ UDP Tracker æœ‰ç€æ›´å¥½çš„ç½‘ç»œä¼˜åŒ–ã€‚</p>\n<h2 id=\"Tracker-ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\"><a href=\"#Tracker-ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\" class=\"headerlink\" title=\"Tracker ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\"></a>Tracker ç›¸å…³å¢å¼ºæ–¹æ¡ˆ</h2><p>BEP ä¸­è¿˜æœ‰ä¸å°‘æ”¹è¿›ææ¡ˆæ˜¯é’ˆå¯¹ Tracker çš„ï¼š</p>\n<h3 id=\"Torrent-æ–‡ä»¶å¤š-Tracker-æ”¯æŒ\"><a href=\"#Torrent-æ–‡ä»¶å¤š-Tracker-æ”¯æŒ\" class=\"headerlink\" title=\"Torrent æ–‡ä»¶å¤š Tracker æ”¯æŒ\"></a>Torrent æ–‡ä»¶å¤š Tracker æ”¯æŒ</h3><p>Torrent æ–‡ä»¶ä¸­ <strong>announce</strong> å­—æ®µåªæ”¯æŒå®šä¹‰ä¸€ä¸ª Trackerï¼Œ<a href=\"http://www.bittorrent.org/beps/bep_0012.html\" target=\"_blank\" rel=\"noopener\">BEP12 - Multitracker Metadata Extension</a> ä¸­æå‡ºäº†è®© Torrent æºå¸¦å¤šä¸ª Tracker çš„æ–¹æ¡ˆã€‚<br>åœ¨ Torrent æ–‡ä»¶æ ¹èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªé”® <strong>announce-list</strong>ï¼Œè¿™é‡Œç®€æ˜“çš„è¡¨ç¤ºä¸º <strong>/announce-list</strong>ï¼Œä¹‹ååœ¨ Torrent ä¸­å¢åŠ é”®æ—¶ä¹Ÿä¼šç®€æ˜“åœ°è¡¨ç¤ºæˆè¿™æ ·ã€‚å¦‚æœ Torrent æ–‡ä»¶ä¸­æœ‰ <strong>announce-list</strong>ï¼Œåˆ™ä¼šå¿½ç•¥ <strong>announce</strong>ã€‚<strong>announce-list</strong> æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œ**<em>åˆ—è¡¨çš„æ¯ä¸ªå­é¡¹æ˜¯éƒ½æ˜¯ä¸€ä¸ªå­é¡¹æ˜¯ Tracker URL çš„åˆ—è¡¨**</em>ã€‚ä¹‹æ‰€ä»¥æ˜¯ä¸€ä¸ªå­é¡¹ä¸ºåˆ—è¡¨çš„åˆ—è¡¨çš„åŸå› åœ¨ BEP12 ä¸­æœ‰è¯¦ç»†çš„ä»‹ç»ä¸ä¸¾ä¾‹ã€‚æ­¤å¤„ä¸è¯¦ç»†å±•å¼€ã€‚</p>\n<h3 id=\"DNS-è¾…åŠ©çº æ­£-Tracker-åœ°å€\"><a href=\"#DNS-è¾…åŠ©çº æ­£-Tracker-åœ°å€\" class=\"headerlink\" title=\"DNS è¾…åŠ©çº æ­£ Tracker åœ°å€\"></a>DNS è¾…åŠ©çº æ­£ Tracker åœ°å€</h3><p>è€ƒè™‘åˆ°éƒ¨åˆ†ç§å­ä¸­çš„ Tracker æœåŠ¡å™¨å¯èƒ½å˜æ›´æœåŠ¡ç«¯å£æˆ–è€…è®² HTTP æœåŠ¡æ”¹ä¸º UDP æœåŠ¡ã€‚<a href=\"http://www.bittorrent.org/beps/bep_0034.html\" target=\"_blank\" rel=\"noopener\">BEP34 - DNS Tracker Preferences</a> ä¸€ç§åŸºäº DNS çš„è§£å†³æ–¹æ¡ˆã€‚<br>å¦‚æœå®¢æˆ·ç«¯å‘ç°è‡ªå·±æ‰€è¯·æ±‚çš„ Tracker æ²¡æœ‰ç›¸åº”ï¼Œåˆ™å¯ä»¥æŸ¥è¯¢ç›¸åº”åŸŸåçš„ DNS TXT è®°å½•ã€‚å¦‚æœæœ‰ TXT è®°å½•æ˜¯ä»¥ â€BITTORRENTâ€œ å¼€å¤´ï¼Œåˆ™å¯ä»¥å¯¹è¿™ä¸ª Tracker åœ°å€è¿›è¡Œçº æ­£ã€‚è¿™ç±» TXT è®°å½•æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p>\n<ul>\n<li>â€œBITTORRENTâ€ï¼šè¡¨æ˜è¯¥ä¸»æœºä¸å†è¿è¡Œä»»ä½• Tracker æœåŠ¡ã€‚</li>\n<li>â€œBITTORRENT DENY ALLâ€ï¼šå’Œå‰ä¸€ä¸ªä¸€è‡´ï¼Œä½†æ˜¯è¡¨æ„æ›´åŠ æ˜æ˜¾ã€‚</li>\n<li>â€œBITTORRENT UDP:1337 TCP:80â€ï¼šè¡¨ç¤ºè¿™ä¸ªä¸»æœºè¿è¡Œä¸¤ä¸ª Tracker æœåŠ¡ï¼Œåˆ†åˆ«æ—¶åœ¨ UDP ç«¯å£ 1337 å’Œ TCP ç«¯å£ 80 ä¸Šï¼Œä¸”ä¼˜å…ˆå»ºè®®ä½¿ç”¨ UDP ç«¯å£ã€‚</li>\n</ul>\n<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç›¸å…³çš„ TXT è®°å½•æŸ¥è¯¢è¿‡ç¨‹ï¼Œè¿™ä¸ªä¸»æœºåœ¨å¤šä¸ª UDP ç«¯å£ä¸Šè¿è¡Œäº† Tracker æœåŠ¡ï¼š</p>\n<figure class=\"highlight shell\"><figcaption><span>dig txt</span><a href=\"/downloads/code/bt_dig_dns_txt.txt\">view raw</a></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\"> dig 9.rarbg.to txt</span></span><br><span class=\"line\">;; QUESTION SECTION:</span><br><span class=\"line\">;9.rarbg.to.                    IN      TXT</span><br><span class=\"line\"></span><br><span class=\"line\">;; ANSWER SECTION:</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2710\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2720\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2730\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2740\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2750\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2770\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2780\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2790\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2800\"</span><br><span class=\"line\"></span><br><span class=\"line\">;; Query time: 207 msec</span><br><span class=\"line\">;; SERVER: 1.1.1.1#53(1.1.1.1)</span><br><span class=\"line\">;; WHEN: Sat Aug 25 05:46:02 CST 2018</span><br><span class=\"line\">;; MSG SIZE  rcvd: 327</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Tracker-è¿”å›å…¬ç½‘-IP\"><a href=\"#Tracker-è¿”å›å…¬ç½‘-IP\" class=\"headerlink\" title=\"Tracker è¿”å›å…¬ç½‘ IP\"></a>Tracker è¿”å›å…¬ç½‘ IP</h3><p><a href=\"http://www.bittorrent.org/beps/bep_0024.html\" target=\"_blank\" rel=\"noopener\">BEP24 - Tracker Returns External IP</a> é€šè¿‡åœ¨ GET è¯·æ±‚çš„è¿”å›ä¸­ï¼ˆUDP ä¹Ÿé€‚ç”¨ï¼Œä¸‹åŒï¼‰å¢åŠ ä¸€ä¸ª <strong>external ip</strong> å­—æ®µæ¥å‘ŠçŸ¥å‘èµ·è¯·æ±‚çš„ peer è‡ªèº«çš„å…¬ç½‘ IPã€‚[Todo:å®¢æˆ·ç«¯éœ€è¦çŸ¥é“è‡ªå·±çš„å…¬ç½‘ IP åšä»€ä¹ˆç”¨æš‚æ—¶è¿˜ä¸å¤ªæ¸…æ¥šâ€¦â€¦ff]<br>é€šè¿‡ peer é—´çš„ yourip æ‰©å±•æ¶ˆæ¯ä¹Ÿå¯ä»¥è·å¾—è‡ªèº«çš„å…¬ç½‘ IPã€‚</p>\n<h3 id=\"Tracker-è¿”å›å‹ç¼©-peer-åˆ—è¡¨\"><a href=\"#Tracker-è¿”å›å‹ç¼©-peer-åˆ—è¡¨\" class=\"headerlink\" title=\"Tracker è¿”å›å‹ç¼© peer åˆ—è¡¨\"></a>Tracker è¿”å›å‹ç¼© peer åˆ—è¡¨</h3><p><a href=\"http://www.bittorrent.org/beps/bep_0023.html\" target=\"_blank\" rel=\"noopener\">BEP23 - Tracker Returns Compact Peer Lists</a> æå‡ºäº†ä¸€ç§å‹ç¼© GET è¯·æ±‚è¿”å›ä¸­ peers å­—æ®µå€¼çš„æ–¹å¼ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å° Tracker æœåŠ¡å™¨çš„æµé‡å‹åŠ›ã€‚<br>è¿™ç§æ–¹æ¡ˆçš„è¿”å›å€¼ä¸­ peers å­—æ®µä¸å†æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç”±ä»£è¡¨æ¯ä¸ª peer çš„å…­ä¸ªå­—èŠ‚ï¼ˆ4 ä¸ªå­—èŠ‚ç”¨äº IP åœ°å€ï¼Œ2 ä¸ªå­—èŠ‚ç”¨äºç«¯å£ï¼‰æ‹¼æ¥è€Œæˆã€‚å»é™¤äº† peer_id è¿™ä¸ªå­—æ®µï¼Œäº‹å®è¯æ˜æ²¡æœ‰è¿™ä¸ªå­—æ®µä¹Ÿæ²¡ä»€ä¹ˆå…³ç³»ã€‚<br>Peer é€šè¿‡åœ¨ GET è¯·æ±‚ä¸­å¢åŠ  <strong>compact</strong> å‚æ•°æ¥å‘ŠçŸ¥ Tracker æœåŠ¡å™¨è‡ªå·±æ›´å–œæ¬¢ä»€ä¹ˆæ ¼å¼ï¼Œ0 ä¸ºåŸå§‹æ ¼å¼ï¼Œ1 ä¸ºå‹ç¼©æ ¼å¼ã€‚ä½†æ˜¯ Tracker ä¸ä¸€å®šä¼šæ¥å—è¿™ä¸ªå‚æ•°çš„å»ºè®®ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä»ç„¶éœ€è¦åŒæ—¶æ”¯æŒä¸¤ç§æ ¼å¼ã€‚</p>\n<h3 id=\"IPv6-æ”¯æŒ\"><a href=\"#IPv6-æ”¯æŒ\" class=\"headerlink\" title=\"IPv6 æ”¯æŒ\"></a>IPv6 æ”¯æŒ</h3><p><a href=\"http://www.bittorrent.org/beps/bep_0007.html\" target=\"_blank\" rel=\"noopener\">BEP7 - IPv6 Tracker Extension</a> æä¾›äº†ä¼˜åŒ– Tracker å¯¹ IPv6 æ”¯æŒçš„æ–¹æ¡ˆã€‚<br>é€šè¿‡åœ¨ GET è¯·æ±‚ä¸­å¢åŠ  <strong>ipv6</strong> å‚æ•°æˆ–è€… <strong>ipv4</strong> å‚æ•°æ¥å‘ŠçŸ¥ Tracker æœåŠ¡å™¨è‡ªå·±çš„ç›¸åº” IP ç‰ˆæœ¬çš„åœ°å€ï¼Œå¦‚æœåœ¨è¿™ä¸¤ä¸ªå­—æ®µä¸­æ²¡æœ‰ç«¯å£ä¿¡æ¯ï¼Œé‚£ä¹ˆå°† <strong>port</strong> å­—æ®µä½œä¸ºç«¯å£ã€‚å¦‚æœ Tracker compact æ ¼å¼è¿”å› peer åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨å›å¤ä¸­å¢åŠ  <strong>peers6</strong> å­—æ®µä»¥è¿”å›ä½¿ç”¨ IPv6 çš„ peerï¼Œæ¯ä¸ª peer å ç”¨ 18 å­—èŠ‚ã€‚ç¼–ç æ–¹å¼ä¸ peers å­—æ®µä¸€è‡´ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2>","site":{"data":{}},"excerpt":"","more":"<p>æœ¬æ–‡æ˜¯ BT ç³»åˆ—æ–‡ç« ä¸­çš„ä¸€ç¯‡ï¼Œä¸»è¦ä»‹ç»ç§å­æ–‡ä»¶ç»“æ„ä¸ç£åŠ›é“¾æ¥çš„åŸç†ï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å…ˆé˜…è¯»åšæ–‡<a href=\"/2018/08/26/bt-overview/\" title=\"BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°\">BT å¢å¼ºå»ºè®®ä¹‹æ¦‚è¿°</a>ã€‚</p>\n<p>p2p æ˜¯ peer-to-peer çš„ç¼©å†™ï¼Œä¸ºäº†è®©ç½‘ç»œä¸­çš„ä¸€ä¸ª peer å¦‚ä½•æ‰èƒ½æ‰¾åˆ°å¦å¤–å¿—åŒé“åˆçš„ peerï¼ŒTracker æ‰®æ¼”ç€è‡³å…³é‡è¦çš„æœˆè€ä½œç”¨ã€‚Tracker æ˜¯ä¸€ä¸ª HTTP æˆ–è€… UDP æœåŠ¡å™¨ï¼Œä½œç”¨æ˜¯å¸®åŠ© peer æ‰¾åˆ°å…¶ä»–æ‹¥æœ‰ç›¸åŒèµ„æºçš„ peerã€‚</p>\n<p>åæ¥æœ‰äº† DHT ç½‘ç»œä¹‹åï¼ŒTracker çš„ä½œç”¨é€æ¸å¼±åŒ–ï¼Œä½†æ˜¯ Tracker ä»£è¡¨çš„è¿™ç§ä¸­å¿ƒåŒ–ä¸€å®šç¨‹åº¦ä¸Šç›¸å¯¹ DHT ä»£è¡¨çš„å»ä¸­å¿ƒåŒ–æ•ˆç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚å¦‚åŒåœ¨æ¦‚è¿°å‰è¨€ä¸­æ‰€è¯´çš„ä¸€æ ·ï¼Œâ€è¿‡æ—¶â€œçš„æŠ€æœ¯æŸäº›æƒ…å†µä¸‹æ˜¯ä¼šâ€œå¤æ´»â€çš„ï¼Œæ‰€ä»¥äº†è§£ä¸€ä¸‹ Tracker çš„å·¥ä½œåŸç†å¹¶ä¸æ˜¯åäº‹ã€‚</p>\n<h2 id=\"HTTP-Tracker\"><a href=\"#HTTP-Tracker\" class=\"headerlink\" title=\"HTTP Tracker\"></a>HTTP Tracker</h2><p>HTTP Tracker å¤„ç†çš„æ¥è‡ª peer çš„ GET è¯·æ±‚åŒ…æ‹¬ä»¥ä¸‹å‚æ•°ï¼š</p>\n<ul>\n<li><strong>info_hash</strong>ï¼šå³éœ€è¦ä¸‹è½½çš„èµ„æºçš„ torrent æ–‡ä»¶çš„ info éƒ¨åˆ†çš„ SHA1 å€¼ï¼Œæˆ–è€…ç£åŠ›é“¾æ¥ä¸­çš„ xt å€¼ã€‚</li>\n<li><strong>peer_id</strong>ï¼šæ ‡ç¤ºè¿™ä¸ªå®¢æˆ·ç«¯çš„å­—ç¬¦ä¸²ï¼Œä¸€èˆ¬ä¼šåŒ…å«å®¢æˆ·ç«¯çš„ç‰ˆæœ¬ä¿¡æ¯ä»¥åŠéšæœºæ•°æ®ï¼ˆ<a href=\"http://www.bittorrent.org/beps/bep_0020.html\" target=\"_blank\" rel=\"noopener\">BEP20 - Peer ID Conventions</a>ï¼‰ã€‚</li>\n<li><strong>ip</strong>ï¼šå¯é€‰ï¼Œpeer çš„ IPã€‚</li>\n<li><strong>port</strong>ï¼šå¯é€‰ï¼Œpeer ç›‘å¬çš„ç«¯å£ï¼Œä¸€èˆ¬æ˜¯ 6881ã€‚ç†è®ºä¸Š Tracker åº”è¯¥éœ€è¦å¯¹è¿™ä¸ª ip å’Œ port çš„ç»„åˆè¿›è¡Œ NAT æ£€æŸ¥ã€‚</li>\n<li><strong>uploaded</strong>ï¼šè¯¥èµ„æºè‡³ä»Šä¸ºæ­¢çš„ä¸Šä¼ å­—èŠ‚æ•°ã€‚</li>\n<li><strong>downloaded</strong>ï¼šè¯¥èµ„æºè‡³ä»Šä¸ºæ­¢çš„ä¸‹è½½å­—èŠ‚æ•°ã€‚</li>\n<li><strong>left</strong>ï¼šè¯¥èµ„æºå‰©ä½™æœªå®Œæˆä¸‹è½½çš„å­—èŠ‚æ•°ã€‚</li>\n<li><strong>event</strong>ï¼šå¯é€‰ï¼Œå½“å‰èµ„æºä¸‹è½½çŠ¶æ€ï¼Œå¯ä»¥æ˜¯<code>started</code>ï¼Œ<code>completed</code>ï¼Œ<code>stopped</code>ï¼Œæ¯æ¬¡å‘ç”ŸçŠ¶æ€å˜åŒ–æ—¶è¿›è¡Œé€šå‘Šã€‚</li>\n</ul>\n<p>è¿™ä¸ªè¯·æ±‚çš„å›å¤æ˜¯ä½¿ç”¨ bencode ç¼–ç çš„å­—å…¸ï¼Œæœ‰å¦‚ä¸‹çš„é”®ï¼š</p>\n<ul>\n<li><strong>failure reason</strong>ï¼šå­—ç¬¦ä¸²ï¼Œå¦‚æœè¯·æ±‚å¤±è´¥å°±ä¼šæœ‰è¿™ä¸ªé”®ï¼Œè¡¨ç¤ºå¤±è´¥çš„åŸå› ï¼Œå¦å¤– <a href=\"http://www.bittorrent.org/beps/bep_0031.html\" target=\"_blank\" rel=\"noopener\">BEP31 - Failure Retry Extension</a> ä¸­å®šä¹‰äº†ä¸€ä¸ª <strong>retry in</strong> å­—æ®µæ¥å‘ŠçŸ¥å‘èµ·è¯·æ±‚çš„ peer é‡è¯•é—´éš”åˆ†é’Ÿæ•°ï¼Œæˆ–è€…æ°¸è¿œä¸è¿›è¡Œé‡è¯•ã€‚å¦‚æœæˆåŠŸå°±ä¼šæœ‰ä»¥ä¸‹ä¸¤ä¸ªé”®ã€‚</li>\n<li><strong>interval</strong>ï¼šæ•´å‹ï¼Œå‘ŠçŸ¥ peer ä¹‹åè¿›è¡Œ GET è¯·æ±‚çš„æ—¶é—´é—´éš”ï¼Œä½†æ˜¯å¦‚æœ peer çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æˆ–è€…éœ€è¦ä» Tracker è·å–æ›´å¤šçš„ peer å°±ä¼šä¸ç®¡è¿™ä¸ªæ—¶é—´é—´éš”é™åˆ¶è€Œç›´æ¥é‡æ–°è¯·æ±‚ã€‚</li>\n<li><strong>peers</strong>ï¼šåˆ—è¡¨ï¼Œæ¯ä¸ªå­é¡¹éƒ½æ˜¯å­—å…¸ï¼Œå­—å…¸çš„é”®åˆ†åˆ«ä¸º <strong>id</strong>ï¼Œ<strong>ip</strong>ï¼Œ<strong>port</strong>ï¼Œåˆ†åˆ«ä¸ GET è¯·æ±‚ä¸­çš„ peer_idï¼Œipï¼Œport å«ä¹‰ä¸€è‡´ï¼Œç”¨äºå”¯ä¸€ç¡®å®šæ¯ä¸ªå…¶ä»– peerã€‚</li>\n</ul>\n<p>åœ¨ HTTP Tracker çš„ URL ä¸Šè¿›è¡Œé€‚å½“çš„æ”¹é€ å¯ä»¥å¾—åˆ° Scrape URLï¼ˆåœ¨ <a href=\"http://www.bittorrent.org/beps/bep_0048.html\" target=\"_blank\" rel=\"noopener\">BEP48 - Tracker Protocol Extension: Scrape</a> ä¸­æå‡ºï¼‰ã€‚é€šè¿‡è¯·æ±‚ Scrape URL å¯ä»¥å¾—åˆ°æŒ‡å®š info_hash çš„å½“å‰ peers çš„å¤§è‡´ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å¤„äºæ´»è·ƒçŠ¶æ€ä¸”å·²å®Œæˆä¸‹è½½ï¼ˆ<strong>complete</strong>ï¼‰çš„ peer æ•°é‡ã€å¤„äºæ´»è·ƒçŠ¶æ€ä½†æœªå®Œæˆä¸‹è½½ï¼ˆ<strong>incomplete</strong>ï¼‰çš„ peer æ•°é‡ã€æ›¾ç»å®Œæˆè¿‡ä¸‹è½½ï¼ˆ<strong>downloaded</strong>ï¼‰çš„ peer æ•°é‡ã€‚æ”¯æŒåŒæ—¶è¯·æ±‚å¤šä¸ª info_hash ã€‚è¿™äº›æ•°æ®å¸®åŠ© peer å†³å®šæ˜¯å¦åº”è¯¥æ‰§è¡Œ Tracker GET è¯·æ±‚ï¼Œä»è€Œä¸€å®šç¨‹åº¦ä¸Šå‡å° HTTP Tracker æœåŠ¡å™¨çš„å‹åŠ›ã€‚</p>\n<p>è€Œ UDP æœ¬èº«æ¯” HTTP æ¶ˆè€—æ›´å°äº›ï¼Œä¸”ç›´æ¥å®ç°äº† Scrape è¯·æ±‚ã€‚</p>\n<h2 id=\"UDP-Tracker\"><a href=\"#UDP-Tracker\" class=\"headerlink\" title=\"UDP Tracker\"></a>UDP Tracker</h2><p>ç”±äº HTTP æ˜¯åŸºäº TCP çš„ï¼Œè¿æ¥çš„æ‰“å¼€å’Œå…³é—­ä¼šå¸¦æ¥ä¸€å®šæŸè€—ã€‚è¿™ç§ç±»ä¼¼çš„å‘ç°æœåŠ¡ä½¿ç”¨ UDP å¯ä»¥å¤§å¤§é™ä½ Tracker æœåŠ¡å™¨çš„å‹åŠ›ã€‚<a href=\"http://www.bittorrent.org/beps/bep_0015.html\" target=\"_blank\" rel=\"noopener\">BEP15 - UDP Tracker Protocol</a> æå‡ºäº†åŸºäº UDP çš„ Tracker æ–¹æ¡ˆã€‚</p>\n<p>ä¸ºäº†é˜²æ­¢ UDP Flood æ”»å‡»ï¼Œpeer ä¸ UDP Tracker çš„é€šä¿¡ä¼šé¦–å…ˆé€šè¿‡ <strong>connect</strong> åŠ¨ä½œè¿›è¡Œç±»ä¼¼ TCP çš„ä¸‰æ¬¡æ¡æ‰‹ï¼Œçº¦å®šä¸€ä¸ª connection_idï¼Œä¹‹åæ‰€æœ‰çš„åŠ¨ä½œéƒ½ä¼šä½¿ç”¨è¿™ä¸ª connection_idã€‚<strong>announce</strong> åŠ¨ä½œå¯ä»¥å‘ UDP Tracker å®Œæˆç±»ä¼¼å¯¹ HTTP Tracker çš„ GET è¯·æ±‚ã€‚ä½¿ç”¨ <strong>scrape</strong> åŠ¨ä½œå®Œæˆç±»ä¼¼å¯¹ HTTP Tracker çš„ Scrape è¯·æ±‚ã€‚å¦‚æœå‡ºç°é”™è¯¯ï¼ŒTracker ä¼šè§¦å‘ <strong>error</strong> åŠ¨ä½œã€‚</p>\n<p>GET è¯·æ±‚å¦‚æœéœ€è¦æ‰©å±•å‚æ•°åªéœ€è¦åœ¨è¯·æ±‚çš„ URL ä¸­å¢åŠ ç›¸å…³çš„å‚æ•°å³å¯ï¼Œåœ¨ UDP Tracker ä¸­ï¼Œå®ç°è¿™ç§å¢åŠ å‚æ•°çš„å¯æ‰©å±•æ€§åˆ™éœ€è¦å¦å¤–æƒ³åŠæ³•ã€‚<a href=\"http://www.bittorrent.org/beps/bep_0041.html\" target=\"_blank\" rel=\"noopener\">BEP41 - UDP Tracker Protocol Extensions</a> å¯¹äºå…¶å®ç°æ–¹æ¡ˆä¸¾äº†ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼šä¸€ä¸ª Tracker æœåŠ¡å™¨æƒ³è¦æé«˜å®ƒçš„è¿è¡Œæ•ˆç‡è€Œé™åˆ¶å…¶æ‰€èƒ½æœåŠ¡çš„ info_hashï¼Œä»–ä»¬è€ƒè™‘åœ¨åœ¨ peer å¯¹ Tracker çš„ URL ä¸­åŠ å…¥ä¸€ä¸ª auth å­—æ®µï¼Œå³è¯¥ info_hash çš„ç­¾åï¼Œè¿™æ ·çš„æƒ…å†µä¸‹ï¼ŒTracker å¯ä»¥é€šè¿‡ Torrent æˆ–è€… Magnet å‘å¸ƒè¿™ä¸ªå¸¦æœ‰ info_hash ç­¾åçš„ Tracker URLï¼Œpeer å¯¹è¯¥ Tracker çš„è¯·æ±‚æ—¶å¸¦ä¸Šè¯¥ç­¾åï¼ŒTracker å°±å¯ä»¥éªŒè¯è¿™ä¸ªç­¾åæ˜¯å¦ä¸ info_hash ç›¸åŒ¹é…ä»¥åŠè¿™ä¸ª info_hash æ˜¯å¦åœ¨å…¶æœåŠ¡çš„èŒƒå›´ï¼Œä»è€Œå®ç°é™åˆ¶ã€‚</p>\n<p>æ¯”å¦‚ Tracker åœ¨ä¸€ä¸ª Magnet ä¸­é™„åŠ çš„ tr å‚æ•°å¦‚ä¸‹ï¼Œauth å­—æ®µå°±æ˜¯æŒ‡çš„ info_hash çš„ç¤ºä¾‹ç­¾åï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">udp://tracker.example.com:80/?auth=0xA0B1C</span><br></pre></td></tr></table></figure>\n\n<p>å®ç° BEP41 æ–¹æ¡ˆåçš„å®¢æˆ·ç«¯åœ¨å¯¹ UDP Tracker å‘èµ· <strong>announce</strong> è¯·æ±‚åŠ¨ä½œæ—¶ï¼Œä¼šåœ¨åŒ…ä½“å°¾éƒ¨æ·»åŠ å¦‚ä¸‹å­—èŠ‚ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0x2, 0xC, &apos;/&apos;, &apos;ï¼Ÿ&apos;, &apos;a&apos;, &apos;u&apos;, &apos;t&apos;, &apos;h&apos;, &apos;=&apos;, &apos;A&apos;, &apos;0&apos;, &apos;B&apos;, &apos;1&apos;, &apos;C&apos;, 0x1, 0x1, 0x0</span><br></pre></td></tr></table></figure>\n\n<p><code>0x2</code> è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ <strong>URLData</strong>ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šç´§è·Ÿç€ä¸¤ä¸ªå‚æ•°ï¼Œ<code>0xC</code> è¡¨ç¤ºåé¢çš„å†…å®¹é•¿åº¦ä¸º 12ï¼Œåç»­çš„ 12 å­—èŠ‚å°±æ˜¯ URLData çš„å†…å®¹ï¼›<code>0x1</code> è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ <strong>NOP</strong> ,å³å¡«å……å­—èŠ‚ï¼Œè¿ç»­ä¸¤ä¸ª <code>0x1</code> è¡¨ç¤ºå¡«å……ä¸¤ä¸ªå­—èŠ‚ï¼Œ<code>0x0</code> è¡¨ç¤ºé™„åŠ çš„é€‰é¡¹ç±»å‹æ˜¯ <strong>EndOfOptions</strong>ï¼Œå³ç»“æŸæ ‡å¿—ã€‚æœ€åä¸‰ä¸ªé€‰é¡¹ä¸æ˜¯å¿…é¡»çš„ï¼Œè¿™é‡ŒåŠ å…¥ä»–ä»¬åªæ˜¯è¯´æ˜æœ‰è¿™äº›é€‰é¡¹ã€‚</p>\n<p>å½“ç„¶è¿™é‡Œä¾‹å­åœ¨ HTTP Tracker ä¸­ä¹Ÿå®¹æ˜“å®ç°ï¼Œä½†æ˜¯ UDP Tracker æœ‰ç€æ›´å¥½çš„ç½‘ç»œä¼˜åŒ–ã€‚</p>\n<h2 id=\"Tracker-ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\"><a href=\"#Tracker-ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\" class=\"headerlink\" title=\"Tracker ç›¸å…³å¢å¼ºæ–¹æ¡ˆ\"></a>Tracker ç›¸å…³å¢å¼ºæ–¹æ¡ˆ</h2><p>BEP ä¸­è¿˜æœ‰ä¸å°‘æ”¹è¿›ææ¡ˆæ˜¯é’ˆå¯¹ Tracker çš„ï¼š</p>\n<h3 id=\"Torrent-æ–‡ä»¶å¤š-Tracker-æ”¯æŒ\"><a href=\"#Torrent-æ–‡ä»¶å¤š-Tracker-æ”¯æŒ\" class=\"headerlink\" title=\"Torrent æ–‡ä»¶å¤š Tracker æ”¯æŒ\"></a>Torrent æ–‡ä»¶å¤š Tracker æ”¯æŒ</h3><p>Torrent æ–‡ä»¶ä¸­ <strong>announce</strong> å­—æ®µåªæ”¯æŒå®šä¹‰ä¸€ä¸ª Trackerï¼Œ<a href=\"http://www.bittorrent.org/beps/bep_0012.html\" target=\"_blank\" rel=\"noopener\">BEP12 - Multitracker Metadata Extension</a> ä¸­æå‡ºäº†è®© Torrent æºå¸¦å¤šä¸ª Tracker çš„æ–¹æ¡ˆã€‚<br>åœ¨ Torrent æ–‡ä»¶æ ¹èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªé”® <strong>announce-list</strong>ï¼Œè¿™é‡Œç®€æ˜“çš„è¡¨ç¤ºä¸º <strong>/announce-list</strong>ï¼Œä¹‹ååœ¨ Torrent ä¸­å¢åŠ é”®æ—¶ä¹Ÿä¼šç®€æ˜“åœ°è¡¨ç¤ºæˆè¿™æ ·ã€‚å¦‚æœ Torrent æ–‡ä»¶ä¸­æœ‰ <strong>announce-list</strong>ï¼Œåˆ™ä¼šå¿½ç•¥ <strong>announce</strong>ã€‚<strong>announce-list</strong> æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œ**<em>åˆ—è¡¨çš„æ¯ä¸ªå­é¡¹æ˜¯éƒ½æ˜¯ä¸€ä¸ªå­é¡¹æ˜¯ Tracker URL çš„åˆ—è¡¨**</em>ã€‚ä¹‹æ‰€ä»¥æ˜¯ä¸€ä¸ªå­é¡¹ä¸ºåˆ—è¡¨çš„åˆ—è¡¨çš„åŸå› åœ¨ BEP12 ä¸­æœ‰è¯¦ç»†çš„ä»‹ç»ä¸ä¸¾ä¾‹ã€‚æ­¤å¤„ä¸è¯¦ç»†å±•å¼€ã€‚</p>\n<h3 id=\"DNS-è¾…åŠ©çº æ­£-Tracker-åœ°å€\"><a href=\"#DNS-è¾…åŠ©çº æ­£-Tracker-åœ°å€\" class=\"headerlink\" title=\"DNS è¾…åŠ©çº æ­£ Tracker åœ°å€\"></a>DNS è¾…åŠ©çº æ­£ Tracker åœ°å€</h3><p>è€ƒè™‘åˆ°éƒ¨åˆ†ç§å­ä¸­çš„ Tracker æœåŠ¡å™¨å¯èƒ½å˜æ›´æœåŠ¡ç«¯å£æˆ–è€…è®² HTTP æœåŠ¡æ”¹ä¸º UDP æœåŠ¡ã€‚<a href=\"http://www.bittorrent.org/beps/bep_0034.html\" target=\"_blank\" rel=\"noopener\">BEP34 - DNS Tracker Preferences</a> ä¸€ç§åŸºäº DNS çš„è§£å†³æ–¹æ¡ˆã€‚<br>å¦‚æœå®¢æˆ·ç«¯å‘ç°è‡ªå·±æ‰€è¯·æ±‚çš„ Tracker æ²¡æœ‰ç›¸åº”ï¼Œåˆ™å¯ä»¥æŸ¥è¯¢ç›¸åº”åŸŸåçš„ DNS TXT è®°å½•ã€‚å¦‚æœæœ‰ TXT è®°å½•æ˜¯ä»¥ â€BITTORRENTâ€œ å¼€å¤´ï¼Œåˆ™å¯ä»¥å¯¹è¿™ä¸ª Tracker åœ°å€è¿›è¡Œçº æ­£ã€‚è¿™ç±» TXT è®°å½•æœ‰ä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p>\n<ul>\n<li>â€œBITTORRENTâ€ï¼šè¡¨æ˜è¯¥ä¸»æœºä¸å†è¿è¡Œä»»ä½• Tracker æœåŠ¡ã€‚</li>\n<li>â€œBITTORRENT DENY ALLâ€ï¼šå’Œå‰ä¸€ä¸ªä¸€è‡´ï¼Œä½†æ˜¯è¡¨æ„æ›´åŠ æ˜æ˜¾ã€‚</li>\n<li>â€œBITTORRENT UDP:1337 TCP:80â€ï¼šè¡¨ç¤ºè¿™ä¸ªä¸»æœºè¿è¡Œä¸¤ä¸ª Tracker æœåŠ¡ï¼Œåˆ†åˆ«æ—¶åœ¨ UDP ç«¯å£ 1337 å’Œ TCP ç«¯å£ 80 ä¸Šï¼Œä¸”ä¼˜å…ˆå»ºè®®ä½¿ç”¨ UDP ç«¯å£ã€‚</li>\n</ul>\n<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç›¸å…³çš„ TXT è®°å½•æŸ¥è¯¢è¿‡ç¨‹ï¼Œè¿™ä¸ªä¸»æœºåœ¨å¤šä¸ª UDP ç«¯å£ä¸Šè¿è¡Œäº† Tracker æœåŠ¡ï¼š</p>\n<figure class=\"highlight shell\"><figcaption><span>dig txt</span><a href=\"/downloads/code/bt_dig_dns_txt.txt\">view raw</a></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&gt;</span><span class=\"bash\"> dig 9.rarbg.to txt</span></span><br><span class=\"line\">;; QUESTION SECTION:</span><br><span class=\"line\">;9.rarbg.to.                    IN      TXT</span><br><span class=\"line\"></span><br><span class=\"line\">;; ANSWER SECTION:</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2710\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2720\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2730\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2740\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2750\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2770\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2780\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2790\"</span><br><span class=\"line\">9.rarbg.to.             5134    IN      TXT     \"BITTORRENT UDP:2800\"</span><br><span class=\"line\"></span><br><span class=\"line\">;; Query time: 207 msec</span><br><span class=\"line\">;; SERVER: 1.1.1.1#53(1.1.1.1)</span><br><span class=\"line\">;; WHEN: Sat Aug 25 05:46:02 CST 2018</span><br><span class=\"line\">;; MSG SIZE  rcvd: 327</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Tracker-è¿”å›å…¬ç½‘-IP\"><a href=\"#Tracker-è¿”å›å…¬ç½‘-IP\" class=\"headerlink\" title=\"Tracker è¿”å›å…¬ç½‘ IP\"></a>Tracker è¿”å›å…¬ç½‘ IP</h3><p><a href=\"http://www.bittorrent.org/beps/bep_0024.html\" target=\"_blank\" rel=\"noopener\">BEP24 - Tracker Returns External IP</a> é€šè¿‡åœ¨ GET è¯·æ±‚çš„è¿”å›ä¸­ï¼ˆUDP ä¹Ÿé€‚ç”¨ï¼Œä¸‹åŒï¼‰å¢åŠ ä¸€ä¸ª <strong>external ip</strong> å­—æ®µæ¥å‘ŠçŸ¥å‘èµ·è¯·æ±‚çš„ peer è‡ªèº«çš„å…¬ç½‘ IPã€‚[Todo:å®¢æˆ·ç«¯éœ€è¦çŸ¥é“è‡ªå·±çš„å…¬ç½‘ IP åšä»€ä¹ˆç”¨æš‚æ—¶è¿˜ä¸å¤ªæ¸…æ¥šâ€¦â€¦ff]<br>é€šè¿‡ peer é—´çš„ yourip æ‰©å±•æ¶ˆæ¯ä¹Ÿå¯ä»¥è·å¾—è‡ªèº«çš„å…¬ç½‘ IPã€‚</p>\n<h3 id=\"Tracker-è¿”å›å‹ç¼©-peer-åˆ—è¡¨\"><a href=\"#Tracker-è¿”å›å‹ç¼©-peer-åˆ—è¡¨\" class=\"headerlink\" title=\"Tracker è¿”å›å‹ç¼© peer åˆ—è¡¨\"></a>Tracker è¿”å›å‹ç¼© peer åˆ—è¡¨</h3><p><a href=\"http://www.bittorrent.org/beps/bep_0023.html\" target=\"_blank\" rel=\"noopener\">BEP23 - Tracker Returns Compact Peer Lists</a> æå‡ºäº†ä¸€ç§å‹ç¼© GET è¯·æ±‚è¿”å›ä¸­ peers å­—æ®µå€¼çš„æ–¹å¼ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å° Tracker æœåŠ¡å™¨çš„æµé‡å‹åŠ›ã€‚<br>è¿™ç§æ–¹æ¡ˆçš„è¿”å›å€¼ä¸­ peers å­—æ®µä¸å†æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç”±ä»£è¡¨æ¯ä¸ª peer çš„å…­ä¸ªå­—èŠ‚ï¼ˆ4 ä¸ªå­—èŠ‚ç”¨äº IP åœ°å€ï¼Œ2 ä¸ªå­—èŠ‚ç”¨äºç«¯å£ï¼‰æ‹¼æ¥è€Œæˆã€‚å»é™¤äº† peer_id è¿™ä¸ªå­—æ®µï¼Œäº‹å®è¯æ˜æ²¡æœ‰è¿™ä¸ªå­—æ®µä¹Ÿæ²¡ä»€ä¹ˆå…³ç³»ã€‚<br>Peer é€šè¿‡åœ¨ GET è¯·æ±‚ä¸­å¢åŠ  <strong>compact</strong> å‚æ•°æ¥å‘ŠçŸ¥ Tracker æœåŠ¡å™¨è‡ªå·±æ›´å–œæ¬¢ä»€ä¹ˆæ ¼å¼ï¼Œ0 ä¸ºåŸå§‹æ ¼å¼ï¼Œ1 ä¸ºå‹ç¼©æ ¼å¼ã€‚ä½†æ˜¯ Tracker ä¸ä¸€å®šä¼šæ¥å—è¿™ä¸ªå‚æ•°çš„å»ºè®®ï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ä»ç„¶éœ€è¦åŒæ—¶æ”¯æŒä¸¤ç§æ ¼å¼ã€‚</p>\n<h3 id=\"IPv6-æ”¯æŒ\"><a href=\"#IPv6-æ”¯æŒ\" class=\"headerlink\" title=\"IPv6 æ”¯æŒ\"></a>IPv6 æ”¯æŒ</h3><p><a href=\"http://www.bittorrent.org/beps/bep_0007.html\" target=\"_blank\" rel=\"noopener\">BEP7 - IPv6 Tracker Extension</a> æä¾›äº†ä¼˜åŒ– Tracker å¯¹ IPv6 æ”¯æŒçš„æ–¹æ¡ˆã€‚<br>é€šè¿‡åœ¨ GET è¯·æ±‚ä¸­å¢åŠ  <strong>ipv6</strong> å‚æ•°æˆ–è€… <strong>ipv4</strong> å‚æ•°æ¥å‘ŠçŸ¥ Tracker æœåŠ¡å™¨è‡ªå·±çš„ç›¸åº” IP ç‰ˆæœ¬çš„åœ°å€ï¼Œå¦‚æœåœ¨è¿™ä¸¤ä¸ªå­—æ®µä¸­æ²¡æœ‰ç«¯å£ä¿¡æ¯ï¼Œé‚£ä¹ˆå°† <strong>port</strong> å­—æ®µä½œä¸ºç«¯å£ã€‚å¦‚æœ Tracker compact æ ¼å¼è¿”å› peer åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨å›å¤ä¸­å¢åŠ  <strong>peers6</strong> å­—æ®µä»¥è¿”å›ä½¿ç”¨ IPv6 çš„ peerï¼Œæ¯ä¸ª peer å ç”¨ 18 å­—èŠ‚ã€‚ç¼–ç æ–¹å¼ä¸ peers å­—æ®µä¸€è‡´ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2>"},{"title":"é—²äº‘å­¤é¹¤","date":"2018-07-10T13:24:55.000Z","updated":"2018-07-10T13:24:55.000Z","_content":"``` java\npublic class Blog {\n    public static void main(String[] args) {\n        System.out.println(\"æ–¯æ˜¯é™‹å®¤ï¼ŒæƒŸå¾å¾·é¦¨\");\n    }\n}\n```","source":"_posts/hello-world.md","raw":"---\ntitle: é—²äº‘å­¤é¹¤\ndate: 2018-07-10 21:24:55\nupdated: 2018-07-10 21:24:55\ntags: [Essay]\n---\n``` java\npublic class Blog {\n    public static void main(String[] args) {\n        System.out.println(\"æ–¯æ˜¯é™‹å®¤ï¼ŒæƒŸå¾å¾·é¦¨\");\n    }\n}\n```","slug":"hello-world","published":1,"comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuhf0008w80vsfyim6xk","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Blog</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"æ–¯æ˜¯é™‹å®¤ï¼ŒæƒŸå¾å¾·é¦¨\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Blog</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"æ–¯æ˜¯é™‹å®¤ï¼ŒæƒŸå¾å¾·é¦¨\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>"},{"title":"åœ¨ IPFS ä¸Šéƒ¨ç½²é™æ€åšå®¢","date":"2018-09-22T13:12:00.000Z","_content":"\n\næœ¬æ–‡ä¸»è¦è®°å½•åœ¨ IPFS ä¸Šéƒ¨ç½²åšå®¢çš„è¿‡ç¨‹ï¼Œç”¨ä»¥ç†Ÿæ‚‰ IPFS çš„åŸºæœ¬æ“ä½œã€‚https://ipfs.0ranga.com å°±æ˜¯åšä¸»åšå®¢åœ¨ IPFS ä¸Šéƒ¨ç½²çš„ç‰ˆæœ¬ã€‚\n\n<!--more-->\n\n## IPFS \n\n### å®‰è£… IPFS\né¦–å…ˆå¾—åœ¨è®¡ç®—æœºä¸Šå®‰è£… IPFSï¼Œåšä¸» PC çš„æ“ä½œç³»ç»Ÿçš„ Archï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…ã€‚å¦‚æœä¹‹åéœ€è¦ä¸ºåšå®¢æ·»åŠ åŸŸååˆ™éœ€è¦åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½² IPFSï¼Œåšä¸»é€‰æ‹©çš„æ˜¯ DightOcean çš„ CentOS 7ã€‚æ‰€ä»¥æä¾›äº†ä»¥ä¸Šä¸¤ç§æ“ä½œç³»ç»Ÿçš„å®‰è£…æ–¹å¼ï¼Œå…¶ä»–ç³»ç»Ÿå¦‚ä½•å®‰è£…è¯·è‡ªè¡Œæ¢ç´¢ã€‚\n``` sh\n# Arch\n## åŒ…ç®¡ç†å™¨ç›´æ¥å®‰è£…\npacman -S go-ipfs \n\n# CentOS\n## ä» https://dist.ipfs.io/#go-ipfs è·å–æœ€æ–°å®‰è£…åŒ…ï¼Œä¾‹å¦‚\nwget https://dist.ipfs.io/go-ipfs/v0.4.17/go-ipfs_v0.4.17_linux-amd64.tar.gz\n\n## è§£å‹\ntar xvfz go-ipfs_v0.4.17_linux-amd64.tar.gz\n\n## å®‰è£…\ncd go-ipfs && ./install.sh\n```\n\nå®‰è£…å®Œæˆåéœ€è¦å…ˆåˆå§‹åŒ– IPFS\n``` sh\nipfs init\n```\nå¦å¤–ï¼Œä¸€èˆ¬åœ¨äº‘æœåŠ¡å™¨ä¸Šéœ€è¦å°† IPFS è®¾ç½®ä¸ºè‡ªå¯åŠ¨æœåŠ¡ï¼Œè®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼Œé¦–å…ˆéœ€è¦æ·»åŠ  service æè¿°æ–‡ä»¶\n``` sh\nvi /etc/systemd/system/ipfs.service\n```\næ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n``` service\n[Unit]\nDescription=IPFS Daemon\n\n[Service]\nType=simple\nExecStart=/usr/local/bin/ipfs daemon --enable-namesys-pubsub\n\n[Install]\nWantedBy=multi-user.target\n```\nç„¶åä½¿æœåŠ¡å¼€æœºè‡ªå¯åŠ¨åŒæ—¶ç«‹å³å¯åŠ¨ï¼š\n``` sh\nsystemctl enable ipfs\nsystemctl start ipfs\n```\n### éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶\næ¥ä¸‹æ¥åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ `index.html`ï¼Œåœ¨é‡Œé¢å†™å…¥ç®€å•çš„è¯\n``` sh\necho 'hello, my simple blog!' > index.html\n```\néšåæ·»åŠ è‡³ IPFS ä¸­\n``` sh\nipfs add index.html\n```\nå¾—åˆ°è¿”å›å¦‚ä¸‹\n``` sh\nipfs add index.html \n# added QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr index.html\n# 23 B / 23 B [=========================================] 100.00%\n```\nå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å†…å®¹\n``` sh\nipfs cat QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr\n```\nå½“æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨èŠ‚ç‚¹åï¼Œæ–‡ä»¶å†…å®¹å°†ä¼šé€æ¸è¢« IPFS ç½‘ç»œå­˜å‚¨\n``` sh\nipfs daemon\n# æˆ–è€…\nsystemctl start ipfs\n```\néšåå¯ä»¥é€šè¿‡è®¿é—® https://gateway.ipfs.io/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr å¾—åˆ°è¯¥æ–‡ä»¶ã€‚å¦‚æœä½ ä¸ä»‹æ„å°†è¿™å¥ç®€å•çš„è¯ä½œä¸ºä½ çš„åšå®¢çš„å…¨éƒ¨å†…å®¹çš„è¯ï¼Œé‚£è‡³æ­¤åšå®¢çš„å…¨éƒ¨åˆ›å»ºå®Œæˆäº†ï¼Œè€Œä¸”ç†è®ºä¸Šæ°¸è¿œä¸ä¼šæ¶ˆå¤±ã€‚\n\n## éƒ¨ç½²é™æ€åšå®¢æ¡†æ¶ï¼šä»¥ Hexo ä¸ºä¾‹\nè™½ç„¶å°æ ‡é¢˜å†™çš„æ˜¯â€œä»¥ Hexo ä¸ºä¾‹â€ï¼Œä½†æœ¬æ–‡ä¸ä¼šç»†è®²å¦‚ä½•ä½¿ç”¨ Hexoï¼Œ[Hexo å®˜æ–¹æ–‡æ¡£](https://hexo.io/zh-cn/docs/)æä¾›äº†ç»†è‡´çš„å¸®åŠ©ã€‚å¦‚æœä½ ä¹‹å‰ç”¨è¿‡ Hexo è€Œä¸”å› ä¸ºæ‡’å¾—å†™ä½œè€ŒæŠŠå®ƒä¸¢å¼ƒåœ¨ç¡¬ç›˜é‡Œï¼Œè¿™é‡Œæœ‰å‡ ä¸ªå‘½ä»¤å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿå›æƒ³èµ·ä½¿ç”¨æ–¹æ³•ã€‚\n``` sh\n# åˆ›å»ºæ–°æ–‡ç« \nhexo new post <new_post_name>\n# æ¸…ç†\nhexo clean\n# ç”Ÿæˆåšå®¢\nhexo g\n# å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨\nhexo s --open\n# éƒ¨ç½²\nhexo d\n```\nåœ¨ä½¿ç”¨ `hexo g` ç”Ÿæˆé™æ€åšå®¢åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ **public** ç›®å½•ä¸­æ‰¾åˆ°éƒ¨ç½²åšå®¢éœ€è¦çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå…¥å£æ˜¯ç†Ÿæ‚‰çš„ **index.html**ã€‚ï¼ˆå…¶ä»–åšå®¢æ¡†æ¶ä¹Ÿæœ‰ä¸ªç±»ä¼¼ public çš„æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ•´ä¸ªåšå®¢ï¼‰\n\nä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†æ•´ä¸ª public æ–‡ä»¶å¤¹æ”¾å…¥ IPFS\n``` sh\nipfs add -r public\n```\næ·»åŠ åçš„è¾“å‡ºä¸­æœ€åä¸€è¡Œæ˜¯ç›®å½• public çš„å“ˆå¸Œå€¼ï¼Œæ¯”å¦‚åšä¸»å¾—åˆ°çš„æ˜¯\n``` sh\n# added QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt public\n```\nç„¶åè®¿é—® https://gateway.ipfs.io/ipfs/QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt/ å°±å¯ä»¥çœ‹åˆ°ä¿å­˜åœ¨ IPFS ä¸Šçš„åšå®¢äº†ã€‚ä¸è¿‡ï¼Œåœ¨ä¿®æ”¹æ–‡ç« æ›´æ–° public ç›®å½•ä¹‹åï¼Œç›®å½•çš„å“ˆå¸Œå€¼ä¼šå˜åŒ–ï¼Œå› æ­¤ä»¥ä¸Šçš„è¿æ¥åªæ˜¯åšå®¢åœ¨å½“å‰çš„ä¸€ä¸ªï¼ˆæ°¸ä¹…ï¼‰çŠ¶æ€ï¼Œå¦‚æœæƒ³è¦é€šè¿‡ä¸€ä¸ªé“¾æ¥è®¿é—®ä¸æ–­æ›´æ–°çš„åšå®¢ï¼Œå°±éœ€è¦å€ŸåŠ© IPNSï¼ŒIPNS çš„ä½œç”¨å°±æ˜¯å°†æŸä¸ªæ–‡ä»¶ä¸ PeerID è¿›è¡Œç»‘å®šï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPeerID å¯ä»¥ä¿æŒä¸å˜ï¼Œè¿™æ ·ï¼Œé€šè¿‡è®¿é—® PeerIDï¼Œå°±å¯ä»¥è®¿é—®ä¸ PeerID ç»‘å®šçš„å†…å®¹äº†ï¼Œè¿™å’Œ DNS ä¸­åŸŸåä¸ IP çš„å…³ç³»ç±»ä¼¼ã€‚\n\né€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†å½“å‰çš„ public ç›®å½•å“ˆå¸Œä¸ PeerIDï¼ŒPeerID ä¸éœ€è¦æ˜¾ç¤ºæŒ‡å®šï¼Œå¾—åˆ°ç»‘å®šç»“æœåçš„ PeerID å®é™…ä¸Šä¸é€šè¿‡ `ipfs id` å‘½ä»¤å¾—åˆ°çš„ ID ä¸€è‡´ã€‚\n``` sh\n# ç»‘å®š\nipfs name publish <file_hash>\nipfs name publish QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt\n\n# ç»‘å®šåçš„è¾“å‡º\n# Published to QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo:\n# /ipfs/QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt\n\n# è®¿é—®ï¼ˆåˆ—å‡ºç›®å½•ï¼‰ IPNS QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo\nipfs ls /ipns/<peer_id>\nipfs ls /ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo\n\n# åå‘è§£æ\nipfs name resolve <peer_id>\nipfs name resolve QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo\n```\nç»‘å®š IPNS ä¹‹åï¼Œå¯ä»¥é€šè¿‡ https://gateway.ipfs.io/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo/ è®¿é—®åˆ°åšå®¢ã€‚\n\n**ä½†æ˜¯ç›´æ¥éƒ¨ç½² public ç›®å½•å­˜åœ¨ä¸€ä¸ªé—®é¢˜**ï¼šhexo è¿™ç±»çš„åšå®¢ä¸­æ‰€æœ‰æœ¬åœ°èµ„æºçš„è·¯å¾„å‡ä¸ºæ ¹ç›®å½•å¼€å¤´çš„ç›¸å¯¹ç«™ç‚¹æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚å¯¹äº `/css/home.css`ï¼Œå½“è®¿é—® `https://gateway.ipfs.io/ipfs/<file_hash>` è¿™æ ·åœ¨æ–‡ä»¶ä¸­æœ‰ç±»ä¼¼ç»å¯¹è·¯å¾„é“¾æ¥æ—¶ï¼Œç›¸å½“äºè®¿é—® `https://gateway.ipfs.io/css/home.css`ï¼Œæ˜¾ç„¶è¿™ä¸ª `home.css` æ–‡ä»¶æ˜¯ä¸å­˜åœ¨çš„ã€‚å¦‚æœæƒ³è¦ä½¿å¾—ç½‘ç«™å¯ä»¥æ­£ç¡®è®¿é—®ï¼Œæœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š\n1. ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `./css/home.css`ï¼Œè¿™æ ·å°±ç›¸å½“äºè®¿é—® `https://gateway.ipfs.io/ipfs/<file_hash>/css/home.css`ï¼Œå¦‚æ­¤å¯ä»¥æ­£ç¡®è®¿é—®ã€‚å¦‚æœåšå®¢æ¡†æ¶è‡ªèº«æ”¯æŒå°†æ‰€æœ‰æœ¬ç«™èµ„æºçš„ç»å¯¹è·¯å¾„æ›¿æ¢æˆè¿™æ ·ï¼Œæˆ–è€…æ•´ä¸ªåšå®¢æ˜¯è‡ªå·±å®ç°å¦‚æ­¤ï¼Œé‚£ä¸éœ€è¦é¢å¤–çš„æ“ä½œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå®Œç¾çš„åšå®¢ã€‚\n2. è®© `http://gateway.site/css/home.css` çœŸå®å­˜åœ¨ï¼Œå³å°† `http://gateway.ipfs.io/ipfs/<file_hash>` æ›¿æ¢æˆä¸€ä¸ªç‹¬ç«‹åŸŸå `http://gateway.site`ï¼Œè¿™å°±éœ€è¦ç”¨åˆ° IPFS æä¾›çš„ [dnslink](https://github.com/ipfs/go-dnslink) å¢å¼ºã€‚\n\n## ä¸ºåšå®¢æ·»åŠ åŸŸå\nè¿˜æ˜¯ä»¥æˆ‘è‡ªå·±çš„åŸŸå 0ranga.com ä¸ºä¾‹ï¼Œè¿™ä¸ªåŸŸåæ‰˜ç®¡åœ¨ Namecheap ä¸Šï¼Œä½¿ç”¨ Namecheap çš„ DNS ç®¡ç†ï¼Œå¯ä»¥ä¸ºåŸŸåå¢åŠ ä¸€ä¸ªå­åŸŸå TXT è®°å½•å¦‚ä¸‹ï¼š\n``` sh\nTXT 0ranga.com dnslink=/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo\n```\nè¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ°å€ https://gateway.ipfs.io/ipns/0ranga.com è®¿é—®åˆ°éƒ¨ç½²åœ¨ IPFS ä¸Šåšå®¢ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥ç¼©çŸ­è®¿é—®é“¾æ¥é•¿åº¦ï¼Œåœ¨ DNS ç®¡ç†ä¸­è¿›ä¸€æ­¥æ·»åŠ å¦‚ä¸‹è®°å½•ï¼ˆä¸ºäº†ä¸ä¸åŸåšå®¢ 0ranga.com å†²çªï¼Œè¿™é‡Œä½¿ç”¨å­åŸŸå ipfs.0ranga.comï¼‰ï¼š\n```\n# 1. ä¸ºå­åŸŸå ipfs.0ranga.com æ·»åŠ  A è®°å½•ï¼Œç»‘å®šåˆ°ä¸€ä¸ª Gateway çš„ IPï¼Œ\n#    ç¤ºä¾‹ä¸­æ˜¯ 209.94.78.78 ï¼Œè¿™ä¸ª IP æ˜¯ gateway.ipfs.io çš„ä¼—å¤š IP ä¸­çš„ä¸€ä¸ª\nA ipfs.0ranga.com 209.94.78.78\n\n# 2. ä¸ºå­åŸŸå ipfs.0ranga.com æ·»åŠ  TXT è®°å½•ï¼ŒæŒ‡å®š IPNS\nTXT ipfs.0ranga.com dnslink=/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo\n```\nç­‰å¾… DNS è®°å½•ç”Ÿæ•ˆåï¼Œå¯ä»¥é€šè¿‡ http://ipfs.0ranga.com è®¿é—®åšå®¢ã€‚è‡³æ­¤ï¼Œåšå®¢çš„çŸ­é“¾æ¥æ”¹é€ å·²ç»åŸºæœ¬å®Œæˆã€‚æ¥ä¸‹æ¥ä¼šè®°å½•äº›è‡ªå·±å¦å¤–çš„ä¸€äº›å°è¯•ï¼ŒåŒ…æ‹¬å¯¹åšå®¢çš„è®¿é—®è¿›è¡ŒåŠ é€Ÿç­‰ã€‚\n\n## è¿›é˜¶\n### éƒ¨ç½²äº‘æœåŠ¡å™¨ä»¥å¢å¼ºåšå®¢çš„å¯ç”¨æ€§åŒæ—¶åŠ å¿«è®¿é—®é€Ÿåº¦\nå¦‚æœéƒ¨ç½²äº†åšå®¢çš„æœ¬åœ° PC å…³æœºï¼ŒåŒæ—¶åšå®¢çš„è®¿é—®é‡ä¸æ˜¯é‚£ä¹ˆå¯è§‚ï¼Œåˆ™å¯èƒ½å­˜åœ¨ä¸€éƒ¨åˆ†åšå®¢æ–‡ä»¶æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œå› ä¸ºåœ¨æ²¡æœ‰æ¿€åŠ±çš„æƒ…å†µä¸‹ IPFS ä¸Šçš„å…¶ä»–èŠ‚ç‚¹ä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å­˜å‚¨å…¶ä»–ç”¨æˆ·å¾€ IPFS ä¸­æ·»åŠ çš„æ–‡ä»¶ã€‚æ‰€ä»¥é…ç½®ä¸€ä¸ªäº‘æœåŠ¡å™¨æ¥å­˜å‚¨åšå®¢æœ¬èº«å°±å¯ä»¥ç¡®ä¿æ–‡ä»¶çš„å¯ç”¨æ€§ï¼ˆè¯·é—®ï¼šé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç”¨ IPFS æ¥éƒ¨ç½²åšå®¢ï¼Ÿï¼‰ï¼ŒåŒæ—¶éšç€ FileCoin æ¿€åŠ±ä¸ IPFS çš„ç»“åˆï¼Œäº‹æƒ…ä¼šå˜å¾—ä¸é‚£ä¹ˆç³Ÿç³•ã€‚\n\näº‘æœåŠ¡éƒ¨ç½²çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n1. æŒ‰ç…§**å®‰è£… IPFS** è¿™å°èŠ‚ä¸­çš„å®‰è£…æ–¹æ³•åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ª IPFS æœåŠ¡ï¼›\n\n2. ä¸ºäº† Gateway å¯ä»¥è¢«å…¬ç½‘è®¿é—®ï¼Œéœ€è¦å°† IPFS é…ç½®æ–‡ä»¶ `ï½/.ipfs/config` ä¸­ `Addresses:Gateway` çš„é…ç½®æ”¹ä¸º `/ip4/0.0.0.0/tcp/80` ï¼Œç”¨ä»¥ç›‘å¬æ‰€æœ‰ç½‘å¡ä¸Šçš„ TCP 80 ç«¯å£ï¼Œéšåé‡å¯ IPFS æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆï¼›\n\n4. é€šè¿‡æœ¬åœ°æµè§ˆå™¨ç›´æ¥è®¿é—®äº‘æœåŠ¡å™¨çš„ IP ï¼ˆåšä¸»ç›®å‰æµ‹è¯•ä½¿ç”¨çš„æœåŠ¡å™¨å®ä¾‹çš„ IP ä¸º `104.248.70.88`ï¼‰ç»“æœä¸º **404 page not found** ï¼Œåˆ™è¡¨æ˜æœåŠ¡éƒ¨ç½²æˆåŠŸã€‚è¿›ä¸€æ­¥ï¼Œè®¿é—® http://104.248.70.88/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr å¯ä»¥å¾—åˆ° **éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶** è¿™èŠ‚ä¸­çš„ **index.html** æ–‡ä»¶ï¼Œè‡³æ­¤å®Œæˆäº† IPFS Gateway çš„éƒ¨ç½²ä¸å…±äº«ï¼›\n\n5. ä¸º Gateway ç»‘å®šåŸŸåã€‚ç±»ä¼¼ä¹‹å‰çš„åšæ³•ï¼Œæ·»åŠ ä¸€æ¡ DNS A è®°å½•ã€‚å¾…è®°å½•ç”Ÿæ•ˆåï¼Œè®¿é—®è¿æ¥å˜ä¸º http://gateway.0ranga.com/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr\n``` sh\nA gateway.0ranga.com 104.248.70.88\n```\n\n6. æ”¹ç”¨è‡ªå·±çš„ Gatewayã€‚å°†ä¹‹å‰é…ç½®çš„å­åŸŸå ipfs.0ranga.com çš„ A è®°å½•å¯¹åº”çš„ IP æ”¹æˆäº‘æœåŠ¡å™¨çš„ IPï¼ˆTXT è®°å½•ä¿æŒä¸å˜ï¼‰ï¼Œå½“æµè§ˆå™¨è®¿é—® ipfs.0ranga.com è¿™ä¸ªåŸŸåæ—¶ï¼Œé¦–å…ˆä¼šè®¿é—® 104.248.70.88 è¿™å° Gateway æœåŠ¡å™¨ï¼ŒGateway å†å‘æ•´ä¸ª IPFS ç½‘ç»œæ”¶é›†å½“å‰é¡µé¢çš„ç¢ç‰‡ï¼›\n``` sh\nA ipfs.0ranga.com 104.248.70.88\n```\n\n7. é€šè¿‡ Pin æ“ä½œå°†æœ¬åœ°åšå®¢ public ç›®å½•â€é’‰â€œè‡³äº‘æœåŠ¡å™¨ IPFS èŠ‚ç‚¹ï¼Œç„¶åå°† public ç›®å½•å“ˆå¸Œç»‘å®šè‡³äº‘æœåŠ¡å™¨ä¸­ IPFS çš„ PeerIDï¼Œå¦å¤–è®°å¾—ä¿®æ”¹å­åŸŸå ipfs.0ranga.com çš„ TXT è®°å½•ä¸­çš„ IPNS åœ°å€ã€‚æ­¤åå³ä½¿å…³é—­æœ¬åœ° PC çš„ IPFS æœåŠ¡ï¼Œéƒ¨ç½²åœ¨ IPFS ä¸Šåšå®¢ä¹Ÿå¯ä»¥è¢«æ­£å¸¸è®¿é—®ï¼Œè®¿é—®åœ°å€ä¾ç„¶æ˜¯ http://ipfs.0ranga.comï¼›\n``` sh\nipfs pin add QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt\n```\n8. å¦‚æœè§‰ç€åŒæ­¥æ–‡ä»¶è‡³äº‘æœåŠ¡å™¨ï¼Œè€Œåˆä¸ä»‹æ„ä¸€ç›´è¿è¡Œæœ¬åœ° PC çš„ IPFS æœåŠ¡ï¼Œä½†æ˜¯åšå®¢çš„è®¿é—®é€Ÿåº¦åˆä¸å¿«ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å°†äº‘æœåŠ¡å™¨ä¸Š IPFS èŠ‚ç‚¹ç›´æ¥åŠ å…¥åˆ°æœ¬åœ° Peer åˆ—è¡¨ä¸­ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©äº‘æœåŠ¡å™¨ä¸Šçš„ IPFS èŠ‚ç‚¹å¿«é€Ÿæ‰¾åˆ°æœ¬åœ° PC IPFS èŠ‚ç‚¹ä¸­çš„åšå®¢æ–‡ä»¶ã€‚\n``` sh\nipfs swarm connect /ip4/104.248.70.88/tcp/4001/ipfs/QmamxGp6sw2dKUHm2RnaJ7zRDeR3w8m98kKAYgfpszeqHR\n```\n\n### HTTPS åŠ æŒ\nåœ¨äº‘æœåŠ¡å™¨ CentOS ç³»ç»Ÿä¸Šå®‰è£… Nginx æœåŠ¡ï¼Œç„¶åä½¿ç”¨ Certbot ç”Ÿæˆ Let's Encrypt è¯ä¹¦ï¼Œè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼ŒCertbot çš„å®‰è£…åœ¨[å®˜æ–¹æ•™ç¨‹](https://certbot.eff.org/lets-encrypt/centosrhel7-nginx)æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œæ­¤å¤„çœç•¥ã€‚æœ€ç»ˆï¼Œå­åŸŸå ipfs.0ranga.com çš„ Nginx çš„é…ç½®å¤§è‡´å¦‚ä¸‹ï¼š\n``` conf\nserver {\n    server_name  ipfs.0ranga.com;\n\n    location / {\n            proxy_pass http://localhost:8080/;\n            proxy_set_header Host $host;\n            proxy_buffering off;\n            proxy_pass_request_headers on;\n    }\n\n\n    listen 443 ssl; # managed by Certbot\n    ssl_certificate /etc/letsencrypt/live/ipfs.0ranga.com/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/ipfs.0ranga.com/privkey.pem; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n}\nserver {\n    if ($host = ipfs.0ranga.com) {\n        return 301 https://$host$request_uri;\n    } # managed by Certbot\n\n\n    listen       80 default_server;\n    server_name  ipfs.0ranga.com;\nreturn 404; # managed by Certbot\n}\n```\næ³¨æ„ï¼Œç”±äºç«¯å£ç”± Nginx è¿›è¡Œæ§åˆ¶ï¼Œ Gateway ä¸èƒ½å†å ç”¨ 80 ç«¯å£ï¼Œå› æ­¤è¿™é‡Œå°†å…¶ï¼ˆ`ï½/.ipfs/config` ä¸­ `Addresses:Gateway` é…ç½®ï¼‰é‡æ–°è®¾å®šä¸º 8080ã€‚gateway.0ranga.com çš„ Nginx é…ç½®ä¹Ÿæ˜¯ç±»ä¼¼ã€‚Hurrayï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ https://ipfs.0ranga.com è®¿é—®åšä¸»éƒ¨ç½²åœ¨ IPFS ä¸Šçš„åšå®¢ï¼Œé€šè¿‡ https://gateway.0ranga.com è®¿é—®åšä¸»çš„ Gateway äº†ã€‚\n\n## æ€»ç»“\nå¯ä»¥ç”¨ä»¥ä¸‹å‡ ä¸ªç½‘å€è¿›è¡Œæ€»ç»“ï¼š\n\n| åºå·                                                       | é“¾æ¥                                                         | æ”¹è¿›ä¹‹å¤„                          |\n| ------------------------------------------------------------ | ----------------------------- | ----------------------------- |\n| 1 | https://gateway.ipfs.io/ipfs/<root_path_hash>/ | åŸå§‹åšå®¢ç›®å½•                  |\n| 2 | https://gateway.ipfs.io/ipns/<peer_id>/ | IPNS æ˜ å°„ç›®å½•ï¼Œç«™ç‚¹æ›´æ–°æ—¶é“¾æ¥ä¿æŒä¸å˜ |\n| 3                     | https://gateway.ipfs.io/ipns/0ranga.com                      | dnslink ç»‘å®šï¼Œå¢åŠ é“¾æ¥å¯è¯»æ€§  |\n| 4                                      | http://ipfs.0ranga.com                                       | å®ç°å®Œå…¨è‡ªå®šä¹‰åŸŸå            |\n| 5                                     | https://ipfs.0ranga.com                                      | ä¸ºåŸŸåæ·»åŠ  HTTPS è¯ä¹¦         |\n\n\n## å‚è€ƒèµ„æ–™\n1. https://michalzalecki.com/set-up-ipfs-node-on-the-server/\n2. https://github.com/ipfs/notes/issues/39\n3. https://www.cloudxns.net/Support/detail/id/304.html\n4. https://ipfs.io/ipns/Qme48wyZ7LaF9gC5693DZyJBtehgaFhaKycESroemD5fNX/post/putting_this_blog_on_ipfs/","source":"_posts/ipfs-blog.md","raw":"---\ntitle: åœ¨ IPFS ä¸Šéƒ¨ç½²é™æ€åšå®¢\ntags:\n  - IPFS\ndate: 2018-09-22 21:12:00\n---\n\n\næœ¬æ–‡ä¸»è¦è®°å½•åœ¨ IPFS ä¸Šéƒ¨ç½²åšå®¢çš„è¿‡ç¨‹ï¼Œç”¨ä»¥ç†Ÿæ‚‰ IPFS çš„åŸºæœ¬æ“ä½œã€‚https://ipfs.0ranga.com å°±æ˜¯åšä¸»åšå®¢åœ¨ IPFS ä¸Šéƒ¨ç½²çš„ç‰ˆæœ¬ã€‚\n\n<!--more-->\n\n## IPFS \n\n### å®‰è£… IPFS\né¦–å…ˆå¾—åœ¨è®¡ç®—æœºä¸Šå®‰è£… IPFSï¼Œåšä¸» PC çš„æ“ä½œç³»ç»Ÿçš„ Archï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…ã€‚å¦‚æœä¹‹åéœ€è¦ä¸ºåšå®¢æ·»åŠ åŸŸååˆ™éœ€è¦åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½² IPFSï¼Œåšä¸»é€‰æ‹©çš„æ˜¯ DightOcean çš„ CentOS 7ã€‚æ‰€ä»¥æä¾›äº†ä»¥ä¸Šä¸¤ç§æ“ä½œç³»ç»Ÿçš„å®‰è£…æ–¹å¼ï¼Œå…¶ä»–ç³»ç»Ÿå¦‚ä½•å®‰è£…è¯·è‡ªè¡Œæ¢ç´¢ã€‚\n``` sh\n# Arch\n## åŒ…ç®¡ç†å™¨ç›´æ¥å®‰è£…\npacman -S go-ipfs \n\n# CentOS\n## ä» https://dist.ipfs.io/#go-ipfs è·å–æœ€æ–°å®‰è£…åŒ…ï¼Œä¾‹å¦‚\nwget https://dist.ipfs.io/go-ipfs/v0.4.17/go-ipfs_v0.4.17_linux-amd64.tar.gz\n\n## è§£å‹\ntar xvfz go-ipfs_v0.4.17_linux-amd64.tar.gz\n\n## å®‰è£…\ncd go-ipfs && ./install.sh\n```\n\nå®‰è£…å®Œæˆåéœ€è¦å…ˆåˆå§‹åŒ– IPFS\n``` sh\nipfs init\n```\nå¦å¤–ï¼Œä¸€èˆ¬åœ¨äº‘æœåŠ¡å™¨ä¸Šéœ€è¦å°† IPFS è®¾ç½®ä¸ºè‡ªå¯åŠ¨æœåŠ¡ï¼Œè®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼Œé¦–å…ˆéœ€è¦æ·»åŠ  service æè¿°æ–‡ä»¶\n``` sh\nvi /etc/systemd/system/ipfs.service\n```\næ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n``` service\n[Unit]\nDescription=IPFS Daemon\n\n[Service]\nType=simple\nExecStart=/usr/local/bin/ipfs daemon --enable-namesys-pubsub\n\n[Install]\nWantedBy=multi-user.target\n```\nç„¶åä½¿æœåŠ¡å¼€æœºè‡ªå¯åŠ¨åŒæ—¶ç«‹å³å¯åŠ¨ï¼š\n``` sh\nsystemctl enable ipfs\nsystemctl start ipfs\n```\n### éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶\næ¥ä¸‹æ¥åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ `index.html`ï¼Œåœ¨é‡Œé¢å†™å…¥ç®€å•çš„è¯\n``` sh\necho 'hello, my simple blog!' > index.html\n```\néšåæ·»åŠ è‡³ IPFS ä¸­\n``` sh\nipfs add index.html\n```\nå¾—åˆ°è¿”å›å¦‚ä¸‹\n``` sh\nipfs add index.html \n# added QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr index.html\n# 23 B / 23 B [=========================================] 100.00%\n```\nå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å†…å®¹\n``` sh\nipfs cat QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr\n```\nå½“æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨èŠ‚ç‚¹åï¼Œæ–‡ä»¶å†…å®¹å°†ä¼šé€æ¸è¢« IPFS ç½‘ç»œå­˜å‚¨\n``` sh\nipfs daemon\n# æˆ–è€…\nsystemctl start ipfs\n```\néšåå¯ä»¥é€šè¿‡è®¿é—® https://gateway.ipfs.io/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr å¾—åˆ°è¯¥æ–‡ä»¶ã€‚å¦‚æœä½ ä¸ä»‹æ„å°†è¿™å¥ç®€å•çš„è¯ä½œä¸ºä½ çš„åšå®¢çš„å…¨éƒ¨å†…å®¹çš„è¯ï¼Œé‚£è‡³æ­¤åšå®¢çš„å…¨éƒ¨åˆ›å»ºå®Œæˆäº†ï¼Œè€Œä¸”ç†è®ºä¸Šæ°¸è¿œä¸ä¼šæ¶ˆå¤±ã€‚\n\n## éƒ¨ç½²é™æ€åšå®¢æ¡†æ¶ï¼šä»¥ Hexo ä¸ºä¾‹\nè™½ç„¶å°æ ‡é¢˜å†™çš„æ˜¯â€œä»¥ Hexo ä¸ºä¾‹â€ï¼Œä½†æœ¬æ–‡ä¸ä¼šç»†è®²å¦‚ä½•ä½¿ç”¨ Hexoï¼Œ[Hexo å®˜æ–¹æ–‡æ¡£](https://hexo.io/zh-cn/docs/)æä¾›äº†ç»†è‡´çš„å¸®åŠ©ã€‚å¦‚æœä½ ä¹‹å‰ç”¨è¿‡ Hexo è€Œä¸”å› ä¸ºæ‡’å¾—å†™ä½œè€ŒæŠŠå®ƒä¸¢å¼ƒåœ¨ç¡¬ç›˜é‡Œï¼Œè¿™é‡Œæœ‰å‡ ä¸ªå‘½ä»¤å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿå›æƒ³èµ·ä½¿ç”¨æ–¹æ³•ã€‚\n``` sh\n# åˆ›å»ºæ–°æ–‡ç« \nhexo new post <new_post_name>\n# æ¸…ç†\nhexo clean\n# ç”Ÿæˆåšå®¢\nhexo g\n# å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨\nhexo s --open\n# éƒ¨ç½²\nhexo d\n```\nåœ¨ä½¿ç”¨ `hexo g` ç”Ÿæˆé™æ€åšå®¢åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ **public** ç›®å½•ä¸­æ‰¾åˆ°éƒ¨ç½²åšå®¢éœ€è¦çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå…¥å£æ˜¯ç†Ÿæ‚‰çš„ **index.html**ã€‚ï¼ˆå…¶ä»–åšå®¢æ¡†æ¶ä¹Ÿæœ‰ä¸ªç±»ä¼¼ public çš„æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ•´ä¸ªåšå®¢ï¼‰\n\nä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†æ•´ä¸ª public æ–‡ä»¶å¤¹æ”¾å…¥ IPFS\n``` sh\nipfs add -r public\n```\næ·»åŠ åçš„è¾“å‡ºä¸­æœ€åä¸€è¡Œæ˜¯ç›®å½• public çš„å“ˆå¸Œå€¼ï¼Œæ¯”å¦‚åšä¸»å¾—åˆ°çš„æ˜¯\n``` sh\n# added QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt public\n```\nç„¶åè®¿é—® https://gateway.ipfs.io/ipfs/QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt/ å°±å¯ä»¥çœ‹åˆ°ä¿å­˜åœ¨ IPFS ä¸Šçš„åšå®¢äº†ã€‚ä¸è¿‡ï¼Œåœ¨ä¿®æ”¹æ–‡ç« æ›´æ–° public ç›®å½•ä¹‹åï¼Œç›®å½•çš„å“ˆå¸Œå€¼ä¼šå˜åŒ–ï¼Œå› æ­¤ä»¥ä¸Šçš„è¿æ¥åªæ˜¯åšå®¢åœ¨å½“å‰çš„ä¸€ä¸ªï¼ˆæ°¸ä¹…ï¼‰çŠ¶æ€ï¼Œå¦‚æœæƒ³è¦é€šè¿‡ä¸€ä¸ªé“¾æ¥è®¿é—®ä¸æ–­æ›´æ–°çš„åšå®¢ï¼Œå°±éœ€è¦å€ŸåŠ© IPNSï¼ŒIPNS çš„ä½œç”¨å°±æ˜¯å°†æŸä¸ªæ–‡ä»¶ä¸ PeerID è¿›è¡Œç»‘å®šï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPeerID å¯ä»¥ä¿æŒä¸å˜ï¼Œè¿™æ ·ï¼Œé€šè¿‡è®¿é—® PeerIDï¼Œå°±å¯ä»¥è®¿é—®ä¸ PeerID ç»‘å®šçš„å†…å®¹äº†ï¼Œè¿™å’Œ DNS ä¸­åŸŸåä¸ IP çš„å…³ç³»ç±»ä¼¼ã€‚\n\né€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†å½“å‰çš„ public ç›®å½•å“ˆå¸Œä¸ PeerIDï¼ŒPeerID ä¸éœ€è¦æ˜¾ç¤ºæŒ‡å®šï¼Œå¾—åˆ°ç»‘å®šç»“æœåçš„ PeerID å®é™…ä¸Šä¸é€šè¿‡ `ipfs id` å‘½ä»¤å¾—åˆ°çš„ ID ä¸€è‡´ã€‚\n``` sh\n# ç»‘å®š\nipfs name publish <file_hash>\nipfs name publish QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt\n\n# ç»‘å®šåçš„è¾“å‡º\n# Published to QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo:\n# /ipfs/QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt\n\n# è®¿é—®ï¼ˆåˆ—å‡ºç›®å½•ï¼‰ IPNS QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo\nipfs ls /ipns/<peer_id>\nipfs ls /ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo\n\n# åå‘è§£æ\nipfs name resolve <peer_id>\nipfs name resolve QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo\n```\nç»‘å®š IPNS ä¹‹åï¼Œå¯ä»¥é€šè¿‡ https://gateway.ipfs.io/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo/ è®¿é—®åˆ°åšå®¢ã€‚\n\n**ä½†æ˜¯ç›´æ¥éƒ¨ç½² public ç›®å½•å­˜åœ¨ä¸€ä¸ªé—®é¢˜**ï¼šhexo è¿™ç±»çš„åšå®¢ä¸­æ‰€æœ‰æœ¬åœ°èµ„æºçš„è·¯å¾„å‡ä¸ºæ ¹ç›®å½•å¼€å¤´çš„ç›¸å¯¹ç«™ç‚¹æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚å¯¹äº `/css/home.css`ï¼Œå½“è®¿é—® `https://gateway.ipfs.io/ipfs/<file_hash>` è¿™æ ·åœ¨æ–‡ä»¶ä¸­æœ‰ç±»ä¼¼ç»å¯¹è·¯å¾„é“¾æ¥æ—¶ï¼Œç›¸å½“äºè®¿é—® `https://gateway.ipfs.io/css/home.css`ï¼Œæ˜¾ç„¶è¿™ä¸ª `home.css` æ–‡ä»¶æ˜¯ä¸å­˜åœ¨çš„ã€‚å¦‚æœæƒ³è¦ä½¿å¾—ç½‘ç«™å¯ä»¥æ­£ç¡®è®¿é—®ï¼Œæœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š\n1. ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `./css/home.css`ï¼Œè¿™æ ·å°±ç›¸å½“äºè®¿é—® `https://gateway.ipfs.io/ipfs/<file_hash>/css/home.css`ï¼Œå¦‚æ­¤å¯ä»¥æ­£ç¡®è®¿é—®ã€‚å¦‚æœåšå®¢æ¡†æ¶è‡ªèº«æ”¯æŒå°†æ‰€æœ‰æœ¬ç«™èµ„æºçš„ç»å¯¹è·¯å¾„æ›¿æ¢æˆè¿™æ ·ï¼Œæˆ–è€…æ•´ä¸ªåšå®¢æ˜¯è‡ªå·±å®ç°å¦‚æ­¤ï¼Œé‚£ä¸éœ€è¦é¢å¤–çš„æ“ä½œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå®Œç¾çš„åšå®¢ã€‚\n2. è®© `http://gateway.site/css/home.css` çœŸå®å­˜åœ¨ï¼Œå³å°† `http://gateway.ipfs.io/ipfs/<file_hash>` æ›¿æ¢æˆä¸€ä¸ªç‹¬ç«‹åŸŸå `http://gateway.site`ï¼Œè¿™å°±éœ€è¦ç”¨åˆ° IPFS æä¾›çš„ [dnslink](https://github.com/ipfs/go-dnslink) å¢å¼ºã€‚\n\n## ä¸ºåšå®¢æ·»åŠ åŸŸå\nè¿˜æ˜¯ä»¥æˆ‘è‡ªå·±çš„åŸŸå 0ranga.com ä¸ºä¾‹ï¼Œè¿™ä¸ªåŸŸåæ‰˜ç®¡åœ¨ Namecheap ä¸Šï¼Œä½¿ç”¨ Namecheap çš„ DNS ç®¡ç†ï¼Œå¯ä»¥ä¸ºåŸŸåå¢åŠ ä¸€ä¸ªå­åŸŸå TXT è®°å½•å¦‚ä¸‹ï¼š\n``` sh\nTXT 0ranga.com dnslink=/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo\n```\nè¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ°å€ https://gateway.ipfs.io/ipns/0ranga.com è®¿é—®åˆ°éƒ¨ç½²åœ¨ IPFS ä¸Šåšå®¢ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥ç¼©çŸ­è®¿é—®é“¾æ¥é•¿åº¦ï¼Œåœ¨ DNS ç®¡ç†ä¸­è¿›ä¸€æ­¥æ·»åŠ å¦‚ä¸‹è®°å½•ï¼ˆä¸ºäº†ä¸ä¸åŸåšå®¢ 0ranga.com å†²çªï¼Œè¿™é‡Œä½¿ç”¨å­åŸŸå ipfs.0ranga.comï¼‰ï¼š\n```\n# 1. ä¸ºå­åŸŸå ipfs.0ranga.com æ·»åŠ  A è®°å½•ï¼Œç»‘å®šåˆ°ä¸€ä¸ª Gateway çš„ IPï¼Œ\n#    ç¤ºä¾‹ä¸­æ˜¯ 209.94.78.78 ï¼Œè¿™ä¸ª IP æ˜¯ gateway.ipfs.io çš„ä¼—å¤š IP ä¸­çš„ä¸€ä¸ª\nA ipfs.0ranga.com 209.94.78.78\n\n# 2. ä¸ºå­åŸŸå ipfs.0ranga.com æ·»åŠ  TXT è®°å½•ï¼ŒæŒ‡å®š IPNS\nTXT ipfs.0ranga.com dnslink=/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo\n```\nç­‰å¾… DNS è®°å½•ç”Ÿæ•ˆåï¼Œå¯ä»¥é€šè¿‡ http://ipfs.0ranga.com è®¿é—®åšå®¢ã€‚è‡³æ­¤ï¼Œåšå®¢çš„çŸ­é“¾æ¥æ”¹é€ å·²ç»åŸºæœ¬å®Œæˆã€‚æ¥ä¸‹æ¥ä¼šè®°å½•äº›è‡ªå·±å¦å¤–çš„ä¸€äº›å°è¯•ï¼ŒåŒ…æ‹¬å¯¹åšå®¢çš„è®¿é—®è¿›è¡ŒåŠ é€Ÿç­‰ã€‚\n\n## è¿›é˜¶\n### éƒ¨ç½²äº‘æœåŠ¡å™¨ä»¥å¢å¼ºåšå®¢çš„å¯ç”¨æ€§åŒæ—¶åŠ å¿«è®¿é—®é€Ÿåº¦\nå¦‚æœéƒ¨ç½²äº†åšå®¢çš„æœ¬åœ° PC å…³æœºï¼ŒåŒæ—¶åšå®¢çš„è®¿é—®é‡ä¸æ˜¯é‚£ä¹ˆå¯è§‚ï¼Œåˆ™å¯èƒ½å­˜åœ¨ä¸€éƒ¨åˆ†åšå®¢æ–‡ä»¶æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œå› ä¸ºåœ¨æ²¡æœ‰æ¿€åŠ±çš„æƒ…å†µä¸‹ IPFS ä¸Šçš„å…¶ä»–èŠ‚ç‚¹ä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å­˜å‚¨å…¶ä»–ç”¨æˆ·å¾€ IPFS ä¸­æ·»åŠ çš„æ–‡ä»¶ã€‚æ‰€ä»¥é…ç½®ä¸€ä¸ªäº‘æœåŠ¡å™¨æ¥å­˜å‚¨åšå®¢æœ¬èº«å°±å¯ä»¥ç¡®ä¿æ–‡ä»¶çš„å¯ç”¨æ€§ï¼ˆè¯·é—®ï¼šé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç”¨ IPFS æ¥éƒ¨ç½²åšå®¢ï¼Ÿï¼‰ï¼ŒåŒæ—¶éšç€ FileCoin æ¿€åŠ±ä¸ IPFS çš„ç»“åˆï¼Œäº‹æƒ…ä¼šå˜å¾—ä¸é‚£ä¹ˆç³Ÿç³•ã€‚\n\näº‘æœåŠ¡éƒ¨ç½²çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n1. æŒ‰ç…§**å®‰è£… IPFS** è¿™å°èŠ‚ä¸­çš„å®‰è£…æ–¹æ³•åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ª IPFS æœåŠ¡ï¼›\n\n2. ä¸ºäº† Gateway å¯ä»¥è¢«å…¬ç½‘è®¿é—®ï¼Œéœ€è¦å°† IPFS é…ç½®æ–‡ä»¶ `ï½/.ipfs/config` ä¸­ `Addresses:Gateway` çš„é…ç½®æ”¹ä¸º `/ip4/0.0.0.0/tcp/80` ï¼Œç”¨ä»¥ç›‘å¬æ‰€æœ‰ç½‘å¡ä¸Šçš„ TCP 80 ç«¯å£ï¼Œéšåé‡å¯ IPFS æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆï¼›\n\n4. é€šè¿‡æœ¬åœ°æµè§ˆå™¨ç›´æ¥è®¿é—®äº‘æœåŠ¡å™¨çš„ IP ï¼ˆåšä¸»ç›®å‰æµ‹è¯•ä½¿ç”¨çš„æœåŠ¡å™¨å®ä¾‹çš„ IP ä¸º `104.248.70.88`ï¼‰ç»“æœä¸º **404 page not found** ï¼Œåˆ™è¡¨æ˜æœåŠ¡éƒ¨ç½²æˆåŠŸã€‚è¿›ä¸€æ­¥ï¼Œè®¿é—® http://104.248.70.88/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr å¯ä»¥å¾—åˆ° **éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶** è¿™èŠ‚ä¸­çš„ **index.html** æ–‡ä»¶ï¼Œè‡³æ­¤å®Œæˆäº† IPFS Gateway çš„éƒ¨ç½²ä¸å…±äº«ï¼›\n\n5. ä¸º Gateway ç»‘å®šåŸŸåã€‚ç±»ä¼¼ä¹‹å‰çš„åšæ³•ï¼Œæ·»åŠ ä¸€æ¡ DNS A è®°å½•ã€‚å¾…è®°å½•ç”Ÿæ•ˆåï¼Œè®¿é—®è¿æ¥å˜ä¸º http://gateway.0ranga.com/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr\n``` sh\nA gateway.0ranga.com 104.248.70.88\n```\n\n6. æ”¹ç”¨è‡ªå·±çš„ Gatewayã€‚å°†ä¹‹å‰é…ç½®çš„å­åŸŸå ipfs.0ranga.com çš„ A è®°å½•å¯¹åº”çš„ IP æ”¹æˆäº‘æœåŠ¡å™¨çš„ IPï¼ˆTXT è®°å½•ä¿æŒä¸å˜ï¼‰ï¼Œå½“æµè§ˆå™¨è®¿é—® ipfs.0ranga.com è¿™ä¸ªåŸŸåæ—¶ï¼Œé¦–å…ˆä¼šè®¿é—® 104.248.70.88 è¿™å° Gateway æœåŠ¡å™¨ï¼ŒGateway å†å‘æ•´ä¸ª IPFS ç½‘ç»œæ”¶é›†å½“å‰é¡µé¢çš„ç¢ç‰‡ï¼›\n``` sh\nA ipfs.0ranga.com 104.248.70.88\n```\n\n7. é€šè¿‡ Pin æ“ä½œå°†æœ¬åœ°åšå®¢ public ç›®å½•â€é’‰â€œè‡³äº‘æœåŠ¡å™¨ IPFS èŠ‚ç‚¹ï¼Œç„¶åå°† public ç›®å½•å“ˆå¸Œç»‘å®šè‡³äº‘æœåŠ¡å™¨ä¸­ IPFS çš„ PeerIDï¼Œå¦å¤–è®°å¾—ä¿®æ”¹å­åŸŸå ipfs.0ranga.com çš„ TXT è®°å½•ä¸­çš„ IPNS åœ°å€ã€‚æ­¤åå³ä½¿å…³é—­æœ¬åœ° PC çš„ IPFS æœåŠ¡ï¼Œéƒ¨ç½²åœ¨ IPFS ä¸Šåšå®¢ä¹Ÿå¯ä»¥è¢«æ­£å¸¸è®¿é—®ï¼Œè®¿é—®åœ°å€ä¾ç„¶æ˜¯ http://ipfs.0ranga.comï¼›\n``` sh\nipfs pin add QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt\n```\n8. å¦‚æœè§‰ç€åŒæ­¥æ–‡ä»¶è‡³äº‘æœåŠ¡å™¨ï¼Œè€Œåˆä¸ä»‹æ„ä¸€ç›´è¿è¡Œæœ¬åœ° PC çš„ IPFS æœåŠ¡ï¼Œä½†æ˜¯åšå®¢çš„è®¿é—®é€Ÿåº¦åˆä¸å¿«ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å°†äº‘æœåŠ¡å™¨ä¸Š IPFS èŠ‚ç‚¹ç›´æ¥åŠ å…¥åˆ°æœ¬åœ° Peer åˆ—è¡¨ä¸­ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©äº‘æœåŠ¡å™¨ä¸Šçš„ IPFS èŠ‚ç‚¹å¿«é€Ÿæ‰¾åˆ°æœ¬åœ° PC IPFS èŠ‚ç‚¹ä¸­çš„åšå®¢æ–‡ä»¶ã€‚\n``` sh\nipfs swarm connect /ip4/104.248.70.88/tcp/4001/ipfs/QmamxGp6sw2dKUHm2RnaJ7zRDeR3w8m98kKAYgfpszeqHR\n```\n\n### HTTPS åŠ æŒ\nåœ¨äº‘æœåŠ¡å™¨ CentOS ç³»ç»Ÿä¸Šå®‰è£… Nginx æœåŠ¡ï¼Œç„¶åä½¿ç”¨ Certbot ç”Ÿæˆ Let's Encrypt è¯ä¹¦ï¼Œè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼ŒCertbot çš„å®‰è£…åœ¨[å®˜æ–¹æ•™ç¨‹](https://certbot.eff.org/lets-encrypt/centosrhel7-nginx)æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œæ­¤å¤„çœç•¥ã€‚æœ€ç»ˆï¼Œå­åŸŸå ipfs.0ranga.com çš„ Nginx çš„é…ç½®å¤§è‡´å¦‚ä¸‹ï¼š\n``` conf\nserver {\n    server_name  ipfs.0ranga.com;\n\n    location / {\n            proxy_pass http://localhost:8080/;\n            proxy_set_header Host $host;\n            proxy_buffering off;\n            proxy_pass_request_headers on;\n    }\n\n\n    listen 443 ssl; # managed by Certbot\n    ssl_certificate /etc/letsencrypt/live/ipfs.0ranga.com/fullchain.pem; # managed by Certbot\n    ssl_certificate_key /etc/letsencrypt/live/ipfs.0ranga.com/privkey.pem; # managed by Certbot\n    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n}\nserver {\n    if ($host = ipfs.0ranga.com) {\n        return 301 https://$host$request_uri;\n    } # managed by Certbot\n\n\n    listen       80 default_server;\n    server_name  ipfs.0ranga.com;\nreturn 404; # managed by Certbot\n}\n```\næ³¨æ„ï¼Œç”±äºç«¯å£ç”± Nginx è¿›è¡Œæ§åˆ¶ï¼Œ Gateway ä¸èƒ½å†å ç”¨ 80 ç«¯å£ï¼Œå› æ­¤è¿™é‡Œå°†å…¶ï¼ˆ`ï½/.ipfs/config` ä¸­ `Addresses:Gateway` é…ç½®ï¼‰é‡æ–°è®¾å®šä¸º 8080ã€‚gateway.0ranga.com çš„ Nginx é…ç½®ä¹Ÿæ˜¯ç±»ä¼¼ã€‚Hurrayï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ https://ipfs.0ranga.com è®¿é—®åšä¸»éƒ¨ç½²åœ¨ IPFS ä¸Šçš„åšå®¢ï¼Œé€šè¿‡ https://gateway.0ranga.com è®¿é—®åšä¸»çš„ Gateway äº†ã€‚\n\n## æ€»ç»“\nå¯ä»¥ç”¨ä»¥ä¸‹å‡ ä¸ªç½‘å€è¿›è¡Œæ€»ç»“ï¼š\n\n| åºå·                                                       | é“¾æ¥                                                         | æ”¹è¿›ä¹‹å¤„                          |\n| ------------------------------------------------------------ | ----------------------------- | ----------------------------- |\n| 1 | https://gateway.ipfs.io/ipfs/<root_path_hash>/ | åŸå§‹åšå®¢ç›®å½•                  |\n| 2 | https://gateway.ipfs.io/ipns/<peer_id>/ | IPNS æ˜ å°„ç›®å½•ï¼Œç«™ç‚¹æ›´æ–°æ—¶é“¾æ¥ä¿æŒä¸å˜ |\n| 3                     | https://gateway.ipfs.io/ipns/0ranga.com                      | dnslink ç»‘å®šï¼Œå¢åŠ é“¾æ¥å¯è¯»æ€§  |\n| 4                                      | http://ipfs.0ranga.com                                       | å®ç°å®Œå…¨è‡ªå®šä¹‰åŸŸå            |\n| 5                                     | https://ipfs.0ranga.com                                      | ä¸ºåŸŸåæ·»åŠ  HTTPS è¯ä¹¦         |\n\n\n## å‚è€ƒèµ„æ–™\n1. https://michalzalecki.com/set-up-ipfs-node-on-the-server/\n2. https://github.com/ipfs/notes/issues/39\n3. https://www.cloudxns.net/Support/detail/id/304.html\n4. https://ipfs.io/ipns/Qme48wyZ7LaF9gC5693DZyJBtehgaFhaKycESroemD5fNX/post/putting_this_blog_on_ipfs/","slug":"ipfs-blog","published":1,"updated":"2020-07-18T06:30:19.519Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuhg0009w80vmsapolqb","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>æœ¬æ–‡ä¸»è¦è®°å½•åœ¨ IPFS ä¸Šéƒ¨ç½²åšå®¢çš„è¿‡ç¨‹ï¼Œç”¨ä»¥ç†Ÿæ‚‰ IPFS çš„åŸºæœ¬æ“ä½œã€‚<a href=\"https://ipfs.0ranga.com/\" target=\"_blank\" rel=\"noopener\">https://ipfs.0ranga.com</a> å°±æ˜¯åšä¸»åšå®¢åœ¨ IPFS ä¸Šéƒ¨ç½²çš„ç‰ˆæœ¬ã€‚</p>\n<a id=\"more\"></a>\n\n<h2 id=\"IPFS\"><a href=\"#IPFS\" class=\"headerlink\" title=\"IPFS\"></a>IPFS</h2><h3 id=\"å®‰è£…-IPFS\"><a href=\"#å®‰è£…-IPFS\" class=\"headerlink\" title=\"å®‰è£… IPFS\"></a>å®‰è£… IPFS</h3><p>é¦–å…ˆå¾—åœ¨è®¡ç®—æœºä¸Šå®‰è£… IPFSï¼Œåšä¸» PC çš„æ“ä½œç³»ç»Ÿçš„ Archï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…ã€‚å¦‚æœä¹‹åéœ€è¦ä¸ºåšå®¢æ·»åŠ åŸŸååˆ™éœ€è¦åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½² IPFSï¼Œåšä¸»é€‰æ‹©çš„æ˜¯ DightOcean çš„ CentOS 7ã€‚æ‰€ä»¥æä¾›äº†ä»¥ä¸Šä¸¤ç§æ“ä½œç³»ç»Ÿçš„å®‰è£…æ–¹å¼ï¼Œå…¶ä»–ç³»ç»Ÿå¦‚ä½•å®‰è£…è¯·è‡ªè¡Œæ¢ç´¢ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Arch</span></span><br><span class=\"line\"><span class=\"comment\">## åŒ…ç®¡ç†å™¨ç›´æ¥å®‰è£…</span></span><br><span class=\"line\">pacman -S go-ipfs </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># CentOS</span></span><br><span class=\"line\"><span class=\"comment\">## ä» https://dist.ipfs.io/#go-ipfs è·å–æœ€æ–°å®‰è£…åŒ…ï¼Œä¾‹å¦‚</span></span><br><span class=\"line\">wget https://dist.ipfs.io/go-ipfs/v0.4.17/go-ipfs_v0.4.17_linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è§£å‹</span></span><br><span class=\"line\">tar xvfz go-ipfs_v0.4.17_linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å®‰è£…</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> go-ipfs &amp;&amp; ./install.sh</span><br></pre></td></tr></table></figure>\n\n<p>å®‰è£…å®Œæˆåéœ€è¦å…ˆåˆå§‹åŒ– IPFS</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs init</span><br></pre></td></tr></table></figure>\n\n<p>å¦å¤–ï¼Œä¸€èˆ¬åœ¨äº‘æœåŠ¡å™¨ä¸Šéœ€è¦å°† IPFS è®¾ç½®ä¸ºè‡ªå¯åŠ¨æœåŠ¡ï¼Œè®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼Œé¦–å…ˆéœ€è¦æ·»åŠ  service æè¿°æ–‡ä»¶</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/systemd/system/ipfs.service</span><br></pre></td></tr></table></figure>\n\n<p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=IPFS Daemon</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">ExecStart=/usr/local/bin/ipfs daemon --enable-namesys-pubsub</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åä½¿æœåŠ¡å¼€æœºè‡ªå¯åŠ¨åŒæ—¶ç«‹å³å¯åŠ¨ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl <span class=\"built_in\">enable</span> ipfs</span><br><span class=\"line\">systemctl start ipfs</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶\"><a href=\"#éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶\" class=\"headerlink\" title=\"éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶\"></a>éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶</h3><p>æ¥ä¸‹æ¥åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ <code>index.html</code>ï¼Œåœ¨é‡Œé¢å†™å…¥ç®€å•çš„è¯</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello, my simple blog!'</span> &gt; index.html</span><br></pre></td></tr></table></figure>\n\n<p>éšåæ·»åŠ è‡³ IPFS ä¸­</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs add index.html</span><br></pre></td></tr></table></figure>\n\n<p>å¾—åˆ°è¿”å›å¦‚ä¸‹</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs add index.html </span><br><span class=\"line\"><span class=\"comment\"># added QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr index.html</span></span><br><span class=\"line\"><span class=\"comment\"># 23 B / 23 B [=========================================] 100.00%</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å†…å®¹</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs cat QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr</span><br></pre></td></tr></table></figure>\n\n<p>å½“æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨èŠ‚ç‚¹åï¼Œæ–‡ä»¶å†…å®¹å°†ä¼šé€æ¸è¢« IPFS ç½‘ç»œå­˜å‚¨</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs daemon</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\">systemctl start ipfs</span><br></pre></td></tr></table></figure>\n\n<p>éšåå¯ä»¥é€šè¿‡è®¿é—® <a href=\"https://gateway.ipfs.io/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr</a> å¾—åˆ°è¯¥æ–‡ä»¶ã€‚å¦‚æœä½ ä¸ä»‹æ„å°†è¿™å¥ç®€å•çš„è¯ä½œä¸ºä½ çš„åšå®¢çš„å…¨éƒ¨å†…å®¹çš„è¯ï¼Œé‚£è‡³æ­¤åšå®¢çš„å…¨éƒ¨åˆ›å»ºå®Œæˆäº†ï¼Œè€Œä¸”ç†è®ºä¸Šæ°¸è¿œä¸ä¼šæ¶ˆå¤±ã€‚</p>\n<h2 id=\"éƒ¨ç½²é™æ€åšå®¢æ¡†æ¶ï¼šä»¥-Hexo-ä¸ºä¾‹\"><a href=\"#éƒ¨ç½²é™æ€åšå®¢æ¡†æ¶ï¼šä»¥-Hexo-ä¸ºä¾‹\" class=\"headerlink\" title=\"éƒ¨ç½²é™æ€åšå®¢æ¡†æ¶ï¼šä»¥ Hexo ä¸ºä¾‹\"></a>éƒ¨ç½²é™æ€åšå®¢æ¡†æ¶ï¼šä»¥ Hexo ä¸ºä¾‹</h2><p>è™½ç„¶å°æ ‡é¢˜å†™çš„æ˜¯â€œä»¥ Hexo ä¸ºä¾‹â€ï¼Œä½†æœ¬æ–‡ä¸ä¼šç»†è®²å¦‚ä½•ä½¿ç”¨ Hexoï¼Œ<a href=\"https://hexo.io/zh-cn/docs/\" target=\"_blank\" rel=\"noopener\">Hexo å®˜æ–¹æ–‡æ¡£</a>æä¾›äº†ç»†è‡´çš„å¸®åŠ©ã€‚å¦‚æœä½ ä¹‹å‰ç”¨è¿‡ Hexo è€Œä¸”å› ä¸ºæ‡’å¾—å†™ä½œè€ŒæŠŠå®ƒä¸¢å¼ƒåœ¨ç¡¬ç›˜é‡Œï¼Œè¿™é‡Œæœ‰å‡ ä¸ªå‘½ä»¤å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿå›æƒ³èµ·ä½¿ç”¨æ–¹æ³•ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæ–°æ–‡ç« </span></span><br><span class=\"line\">hexo new post &lt;new_post_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># æ¸…ç†</span></span><br><span class=\"line\">hexo clean</span><br><span class=\"line\"><span class=\"comment\"># ç”Ÿæˆåšå®¢</span></span><br><span class=\"line\">hexo g</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨</span></span><br><span class=\"line\">hexo s --open</span><br><span class=\"line\"><span class=\"comment\"># éƒ¨ç½²</span></span><br><span class=\"line\">hexo d</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ä½¿ç”¨ <code>hexo g</code> ç”Ÿæˆé™æ€åšå®¢åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <strong>public</strong> ç›®å½•ä¸­æ‰¾åˆ°éƒ¨ç½²åšå®¢éœ€è¦çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå…¥å£æ˜¯ç†Ÿæ‚‰çš„ <strong>index.html</strong>ã€‚ï¼ˆå…¶ä»–åšå®¢æ¡†æ¶ä¹Ÿæœ‰ä¸ªç±»ä¼¼ public çš„æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ•´ä¸ªåšå®¢ï¼‰</p>\n<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†æ•´ä¸ª public æ–‡ä»¶å¤¹æ”¾å…¥ IPFS</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs add -r public</span><br></pre></td></tr></table></figure>\n\n<p>æ·»åŠ åçš„è¾“å‡ºä¸­æœ€åä¸€è¡Œæ˜¯ç›®å½• public çš„å“ˆå¸Œå€¼ï¼Œæ¯”å¦‚åšä¸»å¾—åˆ°çš„æ˜¯</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># added QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt public</span></span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åè®¿é—® <a href=\"https://gateway.ipfs.io/ipfs/QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt/\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipfs/QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt/</a> å°±å¯ä»¥çœ‹åˆ°ä¿å­˜åœ¨ IPFS ä¸Šçš„åšå®¢äº†ã€‚ä¸è¿‡ï¼Œåœ¨ä¿®æ”¹æ–‡ç« æ›´æ–° public ç›®å½•ä¹‹åï¼Œç›®å½•çš„å“ˆå¸Œå€¼ä¼šå˜åŒ–ï¼Œå› æ­¤ä»¥ä¸Šçš„è¿æ¥åªæ˜¯åšå®¢åœ¨å½“å‰çš„ä¸€ä¸ªï¼ˆæ°¸ä¹…ï¼‰çŠ¶æ€ï¼Œå¦‚æœæƒ³è¦é€šè¿‡ä¸€ä¸ªé“¾æ¥è®¿é—®ä¸æ–­æ›´æ–°çš„åšå®¢ï¼Œå°±éœ€è¦å€ŸåŠ© IPNSï¼ŒIPNS çš„ä½œç”¨å°±æ˜¯å°†æŸä¸ªæ–‡ä»¶ä¸ PeerID è¿›è¡Œç»‘å®šï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPeerID å¯ä»¥ä¿æŒä¸å˜ï¼Œè¿™æ ·ï¼Œé€šè¿‡è®¿é—® PeerIDï¼Œå°±å¯ä»¥è®¿é—®ä¸ PeerID ç»‘å®šçš„å†…å®¹äº†ï¼Œè¿™å’Œ DNS ä¸­åŸŸåä¸ IP çš„å…³ç³»ç±»ä¼¼ã€‚</p>\n<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†å½“å‰çš„ public ç›®å½•å“ˆå¸Œä¸ PeerIDï¼ŒPeerID ä¸éœ€è¦æ˜¾ç¤ºæŒ‡å®šï¼Œå¾—åˆ°ç»‘å®šç»“æœåçš„ PeerID å®é™…ä¸Šä¸é€šè¿‡ <code>ipfs id</code> å‘½ä»¤å¾—åˆ°çš„ ID ä¸€è‡´ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç»‘å®š</span></span><br><span class=\"line\">ipfs name publish &lt;file_hash&gt;</span><br><span class=\"line\">ipfs name publish QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç»‘å®šåçš„è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\"># Published to QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo:</span></span><br><span class=\"line\"><span class=\"comment\"># /ipfs/QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¿é—®ï¼ˆåˆ—å‡ºç›®å½•ï¼‰ IPNS QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo</span></span><br><span class=\"line\">ipfs ls /ipns/&lt;peer_id&gt;</span><br><span class=\"line\">ipfs ls /ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åå‘è§£æ</span></span><br><span class=\"line\">ipfs name resolve &lt;peer_id&gt;</span><br><span class=\"line\">ipfs name resolve QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo</span><br></pre></td></tr></table></figure>\n\n<p>ç»‘å®š IPNS ä¹‹åï¼Œå¯ä»¥é€šè¿‡ <a href=\"https://gateway.ipfs.io/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo/\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo/</a> è®¿é—®åˆ°åšå®¢ã€‚</p>\n<p><strong>ä½†æ˜¯ç›´æ¥éƒ¨ç½² public ç›®å½•å­˜åœ¨ä¸€ä¸ªé—®é¢˜</strong>ï¼šhexo è¿™ç±»çš„åšå®¢ä¸­æ‰€æœ‰æœ¬åœ°èµ„æºçš„è·¯å¾„å‡ä¸ºæ ¹ç›®å½•å¼€å¤´çš„ç›¸å¯¹ç«™ç‚¹æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚å¯¹äº <code>/css/home.css</code>ï¼Œå½“è®¿é—® <code>https://gateway.ipfs.io/ipfs/&lt;file_hash&gt;</code> è¿™æ ·åœ¨æ–‡ä»¶ä¸­æœ‰ç±»ä¼¼ç»å¯¹è·¯å¾„é“¾æ¥æ—¶ï¼Œç›¸å½“äºè®¿é—® <code>https://gateway.ipfs.io/css/home.css</code>ï¼Œæ˜¾ç„¶è¿™ä¸ª <code>home.css</code> æ–‡ä»¶æ˜¯ä¸å­˜åœ¨çš„ã€‚å¦‚æœæƒ³è¦ä½¿å¾—ç½‘ç«™å¯ä»¥æ­£ç¡®è®¿é—®ï¼Œæœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š</p>\n<ol>\n<li>ä½¿ç”¨ç›¸å¯¹è·¯å¾„ <code>./css/home.css</code>ï¼Œè¿™æ ·å°±ç›¸å½“äºè®¿é—® <code>https://gateway.ipfs.io/ipfs/&lt;file_hash&gt;/css/home.css</code>ï¼Œå¦‚æ­¤å¯ä»¥æ­£ç¡®è®¿é—®ã€‚å¦‚æœåšå®¢æ¡†æ¶è‡ªèº«æ”¯æŒå°†æ‰€æœ‰æœ¬ç«™èµ„æºçš„ç»å¯¹è·¯å¾„æ›¿æ¢æˆè¿™æ ·ï¼Œæˆ–è€…æ•´ä¸ªåšå®¢æ˜¯è‡ªå·±å®ç°å¦‚æ­¤ï¼Œé‚£ä¸éœ€è¦é¢å¤–çš„æ“ä½œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå®Œç¾çš„åšå®¢ã€‚</li>\n<li>è®© <code>http://gateway.site/css/home.css</code> çœŸå®å­˜åœ¨ï¼Œå³å°† <code>http://gateway.ipfs.io/ipfs/&lt;file_hash&gt;</code> æ›¿æ¢æˆä¸€ä¸ªç‹¬ç«‹åŸŸå <code>http://gateway.site</code>ï¼Œè¿™å°±éœ€è¦ç”¨åˆ° IPFS æä¾›çš„ <a href=\"https://github.com/ipfs/go-dnslink\" target=\"_blank\" rel=\"noopener\">dnslink</a> å¢å¼ºã€‚</li>\n</ol>\n<h2 id=\"ä¸ºåšå®¢æ·»åŠ åŸŸå\"><a href=\"#ä¸ºåšå®¢æ·»åŠ åŸŸå\" class=\"headerlink\" title=\"ä¸ºåšå®¢æ·»åŠ åŸŸå\"></a>ä¸ºåšå®¢æ·»åŠ åŸŸå</h2><p>è¿˜æ˜¯ä»¥æˆ‘è‡ªå·±çš„åŸŸå 0ranga.com ä¸ºä¾‹ï¼Œè¿™ä¸ªåŸŸåæ‰˜ç®¡åœ¨ Namecheap ä¸Šï¼Œä½¿ç”¨ Namecheap çš„ DNS ç®¡ç†ï¼Œå¯ä»¥ä¸ºåŸŸåå¢åŠ ä¸€ä¸ªå­åŸŸå TXT è®°å½•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TXT 0ranga.com dnslink=/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ°å€ <a href=\"https://gateway.ipfs.io/ipns/0ranga.com\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipns/0ranga.com</a> è®¿é—®åˆ°éƒ¨ç½²åœ¨ IPFS ä¸Šåšå®¢ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥ç¼©çŸ­è®¿é—®é“¾æ¥é•¿åº¦ï¼Œåœ¨ DNS ç®¡ç†ä¸­è¿›ä¸€æ­¥æ·»åŠ å¦‚ä¸‹è®°å½•ï¼ˆä¸ºäº†ä¸ä¸åŸåšå®¢ 0ranga.com å†²çªï¼Œè¿™é‡Œä½¿ç”¨å­åŸŸå ipfs.0ranga.comï¼‰ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1. ä¸ºå­åŸŸå ipfs.0ranga.com æ·»åŠ  A è®°å½•ï¼Œç»‘å®šåˆ°ä¸€ä¸ª Gateway çš„ IPï¼Œ</span><br><span class=\"line\">#    ç¤ºä¾‹ä¸­æ˜¯ 209.94.78.78 ï¼Œè¿™ä¸ª IP æ˜¯ gateway.ipfs.io çš„ä¼—å¤š IP ä¸­çš„ä¸€ä¸ª</span><br><span class=\"line\">A ipfs.0ranga.com 209.94.78.78</span><br><span class=\"line\"></span><br><span class=\"line\"># 2. ä¸ºå­åŸŸå ipfs.0ranga.com æ·»åŠ  TXT è®°å½•ï¼ŒæŒ‡å®š IPNS</span><br><span class=\"line\">TXT ipfs.0ranga.com dnslink=/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo</span><br></pre></td></tr></table></figure>\n\n<p>ç­‰å¾… DNS è®°å½•ç”Ÿæ•ˆåï¼Œå¯ä»¥é€šè¿‡ <a href=\"http://ipfs.0ranga.com/\" target=\"_blank\" rel=\"noopener\">http://ipfs.0ranga.com</a> è®¿é—®åšå®¢ã€‚è‡³æ­¤ï¼Œåšå®¢çš„çŸ­é“¾æ¥æ”¹é€ å·²ç»åŸºæœ¬å®Œæˆã€‚æ¥ä¸‹æ¥ä¼šè®°å½•äº›è‡ªå·±å¦å¤–çš„ä¸€äº›å°è¯•ï¼ŒåŒ…æ‹¬å¯¹åšå®¢çš„è®¿é—®è¿›è¡ŒåŠ é€Ÿç­‰ã€‚</p>\n<h2 id=\"è¿›é˜¶\"><a href=\"#è¿›é˜¶\" class=\"headerlink\" title=\"è¿›é˜¶\"></a>è¿›é˜¶</h2><h3 id=\"éƒ¨ç½²äº‘æœåŠ¡å™¨ä»¥å¢å¼ºåšå®¢çš„å¯ç”¨æ€§åŒæ—¶åŠ å¿«è®¿é—®é€Ÿåº¦\"><a href=\"#éƒ¨ç½²äº‘æœåŠ¡å™¨ä»¥å¢å¼ºåšå®¢çš„å¯ç”¨æ€§åŒæ—¶åŠ å¿«è®¿é—®é€Ÿåº¦\" class=\"headerlink\" title=\"éƒ¨ç½²äº‘æœåŠ¡å™¨ä»¥å¢å¼ºåšå®¢çš„å¯ç”¨æ€§åŒæ—¶åŠ å¿«è®¿é—®é€Ÿåº¦\"></a>éƒ¨ç½²äº‘æœåŠ¡å™¨ä»¥å¢å¼ºåšå®¢çš„å¯ç”¨æ€§åŒæ—¶åŠ å¿«è®¿é—®é€Ÿåº¦</h3><p>å¦‚æœéƒ¨ç½²äº†åšå®¢çš„æœ¬åœ° PC å…³æœºï¼ŒåŒæ—¶åšå®¢çš„è®¿é—®é‡ä¸æ˜¯é‚£ä¹ˆå¯è§‚ï¼Œåˆ™å¯èƒ½å­˜åœ¨ä¸€éƒ¨åˆ†åšå®¢æ–‡ä»¶æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œå› ä¸ºåœ¨æ²¡æœ‰æ¿€åŠ±çš„æƒ…å†µä¸‹ IPFS ä¸Šçš„å…¶ä»–èŠ‚ç‚¹ä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å­˜å‚¨å…¶ä»–ç”¨æˆ·å¾€ IPFS ä¸­æ·»åŠ çš„æ–‡ä»¶ã€‚æ‰€ä»¥é…ç½®ä¸€ä¸ªäº‘æœåŠ¡å™¨æ¥å­˜å‚¨åšå®¢æœ¬èº«å°±å¯ä»¥ç¡®ä¿æ–‡ä»¶çš„å¯ç”¨æ€§ï¼ˆè¯·é—®ï¼šé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç”¨ IPFS æ¥éƒ¨ç½²åšå®¢ï¼Ÿï¼‰ï¼ŒåŒæ—¶éšç€ FileCoin æ¿€åŠ±ä¸ IPFS çš„ç»“åˆï¼Œäº‹æƒ…ä¼šå˜å¾—ä¸é‚£ä¹ˆç³Ÿç³•ã€‚</p>\n<p>äº‘æœåŠ¡éƒ¨ç½²çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<ol>\n<li><p>æŒ‰ç…§<strong>å®‰è£… IPFS</strong> è¿™å°èŠ‚ä¸­çš„å®‰è£…æ–¹æ³•åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ª IPFS æœåŠ¡ï¼›</p>\n</li>\n<li><p>ä¸ºäº† Gateway å¯ä»¥è¢«å…¬ç½‘è®¿é—®ï¼Œéœ€è¦å°† IPFS é…ç½®æ–‡ä»¶ <code>ï½/.ipfs/config</code> ä¸­ <code>Addresses:Gateway</code> çš„é…ç½®æ”¹ä¸º <code>/ip4/0.0.0.0/tcp/80</code> ï¼Œç”¨ä»¥ç›‘å¬æ‰€æœ‰ç½‘å¡ä¸Šçš„ TCP 80 ç«¯å£ï¼Œéšåé‡å¯ IPFS æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆï¼›</p>\n</li>\n<li><p>é€šè¿‡æœ¬åœ°æµè§ˆå™¨ç›´æ¥è®¿é—®äº‘æœåŠ¡å™¨çš„ IP ï¼ˆåšä¸»ç›®å‰æµ‹è¯•ä½¿ç”¨çš„æœåŠ¡å™¨å®ä¾‹çš„ IP ä¸º <code>104.248.70.88</code>ï¼‰ç»“æœä¸º <strong>404 page not found</strong> ï¼Œåˆ™è¡¨æ˜æœåŠ¡éƒ¨ç½²æˆåŠŸã€‚è¿›ä¸€æ­¥ï¼Œè®¿é—® <a href=\"http://104.248.70.88/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr\" target=\"_blank\" rel=\"noopener\">http://104.248.70.88/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr</a> å¯ä»¥å¾—åˆ° <strong>éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶</strong> è¿™èŠ‚ä¸­çš„ <strong>index.html</strong> æ–‡ä»¶ï¼Œè‡³æ­¤å®Œæˆäº† IPFS Gateway çš„éƒ¨ç½²ä¸å…±äº«ï¼›</p>\n</li>\n<li><p>ä¸º Gateway ç»‘å®šåŸŸåã€‚ç±»ä¼¼ä¹‹å‰çš„åšæ³•ï¼Œæ·»åŠ ä¸€æ¡ DNS A è®°å½•ã€‚å¾…è®°å½•ç”Ÿæ•ˆåï¼Œè®¿é—®è¿æ¥å˜ä¸º <a href=\"http://gateway.0ranga.com/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr\" target=\"_blank\" rel=\"noopener\">http://gateway.0ranga.com/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr</a></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A gateway.0ranga.com 104.248.70.88</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>æ”¹ç”¨è‡ªå·±çš„ Gatewayã€‚å°†ä¹‹å‰é…ç½®çš„å­åŸŸå ipfs.0ranga.com çš„ A è®°å½•å¯¹åº”çš„ IP æ”¹æˆäº‘æœåŠ¡å™¨çš„ IPï¼ˆTXT è®°å½•ä¿æŒä¸å˜ï¼‰ï¼Œå½“æµè§ˆå™¨è®¿é—® ipfs.0ranga.com è¿™ä¸ªåŸŸåæ—¶ï¼Œé¦–å…ˆä¼šè®¿é—® 104.248.70.88 è¿™å° Gateway æœåŠ¡å™¨ï¼ŒGateway å†å‘æ•´ä¸ª IPFS ç½‘ç»œæ”¶é›†å½“å‰é¡µé¢çš„ç¢ç‰‡ï¼›</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A ipfs.0ranga.com 104.248.70.88</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>é€šè¿‡ Pin æ“ä½œå°†æœ¬åœ°åšå®¢ public ç›®å½•â€é’‰â€œè‡³äº‘æœåŠ¡å™¨ IPFS èŠ‚ç‚¹ï¼Œç„¶åå°† public ç›®å½•å“ˆå¸Œç»‘å®šè‡³äº‘æœåŠ¡å™¨ä¸­ IPFS çš„ PeerIDï¼Œå¦å¤–è®°å¾—ä¿®æ”¹å­åŸŸå ipfs.0ranga.com çš„ TXT è®°å½•ä¸­çš„ IPNS åœ°å€ã€‚æ­¤åå³ä½¿å…³é—­æœ¬åœ° PC çš„ IPFS æœåŠ¡ï¼Œéƒ¨ç½²åœ¨ IPFS ä¸Šåšå®¢ä¹Ÿå¯ä»¥è¢«æ­£å¸¸è®¿é—®ï¼Œè®¿é—®åœ°å€ä¾ç„¶æ˜¯ <a href=\"http://ipfs.0ranga.com;/\" target=\"_blank\" rel=\"noopener\">http://ipfs.0ranga.comï¼›</a></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs pin add QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>å¦‚æœè§‰ç€åŒæ­¥æ–‡ä»¶è‡³äº‘æœåŠ¡å™¨ï¼Œè€Œåˆä¸ä»‹æ„ä¸€ç›´è¿è¡Œæœ¬åœ° PC çš„ IPFS æœåŠ¡ï¼Œä½†æ˜¯åšå®¢çš„è®¿é—®é€Ÿåº¦åˆä¸å¿«ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å°†äº‘æœåŠ¡å™¨ä¸Š IPFS èŠ‚ç‚¹ç›´æ¥åŠ å…¥åˆ°æœ¬åœ° Peer åˆ—è¡¨ä¸­ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©äº‘æœåŠ¡å™¨ä¸Šçš„ IPFS èŠ‚ç‚¹å¿«é€Ÿæ‰¾åˆ°æœ¬åœ° PC IPFS èŠ‚ç‚¹ä¸­çš„åšå®¢æ–‡ä»¶ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs swarm connect /ip4/104.248.70.88/tcp/4001/ipfs/QmamxGp6sw2dKUHm2RnaJ7zRDeR3w8m98kKAYgfpszeqHR</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h3 id=\"HTTPS-åŠ æŒ\"><a href=\"#HTTPS-åŠ æŒ\" class=\"headerlink\" title=\"HTTPS åŠ æŒ\"></a>HTTPS åŠ æŒ</h3><p>åœ¨äº‘æœåŠ¡å™¨ CentOS ç³»ç»Ÿä¸Šå®‰è£… Nginx æœåŠ¡ï¼Œç„¶åä½¿ç”¨ Certbot ç”Ÿæˆ Letâ€™s Encrypt è¯ä¹¦ï¼Œè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼ŒCertbot çš„å®‰è£…åœ¨<a href=\"https://certbot.eff.org/lets-encrypt/centosrhel7-nginx\" target=\"_blank\" rel=\"noopener\">å®˜æ–¹æ•™ç¨‹</a>æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œæ­¤å¤„çœç•¥ã€‚æœ€ç»ˆï¼Œå­åŸŸå ipfs.0ranga.com çš„ Nginx çš„é…ç½®å¤§è‡´å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    server_name  ipfs.0ranga.com;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">            proxy_pass http://localhost:8080/;</span><br><span class=\"line\">            proxy_set_header Host $host;</span><br><span class=\"line\">            proxy_buffering off;</span><br><span class=\"line\">            proxy_pass_request_headers on;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    listen 443 ssl; # managed by Certbot</span><br><span class=\"line\">    ssl_certificate /etc/letsencrypt/live/ipfs.0ranga.com/fullchain.pem; # managed by Certbot</span><br><span class=\"line\">    ssl_certificate_key /etc/letsencrypt/live/ipfs.0ranga.com/privkey.pem; # managed by Certbot</span><br><span class=\"line\">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class=\"line\">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    if ($host = ipfs.0ranga.com) &#123;</span><br><span class=\"line\">        return 301 https://$host$request_uri;</span><br><span class=\"line\">    &#125; # managed by Certbot</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    listen       80 default_server;</span><br><span class=\"line\">    server_name  ipfs.0ranga.com;</span><br><span class=\"line\">return 404; # managed by Certbot</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ³¨æ„ï¼Œç”±äºç«¯å£ç”± Nginx è¿›è¡Œæ§åˆ¶ï¼Œ Gateway ä¸èƒ½å†å ç”¨ 80 ç«¯å£ï¼Œå› æ­¤è¿™é‡Œå°†å…¶ï¼ˆ<code>ï½/.ipfs/config</code> ä¸­ <code>Addresses:Gateway</code> é…ç½®ï¼‰é‡æ–°è®¾å®šä¸º 8080ã€‚gateway.0ranga.com çš„ Nginx é…ç½®ä¹Ÿæ˜¯ç±»ä¼¼ã€‚Hurrayï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ <a href=\"https://ipfs.0ranga.com/\" target=\"_blank\" rel=\"noopener\">https://ipfs.0ranga.com</a> è®¿é—®åšä¸»éƒ¨ç½²åœ¨ IPFS ä¸Šçš„åšå®¢ï¼Œé€šè¿‡ <a href=\"https://gateway.0ranga.com/\" target=\"_blank\" rel=\"noopener\">https://gateway.0ranga.com</a> è®¿é—®åšä¸»çš„ Gateway äº†ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>å¯ä»¥ç”¨ä»¥ä¸‹å‡ ä¸ªç½‘å€è¿›è¡Œæ€»ç»“ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>åºå·</th>\n<th>é“¾æ¥</th>\n<th>æ”¹è¿›ä¹‹å¤„</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><a href=\"https://gateway.ipfs.io/ipfs/\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipfs/</a><root_path_hash>/</root_path_hash></td>\n<td>åŸå§‹åšå®¢ç›®å½•</td>\n</tr>\n<tr>\n<td>2</td>\n<td><a href=\"https://gateway.ipfs.io/ipns/\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipns/</a><peer_id>/</peer_id></td>\n<td>IPNS æ˜ å°„ç›®å½•ï¼Œç«™ç‚¹æ›´æ–°æ—¶é“¾æ¥ä¿æŒä¸å˜</td>\n</tr>\n<tr>\n<td>3</td>\n<td><a href=\"https://gateway.ipfs.io/ipns/0ranga.com\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipns/0ranga.com</a></td>\n<td>dnslink ç»‘å®šï¼Œå¢åŠ é“¾æ¥å¯è¯»æ€§</td>\n</tr>\n<tr>\n<td>4</td>\n<td><a href=\"http://ipfs.0ranga.com/\" target=\"_blank\" rel=\"noopener\">http://ipfs.0ranga.com</a></td>\n<td>å®ç°å®Œå…¨è‡ªå®šä¹‰åŸŸå</td>\n</tr>\n<tr>\n<td>5</td>\n<td><a href=\"https://ipfs.0ranga.com/\" target=\"_blank\" rel=\"noopener\">https://ipfs.0ranga.com</a></td>\n<td>ä¸ºåŸŸåæ·»åŠ  HTTPS è¯ä¹¦</td>\n</tr>\n</tbody></table>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://michalzalecki.com/set-up-ipfs-node-on-the-server/\" target=\"_blank\" rel=\"noopener\">https://michalzalecki.com/set-up-ipfs-node-on-the-server/</a></li>\n<li><a href=\"https://github.com/ipfs/notes/issues/39\" target=\"_blank\" rel=\"noopener\">https://github.com/ipfs/notes/issues/39</a></li>\n<li><a href=\"https://www.cloudxns.net/Support/detail/id/304.html\" target=\"_blank\" rel=\"noopener\">https://www.cloudxns.net/Support/detail/id/304.html</a></li>\n<li><a href=\"https://ipfs.io/ipns/Qme48wyZ7LaF9gC5693DZyJBtehgaFhaKycESroemD5fNX/post/putting_this_blog_on_ipfs/\" target=\"_blank\" rel=\"noopener\">https://ipfs.io/ipns/Qme48wyZ7LaF9gC5693DZyJBtehgaFhaKycESroemD5fNX/post/putting_this_blog_on_ipfs/</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>æœ¬æ–‡ä¸»è¦è®°å½•åœ¨ IPFS ä¸Šéƒ¨ç½²åšå®¢çš„è¿‡ç¨‹ï¼Œç”¨ä»¥ç†Ÿæ‚‰ IPFS çš„åŸºæœ¬æ“ä½œã€‚<a href=\"https://ipfs.0ranga.com/\" target=\"_blank\" rel=\"noopener\">https://ipfs.0ranga.com</a> å°±æ˜¯åšä¸»åšå®¢åœ¨ IPFS ä¸Šéƒ¨ç½²çš„ç‰ˆæœ¬ã€‚</p>","more":"<h2 id=\"IPFS\"><a href=\"#IPFS\" class=\"headerlink\" title=\"IPFS\"></a>IPFS</h2><h3 id=\"å®‰è£…-IPFS\"><a href=\"#å®‰è£…-IPFS\" class=\"headerlink\" title=\"å®‰è£… IPFS\"></a>å®‰è£… IPFS</h3><p>é¦–å…ˆå¾—åœ¨è®¡ç®—æœºä¸Šå®‰è£… IPFSï¼Œåšä¸» PC çš„æ“ä½œç³»ç»Ÿçš„ Archï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨åŒ…ç®¡ç†å™¨è¿›è¡Œå®‰è£…ã€‚å¦‚æœä¹‹åéœ€è¦ä¸ºåšå®¢æ·»åŠ åŸŸååˆ™éœ€è¦åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½² IPFSï¼Œåšä¸»é€‰æ‹©çš„æ˜¯ DightOcean çš„ CentOS 7ã€‚æ‰€ä»¥æä¾›äº†ä»¥ä¸Šä¸¤ç§æ“ä½œç³»ç»Ÿçš„å®‰è£…æ–¹å¼ï¼Œå…¶ä»–ç³»ç»Ÿå¦‚ä½•å®‰è£…è¯·è‡ªè¡Œæ¢ç´¢ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Arch</span></span><br><span class=\"line\"><span class=\"comment\">## åŒ…ç®¡ç†å™¨ç›´æ¥å®‰è£…</span></span><br><span class=\"line\">pacman -S go-ipfs </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># CentOS</span></span><br><span class=\"line\"><span class=\"comment\">## ä» https://dist.ipfs.io/#go-ipfs è·å–æœ€æ–°å®‰è£…åŒ…ï¼Œä¾‹å¦‚</span></span><br><span class=\"line\">wget https://dist.ipfs.io/go-ipfs/v0.4.17/go-ipfs_v0.4.17_linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## è§£å‹</span></span><br><span class=\"line\">tar xvfz go-ipfs_v0.4.17_linux-amd64.tar.gz</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## å®‰è£…</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> go-ipfs &amp;&amp; ./install.sh</span><br></pre></td></tr></table></figure>\n\n<p>å®‰è£…å®Œæˆåéœ€è¦å…ˆåˆå§‹åŒ– IPFS</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs init</span><br></pre></td></tr></table></figure>\n\n<p>å¦å¤–ï¼Œä¸€èˆ¬åœ¨äº‘æœåŠ¡å™¨ä¸Šéœ€è¦å°† IPFS è®¾ç½®ä¸ºè‡ªå¯åŠ¨æœåŠ¡ï¼Œè®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼Œé¦–å…ˆéœ€è¦æ·»åŠ  service æè¿°æ–‡ä»¶</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi /etc/systemd/system/ipfs.service</span><br></pre></td></tr></table></figure>\n\n<p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Unit]</span><br><span class=\"line\">Description=IPFS Daemon</span><br><span class=\"line\"></span><br><span class=\"line\">[Service]</span><br><span class=\"line\">Type=simple</span><br><span class=\"line\">ExecStart=/usr/local/bin/ipfs daemon --enable-namesys-pubsub</span><br><span class=\"line\"></span><br><span class=\"line\">[Install]</span><br><span class=\"line\">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åä½¿æœåŠ¡å¼€æœºè‡ªå¯åŠ¨åŒæ—¶ç«‹å³å¯åŠ¨ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl <span class=\"built_in\">enable</span> ipfs</span><br><span class=\"line\">systemctl start ipfs</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶\"><a href=\"#éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶\" class=\"headerlink\" title=\"éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶\"></a>éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶</h3><p>æ¥ä¸‹æ¥åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ <code>index.html</code>ï¼Œåœ¨é‡Œé¢å†™å…¥ç®€å•çš„è¯</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">'hello, my simple blog!'</span> &gt; index.html</span><br></pre></td></tr></table></figure>\n\n<p>éšåæ·»åŠ è‡³ IPFS ä¸­</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs add index.html</span><br></pre></td></tr></table></figure>\n\n<p>å¾—åˆ°è¿”å›å¦‚ä¸‹</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs add index.html </span><br><span class=\"line\"><span class=\"comment\"># added QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr index.html</span></span><br><span class=\"line\"><span class=\"comment\"># 23 B / 23 B [=========================================] 100.00%</span></span><br></pre></td></tr></table></figure>\n\n<p>å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å†…å®¹</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs cat QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr</span><br></pre></td></tr></table></figure>\n\n<p>å½“æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯åŠ¨èŠ‚ç‚¹åï¼Œæ–‡ä»¶å†…å®¹å°†ä¼šé€æ¸è¢« IPFS ç½‘ç»œå­˜å‚¨</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs daemon</span><br><span class=\"line\"><span class=\"comment\"># æˆ–è€…</span></span><br><span class=\"line\">systemctl start ipfs</span><br></pre></td></tr></table></figure>\n\n<p>éšåå¯ä»¥é€šè¿‡è®¿é—® <a href=\"https://gateway.ipfs.io/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr</a> å¾—åˆ°è¯¥æ–‡ä»¶ã€‚å¦‚æœä½ ä¸ä»‹æ„å°†è¿™å¥ç®€å•çš„è¯ä½œä¸ºä½ çš„åšå®¢çš„å…¨éƒ¨å†…å®¹çš„è¯ï¼Œé‚£è‡³æ­¤åšå®¢çš„å…¨éƒ¨åˆ›å»ºå®Œæˆäº†ï¼Œè€Œä¸”ç†è®ºä¸Šæ°¸è¿œä¸ä¼šæ¶ˆå¤±ã€‚</p>\n<h2 id=\"éƒ¨ç½²é™æ€åšå®¢æ¡†æ¶ï¼šä»¥-Hexo-ä¸ºä¾‹\"><a href=\"#éƒ¨ç½²é™æ€åšå®¢æ¡†æ¶ï¼šä»¥-Hexo-ä¸ºä¾‹\" class=\"headerlink\" title=\"éƒ¨ç½²é™æ€åšå®¢æ¡†æ¶ï¼šä»¥ Hexo ä¸ºä¾‹\"></a>éƒ¨ç½²é™æ€åšå®¢æ¡†æ¶ï¼šä»¥ Hexo ä¸ºä¾‹</h2><p>è™½ç„¶å°æ ‡é¢˜å†™çš„æ˜¯â€œä»¥ Hexo ä¸ºä¾‹â€ï¼Œä½†æœ¬æ–‡ä¸ä¼šç»†è®²å¦‚ä½•ä½¿ç”¨ Hexoï¼Œ<a href=\"https://hexo.io/zh-cn/docs/\" target=\"_blank\" rel=\"noopener\">Hexo å®˜æ–¹æ–‡æ¡£</a>æä¾›äº†ç»†è‡´çš„å¸®åŠ©ã€‚å¦‚æœä½ ä¹‹å‰ç”¨è¿‡ Hexo è€Œä¸”å› ä¸ºæ‡’å¾—å†™ä½œè€ŒæŠŠå®ƒä¸¢å¼ƒåœ¨ç¡¬ç›˜é‡Œï¼Œè¿™é‡Œæœ‰å‡ ä¸ªå‘½ä»¤å¯ä»¥å¸®åŠ©ä½ å¿«é€Ÿå›æƒ³èµ·ä½¿ç”¨æ–¹æ³•ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åˆ›å»ºæ–°æ–‡ç« </span></span><br><span class=\"line\">hexo new post &lt;new_post_name&gt;</span><br><span class=\"line\"><span class=\"comment\"># æ¸…ç†</span></span><br><span class=\"line\">hexo clean</span><br><span class=\"line\"><span class=\"comment\"># ç”Ÿæˆåšå®¢</span></span><br><span class=\"line\">hexo g</span><br><span class=\"line\"><span class=\"comment\"># å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨</span></span><br><span class=\"line\">hexo s --open</span><br><span class=\"line\"><span class=\"comment\"># éƒ¨ç½²</span></span><br><span class=\"line\">hexo d</span><br></pre></td></tr></table></figure>\n\n<p>åœ¨ä½¿ç”¨ <code>hexo g</code> ç”Ÿæˆé™æ€åšå®¢åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ <strong>public</strong> ç›®å½•ä¸­æ‰¾åˆ°éƒ¨ç½²åšå®¢éœ€è¦çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå…¥å£æ˜¯ç†Ÿæ‚‰çš„ <strong>index.html</strong>ã€‚ï¼ˆå…¶ä»–åšå®¢æ¡†æ¶ä¹Ÿæœ‰ä¸ªç±»ä¼¼ public çš„æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æ•´ä¸ªåšå®¢ï¼‰</p>\n<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å°†æ•´ä¸ª public æ–‡ä»¶å¤¹æ”¾å…¥ IPFS</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs add -r public</span><br></pre></td></tr></table></figure>\n\n<p>æ·»åŠ åçš„è¾“å‡ºä¸­æœ€åä¸€è¡Œæ˜¯ç›®å½• public çš„å“ˆå¸Œå€¼ï¼Œæ¯”å¦‚åšä¸»å¾—åˆ°çš„æ˜¯</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># added QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt public</span></span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åè®¿é—® <a href=\"https://gateway.ipfs.io/ipfs/QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt/\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipfs/QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt/</a> å°±å¯ä»¥çœ‹åˆ°ä¿å­˜åœ¨ IPFS ä¸Šçš„åšå®¢äº†ã€‚ä¸è¿‡ï¼Œåœ¨ä¿®æ”¹æ–‡ç« æ›´æ–° public ç›®å½•ä¹‹åï¼Œç›®å½•çš„å“ˆå¸Œå€¼ä¼šå˜åŒ–ï¼Œå› æ­¤ä»¥ä¸Šçš„è¿æ¥åªæ˜¯åšå®¢åœ¨å½“å‰çš„ä¸€ä¸ªï¼ˆæ°¸ä¹…ï¼‰çŠ¶æ€ï¼Œå¦‚æœæƒ³è¦é€šè¿‡ä¸€ä¸ªé“¾æ¥è®¿é—®ä¸æ–­æ›´æ–°çš„åšå®¢ï¼Œå°±éœ€è¦å€ŸåŠ© IPNSï¼ŒIPNS çš„ä½œç”¨å°±æ˜¯å°†æŸä¸ªæ–‡ä»¶ä¸ PeerID è¿›è¡Œç»‘å®šï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPeerID å¯ä»¥ä¿æŒä¸å˜ï¼Œè¿™æ ·ï¼Œé€šè¿‡è®¿é—® PeerIDï¼Œå°±å¯ä»¥è®¿é—®ä¸ PeerID ç»‘å®šçš„å†…å®¹äº†ï¼Œè¿™å’Œ DNS ä¸­åŸŸåä¸ IP çš„å…³ç³»ç±»ä¼¼ã€‚</p>\n<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤å°†å½“å‰çš„ public ç›®å½•å“ˆå¸Œä¸ PeerIDï¼ŒPeerID ä¸éœ€è¦æ˜¾ç¤ºæŒ‡å®šï¼Œå¾—åˆ°ç»‘å®šç»“æœåçš„ PeerID å®é™…ä¸Šä¸é€šè¿‡ <code>ipfs id</code> å‘½ä»¤å¾—åˆ°çš„ ID ä¸€è‡´ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># ç»‘å®š</span></span><br><span class=\"line\">ipfs name publish &lt;file_hash&gt;</span><br><span class=\"line\">ipfs name publish QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç»‘å®šåçš„è¾“å‡º</span></span><br><span class=\"line\"><span class=\"comment\"># Published to QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo:</span></span><br><span class=\"line\"><span class=\"comment\"># /ipfs/QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¿é—®ï¼ˆåˆ—å‡ºç›®å½•ï¼‰ IPNS QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo</span></span><br><span class=\"line\">ipfs ls /ipns/&lt;peer_id&gt;</span><br><span class=\"line\">ipfs ls /ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åå‘è§£æ</span></span><br><span class=\"line\">ipfs name resolve &lt;peer_id&gt;</span><br><span class=\"line\">ipfs name resolve QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo</span><br></pre></td></tr></table></figure>\n\n<p>ç»‘å®š IPNS ä¹‹åï¼Œå¯ä»¥é€šè¿‡ <a href=\"https://gateway.ipfs.io/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo/\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo/</a> è®¿é—®åˆ°åšå®¢ã€‚</p>\n<p><strong>ä½†æ˜¯ç›´æ¥éƒ¨ç½² public ç›®å½•å­˜åœ¨ä¸€ä¸ªé—®é¢˜</strong>ï¼šhexo è¿™ç±»çš„åšå®¢ä¸­æ‰€æœ‰æœ¬åœ°èµ„æºçš„è·¯å¾„å‡ä¸ºæ ¹ç›®å½•å¼€å¤´çš„ç›¸å¯¹ç«™ç‚¹æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚å¯¹äº <code>/css/home.css</code>ï¼Œå½“è®¿é—® <code>https://gateway.ipfs.io/ipfs/&lt;file_hash&gt;</code> è¿™æ ·åœ¨æ–‡ä»¶ä¸­æœ‰ç±»ä¼¼ç»å¯¹è·¯å¾„é“¾æ¥æ—¶ï¼Œç›¸å½“äºè®¿é—® <code>https://gateway.ipfs.io/css/home.css</code>ï¼Œæ˜¾ç„¶è¿™ä¸ª <code>home.css</code> æ–‡ä»¶æ˜¯ä¸å­˜åœ¨çš„ã€‚å¦‚æœæƒ³è¦ä½¿å¾—ç½‘ç«™å¯ä»¥æ­£ç¡®è®¿é—®ï¼Œæœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š</p>\n<ol>\n<li>ä½¿ç”¨ç›¸å¯¹è·¯å¾„ <code>./css/home.css</code>ï¼Œè¿™æ ·å°±ç›¸å½“äºè®¿é—® <code>https://gateway.ipfs.io/ipfs/&lt;file_hash&gt;/css/home.css</code>ï¼Œå¦‚æ­¤å¯ä»¥æ­£ç¡®è®¿é—®ã€‚å¦‚æœåšå®¢æ¡†æ¶è‡ªèº«æ”¯æŒå°†æ‰€æœ‰æœ¬ç«™èµ„æºçš„ç»å¯¹è·¯å¾„æ›¿æ¢æˆè¿™æ ·ï¼Œæˆ–è€…æ•´ä¸ªåšå®¢æ˜¯è‡ªå·±å®ç°å¦‚æ­¤ï¼Œé‚£ä¸éœ€è¦é¢å¤–çš„æ“ä½œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå®Œç¾çš„åšå®¢ã€‚</li>\n<li>è®© <code>http://gateway.site/css/home.css</code> çœŸå®å­˜åœ¨ï¼Œå³å°† <code>http://gateway.ipfs.io/ipfs/&lt;file_hash&gt;</code> æ›¿æ¢æˆä¸€ä¸ªç‹¬ç«‹åŸŸå <code>http://gateway.site</code>ï¼Œè¿™å°±éœ€è¦ç”¨åˆ° IPFS æä¾›çš„ <a href=\"https://github.com/ipfs/go-dnslink\" target=\"_blank\" rel=\"noopener\">dnslink</a> å¢å¼ºã€‚</li>\n</ol>\n<h2 id=\"ä¸ºåšå®¢æ·»åŠ åŸŸå\"><a href=\"#ä¸ºåšå®¢æ·»åŠ åŸŸå\" class=\"headerlink\" title=\"ä¸ºåšå®¢æ·»åŠ åŸŸå\"></a>ä¸ºåšå®¢æ·»åŠ åŸŸå</h2><p>è¿˜æ˜¯ä»¥æˆ‘è‡ªå·±çš„åŸŸå 0ranga.com ä¸ºä¾‹ï¼Œè¿™ä¸ªåŸŸåæ‰˜ç®¡åœ¨ Namecheap ä¸Šï¼Œä½¿ç”¨ Namecheap çš„ DNS ç®¡ç†ï¼Œå¯ä»¥ä¸ºåŸŸåå¢åŠ ä¸€ä¸ªå­åŸŸå TXT è®°å½•å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TXT 0ranga.com dnslink=/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo</span><br></pre></td></tr></table></figure>\n\n<p>è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ°å€ <a href=\"https://gateway.ipfs.io/ipns/0ranga.com\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipns/0ranga.com</a> è®¿é—®åˆ°éƒ¨ç½²åœ¨ IPFS ä¸Šåšå®¢ã€‚æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥ç¼©çŸ­è®¿é—®é“¾æ¥é•¿åº¦ï¼Œåœ¨ DNS ç®¡ç†ä¸­è¿›ä¸€æ­¥æ·»åŠ å¦‚ä¸‹è®°å½•ï¼ˆä¸ºäº†ä¸ä¸åŸåšå®¢ 0ranga.com å†²çªï¼Œè¿™é‡Œä½¿ç”¨å­åŸŸå ipfs.0ranga.comï¼‰ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1. ä¸ºå­åŸŸå ipfs.0ranga.com æ·»åŠ  A è®°å½•ï¼Œç»‘å®šåˆ°ä¸€ä¸ª Gateway çš„ IPï¼Œ</span><br><span class=\"line\">#    ç¤ºä¾‹ä¸­æ˜¯ 209.94.78.78 ï¼Œè¿™ä¸ª IP æ˜¯ gateway.ipfs.io çš„ä¼—å¤š IP ä¸­çš„ä¸€ä¸ª</span><br><span class=\"line\">A ipfs.0ranga.com 209.94.78.78</span><br><span class=\"line\"></span><br><span class=\"line\"># 2. ä¸ºå­åŸŸå ipfs.0ranga.com æ·»åŠ  TXT è®°å½•ï¼ŒæŒ‡å®š IPNS</span><br><span class=\"line\">TXT ipfs.0ranga.com dnslink=/ipns/QmRP5ZT2B5W8zWTXhPwpgZQpuj8Gv5bNaXWbttRB6niAYo</span><br></pre></td></tr></table></figure>\n\n<p>ç­‰å¾… DNS è®°å½•ç”Ÿæ•ˆåï¼Œå¯ä»¥é€šè¿‡ <a href=\"http://ipfs.0ranga.com/\" target=\"_blank\" rel=\"noopener\">http://ipfs.0ranga.com</a> è®¿é—®åšå®¢ã€‚è‡³æ­¤ï¼Œåšå®¢çš„çŸ­é“¾æ¥æ”¹é€ å·²ç»åŸºæœ¬å®Œæˆã€‚æ¥ä¸‹æ¥ä¼šè®°å½•äº›è‡ªå·±å¦å¤–çš„ä¸€äº›å°è¯•ï¼ŒåŒ…æ‹¬å¯¹åšå®¢çš„è®¿é—®è¿›è¡ŒåŠ é€Ÿç­‰ã€‚</p>\n<h2 id=\"è¿›é˜¶\"><a href=\"#è¿›é˜¶\" class=\"headerlink\" title=\"è¿›é˜¶\"></a>è¿›é˜¶</h2><h3 id=\"éƒ¨ç½²äº‘æœåŠ¡å™¨ä»¥å¢å¼ºåšå®¢çš„å¯ç”¨æ€§åŒæ—¶åŠ å¿«è®¿é—®é€Ÿåº¦\"><a href=\"#éƒ¨ç½²äº‘æœåŠ¡å™¨ä»¥å¢å¼ºåšå®¢çš„å¯ç”¨æ€§åŒæ—¶åŠ å¿«è®¿é—®é€Ÿåº¦\" class=\"headerlink\" title=\"éƒ¨ç½²äº‘æœåŠ¡å™¨ä»¥å¢å¼ºåšå®¢çš„å¯ç”¨æ€§åŒæ—¶åŠ å¿«è®¿é—®é€Ÿåº¦\"></a>éƒ¨ç½²äº‘æœåŠ¡å™¨ä»¥å¢å¼ºåšå®¢çš„å¯ç”¨æ€§åŒæ—¶åŠ å¿«è®¿é—®é€Ÿåº¦</h3><p>å¦‚æœéƒ¨ç½²äº†åšå®¢çš„æœ¬åœ° PC å…³æœºï¼ŒåŒæ—¶åšå®¢çš„è®¿é—®é‡ä¸æ˜¯é‚£ä¹ˆå¯è§‚ï¼Œåˆ™å¯èƒ½å­˜åœ¨ä¸€éƒ¨åˆ†åšå®¢æ–‡ä»¶æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œå› ä¸ºåœ¨æ²¡æœ‰æ¿€åŠ±çš„æƒ…å†µä¸‹ IPFS ä¸Šçš„å…¶ä»–èŠ‚ç‚¹ä¸€èˆ¬ä¸ä¼šä¸»åŠ¨å­˜å‚¨å…¶ä»–ç”¨æˆ·å¾€ IPFS ä¸­æ·»åŠ çš„æ–‡ä»¶ã€‚æ‰€ä»¥é…ç½®ä¸€ä¸ªäº‘æœåŠ¡å™¨æ¥å­˜å‚¨åšå®¢æœ¬èº«å°±å¯ä»¥ç¡®ä¿æ–‡ä»¶çš„å¯ç”¨æ€§ï¼ˆè¯·é—®ï¼šé‚£ä¸ºä»€ä¹ˆè¿˜è¦ç”¨ IPFS æ¥éƒ¨ç½²åšå®¢ï¼Ÿï¼‰ï¼ŒåŒæ—¶éšç€ FileCoin æ¿€åŠ±ä¸ IPFS çš„ç»“åˆï¼Œäº‹æƒ…ä¼šå˜å¾—ä¸é‚£ä¹ˆç³Ÿç³•ã€‚</p>\n<p>äº‘æœåŠ¡éƒ¨ç½²çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<ol>\n<li><p>æŒ‰ç…§<strong>å®‰è£… IPFS</strong> è¿™å°èŠ‚ä¸­çš„å®‰è£…æ–¹æ³•åœ¨äº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²ä¸€ä¸ª IPFS æœåŠ¡ï¼›</p>\n</li>\n<li><p>ä¸ºäº† Gateway å¯ä»¥è¢«å…¬ç½‘è®¿é—®ï¼Œéœ€è¦å°† IPFS é…ç½®æ–‡ä»¶ <code>ï½/.ipfs/config</code> ä¸­ <code>Addresses:Gateway</code> çš„é…ç½®æ”¹ä¸º <code>/ip4/0.0.0.0/tcp/80</code> ï¼Œç”¨ä»¥ç›‘å¬æ‰€æœ‰ç½‘å¡ä¸Šçš„ TCP 80 ç«¯å£ï¼Œéšåé‡å¯ IPFS æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆï¼›</p>\n</li>\n<li><p>é€šè¿‡æœ¬åœ°æµè§ˆå™¨ç›´æ¥è®¿é—®äº‘æœåŠ¡å™¨çš„ IP ï¼ˆåšä¸»ç›®å‰æµ‹è¯•ä½¿ç”¨çš„æœåŠ¡å™¨å®ä¾‹çš„ IP ä¸º <code>104.248.70.88</code>ï¼‰ç»“æœä¸º <strong>404 page not found</strong> ï¼Œåˆ™è¡¨æ˜æœåŠ¡éƒ¨ç½²æˆåŠŸã€‚è¿›ä¸€æ­¥ï¼Œè®¿é—® <a href=\"http://104.248.70.88/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr\" target=\"_blank\" rel=\"noopener\">http://104.248.70.88/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr</a> å¯ä»¥å¾—åˆ° <strong>éƒ¨ç½²ä¸€ä¸ªæ–‡ä»¶</strong> è¿™èŠ‚ä¸­çš„ <strong>index.html</strong> æ–‡ä»¶ï¼Œè‡³æ­¤å®Œæˆäº† IPFS Gateway çš„éƒ¨ç½²ä¸å…±äº«ï¼›</p>\n</li>\n<li><p>ä¸º Gateway ç»‘å®šåŸŸåã€‚ç±»ä¼¼ä¹‹å‰çš„åšæ³•ï¼Œæ·»åŠ ä¸€æ¡ DNS A è®°å½•ã€‚å¾…è®°å½•ç”Ÿæ•ˆåï¼Œè®¿é—®è¿æ¥å˜ä¸º <a href=\"http://gateway.0ranga.com/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr\" target=\"_blank\" rel=\"noopener\">http://gateway.0ranga.com/ipfs/QmaqwGFUj34wDLPzHVxmJhEN6n27xidsfrmf2WUnhSTKTr</a></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A gateway.0ranga.com 104.248.70.88</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>æ”¹ç”¨è‡ªå·±çš„ Gatewayã€‚å°†ä¹‹å‰é…ç½®çš„å­åŸŸå ipfs.0ranga.com çš„ A è®°å½•å¯¹åº”çš„ IP æ”¹æˆäº‘æœåŠ¡å™¨çš„ IPï¼ˆTXT è®°å½•ä¿æŒä¸å˜ï¼‰ï¼Œå½“æµè§ˆå™¨è®¿é—® ipfs.0ranga.com è¿™ä¸ªåŸŸåæ—¶ï¼Œé¦–å…ˆä¼šè®¿é—® 104.248.70.88 è¿™å° Gateway æœåŠ¡å™¨ï¼ŒGateway å†å‘æ•´ä¸ª IPFS ç½‘ç»œæ”¶é›†å½“å‰é¡µé¢çš„ç¢ç‰‡ï¼›</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">A ipfs.0ranga.com 104.248.70.88</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>é€šè¿‡ Pin æ“ä½œå°†æœ¬åœ°åšå®¢ public ç›®å½•â€é’‰â€œè‡³äº‘æœåŠ¡å™¨ IPFS èŠ‚ç‚¹ï¼Œç„¶åå°† public ç›®å½•å“ˆå¸Œç»‘å®šè‡³äº‘æœåŠ¡å™¨ä¸­ IPFS çš„ PeerIDï¼Œå¦å¤–è®°å¾—ä¿®æ”¹å­åŸŸå ipfs.0ranga.com çš„ TXT è®°å½•ä¸­çš„ IPNS åœ°å€ã€‚æ­¤åå³ä½¿å…³é—­æœ¬åœ° PC çš„ IPFS æœåŠ¡ï¼Œéƒ¨ç½²åœ¨ IPFS ä¸Šåšå®¢ä¹Ÿå¯ä»¥è¢«æ­£å¸¸è®¿é—®ï¼Œè®¿é—®åœ°å€ä¾ç„¶æ˜¯ <a href=\"http://ipfs.0ranga.com;/\" target=\"_blank\" rel=\"noopener\">http://ipfs.0ranga.comï¼›</a></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs pin add QmSc5D1ahPbVkAhHFxJvqnWDEWrgMQw9B9BGmQv5i1VAwt</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>å¦‚æœè§‰ç€åŒæ­¥æ–‡ä»¶è‡³äº‘æœåŠ¡å™¨ï¼Œè€Œåˆä¸ä»‹æ„ä¸€ç›´è¿è¡Œæœ¬åœ° PC çš„ IPFS æœåŠ¡ï¼Œä½†æ˜¯åšå®¢çš„è®¿é—®é€Ÿåº¦åˆä¸å¿«ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å°†äº‘æœåŠ¡å™¨ä¸Š IPFS èŠ‚ç‚¹ç›´æ¥åŠ å…¥åˆ°æœ¬åœ° Peer åˆ—è¡¨ä¸­ï¼Œè¿™æ ·å¯ä»¥å¸®åŠ©äº‘æœåŠ¡å™¨ä¸Šçš„ IPFS èŠ‚ç‚¹å¿«é€Ÿæ‰¾åˆ°æœ¬åœ° PC IPFS èŠ‚ç‚¹ä¸­çš„åšå®¢æ–‡ä»¶ã€‚</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ipfs swarm connect /ip4/104.248.70.88/tcp/4001/ipfs/QmamxGp6sw2dKUHm2RnaJ7zRDeR3w8m98kKAYgfpszeqHR</span><br></pre></td></tr></table></figure>\n\n</li>\n</ol>\n<h3 id=\"HTTPS-åŠ æŒ\"><a href=\"#HTTPS-åŠ æŒ\" class=\"headerlink\" title=\"HTTPS åŠ æŒ\"></a>HTTPS åŠ æŒ</h3><p>åœ¨äº‘æœåŠ¡å™¨ CentOS ç³»ç»Ÿä¸Šå®‰è£… Nginx æœåŠ¡ï¼Œç„¶åä½¿ç”¨ Certbot ç”Ÿæˆ Letâ€™s Encrypt è¯ä¹¦ï¼Œè¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼ŒCertbot çš„å®‰è£…åœ¨<a href=\"https://certbot.eff.org/lets-encrypt/centosrhel7-nginx\" target=\"_blank\" rel=\"noopener\">å®˜æ–¹æ•™ç¨‹</a>æœ‰è¯¦ç»†çš„è¯´æ˜ï¼Œæ­¤å¤„çœç•¥ã€‚æœ€ç»ˆï¼Œå­åŸŸå ipfs.0ranga.com çš„ Nginx çš„é…ç½®å¤§è‡´å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server &#123;</span><br><span class=\"line\">    server_name  ipfs.0ranga.com;</span><br><span class=\"line\"></span><br><span class=\"line\">    location / &#123;</span><br><span class=\"line\">            proxy_pass http://localhost:8080/;</span><br><span class=\"line\">            proxy_set_header Host $host;</span><br><span class=\"line\">            proxy_buffering off;</span><br><span class=\"line\">            proxy_pass_request_headers on;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    listen 443 ssl; # managed by Certbot</span><br><span class=\"line\">    ssl_certificate /etc/letsencrypt/live/ipfs.0ranga.com/fullchain.pem; # managed by Certbot</span><br><span class=\"line\">    ssl_certificate_key /etc/letsencrypt/live/ipfs.0ranga.com/privkey.pem; # managed by Certbot</span><br><span class=\"line\">    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot</span><br><span class=\"line\">    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">server &#123;</span><br><span class=\"line\">    if ($host = ipfs.0ranga.com) &#123;</span><br><span class=\"line\">        return 301 https://$host$request_uri;</span><br><span class=\"line\">    &#125; # managed by Certbot</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    listen       80 default_server;</span><br><span class=\"line\">    server_name  ipfs.0ranga.com;</span><br><span class=\"line\">return 404; # managed by Certbot</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>æ³¨æ„ï¼Œç”±äºç«¯å£ç”± Nginx è¿›è¡Œæ§åˆ¶ï¼Œ Gateway ä¸èƒ½å†å ç”¨ 80 ç«¯å£ï¼Œå› æ­¤è¿™é‡Œå°†å…¶ï¼ˆ<code>ï½/.ipfs/config</code> ä¸­ <code>Addresses:Gateway</code> é…ç½®ï¼‰é‡æ–°è®¾å®šä¸º 8080ã€‚gateway.0ranga.com çš„ Nginx é…ç½®ä¹Ÿæ˜¯ç±»ä¼¼ã€‚Hurrayï¼ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ <a href=\"https://ipfs.0ranga.com/\" target=\"_blank\" rel=\"noopener\">https://ipfs.0ranga.com</a> è®¿é—®åšä¸»éƒ¨ç½²åœ¨ IPFS ä¸Šçš„åšå®¢ï¼Œé€šè¿‡ <a href=\"https://gateway.0ranga.com/\" target=\"_blank\" rel=\"noopener\">https://gateway.0ranga.com</a> è®¿é—®åšä¸»çš„ Gateway äº†ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a href=\"#æ€»ç»“\" class=\"headerlink\" title=\"æ€»ç»“\"></a>æ€»ç»“</h2><p>å¯ä»¥ç”¨ä»¥ä¸‹å‡ ä¸ªç½‘å€è¿›è¡Œæ€»ç»“ï¼š</p>\n<table>\n<thead>\n<tr>\n<th>åºå·</th>\n<th>é“¾æ¥</th>\n<th>æ”¹è¿›ä¹‹å¤„</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><a href=\"https://gateway.ipfs.io/ipfs/\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipfs/</a><root_path_hash>/</root_path_hash></td>\n<td>åŸå§‹åšå®¢ç›®å½•</td>\n</tr>\n<tr>\n<td>2</td>\n<td><a href=\"https://gateway.ipfs.io/ipns/\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipns/</a><peer_id>/</peer_id></td>\n<td>IPNS æ˜ å°„ç›®å½•ï¼Œç«™ç‚¹æ›´æ–°æ—¶é“¾æ¥ä¿æŒä¸å˜</td>\n</tr>\n<tr>\n<td>3</td>\n<td><a href=\"https://gateway.ipfs.io/ipns/0ranga.com\" target=\"_blank\" rel=\"noopener\">https://gateway.ipfs.io/ipns/0ranga.com</a></td>\n<td>dnslink ç»‘å®šï¼Œå¢åŠ é“¾æ¥å¯è¯»æ€§</td>\n</tr>\n<tr>\n<td>4</td>\n<td><a href=\"http://ipfs.0ranga.com/\" target=\"_blank\" rel=\"noopener\">http://ipfs.0ranga.com</a></td>\n<td>å®ç°å®Œå…¨è‡ªå®šä¹‰åŸŸå</td>\n</tr>\n<tr>\n<td>5</td>\n<td><a href=\"https://ipfs.0ranga.com/\" target=\"_blank\" rel=\"noopener\">https://ipfs.0ranga.com</a></td>\n<td>ä¸ºåŸŸåæ·»åŠ  HTTPS è¯ä¹¦</td>\n</tr>\n</tbody></table>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://michalzalecki.com/set-up-ipfs-node-on-the-server/\" target=\"_blank\" rel=\"noopener\">https://michalzalecki.com/set-up-ipfs-node-on-the-server/</a></li>\n<li><a href=\"https://github.com/ipfs/notes/issues/39\" target=\"_blank\" rel=\"noopener\">https://github.com/ipfs/notes/issues/39</a></li>\n<li><a href=\"https://www.cloudxns.net/Support/detail/id/304.html\" target=\"_blank\" rel=\"noopener\">https://www.cloudxns.net/Support/detail/id/304.html</a></li>\n<li><a href=\"https://ipfs.io/ipns/Qme48wyZ7LaF9gC5693DZyJBtehgaFhaKycESroemD5fNX/post/putting_this_blog_on_ipfs/\" target=\"_blank\" rel=\"noopener\">https://ipfs.io/ipns/Qme48wyZ7LaF9gC5693DZyJBtehgaFhaKycESroemD5fNX/post/putting_this_blog_on_ipfs/</a></li>\n</ol>"},{"title":"DHT ç½‘ç»œä¹‹ Kademlia ç®—æ³•","date":"2018-11-08T03:29:00.000Z","_content":"\næœ¬æ–‡æ˜¯è®ºæ–‡ [Kademlia: A Peer-to-Peer Information System Based on the XOR Metric](http://www.scs.stanford.edu/~dm/home/papers/kpos.pdf) çš„ç¿»è¯‘ã€‚\n<!-- more -->\n\n# Kademliaï¼šä¸€ç§åŸºäº XOR è·ç¦»çš„ P2P ä¿¡æ¯ç³»ç»Ÿ\n\nä½œè€…ï¼šPetar Maymounkov ä»¥åŠ David MazieÌ€res\n\n## Abstractï¼ˆæ‘˜è¦ï¼‰\n\næˆ‘ä»¬æè¿°äº†ä¸€ç§åœ¨å®¹æ˜“å‡ºé”™çš„ç¯å¢ƒä¸‹ä»å…·æœ‰å¯è¯æ˜çš„å®¹é”™æ€§å’Œæ€§èƒ½çš„ P2P åˆ†å¸ƒå¼æ•£åˆ—è¡¨ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿä½¿ç”¨äº†ä¸€ç§åŸºäº XOR è·ç¦»çš„æ–°å‹æ‹“æ‰‘æ¥è·¯ç”±æŸ¥è¯¢ä¸å®šä½èŠ‚ç‚¹çš„éœ€æ±‚ï¼Œè¯¥æ‹“æ‰‘ç®€åŒ–äº†ç®—æ³•åŠç®—æ³•çš„è¯æ˜ã€‚è¯¥æ‹“æ‰‘æœ‰è¿™æ ·ä¸€ä¸ªç‰¹ç‚¹ï¼šæ¯æ¬¡ä¿¡æ¯äº¤æ¢éƒ½ä¼ é€’æˆ–è€…åŠ å¼ºäº†ï¼ˆèŠ‚ç‚¹é—´ï¼‰æœ‰æ•ˆè”ç³»ã€‚ç³»ç»Ÿæ ¹æ®è¿™ç§è”ç³»æ¥å‘é€å¹¶è¡Œå¼‚æ­¥æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»è€Œåšåˆ°å®¹å¿èŠ‚ç‚¹æ•…éšœåŒæ—¶ä¸å¯¹ç”¨æˆ·é€ æˆè¶…æ—¶ã€‚\n\n## Introductionï¼ˆä»‹ç»ï¼‰\n\næœ¬è®ºæ–‡æè¿° Kademlia â€”â€” ä¸€ä¸ª P2P åˆ†å¸ƒå¼æ•£åˆ—è¡¨ï¼ˆDHTï¼‰ã€‚Kademlia æœ‰è®¸å¤šä¹‹å‰çš„ DHT æ— æ³•åŒæ—¶æä¾›çš„ç†æ€§åŠŸèƒ½ã€‚å®ƒæœ€å¤§é™åº¦åœ°å‡å°‘äº†èŠ‚ç‚¹å¿…é¡»å‘é€çš„ç”¨äºäº’ç›¸äº†è§£çš„é…ç½®æ¶ˆæ¯æ•°é‡ã€‚æŸ¥æ‰¾ Key æ—¶é™„å¸¦è‡ªåŠ¨ä¼ æ’­é…ç½®ä¿¡æ¯ã€‚èŠ‚ç‚¹å…·æœ‰è¶³å¤Ÿçš„è®¤çŸ¥ä¸çµæ´»æ€§æ¥é€šè¿‡ä½å»¶è¿Ÿè·¯å¾„è·¯ç”±æŸ¥è¯¢ã€‚Kademlia ä½¿ç”¨å¹¶è¡Œå¼‚æ­¥æŸ¥è¯¢æ¥é¿å…æ¥è‡ªå¤±è´¥èŠ‚ç‚¹çš„è¶…æ—¶å»¶è¿Ÿã€‚èŠ‚ç‚¹è®°å½•å…¶ä»–èŠ‚ç‚¹çš„å­˜åœ¨ä»¥é˜»æŒ¡æŸäº›åŸºæœ¬çš„æ‹’ç»æœåŠ¡æ”»å‡»ã€‚æœ€åï¼Œåªè¦å¯¹è¿è¡Œæ—¶é—´è¿›è¡Œç®€å•çš„å‡è®¾å°±å¯ä»¥å¯¹ Kademlia çš„å‡ ä¸ªé‡è¦ç‰¹æ€§è¿›è¡Œæ­£å¼è¯æ˜ã€‚\n\nKademlia é‡‡ç”¨äº†è®¸å¤š DHT ä½¿ç”¨çš„åŸºæœ¬æ–¹æ³•ã€‚å¯†é’¥ä½¿ç”¨ä¸é€æ˜çš„ 160 ä½ç©ºé—´ï¼Œæ¯”å¦‚ SHA-1 æ•£åˆ—ã€‚å‚ä¸çš„è®¡ç®—æœºåœ¨ 160 ä½å¯†é’¥ç©ºé—´ä¸­éƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹ IDã€‚**key-value é”®å€¼å¯¹å­˜å‚¨åœ¨é‚£äº› ID â€œæ¥è¿‘â€ key çš„èŠ‚ç‚¹ä¸Š**ã€‚æœ€ç»ˆï¼Œä¸€ä¸ªåŸºäºèŠ‚ç‚¹ ID çš„è·¯ç”±ç®—æ³•ä½¿å¾—ä»»ä½•èŠ‚ç‚¹å¯ä»¥é€šè¿‡ç»™å‡ºçš„ç›®æ ‡ key æœ‰æ•ˆåœ°å®šä½ key é™„è¿‘çš„èŠ‚ç‚¹ã€‚\n\nKademlia çš„ä¼—å¤šä¼˜ç‚¹å¾—ç›Šäºå®ƒåˆ›æ–°åœ°ä½¿ç”¨ XOR æ¥åº¦é‡èŠ‚ç‚¹é—´çš„è·ç¦»ã€‚XOR æ˜¯å¯¹ç§°çš„ï¼Œå…è®¸ Kademlia æ¥æ”¶æ¥è‡ªé‚£äº›æ‹¥æœ‰å®Œå…¨ç›¸åŒçš„è·¯ç”±è¡¨ä¿¡æ¯çš„èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚ã€‚åƒæ˜¯ Chord è¿™æ ·æ²¡æœ‰è¿™ç§ç‰¹æ€§çš„ç³»ç»Ÿå°±æ— æ³•ä»æŸ¥è¯¢è¯·æ±‚ä¸­è·å–æœ‰ç”¨çš„è·¯ç”±ä¿¡æ¯ã€‚ç”šè€…ï¼Œä¸å¯¹ç§°ä¼šå¯¼è‡´ä¸¥æ ¼çš„è·¯ç”±è¡¨ã€‚åœ¨ Chord ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¿…é¡»å­˜å‚¨ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ\n\nä¸ºäº†å®šä½æ¥è¿‘ç‰¹å®š ID çš„èŠ‚ç‚¹ï¼ŒKademlia è‡ªå§‹è‡³ç»ˆä»…ä½¿ç”¨ä¸€ä¸ªè·¯ç”±ç®—æ³•ã€‚ç›¸åï¼Œå…¶ä»–ç³»ç»Ÿä½¿ç”¨ä¸€ç§ç®—æ³•æ¥æ¥è¿‘ç›®æ ‡ IDï¼Œä½¿ç”¨å¦ä¸€ç§ç®—æ³•æ¥å®Œæˆæœ€åå‡ è·³ã€‚åœ¨ç°æœ‰çš„ç³»ç»Ÿä¸­ï¼ŒKademlia æœ€åƒ Pastry çš„ç¬¬ä¸€é˜¶æ®µï¼Œè™½ç„¶ä½œè€…æ²¡æœ‰ç”¨è¿™ç§æ–¹å¼æè¿°ï¼Œä½†æ˜¯é€šè¿‡ Kademlia çš„ XOR è·ç¦»å‘ç°ç›®æ ‡ ID çš„èŠ‚ç‚¹æ•°å¯ä»¥å‡å°‘ä¸€åŠã€‚åœ¨ Pastry çš„ç¬¬äºŒé˜¶æ®µï¼Œå®ƒå°†è·ç¦»åº¦é‡åˆ‡æ¢ä¸º ID é—´çš„æ•°å­—å·®å¼‚ã€‚å®ƒè¿˜åœ¨å¤åˆ¶ä¸­ä½¿ç”¨ç¬¬äºŒä¸ªæ•°å­—å·®å¼‚åº¦é‡ã€‚é—æ†¾çš„æ˜¯ï¼Œç¬¬äºŒä¸ªåº¦é‡æ ‡å‡†ä¸­ç›¸è·è¾ƒè¿‘çš„èŠ‚ç‚¹åœ¨ç¬¬ä¸€ä¸ªåº¦é‡æ ‡å‡†ä¸­åˆ™å¯èƒ½ç›¸å·®å¾ˆè¿œï¼Œä»¥è‡´åœ¨ç‰¹å®šèŠ‚ç‚¹ ID å€¼å¤„äº§ç”Ÿäº†ä¸è¿ç»­æ€§ï¼Œä»è€Œé™ä½äº†æ€§èƒ½ï¼Œå¹¶ä½¿å¾—å¯¹æœ€åæƒ…å†µè¡Œä¸ºçš„æ­£å¼åˆ†æå˜å¾—å¤æ‚ã€‚\n\n## System Descriptionï¼ˆç³»ç»Ÿæè¿°ï¼‰\n\nä¸å…¶ä»– DHT ç›¸åŒç±»ä¼¼ï¼ŒKademlia ç»™èŠ‚ç‚¹åˆ†é…ä¸€ä¸ª 160 ä½çš„é€æ˜ IDï¼Œå¹¶æä¾›ä¸€ä¸ªæŸ¥è¯¢ç®—æ³•ç”¨ä»¥å®šä½æ›´åŠ æ¥è¿‘æŒ‡å®šèŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œä»¥å¯¹æ•°çº§åˆ«æ”¶æ•›æŸ¥è¯¢åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚\n\nKademlia é«˜æ•ˆåœ°å°†èŠ‚ç‚¹ä½œä¸ºä¸€ä¸ªäºŒå‰æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ä½ç½®å–å†³äºå…¶ ID çš„æœ€çŸ­å”¯ä¸€å‰ç¼€ã€‚å›¾ä¸€å±•ç¤ºäº†å”¯ä¸€å‰ç¼€ä¸º 0011 çš„èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®ã€‚å¯¹äºä»»ä¸€ç»™å®šçš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°†äºŒå‰æ ‘åˆ†ä¸ºä¸€ç³»åˆ—è¿ç»­çš„ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„å­æ ‘ã€‚æœ€é«˜çš„å­æ ‘ç”±ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„æ•´ä¸ªäºŒå‰æ ‘çš„ä¸€åŠç»„æˆã€‚æ¥ä¸‹æ¥çš„å­æ ‘ç”±ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„å‰©ä½™äºŒå‰æ ‘çš„ä¸€èˆ¬ç»„æˆã€‚åœ¨å›¾ç¤ºä¸­ï¼ŒèŠ‚ç‚¹ 0011 çš„æ‰€æœ‰å­æ ‘è¢«åœˆå‡ºï¼ŒæŒ‰ç…§é«˜åº¦ç”±é«˜åˆ°ä½æ’åºï¼Œå‰ç¼€åˆ†åˆ«æ˜¯ 0, 01, 000 ä»¥åŠ 0010ã€‚\n\n![å›¾ä¸€ï¼šKademlia äºŒå‰æ ‘ã€‚é»‘è‰²çš„ç‚¹è¡¨ç¤ºèŠ‚ç‚¹ 0011Â·Â·Â· çš„ä½ç½®ï¼›ç°è‰²çš„åœˆè¡¨ç¤ºèŠ‚ç‚¹ 0011Â·Â·Â· å¿…é¡»ä¸ä¹‹å»ºç«‹è”ç³»çš„å­æ ‘ã€‚](kademlia-1.png)\n\nKademlia åè®®ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥æ™“å…¶æ¯ä¸ªå­æ ‘ä¸­çš„è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹ã€‚æœ‰äº†è¿™ä¸ªä¿è¯ï¼Œä»»ä¸€èŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡ ID å®šä½åˆ°å¦å¤–çš„èŠ‚ç‚¹ã€‚å›¾äºŒå±•ç¤ºäº†èŠ‚ç‚¹ 0011 é€šè¿‡ä¸æ–­åœ¨å­æ ‘ä¸­æŸ¥è¯¢æœ€ä½³å®ƒæ‰€çŸ¥æ™“çš„æœ€ä½³èŠ‚ç‚¹çš„æ–¹å¼æœ€ç»ˆæ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ 1110 çš„è¿‡ç¨‹ã€‚\n\n![å›¾äºŒï¼šé€šè¿‡ ID å®šä½èŠ‚ç‚¹ã€‚å‰ç¼€ä¸º 0011 çš„èŠ‚ç‚¹é€šè¿‡ä¾æ¬¡çŸ¥æ™“ä¸æŸ¥è¯¢è¶Šæ¥è¶Šè¿‘çš„èŠ‚ç‚¹ä»è€Œæ‰¾åˆ°å‰ç¼€ä¸º 1110 çš„èŠ‚ç‚¹ã€‚å›¾ä¸Šæ–¹çš„çº¿ä»£è¡¨äº† 160 æ¯”ç‰¹çš„ ID ç©ºé—´ï¼Œå¹¶ä¸”å±•ç¤ºäº†æŸ¥è¯¢åˆ°ç›®æ ‡èŠ‚ç‚¹çš„æ•´ä¸ªè¿‡ç¨‹ã€‚å›¾çš„ä¸»ä½“ç”»å‡ºäº†èŠ‚ç‚¹ 1110 å‘å‡ºçš„ RPC æ¶ˆæ¯ï¼Œç¬¬ä¸€ä¸ª RPC æ¶ˆæ¯å‘é€ç»™ 101ï¼Œåç»­çš„ RPC æ¶ˆæ¯å‘é€ç»™å‰ä¸€ä¸ª RPC æ¶ˆæ¯è¿”å›çš„èŠ‚ç‚¹ã€‚](kademlia-2.png)\n\næœ¬èŠ‚çš„å‰©ä½™éƒ¨åˆ†è¡¥å……äº†æŸ¥æ‰¾ç®—æ³•çš„å…·ä½“ç»†èŠ‚ã€‚æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªç²¾ç¡®çš„æ¦‚å¿µæ¥æè¿°èŠ‚ç‚¹é—´çš„è·ç¦»ï¼Œè®©æˆ‘ä»¬æŒ‡å‡ºè·ç¦»æŸä¸ª key æœ€è¿‘çš„ k ä¸ªèŠ‚ç‚¹æä¾›äº†å¯èƒ½ã€‚ç„¶åç»™å‡ºä¸€ä¸ªæŸ¥è¯¢åè®®ï¼Œå³ä½¿æ²¡æœ‰èŠ‚ç‚¹ä¸ç»™å®šçš„ key æ‹¥æœ‰ç›¸åŒçš„å”¯ä¸€å‰ç¼€æˆ–è€…ç»™å®šèŠ‚ç‚¹çš„ä¸€äº›å­æ ‘æ˜¯ç©ºçš„ï¼Œè¿™ä¸ªåè®®ä»ç„¶æ˜¯å¯å·¥ä½œçš„ã€‚\n\n### XOR Metricï¼ˆXOR åº¦é‡ï¼‰\n\næ¯ä¸ª Kademlia èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª 160 æ¯”ç‰¹çš„èŠ‚ç‚¹ IDã€‚èŠ‚ç‚¹ ID ç›®å‰åªæ˜¯éšæœºçš„ 160 ä½æ ‡è¯†ç¬¦ï¼Œå°½ç®¡å®ƒä»¬åŒæ ·å¯ä»¥åƒåœ¨ Chord ä¸­é‚£æ ·æ„é€ ã€‚èŠ‚ç‚¹å‘é€çš„æ¯æ¡æ¶ˆæ¯éƒ½åŒ…å«å…¶èŠ‚ç‚¹IDï¼Œå…è®¸æ¥æ”¶æ–¹åœ¨å¿…è¦æ—¶è®°å½•å‘é€æ–¹çš„å­˜åœ¨ã€‚\n\né”®åŒæ ·æ˜¯ 160 ä½æ ‡è¯†ç¬¦ã€‚ä¸ºäº†ç»™ç‰¹å®šçš„èŠ‚ç‚¹åˆ†é… key-value é”®å€¼å¯¹ï¼ŒKademlia ä¾èµ–ä¸¤ä¸ªæ ‡è¯†ç¬¦ä¹‹é—´çš„è·ç¦»çš„åº¦é‡ã€‚ç»™å‡ºä¸¤ä¸ª 160 ä½çš„æ ‡è¯†ç¬¦ $x$ å’Œ $y$ï¼ŒKademlia å°† $x$ ä¸ $y$ çš„è·ç¦»å®šä¹‰ä¸º $x$ ä¸ $y$ æŒ‰ä½å¼‚æˆ–åçš„æ•´æ•°å€¼ï¼Œå³ $d(x, y) = x \\oplus y$ã€‚\n\næˆ‘ä»¬é¦–å…ˆæ³¨æ„åˆ° XOR è¿ç®—æ˜¯æœ‰æ•ˆçš„ï¼Œå°½ç®¡å±äºéæ¬§å‡ é‡Œå¾·è·ç¦»ã€‚å¼‚æˆ–è¿ç®—æœ‰ä»¥ä¸‹æ€§è´¨ï¼š\n\n- $$d(x, x) = 0$$\n- $$d(x, y)>0, \\text{ if } x \\neq y$$\n- $$\\forall x, y:d(x, y)=d(y, x)$$\n- $$d(x,y)+d(y,z) \\geq d(x,z)$$\n- $$d(x,y) \\oplus d(y,z) = d(x,z)$$\n- $$\\forall a \\geq 0, b \\geq 0: a+b \\geq a \\oplus b$$\n\næ¥ä¸‹æ¥æˆ‘ä»¬æ³¨æ„åˆ°å¼‚æˆ–åº¦é‡åˆ»ç”»äº†åŸºäºäºŒå‰æ ‘çš„ç³»ç»Ÿè‰å›¾ä¸­éšå«çš„è·ç¦»æ¦‚å¿µã€‚åœ¨ 160 ä½ ID å®Œå…¨å¡«å……çš„äºŒå‰æ ‘ä¸­ï¼Œä¸¤ä¸ª ID é—´è·ç¦»å¤§å°æ˜¯åŒ…å«å®ƒä»¬çš„æœ€å°å­æ ‘çš„é«˜åº¦ã€‚å½“æ ‘æœªå®Œå…¨å¡«æ»¡æ—¶ï¼Œä¸ ID $x$ æœ€æ¥è¿‘çš„èŠ‚ç‚¹æ˜¯èŠ‚ç‚¹ ID ä¸ $x$ å…±äº«æœ€é•¿å…¬å…±å‰ç¼€çš„èŠ‚ç‚¹ã€‚å¦‚æœæ ‘ä¸­æœ‰ç©ºåˆ†æ”¯ï¼Œåˆ™å¯èƒ½æœ‰å¤šä¸ªå¶å­èŠ‚ç‚¹å…·æœ‰æœ€é•¿çš„å…¬å…±å‰ç¼€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ $x$ æœ€æ¥è¿‘çš„å¶å­å°†å˜ä¸ºç¦»é€šè¿‡ç¿»è½¬ $x$ ä¸­å¯¹åº”äºæ ‘çš„ç©ºåˆ†æ”¯ä¸­çš„ä½å¾—åˆ°çš„ $\\widetilde{x}$ æœ€è¿‘çš„å¶å­ã€‚\n\nç±»ä¼¼äº Chord ç®—æ³•çš„é¡ºæ—¶é’ˆåœ†å‘¨åº¦é‡ï¼ŒXOR ä¹Ÿæ˜¯å•å‘çš„ã€‚å¯¹äºä»»æ„ç»™å®šçš„ç‚¹ $x$ ä»¥åŠ $âˆ† > 0$ï¼Œä»…å­˜åœ¨ä¸€ä¸ªç‚¹ $y$ ä½¿å¾— $d(x, y) = âˆ†$ã€‚å•å‘æ€§ä¿è¯äº†å¯¹äºç›¸åŒçš„ keyï¼Œæ— è®ºä»å“ªä¸ªåŸç‚¹å¼€å§‹æŸ¥è¯¢ï¼Œéƒ½ä¼šæ²¿ç€ç›¸åŒçš„è·¯å¾„è¿›è¡Œæ”¶æ•›ã€‚è¿™æ ·ï¼Œæ²¿ç€æŸ¥è¯¢è·¯å¾„ç¼“å­˜ key-value é”®å€¼å¯¹å°±èƒ½å‡è½»å­˜æ”¾çƒ­é—¨ key å€¼èŠ‚ç‚¹çš„å‹åŠ›ã€‚ç±»ä¼¼äº Pastry è€Œä¸åŒäº Chordï¼Œ XOR æ‹“æ‰‘æ˜¯å¯¹ç§°çš„ã€‚\n\n### Node Stateï¼ˆèŠ‚ç‚¹çŠ¶æ€ï¼‰\n\nKademlia èŠ‚ç‚¹å­˜å‚¨äº†å…¶ä»–èŠ‚ç‚¹è”ç³»äººçš„ä¿¡æ¯ä»¥è·¯ç”±æŸ¥è¯¢æ¶ˆæ¯ã€‚å¯¹äºæ¯ä¸ª $0 \\leq i < 160$ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ„å»ºä¸€ä¸ªï¼ˆIP åœ°å€ï¼ŒUDP ç«¯å£ï¼ŒèŠ‚ç‚¹ IDï¼‰çš„ä¸‰å…ƒç»„åˆ—è¡¨ç”¨æ¥å­˜å‚¨ä¸è¯¥èŠ‚ç‚¹ç›¸è· $[2^i$, $2^{i+1})$ çš„èŠ‚ç‚¹ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸º $K$ æ¡¶ã€‚æ¯ä¸ª $K$ æ¡¶å†…èŠ‚ç‚¹æ ¹æ®èŠ‚ç‚¹æœ€åå¯è§æ—¶é—´è¿›è¡Œæ’åºï¼Œæœ€æ—©å¯è§çš„æ”¾ç½®åœ¨å¼€å¤´ï¼Œæœ€è¿‘å¯è§çš„æ”¾ç½®åœ¨æœ«å°¾ã€‚å¯¹äºè¾ƒå°çš„ $i$ å€¼ï¼Œ$K$ æ¡¶é€šå¸¸æ˜¯ç©ºçš„ï¼ˆå› ä¸ºä¸å­˜åœ¨åˆé€‚çš„èŠ‚ç‚¹ï¼‰ã€‚å¯¹äºè¾ƒå¤§çš„ $i$ å€¼ï¼Œåˆ—è¡¨æœ€å¤§å®¹é‡ä¸º $k$ï¼Œ$k$ æ˜¯ä¸€ä¸ªç³»ç»ŸèŒƒå›´å†…çš„å¤åˆ¶å‚æ•°ã€‚ä»…å½“ä»»æ„ç»™å®šçš„ $k$ ä¸ªèŠ‚ç‚¹ä¸ä¼šåœ¨ä¸€ä¸ªå°æ—¶å†…åŒæ—¶å¤±æ•ˆæ—¶ï¼Œ$k$ å€¼æ‰æœ‰æ•ˆï¼Œä¾‹å¦‚ $k = 20$ã€‚\n\nå½“ä¸€ä¸ª Kademlia èŠ‚ç‚¹æ”¶åˆ°ä»»ä¸€æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„è¯·æ±‚æˆ–è€…å›å¤æ¶ˆæ¯ï¼Œå®ƒä¼šæ ¹æ®å‘é€è€…çš„èŠ‚ç‚¹ ID æ›´æ–° $K$ æ¡¶ã€‚è§„åˆ™å¦‚ä¸‹ï¼š\n\n- å¦‚æœå‘é€èŠ‚ç‚¹å·²ç»å­˜åœ¨æ¥æ”¶æ–¹çš„ $K$ æ¡¶ä¸­ï¼š\n    - æ¥æ”¶æ–¹å°†å‘é€èŠ‚ç‚¹ç§»åŠ¨åˆ°ç›¸åº” $K$ æ¡¶çš„å°¾éƒ¨ï¼›\n- å¦‚æœå‘é€èŠ‚ç‚¹å¹¶æœªå­˜åœ¨æ¥æ”¶æ–¹çš„ $K$ æ¡¶ä¸­ï¼š\n    - å¦‚æœ $K$ æ¡¶ä¸­èŠ‚ç‚¹æ•°é‡å°‘äº $k$ ä¸ªï¼Œåˆ™ç›´æ¥å°†å‘é€èŠ‚ç‚¹æ’å…¥è‡³ $K$ æ¡¶å°¾éƒ¨ï¼›\n    - å¦‚æœ $K$ æ¡¶å·²æ»¡ï¼š\n        - å¦‚æœæœ€æ—©å¯è§çš„èŠ‚ç‚¹ä¸èƒ½ ping é€šï¼Œåˆ™ç§»é™¤è¯¥èŠ‚ç‚¹ï¼Œç„¶åå°†å‘é€èŠ‚ç‚¹æ’å…¥è‡³ $K$ æ¡¶å°¾éƒ¨ï¼›\n        - å¦‚æœæœ€æ—©å¯è§çš„èŠ‚ç‚¹å¯ä»¥ ping é€šï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°å°¾éƒ¨ï¼Œç„¶åä¸¢å¼ƒå‘é€èŠ‚ç‚¹ï¼›\n\n$K$ æ¡¶é«˜æ•ˆåœ°å®ç°äº† LRU ç®—æ³•ï¼Œåªæ˜¯æ´»åŠ¨çš„èŠ‚ç‚¹æ°¸è¿œä¸ä¼šä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚è¿™ç§å¯¹ä¸æ—§è”ç³»äººçš„åå¥½æ¥è‡ªäºæˆ‘ä»¬çš„å¯¹äº Saroiu ç­‰äººä» Gnutella ç½‘ç»œæ”¶é›†çš„è¿½è¸ªæ•°æ®çš„åˆ†æã€‚å›¾ 3 å±•ç¤ºäº† Gnutella èŠ‚ç‚¹éšç€å½“å‰æ—¶é—´çš„æ¨ç§»ï¼Œé¢å¤–åœ¨çº¿ä¸€ä¸ªå°æ—¶çš„å¯èƒ½æ€§ã€‚ä¸€ä¸ªèŠ‚ç‚¹åœ¨çº¿æ—¶é—´è¶Šé•¿ï¼Œå®ƒå°±è¶Šå¯èƒ½ç»§ç»­é¢å¤–åœ¨çº¿ä¸€ä¸ªå°æ—¶ã€‚é€šè¿‡ä¿æŒæœ€è€çš„åœ¨çº¿èŠ‚ç‚¹ï¼Œ$K$ æ¡¶æœ€å¤§åŒ–äº†åˆ—è¡¨ä¸­èŠ‚ç‚¹åœ¨çº¿çš„å¯èƒ½æ€§ã€‚\n\n![å›¾ä¸‰ï¼šé¢å¤–ä¿æŒä¸€å°æ—¶åœ¨çº¿çš„å¯èƒ½æ€§å…³äºæ—¶é—´çš„å‡½æ•°ã€‚X è½´ä»£è¡¨åˆ†é’Ÿï¼ŒY è½´è¡¨ç¤ºä¿æŒåœ¨çº¿ $x$ åˆ†é’Ÿçš„èŠ‚ç‚¹ç»§ç»­ä¿æŒåœ¨çº¿åˆ° $x + 60$ åˆ†é’Ÿæ—¶åˆ»çš„å¯èƒ½æ€§](kademlia-3.png)\n\n$K$ æ¡¶é‡‡ç”¨è¿™æ ·çš„æ›´æ–°ç­–ç•¥çš„å¦ä¸€ä¸ªä¼˜ç‚¹åœ¨äºå¯ä»¥æŠµæŒ¡ç‰¹å®šçš„ DoS æ”»å‡»ã€‚æ”»å‡»è€…ä¸èƒ½ä½¿ç”¨æ–°çš„èŠ‚ç‚¹æ³›æ´ªç³»ç»Ÿæ¥åˆ·æ–°èŠ‚ç‚¹çš„è·¯ç”±çŠ¶æ€ã€‚åªæœ‰å½“æ—§çš„èŠ‚ç‚¹ç¦»å¼€äº†ç³»ç»Ÿï¼ŒKademlia æ‰ä¼šæ’å…¥æ–°çš„èŠ‚ç‚¹ã€‚\n\n### Kademlia protocolï¼ˆKademlia åè®®ï¼‰\n\nKademlia åè®®ç”±å››ä¸ª RPC è°ƒç”¨ç»„æˆï¼š*PING*, *STORE*, *FIND_NODE*, *FIND_VALUE*ã€‚\n\n- *PING* ç”¨äºæ¢æµ‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦åœ¨çº¿ã€‚\n- *STORE* ç”¨äºé€šçŸ¥ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€ä¸ª key-value å¯¹ä»¥ä¾¿ä¹‹åè·å–ã€‚\n- *FIND_NODE* ä½¿ç”¨ä¸€ä¸ª 160 æ¯”ç‰¹çš„ ID ä½œä¸ºå‚æ•°ã€‚è°ƒç”¨å¯¹è±¡è¿”å›ä¸€ä¸ªå…¶çŸ¥æ™“çš„è·ç¦»ç›®æ ‡ ID æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ä¿¡æ¯ <IP åœ°å€ï¼ŒUDP ç«¯å£ï¼ŒèŠ‚ç‚¹ ID> ä¸‰å…ƒç»„ã€‚è¿™ $k$ ä¸ªä¸‰å…ƒç»„å¯èƒ½æ¥è‡ªå•ä¸ª $K$ æ¡¶ï¼Œä¹Ÿå¯èƒ½å› ä¸ºè·ç¦»æœ€è¿‘çš„ $K$ æ¡¶æœªæ»¡è€Œå–è‡ªå¤šä¸ª $K$ æ¡¶ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼ŒRPC è°ƒç”¨æ¥æ”¶è€…å¿…é¡»è¿”å› $k$ ä¸ªèŠ‚ç‚¹ï¼Œé™¤éè¯¥èŠ‚ç‚¹çŸ¥æ™“èŠ‚ç‚¹æ€»æ•°å°äº $k$ ä¸ªã€‚\n- *FIND_VALUE* è°ƒç”¨å’Œ *FIND_NODE* ä¸€æ ·ï¼Œä¸è¿‡å½“è°ƒç”¨çš„æ¥æ”¶è€…å­˜æœ‰è¯·æ±‚è€…æ‰€è¯·æ±‚çš„é”®çš„æ—¶å€™ï¼Œå®ƒå°†è¿”å›ç›¸åº”é”®çš„å€¼ã€‚\n\nåœ¨æ‰€æœ‰çš„ RPC ä¸­ï¼Œæ¥æ”¶è€…å¿…é¡»è¿”å›ä¸€ä¸ª 160 æ¯”ç‰¹çš„éšæœº RPC IDï¼Œä»¥é˜²æ­¢åœ°å€ä¼ªé€ ï¼ˆï¼Ÿï¼‰ã€‚å¯ä»¥å°† PING æ¶ˆæ¯é™„åŠ åœ¨ RPC æ¶ˆæ¯çš„å›å¤ä¸­ä»¥ç¡®å®šå‘é€è€…çš„ç½‘ç»œåœ°å€ã€‚\n\n#### ä¸´è¿‘ ID èŠ‚ç‚¹æŸ¥æ‰¾\n\nKademlia èŠ‚ç‚¹éœ€è¦å®ç°çš„æœ€é‡è¦çš„è¿‡ç¨‹å°±æ˜¯æ ¹æ®ä¸€ä¸ªèŠ‚ç‚¹ ID æ‰¾åˆ°ä¸å®ƒæœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªè¿‡ç¨‹ä¸º *èŠ‚ç‚¹æŸ¥æ‰¾*ï¼ŒKademlia ä½¿ç”¨é€’å½’å®Œæˆè¿™ä¸ªå·¥ä½œã€‚ç”±æŸ¥æ‰¾éœ€æ±‚çš„èµ·å§‹èŠ‚ç‚¹å…ˆä»ç¦»ç›®æ ‡èŠ‚ç‚¹ ID æœ€è¿‘çš„éç©º $K$ æ¡¶ä¸­å–å‡º $Î±$ ä¸ªèŠ‚ç‚¹ï¼ˆå¦‚æœ $K$ æ¡¶ä¸­èŠ‚ç‚¹ä¸è¶³ $Î±$ ä¸ªï¼Œåˆ™ä»å…¶ä»– $K$ æ¡¶ä¸­å–æ»¡ $Î±$ ä¸ªï¼‰ã€‚èµ·å§‹æ¥åœ°å¹¶è¡Œå‘è¿™ $Î±$ ä¸ªèŠ‚ç‚¹å‘é€ *FIND_NODE* RPC è°ƒç”¨ã€‚$Î±$ æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§å‚æ•°ï¼Œä¾‹å¦‚ 3ã€‚\n\nåœ¨é€’å½’è°ƒç”¨é˜¶æ®µï¼Œåˆå§‹èŠ‚ç‚¹æ ¹æ® $Î±$ ä¸ªèŠ‚ç‚¹è¿”å›çš„èŠ‚ç‚¹åˆ—è¡¨å†æ¬¡å‘é€ *FIND_NODE* è¯·æ±‚ï¼ˆé€’å½’è°ƒç”¨åœ¨æ‰€æœ‰ $Î±$ ä¸ªèŠ‚ç‚¹å®Œæˆè¿”å›å‰å°±å¯ä»¥å¼€å§‹ï¼‰ã€‚èµ·å§‹èŠ‚ç‚¹ä»å…¶ä»–èŠ‚ç‚¹è¿”å›çš„å¤§å°ä¸º $k$ çš„èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰å‡º $Î±$ ä¸ªä¹‹å‰æ²¡æœ‰æŸ¥è¯¢è¿‡çš„èŠ‚ç‚¹ï¼Œå‘å®ƒä»¬å‘é€ *FIND_NODE* RPC è°ƒç”¨ã€‚å¤±è´¥çš„èŠ‚ç‚¹å°†ä¸å†ä¼šçº³å…¥è€ƒè™‘èŒƒå›´ã€‚å¦‚æœæœ‰ä¸€è½® *FIND_NODE* è°ƒç”¨ä¸­è¿”å›çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸æ¯”ä¹‹å‰çŸ¥æ™“çš„ $k$ ä¸ªèŠ‚ç‚¹æ›´åŠ æ¥è¿‘ï¼Œåˆ™å½“åˆå§‹èŠ‚ç‚¹å®Œæˆå¯¹æœ€è¿‘çš„è¿™ä¸ª $k$ ä¸ªèŠ‚ç‚¹çš„æŸ¥è¯¢å¹¶å¾—åˆ°å“åº”ä¹‹åï¼ŒæŸ¥è¯¢ç»“æŸã€‚å½“ $a=1$ï¼ŒæŸ¥è¯¢ç®—æ³•åœ¨ä¿¡æ¯å¼€é”€å’Œæ•…éšœèŠ‚ç‚¹çš„æ£€æŸ¥å»¶è¿Ÿä¸Šä¸ Chord ç±»ä¼¼ã€‚ä½†æ˜¯ Kademlia å¯ä»¥çµæ´»åœ°ä» $k$ ä¸ªèŠ‚ç‚¹ä¸­é€‰æ‹©ä»»ä¸€ä¸€ä¸ªå‘é€è¯·æ±‚ä»¥é™ä½æŸ¥è¯¢å»¶è¿Ÿã€‚\n\n#### å­˜å‚¨é”®å€¼å¯¹ä¸é‡æ–°å‘å¸ƒæ—¶é—´\n\nä¸Šè¿°æŸ¥è¯¢è¿‡ç¨‹å®ç°äº†å¤§éƒ¨åˆ†çš„æ“ä½œã€‚ä¸ºäº†å­˜å‚¨ä¸€ä¸ª key-value å¯¹ï¼Œèµ·å§‹èŠ‚ç‚¹é€šè¿‡ä¸Šè¿°æ“ä½œå®šä½åˆ° $k$ ä¸ªç¦» key æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œå¹¶å‘å®ƒä»¬å‘é€ *STORE* è°ƒç”¨ã€‚å¦å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šåœ¨éœ€è¦çš„æƒ…å†µä¸‹é‡æ–°å‘å¸ƒ key-value ä»¥ä½¿ key-value æŒç»­å­˜åœ¨ã€‚åœ¨ Kademlia å½“å‰çš„åº”ç”¨ä¸­ï¼ˆæ–‡ä»¶åˆ†äº«ï¼‰ï¼Œkey-value çš„åŸå§‹å‘å¸ƒè€…éœ€è¦æ¯ä¸ª 24 å°æ—¶é‡æ–°è¿›è¡Œå‘é€ã€‚å¦åˆ™ï¼Œkey-value å°†åœ¨å‘å¸ƒ 24 å°æ—¶åå¤±æ•ˆï¼Œä»¥é™åˆ¶ç³»ç»Ÿä¸­ä¸å¯ç”¨çš„ç´¢å¼•ä¿¡æ¯ã€‚å¯¹äºå…¶ä»–çš„åº”ç”¨ï¼Œæ¯”å¦‚æ•°å­—è¯ä¹¦æˆ–è€…ç”¨äºå€¼æ˜ å°„çš„åŠ å¯†å“ˆå¸Œï¼Œæ›´é•¿çš„è¿‡æœŸæ—¶é—´ä¹Ÿè®¸ä¼šæ›´åˆé€‚ã€‚\n\n#### æŸ¥è¯¢é”®å€¼å¯¹ä¸è¿‡æœŸæ—¶é—´\n\nä¸ºäº†æ‰¾åˆ°ä¸€ä¸ª key-value å¯¹ï¼ŒèŠ‚ç‚¹å‘èµ·ä¸€ä¸ªèŠ‚ç‚¹æŸ¥æ‰¾ä»¥æ‰¾åˆ° ID ä¸ key æœ€æ¥è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚å€¼æŸ¥è¯¢ä½¿ç”¨çš„æ˜¯ *FIND_VALUE* è°ƒç”¨è€Œä¸æ˜¯ *FIND_NODE* è°ƒç”¨ã€‚è€Œä¸”ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹è¿”å›äº†å€¼ï¼Œåˆ™è¿™ä¸ªè¿‡ç¨‹ç«‹å³ç»“æŸã€‚å‡ºäºç¼“å­˜çš„ç›®çš„ï¼Œä¸€æ—¦æŸ¥æ‰¾æˆåŠŸï¼Œå‘èµ·èŠ‚ç‚¹å°†ä¼šå°† key-value å­˜å‚¨è‡³å…¶çŸ¥æ™“çš„ç›¸å¯¹ key æœ€è¿‘çš„ï¼Œä½†æ˜¯åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰è¿”å›å€¼çš„èŠ‚ç‚¹ã€‚\n\nç”±äºæ‹“æ‰‘æ˜¯å•å‘çš„ï¼Œéšåå¯¹äºç›¸åŒ key çš„æŸ¥æ‰¾å¾ˆå¯èƒ½åœ¨æŸ¥è¯¢åˆ°æœ€è¿‘çš„èŠ‚ç‚¹ä¹‹å‰å°±å‘½ä¸­å­˜å‚¨åœ¨éæœ€è¿‘èŠ‚ç‚¹ä¸­ç¼“å­˜ã€‚åœ¨æŸä¸ª key æ´»è·ƒåº¦éå¸¸é«˜çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¯èƒ½ä¼šå°†å…¶å­˜å‚¨åœ¨å¾ˆå¤šèŠ‚ç‚¹ã€‚ä¸ºäº†é¿å…è¿™ç§è¿‡åº¦å­˜å‚¨ï¼Œæˆ‘ä»¬ä¸º key-value è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´ä¸èŠ‚ç‚¹ ID ç›¸å¯¹äº key çš„è·ç¦»æˆæŒ‡æ•°åæ¯”ã€‚è™½ç„¶ç®€å•çš„ LRU ç­–ç•¥ä¼šäº§ç”Ÿç±»ä¼¼çš„ç”Ÿå‘½å‘¨æœŸåˆ†å¸ƒï¼Œä½†æ˜¯æ²¡æœ‰åˆé€‚çš„æ–¹æ³•å»é€‰æ‹©cacheçš„å¤§å°ï¼Œå› ä¸ºèŠ‚ç‚¹å¯¹äºç³»ç»Ÿå°†è¦å‚¨å­˜å¤šå°‘å€¼æ²¡æœ‰å…ˆéªŒçŸ¥è¯†ã€‚\n\n#### $K$ æ¡¶æ›´æ–°ä¸åŠ å…¥ç½‘ç»œ\n\n$K$ æ¡¶ä¼šæ ¹æ®ç»è¿‡èŠ‚ç‚¹çš„è¯·æ±‚è€Œä¿æŒæ›´æ–°ã€‚ä¸ºäº†è§£å†³å› ä¸ºæŸä¸ªç‰¹æ®Šçš„ ID æ®µé•¿æ—¶é—´æ²¡æœ‰æŸ¥è¯¢çš„ç‰¹æ®Šæƒ…å†µï¼ŒèŠ‚ç‚¹ä¼šåˆ·æ–°é‚£äº›åœ¨è¿‡å»ä¸€å°æ—¶å†…æ²¡æœ‰è¿‡æŸ¥è¯¢è¯·æ±‚çš„ $K$ æ¡¶ã€‚åˆ·æ–°å°±æ˜¯éšæœºé€‰å–ä¸€ä¸ªå¤„åœ¨å½“å‰ $K$ æ¡¶èŒƒå›´çš„ IDï¼Œç„¶åå¯¹å…¶è¿›è¡ŒèŠ‚ç‚¹æŸ¥è¯¢ã€‚\n\nä¸ºäº†åŠ å…¥ç½‘ç»œï¼Œä¸€ä¸ªèŠ‚ç‚¹ $u$ å¿…é¡»è¦ä¸ä¸€ä¸ªå·²å­˜åœ¨åœ¨ç½‘ç»œä¸­çš„èŠ‚ç‚¹ w æœ‰è”ç³»ã€‚$u$ å°† w æ’å…¥åˆ°åˆé€‚çš„ $K$ æ¡¶ä¸­ï¼Œéšå $u$ å¯¹è‡ªå·±çš„ nodeID è¿›è¡Œä¸€æ¬¡èŠ‚ç‚¹æŸ¥è¯¢ï¼Œæœ€åï¼Œ$u$ ä¼šè”ç³»åˆ°ç¦»å®ƒé‚»å±…æ›´è¿œçš„èŠ‚ç‚¹ï¼Œç„¶åæ›´æ–°ç›¸åº”çš„ $K$ æ¡¶ã€‚åœ¨åˆ·æ–°è¿‡ç¨‹ä¸­ï¼Œ$u$ å¡«å……äº†è‡ªå·±çš„ $K$ æ¡¶åŒæ—¶ä¹Ÿå°†è‡ªå·±æ’å…¥åˆ°å…¶ä»–èŠ‚ç‚¹çš„ $K$ æ¡¶ä¸­ã€‚\n\n### Routing Tableï¼ˆè·¯ç”±è¡¨ï¼‰\n\nKademlia çš„åŸºç¡€è·¯ç”±è¡¨ç»“æ„éå¸¸ç›´è§‚ï¼Œä½†æ˜¯éœ€è¦å¯¹é«˜åº¦ä¸å¹³è¡¡çš„æ ‘è¿›è¡Œä¸€äº›ç»†èŠ‚å¤„ç†ã€‚è·¯ç”±è¡¨æ˜¯ä¸€æ£µå¶å­èŠ‚ç‚¹ä¸º $K$ æ¡¶çš„äºŒå‰æ ‘ã€‚æ¯ä¸ª $K$ æ¡¶åŒ…å«äº†ä¸€äº›å…·æœ‰å…¬å…±å‰ç¼€çš„ IDã€‚$K$ æ¡¶å…¬å…±å‰ç¼€å°±æ˜¯å…¶åœ¨äºŒå‰æ ‘ä¸­æ‰€å¤„çš„ä½ç½®ã€‚å¯è§ï¼Œæ¯ä¸ª $K$ æ¡¶è¦†ç›–äº†ä¸€éƒ¨åˆ† ID ç©ºé—´ï¼Œæ‰€æœ‰çš„ $K$ æ¡¶é›†åˆæ— é‡å åœ°è¦†ç›–äº†æ•´ä¸ª 160 æ¯”ç‰¹ ID ç©ºé—´ã€‚\n\nè·¯ç”±äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹æ˜¯æŒ‰éœ€åŠ¨æ€åˆ†é…çš„ã€‚å›¾ 4 è¡¨ç¤ºäº†è¿™ä¸€ä¸ªè¿‡ç¨‹ã€‚åˆå§‹çŠ¶æ€ä¸‹ï¼ŒèŠ‚ç‚¹ $u$ çš„è·¯ç”±æ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ª $K$ æ¡¶è¦†ç›–äº†æ•´ä¸ª ID ç©ºé—´ã€‚å½“ $u$ å¾—åˆ°äº†ä¸€ä¸ªæ–°çš„è”ç³»äººæ—¶ï¼Œå®ƒå°†æ ¹æ®ä¸æ–°çš„è”ç³»äººçš„è·ç¦»ï¼Œå°è¯•å°†å…¶æ’å…¥åˆ°åˆé€‚çš„ $K$ æ¡¶ä¸­ã€‚æ’å…¥çš„è§„åˆ™å¦‚ä¸‹ï¼š\n\n- å¦‚æœ $K$ æ¡¶æœªæ»¡ï¼Œæ–°çš„è”ç³»äººå°±ä¼šè¢«ç›´æ¥æ’å…¥ï¼›\n- å¦‚æœ $K$ æ¡¶æ»¡äº†ï¼š\n    - å¦‚æœ $K$ æ¡¶çš„èŒƒå›´åŒ…æ‹¬äº† $u$ è‡ªèº«çš„ IDï¼Œåˆ™ $K$ æ¡¶å°†ä¼šä¸€åˆ†ä¸ºäºŒï¼ŒåŸ $K$ æ¡¶ä¸­çš„ ID é‡æ–°åˆ†é…åˆ°æ–°çš„ $K$ æ¡¶ä¸­ï¼Œç„¶åå†å°è¯•æ’å…¥ï¼›\n    - å¦‚æœ $K$ æ¡¶çš„èŒƒå›´ä¸åŒ…æ‹¬ $u$ è‡ªèº«çš„ IDï¼Œæ–°çš„è”ç³»äººå°†ç›´æ¥è¢«ä¸¢å¼ƒï¼›ï¼ˆ3ï¼‰\n\nåœ¨è¿™æ ·é«˜åº¦ä¸å¹³è¡¡çš„äºŒå‰æ ‘ä¸­ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¯¼è‡´è¿™ç§æƒ…å†µä¸‹å¹¶ä¸ä¼šæŒ‰ç…§è§„åˆ™ 3 è¿›è¡Œæ’å…¥ã€‚å‡è®¾ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œ$u$ æ˜¯**å”¯ä¸€**ä¸€ä¸ª ID ä»¥ 000 å¼€å¤´çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶æœ‰è¶…è¿‡ $k$ ä¸ª ID ä»¥ 001 å¼€å¤´çš„èŠ‚ç‚¹ $v\\_1,v\\_2...v\\_k...v\\_n$ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ $v$ çš„è·¯ç”±æ ‘ï¼Œ$u$ éƒ½å°†ä¼šè¢«æ’å…¥åˆ°ä¸€ä¸ªç©º $K$ æ¡¶ä¸­ã€‚ä½†æ˜¯ç”±äºæŒ‰ç…§è§„åˆ™ 3ï¼Œ $u$ çš„æ¡¶æ›´æ–°åªä¼šé€šçŸ¥åˆ° $u$ çš„è·¯ç”±æ ‘æ‰€è®°å½•çš„æ‰€æœ‰ $v$ ä¸­çš„ $k$ ä¸ªã€‚ä¸ºäº†é¿å…å‰©ä½™çš„ $v$ æ— æ³•å¾—åˆ° $u$ çš„æ¡¶æ›´æ–°ä¿¡æ¯ï¼ŒKademlia èŠ‚ç‚¹é€šè¿‡æ‹†åˆ†ä»¥ä¿å­˜äº†è¶…è¿‡ $k$ ä¸ªçš„æ‰€æœ‰æœ‰æ•ˆçš„èŠ‚ç‚¹ï¼Œå³ä½¿ä¸æ˜¯å› ä¸º $K$ æ¡¶ä¸­åŒ…æ‹¬äº†è‡ªèº«çš„ IDã€‚å›¾ 5 å±•ç¤ºäº†è¿™ç§é¢å¤–çš„æ‹†åˆ†ã€‚å½“ $u$ åˆ·æ–°äº†æ¡¶ï¼Œæ‰€æœ‰å‰ç¼€ä¸º 001 çš„èŠ‚ç‚¹éƒ½ä¼šçŸ¥æ™“ã€‚\n\n![å›¾å››ï¼šè·¯ç”±è¡¨éšæ—¶é—´çš„æ¼”å˜ã€‚ä¸€å¼€å§‹ï¼ŒèŠ‚ç‚¹åªæœ‰ä¸€ä¸ª $K$ æ¡¶ã€‚éšç€ $K$ æ¡¶è¢«å¡«å……ï¼ŒåŒ…å«èŠ‚ç‚¹ ID çš„æ¡¶è¢«ä¸æ–­ä¸€åˆ†ä¸ºäºŒã€‚](kademlia-4.png)\n\n![å›¾äº”ï¼šä¸€ä¸ª ID ä¸º $00...00$ çš„èŠ‚ç‚¹çš„å®½æ¾è·¯ç”±è¡¨ã€‚ä¸ºäº†ç¡®ä¿å…¶çŸ¥æ™“å®ƒå‘¨å›´æœ€å°å­æ ‘ï¼ˆè‡³å°‘ $k$ ä¸ªèŠ‚ç‚¹ï¼‰çš„æ‰€æœ‰è”ç³»äººï¼Œè¿™ä¸ªè·¯ç”±è¡¨è¿›è¡Œäº†é¢å¤–çš„æ‹†åˆ†ã€‚](kademlia-5.png)\n\n### Efficient Key Re-publishingï¼ˆKey çš„é«˜æ•ˆé‡å‘å¸ƒï¼‰\n\nä¸ºäº†ä¿è¯ key-value å¯¹çš„æŒä¹…å­˜åœ¨ï¼ŒèŠ‚ç‚¹å¿…é¡»å‘¨æœŸæ€§é‡å‘å¸ƒ keyã€‚å¦åˆ™ï¼Œä¸¤ç§æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´å¯¹æœ‰æ•ˆ key çš„æŸ¥è¯¢å¤±è´¥ã€‚\n\n- ä¸€äº›è·å¾— key-value å¯¹çš„èŠ‚ç‚¹ç¦»å¼€äº†ç½‘ç»œ\n- æ–°çš„ç›¸æ¯”åŸå§‹è¢«å‘å¸ƒè¿‡ key-value å¯¹çš„èŠ‚ç‚¹ ID æ›´è¿‘çš„èŠ‚ç‚¹åŠ å…¥äº†ç½‘ç»œ\n\nåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ‹¥æœ‰è¿™ä¸ª key-value å¯¹çš„èŠ‚ç‚¹éœ€è¦å°†å…¶é‡æ–°å‘å¸ƒåˆ°ç¦» key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚\n\nä¸ºäº†å¼¥è¡¥èŠ‚ç‚¹ç¦»å¼€ç½‘ç»œçš„æƒ…å†µï¼ŒèŠ‚ç‚¹æ¯éš”ä¸€ä¸ªå°æ—¶é‡æ–°å‘å¸ƒ key-value å¯¹ï¼Œä¸€ä¸ªç›´æ¥çš„å®ç°å°±æ˜¯å°†ä¼šäº§ç”Ÿå¾ˆå¤šæ¶ˆæ¯â€”â€”æ¯ä¸ªå­˜å‚¨è¿™ä¸ª key-value å¯¹çš„èŠ‚ç‚¹ï¼ˆè‡³å¤š $k$ ä¸ªï¼‰é—´éš”ä¸€å°æ—¶ä¼šå‘èµ·ä¸€æ¬¡æŸ¥è¯¢ï¼Œç„¶åå‘å…¶ä»– $k-1$ ä¸ªèŠ‚ç‚¹å‘èµ· *STORE* è¯·æ±‚ã€‚è¿™ä¸ªé‡æ–°å‘å¸ƒæ“ä½œå¯ä»¥å¤§å¤§ç®€åŒ–ã€‚é¦–å…ˆï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°å¯¹æŸä¸ª key-value å¯¹çš„ *STORE* è°ƒç”¨ï¼Œå®ƒå‡è®¾è¿™ä¸ª RPC è°ƒç”¨åŒæ ·è¢«å‘é€ç»™äº†å¦å¤– $k-1$ ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹åœ¨ä¸‹ä¸€ä¸ªå°æ—¶ä¸ä¼šå†é‡æ–°å‘å¸ƒæ­¤ key-value å¯¹ã€‚è¿™ä¿è¯äº†çŸ¥é“å¤åˆ¶é—´éš”ä¸æ˜¯å®Œå…¨åŒæ­¥çš„ï¼Œæ¯éš”å°æ—¶å†…åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¼šé‡æ–°å‘å¸ƒ key-value å¯¹ã€‚\n\nç¬¬äºŒä¸ªä¼˜åŒ–åœ¨äºåœ¨é‡æ–°å‘å¸ƒ key ä¹‹å‰é¿å…è¿›è¡ŒèŠ‚ç‚¹æŸ¥è¯¢ã€‚åƒä¸Šä¸€èŠ‚æ‰€è¯´çš„ï¼Œä¸ºäº†å¤„ç†ä¸å¹³è¡¡æ ‘ï¼Œåœ¨å¿…è¦çš„æ—¶å€™èŠ‚ç‚¹å°†ä¼šæ‹†åˆ† $K$ æ¡¶æ¥ç¡®ä¿å®ƒå¯¹è‡³å°‘ $k$ ä¸ªèŠ‚ç‚¹çš„å‘¨å›´å­æ ‘å……åˆ†äº†è§£ã€‚å¦‚æœèŠ‚ç‚¹åœ¨é‡æ–°å‘å¸ƒ key-value ä¹‹å‰æ›´æ–°äº†è¯¥ $k$ èŠ‚ç‚¹å­æ ‘çš„æ‰€æœ‰ $K$ æ¡¶ï¼Œå®ƒå°†è‡ªåŠ¨è·çŸ¥è·ç¦»ç»™å®š key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚å¯¹äºè¿™äº› $K$ æ¡¶çš„æ›´æ–°ä»£ä»·å¯ä»¥åˆ†æ‘Šç»™è®¸å¤š key çš„é‡æ–°å‘å¸ƒï¼ˆå¹³å‡è€Œè¨€ï¼Œè¿™æ ·å°±é™ä½äº†å•ä¸ª key é‡æ–°å‘å¸ƒæ—¶çš„ä»£ä»·ï¼‰ã€‚\n\nè¦ææ¸…æ¥šä¸ºä»€ä¹ˆåœ¨ $u$ æ›´æ–°è§„æ¨¡å¤§äºç­‰äº $k$ çš„å­æ ‘çš„æ‰€æœ‰ $K$ æ¡¶åä¸å†éœ€è¦èŠ‚ç‚¹æŸ¥è¯¢äº†ï¼Œéœ€è¦åˆ†ä¸ºä¸¤ç§æƒ…å†µã€‚å¦‚æœè¦è¢«å……å‘å¸ƒçš„ key åœ¨è¯¥å­æ ‘çš„ ID èŒƒå›´å†…ï¼Œé‚£ä¹ˆå› ä¸ºå­æ ‘çš„è§„æ¨¡è‡³å°‘ä¸º $k$ è€Œä¸” $u$ å…·æœ‰è¯¥å­æ ‘çš„å…¨éƒ¨çŸ¥è¯†ï¼Œæ˜¾ç„¶ $u$ è‚¯å®šçŸ¥é“è·ç¦» key çš„æœ€è¿‘ $k$ ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœè¦è¢«å……å‘å¸ƒçš„ key åœ¨è¯¥å­æ ‘çš„ ID èŒƒå›´å¤–ï¼Œå› ä¸º $u$ æ˜¯ $k$ ä¸ªè·ç¦» key æœ€è¿‘çš„èŠ‚ç‚¹ä¹‹ä¸€ï¼ˆå¦åˆ™ $u$ ä¸ä¼šå­˜å‚¨å…³äºè¯¥ key çš„ä¿¡æ¯ï¼‰ï¼Œæ˜¾ç„¶æ‰€æœ‰è·ç¦»è¯¥ key æ¯”è·ç¦»å­æ ‘æ›´è¿‘ä¸€äº›çš„ $K$ æ¡¶ä¸­çš„å…ƒç´ éƒ½å°‘äº $k$ã€‚å› æ­¤ï¼Œ$u$ å°†ä¼šçŸ¥æ™“æ‰€æœ‰è¿™äº› $K$ æ¡¶ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå†åŠ ä¸Šå…³äºå­æ ‘çš„çŸ¥è¯†ï¼Œå°±å¯ä»¥å¾—åˆ°è·ç¦»è¯¥ key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚\n\nå½“ä¸€ä¸ªæ–°èŠ‚ç‚¹åŠ å…¥ç½‘ç»œï¼Œå¯¹äºæ¯ä¸ª key-vaule å¯¹æ¥è¯´ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸ºå…¶ $k$ ä¸ªæœ€è¿‘èŠ‚ç‚¹ä¹‹ä¸€ï¼Œé‚£ä¹ˆå¿…é¡»å¯¹å…¶è¿›è¡Œå­˜å‚¨ã€‚ç½‘è·¯ä¸­åŸæœ‰çš„èŠ‚ç‚¹åŒæ ·å¯ä»¥é€šè¿‡å…¶è¾¹ç¼˜å­æ ‘çš„å®Œæ•´çŸ¥è¯†ï¼ŒçŸ¥é“å“ªäº› key-value å¯¹éœ€è¦å­˜å‚¨åœ¨è¯¥æ–°å¢èŠ‚ç‚¹ä¸Šã€‚æ¯ä¸ªäº†è§£åˆ°æ–°èŠ‚ç‚¹çš„èŠ‚ç‚¹éƒ½ä¼šå‘èµ· *STORE* è°ƒç”¨æŠŠç›¸å…³çš„ key-value å¯¹ä¼ é€åˆ°æ–°èŠ‚ç‚¹ä¹‹ä¸Šã€‚ä¸ºäº†é¿å…é‡å¤çš„ STORE è°ƒç”¨ ï¼Œåªæœ‰é‚£äº›è‡ªèº« ID æ¯”å…¶ä»–èŠ‚ç‚¹ ID æ›´æ¥è¿‘ key çš„èŠ‚ç‚¹æ‰ä¼šè¿›è¡Œ key-value å¯¹çš„ä¼ é€ã€‚\n\n## Sketch of Proofï¼ˆå¾…è¯‘ï¼‰\n\nå¾…ç¿»è¯‘\n\n## Implementation Notesï¼ˆå¾…è¯‘ï¼‰\n\nå¾…ç¿»è¯‘\n\n## Summaryï¼ˆæ€»ç»“ï¼‰\n\nç”±äºé‡‡ç”¨åŸºäº XOR åº¦é‡çš„æ‹“æ‰‘ï¼ŒKademlia æ˜¯ç¬¬ä¸€ä¸ªç»“åˆäº†å¯è¯æ˜çš„ä¸€è‡´æ€§ï¼Œæ€§èƒ½ï¼Œä½æ—¶å»¶è·¯ç”±ä»¥åŠå•å‘å¯¹ç§°æ‹“æ‰‘çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿã€‚Kademlia è¿˜å¼•å…¥äº†å¹¶å‘å‚æ•° $Î±$ï¼Œå®ƒå…è®¸äººä»¬åœ¨å¸¦å®½ä¸­äº¤æ¢å¸¸æ•°å› å­ï¼Œä»¥å®ç°å¼‚æ­¥æœ€ä½å»¶è¿Ÿè·¯ç”±é€‰æ‹©å’Œæ— å»¶è¿Ÿé”™è¯¯æ¢å¤ã€‚æœ€åï¼ŒKademlia æ˜¯ç¬¬ä¸€ä¸ªåˆ©ç”¨èŠ‚ç‚¹æ•…éšœä¸æ­£å¸¸è¿è¡Œæ—¶é—´æˆåæ¯”å…³ç³»è¿™ä¸€äº‹å®çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿã€‚\n\n# å‚è€ƒ\n\n1.  [Kademlia ï¼šä¸€ç§åŸºäº XOR åº¦é‡çš„ P2P ä¿¡æ¯ç³»ç»Ÿ](https://blog.csdn.net/hoping/article/details/5307320)\n2.  [P2Pç½‘ç»œ--Kademliaåè®®](http://www.huamo.online/2018/06/12/P2P%E7%BD%91%E7%BB%9C-Kademlia%E5%8D%8F%E8%AE%AE/)","source":"_posts/dht-kademlia.md","raw":"---\ntitle: DHT ç½‘ç»œä¹‹ Kademlia ç®—æ³•\ntags:\n  - Algorithm\n  - ç¿»è¯‘\ndate: 2018-11-08T11:29+08:00\n---\n\næœ¬æ–‡æ˜¯è®ºæ–‡ [Kademlia: A Peer-to-Peer Information System Based on the XOR Metric](http://www.scs.stanford.edu/~dm/home/papers/kpos.pdf) çš„ç¿»è¯‘ã€‚\n<!-- more -->\n\n# Kademliaï¼šä¸€ç§åŸºäº XOR è·ç¦»çš„ P2P ä¿¡æ¯ç³»ç»Ÿ\n\nä½œè€…ï¼šPetar Maymounkov ä»¥åŠ David MazieÌ€res\n\n## Abstractï¼ˆæ‘˜è¦ï¼‰\n\næˆ‘ä»¬æè¿°äº†ä¸€ç§åœ¨å®¹æ˜“å‡ºé”™çš„ç¯å¢ƒä¸‹ä»å…·æœ‰å¯è¯æ˜çš„å®¹é”™æ€§å’Œæ€§èƒ½çš„ P2P åˆ†å¸ƒå¼æ•£åˆ—è¡¨ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿä½¿ç”¨äº†ä¸€ç§åŸºäº XOR è·ç¦»çš„æ–°å‹æ‹“æ‰‘æ¥è·¯ç”±æŸ¥è¯¢ä¸å®šä½èŠ‚ç‚¹çš„éœ€æ±‚ï¼Œè¯¥æ‹“æ‰‘ç®€åŒ–äº†ç®—æ³•åŠç®—æ³•çš„è¯æ˜ã€‚è¯¥æ‹“æ‰‘æœ‰è¿™æ ·ä¸€ä¸ªç‰¹ç‚¹ï¼šæ¯æ¬¡ä¿¡æ¯äº¤æ¢éƒ½ä¼ é€’æˆ–è€…åŠ å¼ºäº†ï¼ˆèŠ‚ç‚¹é—´ï¼‰æœ‰æ•ˆè”ç³»ã€‚ç³»ç»Ÿæ ¹æ®è¿™ç§è”ç³»æ¥å‘é€å¹¶è¡Œå¼‚æ­¥æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»è€Œåšåˆ°å®¹å¿èŠ‚ç‚¹æ•…éšœåŒæ—¶ä¸å¯¹ç”¨æˆ·é€ æˆè¶…æ—¶ã€‚\n\n## Introductionï¼ˆä»‹ç»ï¼‰\n\næœ¬è®ºæ–‡æè¿° Kademlia â€”â€” ä¸€ä¸ª P2P åˆ†å¸ƒå¼æ•£åˆ—è¡¨ï¼ˆDHTï¼‰ã€‚Kademlia æœ‰è®¸å¤šä¹‹å‰çš„ DHT æ— æ³•åŒæ—¶æä¾›çš„ç†æ€§åŠŸèƒ½ã€‚å®ƒæœ€å¤§é™åº¦åœ°å‡å°‘äº†èŠ‚ç‚¹å¿…é¡»å‘é€çš„ç”¨äºäº’ç›¸äº†è§£çš„é…ç½®æ¶ˆæ¯æ•°é‡ã€‚æŸ¥æ‰¾ Key æ—¶é™„å¸¦è‡ªåŠ¨ä¼ æ’­é…ç½®ä¿¡æ¯ã€‚èŠ‚ç‚¹å…·æœ‰è¶³å¤Ÿçš„è®¤çŸ¥ä¸çµæ´»æ€§æ¥é€šè¿‡ä½å»¶è¿Ÿè·¯å¾„è·¯ç”±æŸ¥è¯¢ã€‚Kademlia ä½¿ç”¨å¹¶è¡Œå¼‚æ­¥æŸ¥è¯¢æ¥é¿å…æ¥è‡ªå¤±è´¥èŠ‚ç‚¹çš„è¶…æ—¶å»¶è¿Ÿã€‚èŠ‚ç‚¹è®°å½•å…¶ä»–èŠ‚ç‚¹çš„å­˜åœ¨ä»¥é˜»æŒ¡æŸäº›åŸºæœ¬çš„æ‹’ç»æœåŠ¡æ”»å‡»ã€‚æœ€åï¼Œåªè¦å¯¹è¿è¡Œæ—¶é—´è¿›è¡Œç®€å•çš„å‡è®¾å°±å¯ä»¥å¯¹ Kademlia çš„å‡ ä¸ªé‡è¦ç‰¹æ€§è¿›è¡Œæ­£å¼è¯æ˜ã€‚\n\nKademlia é‡‡ç”¨äº†è®¸å¤š DHT ä½¿ç”¨çš„åŸºæœ¬æ–¹æ³•ã€‚å¯†é’¥ä½¿ç”¨ä¸é€æ˜çš„ 160 ä½ç©ºé—´ï¼Œæ¯”å¦‚ SHA-1 æ•£åˆ—ã€‚å‚ä¸çš„è®¡ç®—æœºåœ¨ 160 ä½å¯†é’¥ç©ºé—´ä¸­éƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹ IDã€‚**key-value é”®å€¼å¯¹å­˜å‚¨åœ¨é‚£äº› ID â€œæ¥è¿‘â€ key çš„èŠ‚ç‚¹ä¸Š**ã€‚æœ€ç»ˆï¼Œä¸€ä¸ªåŸºäºèŠ‚ç‚¹ ID çš„è·¯ç”±ç®—æ³•ä½¿å¾—ä»»ä½•èŠ‚ç‚¹å¯ä»¥é€šè¿‡ç»™å‡ºçš„ç›®æ ‡ key æœ‰æ•ˆåœ°å®šä½ key é™„è¿‘çš„èŠ‚ç‚¹ã€‚\n\nKademlia çš„ä¼—å¤šä¼˜ç‚¹å¾—ç›Šäºå®ƒåˆ›æ–°åœ°ä½¿ç”¨ XOR æ¥åº¦é‡èŠ‚ç‚¹é—´çš„è·ç¦»ã€‚XOR æ˜¯å¯¹ç§°çš„ï¼Œå…è®¸ Kademlia æ¥æ”¶æ¥è‡ªé‚£äº›æ‹¥æœ‰å®Œå…¨ç›¸åŒçš„è·¯ç”±è¡¨ä¿¡æ¯çš„èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚ã€‚åƒæ˜¯ Chord è¿™æ ·æ²¡æœ‰è¿™ç§ç‰¹æ€§çš„ç³»ç»Ÿå°±æ— æ³•ä»æŸ¥è¯¢è¯·æ±‚ä¸­è·å–æœ‰ç”¨çš„è·¯ç”±ä¿¡æ¯ã€‚ç”šè€…ï¼Œä¸å¯¹ç§°ä¼šå¯¼è‡´ä¸¥æ ¼çš„è·¯ç”±è¡¨ã€‚åœ¨ Chord ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¿…é¡»å­˜å‚¨ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ\n\nä¸ºäº†å®šä½æ¥è¿‘ç‰¹å®š ID çš„èŠ‚ç‚¹ï¼ŒKademlia è‡ªå§‹è‡³ç»ˆä»…ä½¿ç”¨ä¸€ä¸ªè·¯ç”±ç®—æ³•ã€‚ç›¸åï¼Œå…¶ä»–ç³»ç»Ÿä½¿ç”¨ä¸€ç§ç®—æ³•æ¥æ¥è¿‘ç›®æ ‡ IDï¼Œä½¿ç”¨å¦ä¸€ç§ç®—æ³•æ¥å®Œæˆæœ€åå‡ è·³ã€‚åœ¨ç°æœ‰çš„ç³»ç»Ÿä¸­ï¼ŒKademlia æœ€åƒ Pastry çš„ç¬¬ä¸€é˜¶æ®µï¼Œè™½ç„¶ä½œè€…æ²¡æœ‰ç”¨è¿™ç§æ–¹å¼æè¿°ï¼Œä½†æ˜¯é€šè¿‡ Kademlia çš„ XOR è·ç¦»å‘ç°ç›®æ ‡ ID çš„èŠ‚ç‚¹æ•°å¯ä»¥å‡å°‘ä¸€åŠã€‚åœ¨ Pastry çš„ç¬¬äºŒé˜¶æ®µï¼Œå®ƒå°†è·ç¦»åº¦é‡åˆ‡æ¢ä¸º ID é—´çš„æ•°å­—å·®å¼‚ã€‚å®ƒè¿˜åœ¨å¤åˆ¶ä¸­ä½¿ç”¨ç¬¬äºŒä¸ªæ•°å­—å·®å¼‚åº¦é‡ã€‚é—æ†¾çš„æ˜¯ï¼Œç¬¬äºŒä¸ªåº¦é‡æ ‡å‡†ä¸­ç›¸è·è¾ƒè¿‘çš„èŠ‚ç‚¹åœ¨ç¬¬ä¸€ä¸ªåº¦é‡æ ‡å‡†ä¸­åˆ™å¯èƒ½ç›¸å·®å¾ˆè¿œï¼Œä»¥è‡´åœ¨ç‰¹å®šèŠ‚ç‚¹ ID å€¼å¤„äº§ç”Ÿäº†ä¸è¿ç»­æ€§ï¼Œä»è€Œé™ä½äº†æ€§èƒ½ï¼Œå¹¶ä½¿å¾—å¯¹æœ€åæƒ…å†µè¡Œä¸ºçš„æ­£å¼åˆ†æå˜å¾—å¤æ‚ã€‚\n\n## System Descriptionï¼ˆç³»ç»Ÿæè¿°ï¼‰\n\nä¸å…¶ä»– DHT ç›¸åŒç±»ä¼¼ï¼ŒKademlia ç»™èŠ‚ç‚¹åˆ†é…ä¸€ä¸ª 160 ä½çš„é€æ˜ IDï¼Œå¹¶æä¾›ä¸€ä¸ªæŸ¥è¯¢ç®—æ³•ç”¨ä»¥å®šä½æ›´åŠ æ¥è¿‘æŒ‡å®šèŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œä»¥å¯¹æ•°çº§åˆ«æ”¶æ•›æŸ¥è¯¢åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚\n\nKademlia é«˜æ•ˆåœ°å°†èŠ‚ç‚¹ä½œä¸ºä¸€ä¸ªäºŒå‰æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ä½ç½®å–å†³äºå…¶ ID çš„æœ€çŸ­å”¯ä¸€å‰ç¼€ã€‚å›¾ä¸€å±•ç¤ºäº†å”¯ä¸€å‰ç¼€ä¸º 0011 çš„èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®ã€‚å¯¹äºä»»ä¸€ç»™å®šçš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°†äºŒå‰æ ‘åˆ†ä¸ºä¸€ç³»åˆ—è¿ç»­çš„ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„å­æ ‘ã€‚æœ€é«˜çš„å­æ ‘ç”±ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„æ•´ä¸ªäºŒå‰æ ‘çš„ä¸€åŠç»„æˆã€‚æ¥ä¸‹æ¥çš„å­æ ‘ç”±ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„å‰©ä½™äºŒå‰æ ‘çš„ä¸€èˆ¬ç»„æˆã€‚åœ¨å›¾ç¤ºä¸­ï¼ŒèŠ‚ç‚¹ 0011 çš„æ‰€æœ‰å­æ ‘è¢«åœˆå‡ºï¼ŒæŒ‰ç…§é«˜åº¦ç”±é«˜åˆ°ä½æ’åºï¼Œå‰ç¼€åˆ†åˆ«æ˜¯ 0, 01, 000 ä»¥åŠ 0010ã€‚\n\n![å›¾ä¸€ï¼šKademlia äºŒå‰æ ‘ã€‚é»‘è‰²çš„ç‚¹è¡¨ç¤ºèŠ‚ç‚¹ 0011Â·Â·Â· çš„ä½ç½®ï¼›ç°è‰²çš„åœˆè¡¨ç¤ºèŠ‚ç‚¹ 0011Â·Â·Â· å¿…é¡»ä¸ä¹‹å»ºç«‹è”ç³»çš„å­æ ‘ã€‚](kademlia-1.png)\n\nKademlia åè®®ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥æ™“å…¶æ¯ä¸ªå­æ ‘ä¸­çš„è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹ã€‚æœ‰äº†è¿™ä¸ªä¿è¯ï¼Œä»»ä¸€èŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡ ID å®šä½åˆ°å¦å¤–çš„èŠ‚ç‚¹ã€‚å›¾äºŒå±•ç¤ºäº†èŠ‚ç‚¹ 0011 é€šè¿‡ä¸æ–­åœ¨å­æ ‘ä¸­æŸ¥è¯¢æœ€ä½³å®ƒæ‰€çŸ¥æ™“çš„æœ€ä½³èŠ‚ç‚¹çš„æ–¹å¼æœ€ç»ˆæ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ 1110 çš„è¿‡ç¨‹ã€‚\n\n![å›¾äºŒï¼šé€šè¿‡ ID å®šä½èŠ‚ç‚¹ã€‚å‰ç¼€ä¸º 0011 çš„èŠ‚ç‚¹é€šè¿‡ä¾æ¬¡çŸ¥æ™“ä¸æŸ¥è¯¢è¶Šæ¥è¶Šè¿‘çš„èŠ‚ç‚¹ä»è€Œæ‰¾åˆ°å‰ç¼€ä¸º 1110 çš„èŠ‚ç‚¹ã€‚å›¾ä¸Šæ–¹çš„çº¿ä»£è¡¨äº† 160 æ¯”ç‰¹çš„ ID ç©ºé—´ï¼Œå¹¶ä¸”å±•ç¤ºäº†æŸ¥è¯¢åˆ°ç›®æ ‡èŠ‚ç‚¹çš„æ•´ä¸ªè¿‡ç¨‹ã€‚å›¾çš„ä¸»ä½“ç”»å‡ºäº†èŠ‚ç‚¹ 1110 å‘å‡ºçš„ RPC æ¶ˆæ¯ï¼Œç¬¬ä¸€ä¸ª RPC æ¶ˆæ¯å‘é€ç»™ 101ï¼Œåç»­çš„ RPC æ¶ˆæ¯å‘é€ç»™å‰ä¸€ä¸ª RPC æ¶ˆæ¯è¿”å›çš„èŠ‚ç‚¹ã€‚](kademlia-2.png)\n\næœ¬èŠ‚çš„å‰©ä½™éƒ¨åˆ†è¡¥å……äº†æŸ¥æ‰¾ç®—æ³•çš„å…·ä½“ç»†èŠ‚ã€‚æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªç²¾ç¡®çš„æ¦‚å¿µæ¥æè¿°èŠ‚ç‚¹é—´çš„è·ç¦»ï¼Œè®©æˆ‘ä»¬æŒ‡å‡ºè·ç¦»æŸä¸ª key æœ€è¿‘çš„ k ä¸ªèŠ‚ç‚¹æä¾›äº†å¯èƒ½ã€‚ç„¶åç»™å‡ºä¸€ä¸ªæŸ¥è¯¢åè®®ï¼Œå³ä½¿æ²¡æœ‰èŠ‚ç‚¹ä¸ç»™å®šçš„ key æ‹¥æœ‰ç›¸åŒçš„å”¯ä¸€å‰ç¼€æˆ–è€…ç»™å®šèŠ‚ç‚¹çš„ä¸€äº›å­æ ‘æ˜¯ç©ºçš„ï¼Œè¿™ä¸ªåè®®ä»ç„¶æ˜¯å¯å·¥ä½œçš„ã€‚\n\n### XOR Metricï¼ˆXOR åº¦é‡ï¼‰\n\næ¯ä¸ª Kademlia èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª 160 æ¯”ç‰¹çš„èŠ‚ç‚¹ IDã€‚èŠ‚ç‚¹ ID ç›®å‰åªæ˜¯éšæœºçš„ 160 ä½æ ‡è¯†ç¬¦ï¼Œå°½ç®¡å®ƒä»¬åŒæ ·å¯ä»¥åƒåœ¨ Chord ä¸­é‚£æ ·æ„é€ ã€‚èŠ‚ç‚¹å‘é€çš„æ¯æ¡æ¶ˆæ¯éƒ½åŒ…å«å…¶èŠ‚ç‚¹IDï¼Œå…è®¸æ¥æ”¶æ–¹åœ¨å¿…è¦æ—¶è®°å½•å‘é€æ–¹çš„å­˜åœ¨ã€‚\n\né”®åŒæ ·æ˜¯ 160 ä½æ ‡è¯†ç¬¦ã€‚ä¸ºäº†ç»™ç‰¹å®šçš„èŠ‚ç‚¹åˆ†é… key-value é”®å€¼å¯¹ï¼ŒKademlia ä¾èµ–ä¸¤ä¸ªæ ‡è¯†ç¬¦ä¹‹é—´çš„è·ç¦»çš„åº¦é‡ã€‚ç»™å‡ºä¸¤ä¸ª 160 ä½çš„æ ‡è¯†ç¬¦ $x$ å’Œ $y$ï¼ŒKademlia å°† $x$ ä¸ $y$ çš„è·ç¦»å®šä¹‰ä¸º $x$ ä¸ $y$ æŒ‰ä½å¼‚æˆ–åçš„æ•´æ•°å€¼ï¼Œå³ $d(x, y) = x \\oplus y$ã€‚\n\næˆ‘ä»¬é¦–å…ˆæ³¨æ„åˆ° XOR è¿ç®—æ˜¯æœ‰æ•ˆçš„ï¼Œå°½ç®¡å±äºéæ¬§å‡ é‡Œå¾·è·ç¦»ã€‚å¼‚æˆ–è¿ç®—æœ‰ä»¥ä¸‹æ€§è´¨ï¼š\n\n- $$d(x, x) = 0$$\n- $$d(x, y)>0, \\text{ if } x \\neq y$$\n- $$\\forall x, y:d(x, y)=d(y, x)$$\n- $$d(x,y)+d(y,z) \\geq d(x,z)$$\n- $$d(x,y) \\oplus d(y,z) = d(x,z)$$\n- $$\\forall a \\geq 0, b \\geq 0: a+b \\geq a \\oplus b$$\n\næ¥ä¸‹æ¥æˆ‘ä»¬æ³¨æ„åˆ°å¼‚æˆ–åº¦é‡åˆ»ç”»äº†åŸºäºäºŒå‰æ ‘çš„ç³»ç»Ÿè‰å›¾ä¸­éšå«çš„è·ç¦»æ¦‚å¿µã€‚åœ¨ 160 ä½ ID å®Œå…¨å¡«å……çš„äºŒå‰æ ‘ä¸­ï¼Œä¸¤ä¸ª ID é—´è·ç¦»å¤§å°æ˜¯åŒ…å«å®ƒä»¬çš„æœ€å°å­æ ‘çš„é«˜åº¦ã€‚å½“æ ‘æœªå®Œå…¨å¡«æ»¡æ—¶ï¼Œä¸ ID $x$ æœ€æ¥è¿‘çš„èŠ‚ç‚¹æ˜¯èŠ‚ç‚¹ ID ä¸ $x$ å…±äº«æœ€é•¿å…¬å…±å‰ç¼€çš„èŠ‚ç‚¹ã€‚å¦‚æœæ ‘ä¸­æœ‰ç©ºåˆ†æ”¯ï¼Œåˆ™å¯èƒ½æœ‰å¤šä¸ªå¶å­èŠ‚ç‚¹å…·æœ‰æœ€é•¿çš„å…¬å…±å‰ç¼€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ $x$ æœ€æ¥è¿‘çš„å¶å­å°†å˜ä¸ºç¦»é€šè¿‡ç¿»è½¬ $x$ ä¸­å¯¹åº”äºæ ‘çš„ç©ºåˆ†æ”¯ä¸­çš„ä½å¾—åˆ°çš„ $\\widetilde{x}$ æœ€è¿‘çš„å¶å­ã€‚\n\nç±»ä¼¼äº Chord ç®—æ³•çš„é¡ºæ—¶é’ˆåœ†å‘¨åº¦é‡ï¼ŒXOR ä¹Ÿæ˜¯å•å‘çš„ã€‚å¯¹äºä»»æ„ç»™å®šçš„ç‚¹ $x$ ä»¥åŠ $âˆ† > 0$ï¼Œä»…å­˜åœ¨ä¸€ä¸ªç‚¹ $y$ ä½¿å¾— $d(x, y) = âˆ†$ã€‚å•å‘æ€§ä¿è¯äº†å¯¹äºç›¸åŒçš„ keyï¼Œæ— è®ºä»å“ªä¸ªåŸç‚¹å¼€å§‹æŸ¥è¯¢ï¼Œéƒ½ä¼šæ²¿ç€ç›¸åŒçš„è·¯å¾„è¿›è¡Œæ”¶æ•›ã€‚è¿™æ ·ï¼Œæ²¿ç€æŸ¥è¯¢è·¯å¾„ç¼“å­˜ key-value é”®å€¼å¯¹å°±èƒ½å‡è½»å­˜æ”¾çƒ­é—¨ key å€¼èŠ‚ç‚¹çš„å‹åŠ›ã€‚ç±»ä¼¼äº Pastry è€Œä¸åŒäº Chordï¼Œ XOR æ‹“æ‰‘æ˜¯å¯¹ç§°çš„ã€‚\n\n### Node Stateï¼ˆèŠ‚ç‚¹çŠ¶æ€ï¼‰\n\nKademlia èŠ‚ç‚¹å­˜å‚¨äº†å…¶ä»–èŠ‚ç‚¹è”ç³»äººçš„ä¿¡æ¯ä»¥è·¯ç”±æŸ¥è¯¢æ¶ˆæ¯ã€‚å¯¹äºæ¯ä¸ª $0 \\leq i < 160$ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ„å»ºä¸€ä¸ªï¼ˆIP åœ°å€ï¼ŒUDP ç«¯å£ï¼ŒèŠ‚ç‚¹ IDï¼‰çš„ä¸‰å…ƒç»„åˆ—è¡¨ç”¨æ¥å­˜å‚¨ä¸è¯¥èŠ‚ç‚¹ç›¸è· $[2^i$, $2^{i+1})$ çš„èŠ‚ç‚¹ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸º $K$ æ¡¶ã€‚æ¯ä¸ª $K$ æ¡¶å†…èŠ‚ç‚¹æ ¹æ®èŠ‚ç‚¹æœ€åå¯è§æ—¶é—´è¿›è¡Œæ’åºï¼Œæœ€æ—©å¯è§çš„æ”¾ç½®åœ¨å¼€å¤´ï¼Œæœ€è¿‘å¯è§çš„æ”¾ç½®åœ¨æœ«å°¾ã€‚å¯¹äºè¾ƒå°çš„ $i$ å€¼ï¼Œ$K$ æ¡¶é€šå¸¸æ˜¯ç©ºçš„ï¼ˆå› ä¸ºä¸å­˜åœ¨åˆé€‚çš„èŠ‚ç‚¹ï¼‰ã€‚å¯¹äºè¾ƒå¤§çš„ $i$ å€¼ï¼Œåˆ—è¡¨æœ€å¤§å®¹é‡ä¸º $k$ï¼Œ$k$ æ˜¯ä¸€ä¸ªç³»ç»ŸèŒƒå›´å†…çš„å¤åˆ¶å‚æ•°ã€‚ä»…å½“ä»»æ„ç»™å®šçš„ $k$ ä¸ªèŠ‚ç‚¹ä¸ä¼šåœ¨ä¸€ä¸ªå°æ—¶å†…åŒæ—¶å¤±æ•ˆæ—¶ï¼Œ$k$ å€¼æ‰æœ‰æ•ˆï¼Œä¾‹å¦‚ $k = 20$ã€‚\n\nå½“ä¸€ä¸ª Kademlia èŠ‚ç‚¹æ”¶åˆ°ä»»ä¸€æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„è¯·æ±‚æˆ–è€…å›å¤æ¶ˆæ¯ï¼Œå®ƒä¼šæ ¹æ®å‘é€è€…çš„èŠ‚ç‚¹ ID æ›´æ–° $K$ æ¡¶ã€‚è§„åˆ™å¦‚ä¸‹ï¼š\n\n- å¦‚æœå‘é€èŠ‚ç‚¹å·²ç»å­˜åœ¨æ¥æ”¶æ–¹çš„ $K$ æ¡¶ä¸­ï¼š\n    - æ¥æ”¶æ–¹å°†å‘é€èŠ‚ç‚¹ç§»åŠ¨åˆ°ç›¸åº” $K$ æ¡¶çš„å°¾éƒ¨ï¼›\n- å¦‚æœå‘é€èŠ‚ç‚¹å¹¶æœªå­˜åœ¨æ¥æ”¶æ–¹çš„ $K$ æ¡¶ä¸­ï¼š\n    - å¦‚æœ $K$ æ¡¶ä¸­èŠ‚ç‚¹æ•°é‡å°‘äº $k$ ä¸ªï¼Œåˆ™ç›´æ¥å°†å‘é€èŠ‚ç‚¹æ’å…¥è‡³ $K$ æ¡¶å°¾éƒ¨ï¼›\n    - å¦‚æœ $K$ æ¡¶å·²æ»¡ï¼š\n        - å¦‚æœæœ€æ—©å¯è§çš„èŠ‚ç‚¹ä¸èƒ½ ping é€šï¼Œåˆ™ç§»é™¤è¯¥èŠ‚ç‚¹ï¼Œç„¶åå°†å‘é€èŠ‚ç‚¹æ’å…¥è‡³ $K$ æ¡¶å°¾éƒ¨ï¼›\n        - å¦‚æœæœ€æ—©å¯è§çš„èŠ‚ç‚¹å¯ä»¥ ping é€šï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°å°¾éƒ¨ï¼Œç„¶åä¸¢å¼ƒå‘é€èŠ‚ç‚¹ï¼›\n\n$K$ æ¡¶é«˜æ•ˆåœ°å®ç°äº† LRU ç®—æ³•ï¼Œåªæ˜¯æ´»åŠ¨çš„èŠ‚ç‚¹æ°¸è¿œä¸ä¼šä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚è¿™ç§å¯¹ä¸æ—§è”ç³»äººçš„åå¥½æ¥è‡ªäºæˆ‘ä»¬çš„å¯¹äº Saroiu ç­‰äººä» Gnutella ç½‘ç»œæ”¶é›†çš„è¿½è¸ªæ•°æ®çš„åˆ†æã€‚å›¾ 3 å±•ç¤ºäº† Gnutella èŠ‚ç‚¹éšç€å½“å‰æ—¶é—´çš„æ¨ç§»ï¼Œé¢å¤–åœ¨çº¿ä¸€ä¸ªå°æ—¶çš„å¯èƒ½æ€§ã€‚ä¸€ä¸ªèŠ‚ç‚¹åœ¨çº¿æ—¶é—´è¶Šé•¿ï¼Œå®ƒå°±è¶Šå¯èƒ½ç»§ç»­é¢å¤–åœ¨çº¿ä¸€ä¸ªå°æ—¶ã€‚é€šè¿‡ä¿æŒæœ€è€çš„åœ¨çº¿èŠ‚ç‚¹ï¼Œ$K$ æ¡¶æœ€å¤§åŒ–äº†åˆ—è¡¨ä¸­èŠ‚ç‚¹åœ¨çº¿çš„å¯èƒ½æ€§ã€‚\n\n![å›¾ä¸‰ï¼šé¢å¤–ä¿æŒä¸€å°æ—¶åœ¨çº¿çš„å¯èƒ½æ€§å…³äºæ—¶é—´çš„å‡½æ•°ã€‚X è½´ä»£è¡¨åˆ†é’Ÿï¼ŒY è½´è¡¨ç¤ºä¿æŒåœ¨çº¿ $x$ åˆ†é’Ÿçš„èŠ‚ç‚¹ç»§ç»­ä¿æŒåœ¨çº¿åˆ° $x + 60$ åˆ†é’Ÿæ—¶åˆ»çš„å¯èƒ½æ€§](kademlia-3.png)\n\n$K$ æ¡¶é‡‡ç”¨è¿™æ ·çš„æ›´æ–°ç­–ç•¥çš„å¦ä¸€ä¸ªä¼˜ç‚¹åœ¨äºå¯ä»¥æŠµæŒ¡ç‰¹å®šçš„ DoS æ”»å‡»ã€‚æ”»å‡»è€…ä¸èƒ½ä½¿ç”¨æ–°çš„èŠ‚ç‚¹æ³›æ´ªç³»ç»Ÿæ¥åˆ·æ–°èŠ‚ç‚¹çš„è·¯ç”±çŠ¶æ€ã€‚åªæœ‰å½“æ—§çš„èŠ‚ç‚¹ç¦»å¼€äº†ç³»ç»Ÿï¼ŒKademlia æ‰ä¼šæ’å…¥æ–°çš„èŠ‚ç‚¹ã€‚\n\n### Kademlia protocolï¼ˆKademlia åè®®ï¼‰\n\nKademlia åè®®ç”±å››ä¸ª RPC è°ƒç”¨ç»„æˆï¼š*PING*, *STORE*, *FIND_NODE*, *FIND_VALUE*ã€‚\n\n- *PING* ç”¨äºæ¢æµ‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦åœ¨çº¿ã€‚\n- *STORE* ç”¨äºé€šçŸ¥ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€ä¸ª key-value å¯¹ä»¥ä¾¿ä¹‹åè·å–ã€‚\n- *FIND_NODE* ä½¿ç”¨ä¸€ä¸ª 160 æ¯”ç‰¹çš„ ID ä½œä¸ºå‚æ•°ã€‚è°ƒç”¨å¯¹è±¡è¿”å›ä¸€ä¸ªå…¶çŸ¥æ™“çš„è·ç¦»ç›®æ ‡ ID æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ä¿¡æ¯ <IP åœ°å€ï¼ŒUDP ç«¯å£ï¼ŒèŠ‚ç‚¹ ID> ä¸‰å…ƒç»„ã€‚è¿™ $k$ ä¸ªä¸‰å…ƒç»„å¯èƒ½æ¥è‡ªå•ä¸ª $K$ æ¡¶ï¼Œä¹Ÿå¯èƒ½å› ä¸ºè·ç¦»æœ€è¿‘çš„ $K$ æ¡¶æœªæ»¡è€Œå–è‡ªå¤šä¸ª $K$ æ¡¶ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼ŒRPC è°ƒç”¨æ¥æ”¶è€…å¿…é¡»è¿”å› $k$ ä¸ªèŠ‚ç‚¹ï¼Œé™¤éè¯¥èŠ‚ç‚¹çŸ¥æ™“èŠ‚ç‚¹æ€»æ•°å°äº $k$ ä¸ªã€‚\n- *FIND_VALUE* è°ƒç”¨å’Œ *FIND_NODE* ä¸€æ ·ï¼Œä¸è¿‡å½“è°ƒç”¨çš„æ¥æ”¶è€…å­˜æœ‰è¯·æ±‚è€…æ‰€è¯·æ±‚çš„é”®çš„æ—¶å€™ï¼Œå®ƒå°†è¿”å›ç›¸åº”é”®çš„å€¼ã€‚\n\nåœ¨æ‰€æœ‰çš„ RPC ä¸­ï¼Œæ¥æ”¶è€…å¿…é¡»è¿”å›ä¸€ä¸ª 160 æ¯”ç‰¹çš„éšæœº RPC IDï¼Œä»¥é˜²æ­¢åœ°å€ä¼ªé€ ï¼ˆï¼Ÿï¼‰ã€‚å¯ä»¥å°† PING æ¶ˆæ¯é™„åŠ åœ¨ RPC æ¶ˆæ¯çš„å›å¤ä¸­ä»¥ç¡®å®šå‘é€è€…çš„ç½‘ç»œåœ°å€ã€‚\n\n#### ä¸´è¿‘ ID èŠ‚ç‚¹æŸ¥æ‰¾\n\nKademlia èŠ‚ç‚¹éœ€è¦å®ç°çš„æœ€é‡è¦çš„è¿‡ç¨‹å°±æ˜¯æ ¹æ®ä¸€ä¸ªèŠ‚ç‚¹ ID æ‰¾åˆ°ä¸å®ƒæœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªè¿‡ç¨‹ä¸º *èŠ‚ç‚¹æŸ¥æ‰¾*ï¼ŒKademlia ä½¿ç”¨é€’å½’å®Œæˆè¿™ä¸ªå·¥ä½œã€‚ç”±æŸ¥æ‰¾éœ€æ±‚çš„èµ·å§‹èŠ‚ç‚¹å…ˆä»ç¦»ç›®æ ‡èŠ‚ç‚¹ ID æœ€è¿‘çš„éç©º $K$ æ¡¶ä¸­å–å‡º $Î±$ ä¸ªèŠ‚ç‚¹ï¼ˆå¦‚æœ $K$ æ¡¶ä¸­èŠ‚ç‚¹ä¸è¶³ $Î±$ ä¸ªï¼Œåˆ™ä»å…¶ä»– $K$ æ¡¶ä¸­å–æ»¡ $Î±$ ä¸ªï¼‰ã€‚èµ·å§‹æ¥åœ°å¹¶è¡Œå‘è¿™ $Î±$ ä¸ªèŠ‚ç‚¹å‘é€ *FIND_NODE* RPC è°ƒç”¨ã€‚$Î±$ æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§å‚æ•°ï¼Œä¾‹å¦‚ 3ã€‚\n\nåœ¨é€’å½’è°ƒç”¨é˜¶æ®µï¼Œåˆå§‹èŠ‚ç‚¹æ ¹æ® $Î±$ ä¸ªèŠ‚ç‚¹è¿”å›çš„èŠ‚ç‚¹åˆ—è¡¨å†æ¬¡å‘é€ *FIND_NODE* è¯·æ±‚ï¼ˆé€’å½’è°ƒç”¨åœ¨æ‰€æœ‰ $Î±$ ä¸ªèŠ‚ç‚¹å®Œæˆè¿”å›å‰å°±å¯ä»¥å¼€å§‹ï¼‰ã€‚èµ·å§‹èŠ‚ç‚¹ä»å…¶ä»–èŠ‚ç‚¹è¿”å›çš„å¤§å°ä¸º $k$ çš„èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰å‡º $Î±$ ä¸ªä¹‹å‰æ²¡æœ‰æŸ¥è¯¢è¿‡çš„èŠ‚ç‚¹ï¼Œå‘å®ƒä»¬å‘é€ *FIND_NODE* RPC è°ƒç”¨ã€‚å¤±è´¥çš„èŠ‚ç‚¹å°†ä¸å†ä¼šçº³å…¥è€ƒè™‘èŒƒå›´ã€‚å¦‚æœæœ‰ä¸€è½® *FIND_NODE* è°ƒç”¨ä¸­è¿”å›çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸æ¯”ä¹‹å‰çŸ¥æ™“çš„ $k$ ä¸ªèŠ‚ç‚¹æ›´åŠ æ¥è¿‘ï¼Œåˆ™å½“åˆå§‹èŠ‚ç‚¹å®Œæˆå¯¹æœ€è¿‘çš„è¿™ä¸ª $k$ ä¸ªèŠ‚ç‚¹çš„æŸ¥è¯¢å¹¶å¾—åˆ°å“åº”ä¹‹åï¼ŒæŸ¥è¯¢ç»“æŸã€‚å½“ $a=1$ï¼ŒæŸ¥è¯¢ç®—æ³•åœ¨ä¿¡æ¯å¼€é”€å’Œæ•…éšœèŠ‚ç‚¹çš„æ£€æŸ¥å»¶è¿Ÿä¸Šä¸ Chord ç±»ä¼¼ã€‚ä½†æ˜¯ Kademlia å¯ä»¥çµæ´»åœ°ä» $k$ ä¸ªèŠ‚ç‚¹ä¸­é€‰æ‹©ä»»ä¸€ä¸€ä¸ªå‘é€è¯·æ±‚ä»¥é™ä½æŸ¥è¯¢å»¶è¿Ÿã€‚\n\n#### å­˜å‚¨é”®å€¼å¯¹ä¸é‡æ–°å‘å¸ƒæ—¶é—´\n\nä¸Šè¿°æŸ¥è¯¢è¿‡ç¨‹å®ç°äº†å¤§éƒ¨åˆ†çš„æ“ä½œã€‚ä¸ºäº†å­˜å‚¨ä¸€ä¸ª key-value å¯¹ï¼Œèµ·å§‹èŠ‚ç‚¹é€šè¿‡ä¸Šè¿°æ“ä½œå®šä½åˆ° $k$ ä¸ªç¦» key æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œå¹¶å‘å®ƒä»¬å‘é€ *STORE* è°ƒç”¨ã€‚å¦å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šåœ¨éœ€è¦çš„æƒ…å†µä¸‹é‡æ–°å‘å¸ƒ key-value ä»¥ä½¿ key-value æŒç»­å­˜åœ¨ã€‚åœ¨ Kademlia å½“å‰çš„åº”ç”¨ä¸­ï¼ˆæ–‡ä»¶åˆ†äº«ï¼‰ï¼Œkey-value çš„åŸå§‹å‘å¸ƒè€…éœ€è¦æ¯ä¸ª 24 å°æ—¶é‡æ–°è¿›è¡Œå‘é€ã€‚å¦åˆ™ï¼Œkey-value å°†åœ¨å‘å¸ƒ 24 å°æ—¶åå¤±æ•ˆï¼Œä»¥é™åˆ¶ç³»ç»Ÿä¸­ä¸å¯ç”¨çš„ç´¢å¼•ä¿¡æ¯ã€‚å¯¹äºå…¶ä»–çš„åº”ç”¨ï¼Œæ¯”å¦‚æ•°å­—è¯ä¹¦æˆ–è€…ç”¨äºå€¼æ˜ å°„çš„åŠ å¯†å“ˆå¸Œï¼Œæ›´é•¿çš„è¿‡æœŸæ—¶é—´ä¹Ÿè®¸ä¼šæ›´åˆé€‚ã€‚\n\n#### æŸ¥è¯¢é”®å€¼å¯¹ä¸è¿‡æœŸæ—¶é—´\n\nä¸ºäº†æ‰¾åˆ°ä¸€ä¸ª key-value å¯¹ï¼ŒèŠ‚ç‚¹å‘èµ·ä¸€ä¸ªèŠ‚ç‚¹æŸ¥æ‰¾ä»¥æ‰¾åˆ° ID ä¸ key æœ€æ¥è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚å€¼æŸ¥è¯¢ä½¿ç”¨çš„æ˜¯ *FIND_VALUE* è°ƒç”¨è€Œä¸æ˜¯ *FIND_NODE* è°ƒç”¨ã€‚è€Œä¸”ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹è¿”å›äº†å€¼ï¼Œåˆ™è¿™ä¸ªè¿‡ç¨‹ç«‹å³ç»“æŸã€‚å‡ºäºç¼“å­˜çš„ç›®çš„ï¼Œä¸€æ—¦æŸ¥æ‰¾æˆåŠŸï¼Œå‘èµ·èŠ‚ç‚¹å°†ä¼šå°† key-value å­˜å‚¨è‡³å…¶çŸ¥æ™“çš„ç›¸å¯¹ key æœ€è¿‘çš„ï¼Œä½†æ˜¯åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰è¿”å›å€¼çš„èŠ‚ç‚¹ã€‚\n\nç”±äºæ‹“æ‰‘æ˜¯å•å‘çš„ï¼Œéšåå¯¹äºç›¸åŒ key çš„æŸ¥æ‰¾å¾ˆå¯èƒ½åœ¨æŸ¥è¯¢åˆ°æœ€è¿‘çš„èŠ‚ç‚¹ä¹‹å‰å°±å‘½ä¸­å­˜å‚¨åœ¨éæœ€è¿‘èŠ‚ç‚¹ä¸­ç¼“å­˜ã€‚åœ¨æŸä¸ª key æ´»è·ƒåº¦éå¸¸é«˜çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¯èƒ½ä¼šå°†å…¶å­˜å‚¨åœ¨å¾ˆå¤šèŠ‚ç‚¹ã€‚ä¸ºäº†é¿å…è¿™ç§è¿‡åº¦å­˜å‚¨ï¼Œæˆ‘ä»¬ä¸º key-value è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´ä¸èŠ‚ç‚¹ ID ç›¸å¯¹äº key çš„è·ç¦»æˆæŒ‡æ•°åæ¯”ã€‚è™½ç„¶ç®€å•çš„ LRU ç­–ç•¥ä¼šäº§ç”Ÿç±»ä¼¼çš„ç”Ÿå‘½å‘¨æœŸåˆ†å¸ƒï¼Œä½†æ˜¯æ²¡æœ‰åˆé€‚çš„æ–¹æ³•å»é€‰æ‹©cacheçš„å¤§å°ï¼Œå› ä¸ºèŠ‚ç‚¹å¯¹äºç³»ç»Ÿå°†è¦å‚¨å­˜å¤šå°‘å€¼æ²¡æœ‰å…ˆéªŒçŸ¥è¯†ã€‚\n\n#### $K$ æ¡¶æ›´æ–°ä¸åŠ å…¥ç½‘ç»œ\n\n$K$ æ¡¶ä¼šæ ¹æ®ç»è¿‡èŠ‚ç‚¹çš„è¯·æ±‚è€Œä¿æŒæ›´æ–°ã€‚ä¸ºäº†è§£å†³å› ä¸ºæŸä¸ªç‰¹æ®Šçš„ ID æ®µé•¿æ—¶é—´æ²¡æœ‰æŸ¥è¯¢çš„ç‰¹æ®Šæƒ…å†µï¼ŒèŠ‚ç‚¹ä¼šåˆ·æ–°é‚£äº›åœ¨è¿‡å»ä¸€å°æ—¶å†…æ²¡æœ‰è¿‡æŸ¥è¯¢è¯·æ±‚çš„ $K$ æ¡¶ã€‚åˆ·æ–°å°±æ˜¯éšæœºé€‰å–ä¸€ä¸ªå¤„åœ¨å½“å‰ $K$ æ¡¶èŒƒå›´çš„ IDï¼Œç„¶åå¯¹å…¶è¿›è¡ŒèŠ‚ç‚¹æŸ¥è¯¢ã€‚\n\nä¸ºäº†åŠ å…¥ç½‘ç»œï¼Œä¸€ä¸ªèŠ‚ç‚¹ $u$ å¿…é¡»è¦ä¸ä¸€ä¸ªå·²å­˜åœ¨åœ¨ç½‘ç»œä¸­çš„èŠ‚ç‚¹ w æœ‰è”ç³»ã€‚$u$ å°† w æ’å…¥åˆ°åˆé€‚çš„ $K$ æ¡¶ä¸­ï¼Œéšå $u$ å¯¹è‡ªå·±çš„ nodeID è¿›è¡Œä¸€æ¬¡èŠ‚ç‚¹æŸ¥è¯¢ï¼Œæœ€åï¼Œ$u$ ä¼šè”ç³»åˆ°ç¦»å®ƒé‚»å±…æ›´è¿œçš„èŠ‚ç‚¹ï¼Œç„¶åæ›´æ–°ç›¸åº”çš„ $K$ æ¡¶ã€‚åœ¨åˆ·æ–°è¿‡ç¨‹ä¸­ï¼Œ$u$ å¡«å……äº†è‡ªå·±çš„ $K$ æ¡¶åŒæ—¶ä¹Ÿå°†è‡ªå·±æ’å…¥åˆ°å…¶ä»–èŠ‚ç‚¹çš„ $K$ æ¡¶ä¸­ã€‚\n\n### Routing Tableï¼ˆè·¯ç”±è¡¨ï¼‰\n\nKademlia çš„åŸºç¡€è·¯ç”±è¡¨ç»“æ„éå¸¸ç›´è§‚ï¼Œä½†æ˜¯éœ€è¦å¯¹é«˜åº¦ä¸å¹³è¡¡çš„æ ‘è¿›è¡Œä¸€äº›ç»†èŠ‚å¤„ç†ã€‚è·¯ç”±è¡¨æ˜¯ä¸€æ£µå¶å­èŠ‚ç‚¹ä¸º $K$ æ¡¶çš„äºŒå‰æ ‘ã€‚æ¯ä¸ª $K$ æ¡¶åŒ…å«äº†ä¸€äº›å…·æœ‰å…¬å…±å‰ç¼€çš„ IDã€‚$K$ æ¡¶å…¬å…±å‰ç¼€å°±æ˜¯å…¶åœ¨äºŒå‰æ ‘ä¸­æ‰€å¤„çš„ä½ç½®ã€‚å¯è§ï¼Œæ¯ä¸ª $K$ æ¡¶è¦†ç›–äº†ä¸€éƒ¨åˆ† ID ç©ºé—´ï¼Œæ‰€æœ‰çš„ $K$ æ¡¶é›†åˆæ— é‡å åœ°è¦†ç›–äº†æ•´ä¸ª 160 æ¯”ç‰¹ ID ç©ºé—´ã€‚\n\nè·¯ç”±äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹æ˜¯æŒ‰éœ€åŠ¨æ€åˆ†é…çš„ã€‚å›¾ 4 è¡¨ç¤ºäº†è¿™ä¸€ä¸ªè¿‡ç¨‹ã€‚åˆå§‹çŠ¶æ€ä¸‹ï¼ŒèŠ‚ç‚¹ $u$ çš„è·¯ç”±æ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ª $K$ æ¡¶è¦†ç›–äº†æ•´ä¸ª ID ç©ºé—´ã€‚å½“ $u$ å¾—åˆ°äº†ä¸€ä¸ªæ–°çš„è”ç³»äººæ—¶ï¼Œå®ƒå°†æ ¹æ®ä¸æ–°çš„è”ç³»äººçš„è·ç¦»ï¼Œå°è¯•å°†å…¶æ’å…¥åˆ°åˆé€‚çš„ $K$ æ¡¶ä¸­ã€‚æ’å…¥çš„è§„åˆ™å¦‚ä¸‹ï¼š\n\n- å¦‚æœ $K$ æ¡¶æœªæ»¡ï¼Œæ–°çš„è”ç³»äººå°±ä¼šè¢«ç›´æ¥æ’å…¥ï¼›\n- å¦‚æœ $K$ æ¡¶æ»¡äº†ï¼š\n    - å¦‚æœ $K$ æ¡¶çš„èŒƒå›´åŒ…æ‹¬äº† $u$ è‡ªèº«çš„ IDï¼Œåˆ™ $K$ æ¡¶å°†ä¼šä¸€åˆ†ä¸ºäºŒï¼ŒåŸ $K$ æ¡¶ä¸­çš„ ID é‡æ–°åˆ†é…åˆ°æ–°çš„ $K$ æ¡¶ä¸­ï¼Œç„¶åå†å°è¯•æ’å…¥ï¼›\n    - å¦‚æœ $K$ æ¡¶çš„èŒƒå›´ä¸åŒ…æ‹¬ $u$ è‡ªèº«çš„ IDï¼Œæ–°çš„è”ç³»äººå°†ç›´æ¥è¢«ä¸¢å¼ƒï¼›ï¼ˆ3ï¼‰\n\nåœ¨è¿™æ ·é«˜åº¦ä¸å¹³è¡¡çš„äºŒå‰æ ‘ä¸­ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¯¼è‡´è¿™ç§æƒ…å†µä¸‹å¹¶ä¸ä¼šæŒ‰ç…§è§„åˆ™ 3 è¿›è¡Œæ’å…¥ã€‚å‡è®¾ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œ$u$ æ˜¯**å”¯ä¸€**ä¸€ä¸ª ID ä»¥ 000 å¼€å¤´çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶æœ‰è¶…è¿‡ $k$ ä¸ª ID ä»¥ 001 å¼€å¤´çš„èŠ‚ç‚¹ $v\\_1,v\\_2...v\\_k...v\\_n$ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ $v$ çš„è·¯ç”±æ ‘ï¼Œ$u$ éƒ½å°†ä¼šè¢«æ’å…¥åˆ°ä¸€ä¸ªç©º $K$ æ¡¶ä¸­ã€‚ä½†æ˜¯ç”±äºæŒ‰ç…§è§„åˆ™ 3ï¼Œ $u$ çš„æ¡¶æ›´æ–°åªä¼šé€šçŸ¥åˆ° $u$ çš„è·¯ç”±æ ‘æ‰€è®°å½•çš„æ‰€æœ‰ $v$ ä¸­çš„ $k$ ä¸ªã€‚ä¸ºäº†é¿å…å‰©ä½™çš„ $v$ æ— æ³•å¾—åˆ° $u$ çš„æ¡¶æ›´æ–°ä¿¡æ¯ï¼ŒKademlia èŠ‚ç‚¹é€šè¿‡æ‹†åˆ†ä»¥ä¿å­˜äº†è¶…è¿‡ $k$ ä¸ªçš„æ‰€æœ‰æœ‰æ•ˆçš„èŠ‚ç‚¹ï¼Œå³ä½¿ä¸æ˜¯å› ä¸º $K$ æ¡¶ä¸­åŒ…æ‹¬äº†è‡ªèº«çš„ IDã€‚å›¾ 5 å±•ç¤ºäº†è¿™ç§é¢å¤–çš„æ‹†åˆ†ã€‚å½“ $u$ åˆ·æ–°äº†æ¡¶ï¼Œæ‰€æœ‰å‰ç¼€ä¸º 001 çš„èŠ‚ç‚¹éƒ½ä¼šçŸ¥æ™“ã€‚\n\n![å›¾å››ï¼šè·¯ç”±è¡¨éšæ—¶é—´çš„æ¼”å˜ã€‚ä¸€å¼€å§‹ï¼ŒèŠ‚ç‚¹åªæœ‰ä¸€ä¸ª $K$ æ¡¶ã€‚éšç€ $K$ æ¡¶è¢«å¡«å……ï¼ŒåŒ…å«èŠ‚ç‚¹ ID çš„æ¡¶è¢«ä¸æ–­ä¸€åˆ†ä¸ºäºŒã€‚](kademlia-4.png)\n\n![å›¾äº”ï¼šä¸€ä¸ª ID ä¸º $00...00$ çš„èŠ‚ç‚¹çš„å®½æ¾è·¯ç”±è¡¨ã€‚ä¸ºäº†ç¡®ä¿å…¶çŸ¥æ™“å®ƒå‘¨å›´æœ€å°å­æ ‘ï¼ˆè‡³å°‘ $k$ ä¸ªèŠ‚ç‚¹ï¼‰çš„æ‰€æœ‰è”ç³»äººï¼Œè¿™ä¸ªè·¯ç”±è¡¨è¿›è¡Œäº†é¢å¤–çš„æ‹†åˆ†ã€‚](kademlia-5.png)\n\n### Efficient Key Re-publishingï¼ˆKey çš„é«˜æ•ˆé‡å‘å¸ƒï¼‰\n\nä¸ºäº†ä¿è¯ key-value å¯¹çš„æŒä¹…å­˜åœ¨ï¼ŒèŠ‚ç‚¹å¿…é¡»å‘¨æœŸæ€§é‡å‘å¸ƒ keyã€‚å¦åˆ™ï¼Œä¸¤ç§æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´å¯¹æœ‰æ•ˆ key çš„æŸ¥è¯¢å¤±è´¥ã€‚\n\n- ä¸€äº›è·å¾— key-value å¯¹çš„èŠ‚ç‚¹ç¦»å¼€äº†ç½‘ç»œ\n- æ–°çš„ç›¸æ¯”åŸå§‹è¢«å‘å¸ƒè¿‡ key-value å¯¹çš„èŠ‚ç‚¹ ID æ›´è¿‘çš„èŠ‚ç‚¹åŠ å…¥äº†ç½‘ç»œ\n\nåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ‹¥æœ‰è¿™ä¸ª key-value å¯¹çš„èŠ‚ç‚¹éœ€è¦å°†å…¶é‡æ–°å‘å¸ƒåˆ°ç¦» key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚\n\nä¸ºäº†å¼¥è¡¥èŠ‚ç‚¹ç¦»å¼€ç½‘ç»œçš„æƒ…å†µï¼ŒèŠ‚ç‚¹æ¯éš”ä¸€ä¸ªå°æ—¶é‡æ–°å‘å¸ƒ key-value å¯¹ï¼Œä¸€ä¸ªç›´æ¥çš„å®ç°å°±æ˜¯å°†ä¼šäº§ç”Ÿå¾ˆå¤šæ¶ˆæ¯â€”â€”æ¯ä¸ªå­˜å‚¨è¿™ä¸ª key-value å¯¹çš„èŠ‚ç‚¹ï¼ˆè‡³å¤š $k$ ä¸ªï¼‰é—´éš”ä¸€å°æ—¶ä¼šå‘èµ·ä¸€æ¬¡æŸ¥è¯¢ï¼Œç„¶åå‘å…¶ä»– $k-1$ ä¸ªèŠ‚ç‚¹å‘èµ· *STORE* è¯·æ±‚ã€‚è¿™ä¸ªé‡æ–°å‘å¸ƒæ“ä½œå¯ä»¥å¤§å¤§ç®€åŒ–ã€‚é¦–å…ˆï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°å¯¹æŸä¸ª key-value å¯¹çš„ *STORE* è°ƒç”¨ï¼Œå®ƒå‡è®¾è¿™ä¸ª RPC è°ƒç”¨åŒæ ·è¢«å‘é€ç»™äº†å¦å¤– $k-1$ ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹åœ¨ä¸‹ä¸€ä¸ªå°æ—¶ä¸ä¼šå†é‡æ–°å‘å¸ƒæ­¤ key-value å¯¹ã€‚è¿™ä¿è¯äº†çŸ¥é“å¤åˆ¶é—´éš”ä¸æ˜¯å®Œå…¨åŒæ­¥çš„ï¼Œæ¯éš”å°æ—¶å†…åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¼šé‡æ–°å‘å¸ƒ key-value å¯¹ã€‚\n\nç¬¬äºŒä¸ªä¼˜åŒ–åœ¨äºåœ¨é‡æ–°å‘å¸ƒ key ä¹‹å‰é¿å…è¿›è¡ŒèŠ‚ç‚¹æŸ¥è¯¢ã€‚åƒä¸Šä¸€èŠ‚æ‰€è¯´çš„ï¼Œä¸ºäº†å¤„ç†ä¸å¹³è¡¡æ ‘ï¼Œåœ¨å¿…è¦çš„æ—¶å€™èŠ‚ç‚¹å°†ä¼šæ‹†åˆ† $K$ æ¡¶æ¥ç¡®ä¿å®ƒå¯¹è‡³å°‘ $k$ ä¸ªèŠ‚ç‚¹çš„å‘¨å›´å­æ ‘å……åˆ†äº†è§£ã€‚å¦‚æœèŠ‚ç‚¹åœ¨é‡æ–°å‘å¸ƒ key-value ä¹‹å‰æ›´æ–°äº†è¯¥ $k$ èŠ‚ç‚¹å­æ ‘çš„æ‰€æœ‰ $K$ æ¡¶ï¼Œå®ƒå°†è‡ªåŠ¨è·çŸ¥è·ç¦»ç»™å®š key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚å¯¹äºè¿™äº› $K$ æ¡¶çš„æ›´æ–°ä»£ä»·å¯ä»¥åˆ†æ‘Šç»™è®¸å¤š key çš„é‡æ–°å‘å¸ƒï¼ˆå¹³å‡è€Œè¨€ï¼Œè¿™æ ·å°±é™ä½äº†å•ä¸ª key é‡æ–°å‘å¸ƒæ—¶çš„ä»£ä»·ï¼‰ã€‚\n\nè¦ææ¸…æ¥šä¸ºä»€ä¹ˆåœ¨ $u$ æ›´æ–°è§„æ¨¡å¤§äºç­‰äº $k$ çš„å­æ ‘çš„æ‰€æœ‰ $K$ æ¡¶åä¸å†éœ€è¦èŠ‚ç‚¹æŸ¥è¯¢äº†ï¼Œéœ€è¦åˆ†ä¸ºä¸¤ç§æƒ…å†µã€‚å¦‚æœè¦è¢«å……å‘å¸ƒçš„ key åœ¨è¯¥å­æ ‘çš„ ID èŒƒå›´å†…ï¼Œé‚£ä¹ˆå› ä¸ºå­æ ‘çš„è§„æ¨¡è‡³å°‘ä¸º $k$ è€Œä¸” $u$ å…·æœ‰è¯¥å­æ ‘çš„å…¨éƒ¨çŸ¥è¯†ï¼Œæ˜¾ç„¶ $u$ è‚¯å®šçŸ¥é“è·ç¦» key çš„æœ€è¿‘ $k$ ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœè¦è¢«å……å‘å¸ƒçš„ key åœ¨è¯¥å­æ ‘çš„ ID èŒƒå›´å¤–ï¼Œå› ä¸º $u$ æ˜¯ $k$ ä¸ªè·ç¦» key æœ€è¿‘çš„èŠ‚ç‚¹ä¹‹ä¸€ï¼ˆå¦åˆ™ $u$ ä¸ä¼šå­˜å‚¨å…³äºè¯¥ key çš„ä¿¡æ¯ï¼‰ï¼Œæ˜¾ç„¶æ‰€æœ‰è·ç¦»è¯¥ key æ¯”è·ç¦»å­æ ‘æ›´è¿‘ä¸€äº›çš„ $K$ æ¡¶ä¸­çš„å…ƒç´ éƒ½å°‘äº $k$ã€‚å› æ­¤ï¼Œ$u$ å°†ä¼šçŸ¥æ™“æ‰€æœ‰è¿™äº› $K$ æ¡¶ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå†åŠ ä¸Šå…³äºå­æ ‘çš„çŸ¥è¯†ï¼Œå°±å¯ä»¥å¾—åˆ°è·ç¦»è¯¥ key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚\n\nå½“ä¸€ä¸ªæ–°èŠ‚ç‚¹åŠ å…¥ç½‘ç»œï¼Œå¯¹äºæ¯ä¸ª key-vaule å¯¹æ¥è¯´ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸ºå…¶ $k$ ä¸ªæœ€è¿‘èŠ‚ç‚¹ä¹‹ä¸€ï¼Œé‚£ä¹ˆå¿…é¡»å¯¹å…¶è¿›è¡Œå­˜å‚¨ã€‚ç½‘è·¯ä¸­åŸæœ‰çš„èŠ‚ç‚¹åŒæ ·å¯ä»¥é€šè¿‡å…¶è¾¹ç¼˜å­æ ‘çš„å®Œæ•´çŸ¥è¯†ï¼ŒçŸ¥é“å“ªäº› key-value å¯¹éœ€è¦å­˜å‚¨åœ¨è¯¥æ–°å¢èŠ‚ç‚¹ä¸Šã€‚æ¯ä¸ªäº†è§£åˆ°æ–°èŠ‚ç‚¹çš„èŠ‚ç‚¹éƒ½ä¼šå‘èµ· *STORE* è°ƒç”¨æŠŠç›¸å…³çš„ key-value å¯¹ä¼ é€åˆ°æ–°èŠ‚ç‚¹ä¹‹ä¸Šã€‚ä¸ºäº†é¿å…é‡å¤çš„ STORE è°ƒç”¨ ï¼Œåªæœ‰é‚£äº›è‡ªèº« ID æ¯”å…¶ä»–èŠ‚ç‚¹ ID æ›´æ¥è¿‘ key çš„èŠ‚ç‚¹æ‰ä¼šè¿›è¡Œ key-value å¯¹çš„ä¼ é€ã€‚\n\n## Sketch of Proofï¼ˆå¾…è¯‘ï¼‰\n\nå¾…ç¿»è¯‘\n\n## Implementation Notesï¼ˆå¾…è¯‘ï¼‰\n\nå¾…ç¿»è¯‘\n\n## Summaryï¼ˆæ€»ç»“ï¼‰\n\nç”±äºé‡‡ç”¨åŸºäº XOR åº¦é‡çš„æ‹“æ‰‘ï¼ŒKademlia æ˜¯ç¬¬ä¸€ä¸ªç»“åˆäº†å¯è¯æ˜çš„ä¸€è‡´æ€§ï¼Œæ€§èƒ½ï¼Œä½æ—¶å»¶è·¯ç”±ä»¥åŠå•å‘å¯¹ç§°æ‹“æ‰‘çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿã€‚Kademlia è¿˜å¼•å…¥äº†å¹¶å‘å‚æ•° $Î±$ï¼Œå®ƒå…è®¸äººä»¬åœ¨å¸¦å®½ä¸­äº¤æ¢å¸¸æ•°å› å­ï¼Œä»¥å®ç°å¼‚æ­¥æœ€ä½å»¶è¿Ÿè·¯ç”±é€‰æ‹©å’Œæ— å»¶è¿Ÿé”™è¯¯æ¢å¤ã€‚æœ€åï¼ŒKademlia æ˜¯ç¬¬ä¸€ä¸ªåˆ©ç”¨èŠ‚ç‚¹æ•…éšœä¸æ­£å¸¸è¿è¡Œæ—¶é—´æˆåæ¯”å…³ç³»è¿™ä¸€äº‹å®çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿã€‚\n\n# å‚è€ƒ\n\n1.  [Kademlia ï¼šä¸€ç§åŸºäº XOR åº¦é‡çš„ P2P ä¿¡æ¯ç³»ç»Ÿ](https://blog.csdn.net/hoping/article/details/5307320)\n2.  [P2Pç½‘ç»œ--Kademliaåè®®](http://www.huamo.online/2018/06/12/P2P%E7%BD%91%E7%BB%9C-Kademlia%E5%8D%8F%E8%AE%AE/)","slug":"dht-kademlia","published":1,"updated":"2020-07-18T06:30:19.515Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuhi000aw80vrjzc7up5","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>æœ¬æ–‡æ˜¯è®ºæ–‡ <a href=\"http://www.scs.stanford.edu/~dm/home/papers/kpos.pdf\" target=\"_blank\" rel=\"noopener\">Kademlia: A Peer-to-Peer Information System Based on the XOR Metric</a> çš„ç¿»è¯‘ã€‚</p>\n<a id=\"more\"></a>\n\n<h1 id=\"Kademliaï¼šä¸€ç§åŸºäº-XOR-è·ç¦»çš„-P2P-ä¿¡æ¯ç³»ç»Ÿ\"><a href=\"#Kademliaï¼šä¸€ç§åŸºäº-XOR-è·ç¦»çš„-P2P-ä¿¡æ¯ç³»ç»Ÿ\" class=\"headerlink\" title=\"Kademliaï¼šä¸€ç§åŸºäº XOR è·ç¦»çš„ P2P ä¿¡æ¯ç³»ç»Ÿ\"></a>Kademliaï¼šä¸€ç§åŸºäº XOR è·ç¦»çš„ P2P ä¿¡æ¯ç³»ç»Ÿ</h1><p>ä½œè€…ï¼šPetar Maymounkov ä»¥åŠ David MazieÌ€res</p>\n<h2 id=\"Abstractï¼ˆæ‘˜è¦ï¼‰\"><a href=\"#Abstractï¼ˆæ‘˜è¦ï¼‰\" class=\"headerlink\" title=\"Abstractï¼ˆæ‘˜è¦ï¼‰\"></a>Abstractï¼ˆæ‘˜è¦ï¼‰</h2><p>æˆ‘ä»¬æè¿°äº†ä¸€ç§åœ¨å®¹æ˜“å‡ºé”™çš„ç¯å¢ƒä¸‹ä»å…·æœ‰å¯è¯æ˜çš„å®¹é”™æ€§å’Œæ€§èƒ½çš„ P2P åˆ†å¸ƒå¼æ•£åˆ—è¡¨ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿä½¿ç”¨äº†ä¸€ç§åŸºäº XOR è·ç¦»çš„æ–°å‹æ‹“æ‰‘æ¥è·¯ç”±æŸ¥è¯¢ä¸å®šä½èŠ‚ç‚¹çš„éœ€æ±‚ï¼Œè¯¥æ‹“æ‰‘ç®€åŒ–äº†ç®—æ³•åŠç®—æ³•çš„è¯æ˜ã€‚è¯¥æ‹“æ‰‘æœ‰è¿™æ ·ä¸€ä¸ªç‰¹ç‚¹ï¼šæ¯æ¬¡ä¿¡æ¯äº¤æ¢éƒ½ä¼ é€’æˆ–è€…åŠ å¼ºäº†ï¼ˆèŠ‚ç‚¹é—´ï¼‰æœ‰æ•ˆè”ç³»ã€‚ç³»ç»Ÿæ ¹æ®è¿™ç§è”ç³»æ¥å‘é€å¹¶è¡Œå¼‚æ­¥æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»è€Œåšåˆ°å®¹å¿èŠ‚ç‚¹æ•…éšœåŒæ—¶ä¸å¯¹ç”¨æˆ·é€ æˆè¶…æ—¶ã€‚</p>\n<h2 id=\"Introductionï¼ˆä»‹ç»ï¼‰\"><a href=\"#Introductionï¼ˆä»‹ç»ï¼‰\" class=\"headerlink\" title=\"Introductionï¼ˆä»‹ç»ï¼‰\"></a>Introductionï¼ˆä»‹ç»ï¼‰</h2><p>æœ¬è®ºæ–‡æè¿° Kademlia â€”â€” ä¸€ä¸ª P2P åˆ†å¸ƒå¼æ•£åˆ—è¡¨ï¼ˆDHTï¼‰ã€‚Kademlia æœ‰è®¸å¤šä¹‹å‰çš„ DHT æ— æ³•åŒæ—¶æä¾›çš„ç†æ€§åŠŸèƒ½ã€‚å®ƒæœ€å¤§é™åº¦åœ°å‡å°‘äº†èŠ‚ç‚¹å¿…é¡»å‘é€çš„ç”¨äºäº’ç›¸äº†è§£çš„é…ç½®æ¶ˆæ¯æ•°é‡ã€‚æŸ¥æ‰¾ Key æ—¶é™„å¸¦è‡ªåŠ¨ä¼ æ’­é…ç½®ä¿¡æ¯ã€‚èŠ‚ç‚¹å…·æœ‰è¶³å¤Ÿçš„è®¤çŸ¥ä¸çµæ´»æ€§æ¥é€šè¿‡ä½å»¶è¿Ÿè·¯å¾„è·¯ç”±æŸ¥è¯¢ã€‚Kademlia ä½¿ç”¨å¹¶è¡Œå¼‚æ­¥æŸ¥è¯¢æ¥é¿å…æ¥è‡ªå¤±è´¥èŠ‚ç‚¹çš„è¶…æ—¶å»¶è¿Ÿã€‚èŠ‚ç‚¹è®°å½•å…¶ä»–èŠ‚ç‚¹çš„å­˜åœ¨ä»¥é˜»æŒ¡æŸäº›åŸºæœ¬çš„æ‹’ç»æœåŠ¡æ”»å‡»ã€‚æœ€åï¼Œåªè¦å¯¹è¿è¡Œæ—¶é—´è¿›è¡Œç®€å•çš„å‡è®¾å°±å¯ä»¥å¯¹ Kademlia çš„å‡ ä¸ªé‡è¦ç‰¹æ€§è¿›è¡Œæ­£å¼è¯æ˜ã€‚</p>\n<p>Kademlia é‡‡ç”¨äº†è®¸å¤š DHT ä½¿ç”¨çš„åŸºæœ¬æ–¹æ³•ã€‚å¯†é’¥ä½¿ç”¨ä¸é€æ˜çš„ 160 ä½ç©ºé—´ï¼Œæ¯”å¦‚ SHA-1 æ•£åˆ—ã€‚å‚ä¸çš„è®¡ç®—æœºåœ¨ 160 ä½å¯†é’¥ç©ºé—´ä¸­éƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹ IDã€‚<strong>key-value é”®å€¼å¯¹å­˜å‚¨åœ¨é‚£äº› ID â€œæ¥è¿‘â€ key çš„èŠ‚ç‚¹ä¸Š</strong>ã€‚æœ€ç»ˆï¼Œä¸€ä¸ªåŸºäºèŠ‚ç‚¹ ID çš„è·¯ç”±ç®—æ³•ä½¿å¾—ä»»ä½•èŠ‚ç‚¹å¯ä»¥é€šè¿‡ç»™å‡ºçš„ç›®æ ‡ key æœ‰æ•ˆåœ°å®šä½ key é™„è¿‘çš„èŠ‚ç‚¹ã€‚</p>\n<p>Kademlia çš„ä¼—å¤šä¼˜ç‚¹å¾—ç›Šäºå®ƒåˆ›æ–°åœ°ä½¿ç”¨ XOR æ¥åº¦é‡èŠ‚ç‚¹é—´çš„è·ç¦»ã€‚XOR æ˜¯å¯¹ç§°çš„ï¼Œå…è®¸ Kademlia æ¥æ”¶æ¥è‡ªé‚£äº›æ‹¥æœ‰å®Œå…¨ç›¸åŒçš„è·¯ç”±è¡¨ä¿¡æ¯çš„èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚ã€‚åƒæ˜¯ Chord è¿™æ ·æ²¡æœ‰è¿™ç§ç‰¹æ€§çš„ç³»ç»Ÿå°±æ— æ³•ä»æŸ¥è¯¢è¯·æ±‚ä¸­è·å–æœ‰ç”¨çš„è·¯ç”±ä¿¡æ¯ã€‚ç”šè€…ï¼Œä¸å¯¹ç§°ä¼šå¯¼è‡´ä¸¥æ ¼çš„è·¯ç”±è¡¨ã€‚åœ¨ Chord ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¿…é¡»å­˜å‚¨ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p>\n<p>ä¸ºäº†å®šä½æ¥è¿‘ç‰¹å®š ID çš„èŠ‚ç‚¹ï¼ŒKademlia è‡ªå§‹è‡³ç»ˆä»…ä½¿ç”¨ä¸€ä¸ªè·¯ç”±ç®—æ³•ã€‚ç›¸åï¼Œå…¶ä»–ç³»ç»Ÿä½¿ç”¨ä¸€ç§ç®—æ³•æ¥æ¥è¿‘ç›®æ ‡ IDï¼Œä½¿ç”¨å¦ä¸€ç§ç®—æ³•æ¥å®Œæˆæœ€åå‡ è·³ã€‚åœ¨ç°æœ‰çš„ç³»ç»Ÿä¸­ï¼ŒKademlia æœ€åƒ Pastry çš„ç¬¬ä¸€é˜¶æ®µï¼Œè™½ç„¶ä½œè€…æ²¡æœ‰ç”¨è¿™ç§æ–¹å¼æè¿°ï¼Œä½†æ˜¯é€šè¿‡ Kademlia çš„ XOR è·ç¦»å‘ç°ç›®æ ‡ ID çš„èŠ‚ç‚¹æ•°å¯ä»¥å‡å°‘ä¸€åŠã€‚åœ¨ Pastry çš„ç¬¬äºŒé˜¶æ®µï¼Œå®ƒå°†è·ç¦»åº¦é‡åˆ‡æ¢ä¸º ID é—´çš„æ•°å­—å·®å¼‚ã€‚å®ƒè¿˜åœ¨å¤åˆ¶ä¸­ä½¿ç”¨ç¬¬äºŒä¸ªæ•°å­—å·®å¼‚åº¦é‡ã€‚é—æ†¾çš„æ˜¯ï¼Œç¬¬äºŒä¸ªåº¦é‡æ ‡å‡†ä¸­ç›¸è·è¾ƒè¿‘çš„èŠ‚ç‚¹åœ¨ç¬¬ä¸€ä¸ªåº¦é‡æ ‡å‡†ä¸­åˆ™å¯èƒ½ç›¸å·®å¾ˆè¿œï¼Œä»¥è‡´åœ¨ç‰¹å®šèŠ‚ç‚¹ ID å€¼å¤„äº§ç”Ÿäº†ä¸è¿ç»­æ€§ï¼Œä»è€Œé™ä½äº†æ€§èƒ½ï¼Œå¹¶ä½¿å¾—å¯¹æœ€åæƒ…å†µè¡Œä¸ºçš„æ­£å¼åˆ†æå˜å¾—å¤æ‚ã€‚</p>\n<h2 id=\"System-Descriptionï¼ˆç³»ç»Ÿæè¿°ï¼‰\"><a href=\"#System-Descriptionï¼ˆç³»ç»Ÿæè¿°ï¼‰\" class=\"headerlink\" title=\"System Descriptionï¼ˆç³»ç»Ÿæè¿°ï¼‰\"></a>System Descriptionï¼ˆç³»ç»Ÿæè¿°ï¼‰</h2><p>ä¸å…¶ä»– DHT ç›¸åŒç±»ä¼¼ï¼ŒKademlia ç»™èŠ‚ç‚¹åˆ†é…ä¸€ä¸ª 160 ä½çš„é€æ˜ IDï¼Œå¹¶æä¾›ä¸€ä¸ªæŸ¥è¯¢ç®—æ³•ç”¨ä»¥å®šä½æ›´åŠ æ¥è¿‘æŒ‡å®šèŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œä»¥å¯¹æ•°çº§åˆ«æ”¶æ•›æŸ¥è¯¢åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚</p>\n<p>Kademlia é«˜æ•ˆåœ°å°†èŠ‚ç‚¹ä½œä¸ºä¸€ä¸ªäºŒå‰æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ä½ç½®å–å†³äºå…¶ ID çš„æœ€çŸ­å”¯ä¸€å‰ç¼€ã€‚å›¾ä¸€å±•ç¤ºäº†å”¯ä¸€å‰ç¼€ä¸º 0011 çš„èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®ã€‚å¯¹äºä»»ä¸€ç»™å®šçš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°†äºŒå‰æ ‘åˆ†ä¸ºä¸€ç³»åˆ—è¿ç»­çš„ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„å­æ ‘ã€‚æœ€é«˜çš„å­æ ‘ç”±ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„æ•´ä¸ªäºŒå‰æ ‘çš„ä¸€åŠç»„æˆã€‚æ¥ä¸‹æ¥çš„å­æ ‘ç”±ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„å‰©ä½™äºŒå‰æ ‘çš„ä¸€èˆ¬ç»„æˆã€‚åœ¨å›¾ç¤ºä¸­ï¼ŒèŠ‚ç‚¹ 0011 çš„æ‰€æœ‰å­æ ‘è¢«åœˆå‡ºï¼ŒæŒ‰ç…§é«˜åº¦ç”±é«˜åˆ°ä½æ’åºï¼Œå‰ç¼€åˆ†åˆ«æ˜¯ 0, 01, 000 ä»¥åŠ 0010ã€‚</p>\n<p><img src=\"kademlia-1.png\" alt=\"å›¾ä¸€ï¼šKademlia äºŒå‰æ ‘ã€‚é»‘è‰²çš„ç‚¹è¡¨ç¤ºèŠ‚ç‚¹ 0011Â·Â·Â· çš„ä½ç½®ï¼›ç°è‰²çš„åœˆè¡¨ç¤ºèŠ‚ç‚¹ 0011Â·Â·Â· å¿…é¡»ä¸ä¹‹å»ºç«‹è”ç³»çš„å­æ ‘ã€‚\"></p>\n<p>Kademlia åè®®ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥æ™“å…¶æ¯ä¸ªå­æ ‘ä¸­çš„è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹ã€‚æœ‰äº†è¿™ä¸ªä¿è¯ï¼Œä»»ä¸€èŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡ ID å®šä½åˆ°å¦å¤–çš„èŠ‚ç‚¹ã€‚å›¾äºŒå±•ç¤ºäº†èŠ‚ç‚¹ 0011 é€šè¿‡ä¸æ–­åœ¨å­æ ‘ä¸­æŸ¥è¯¢æœ€ä½³å®ƒæ‰€çŸ¥æ™“çš„æœ€ä½³èŠ‚ç‚¹çš„æ–¹å¼æœ€ç»ˆæ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ 1110 çš„è¿‡ç¨‹ã€‚</p>\n<p><img src=\"kademlia-2.png\" alt=\"å›¾äºŒï¼šé€šè¿‡ ID å®šä½èŠ‚ç‚¹ã€‚å‰ç¼€ä¸º 0011 çš„èŠ‚ç‚¹é€šè¿‡ä¾æ¬¡çŸ¥æ™“ä¸æŸ¥è¯¢è¶Šæ¥è¶Šè¿‘çš„èŠ‚ç‚¹ä»è€Œæ‰¾åˆ°å‰ç¼€ä¸º 1110 çš„èŠ‚ç‚¹ã€‚å›¾ä¸Šæ–¹çš„çº¿ä»£è¡¨äº† 160 æ¯”ç‰¹çš„ ID ç©ºé—´ï¼Œå¹¶ä¸”å±•ç¤ºäº†æŸ¥è¯¢åˆ°ç›®æ ‡èŠ‚ç‚¹çš„æ•´ä¸ªè¿‡ç¨‹ã€‚å›¾çš„ä¸»ä½“ç”»å‡ºäº†èŠ‚ç‚¹ 1110 å‘å‡ºçš„ RPC æ¶ˆæ¯ï¼Œç¬¬ä¸€ä¸ª RPC æ¶ˆæ¯å‘é€ç»™ 101ï¼Œåç»­çš„ RPC æ¶ˆæ¯å‘é€ç»™å‰ä¸€ä¸ª RPC æ¶ˆæ¯è¿”å›çš„èŠ‚ç‚¹ã€‚\"></p>\n<p>æœ¬èŠ‚çš„å‰©ä½™éƒ¨åˆ†è¡¥å……äº†æŸ¥æ‰¾ç®—æ³•çš„å…·ä½“ç»†èŠ‚ã€‚æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªç²¾ç¡®çš„æ¦‚å¿µæ¥æè¿°èŠ‚ç‚¹é—´çš„è·ç¦»ï¼Œè®©æˆ‘ä»¬æŒ‡å‡ºè·ç¦»æŸä¸ª key æœ€è¿‘çš„ k ä¸ªèŠ‚ç‚¹æä¾›äº†å¯èƒ½ã€‚ç„¶åç»™å‡ºä¸€ä¸ªæŸ¥è¯¢åè®®ï¼Œå³ä½¿æ²¡æœ‰èŠ‚ç‚¹ä¸ç»™å®šçš„ key æ‹¥æœ‰ç›¸åŒçš„å”¯ä¸€å‰ç¼€æˆ–è€…ç»™å®šèŠ‚ç‚¹çš„ä¸€äº›å­æ ‘æ˜¯ç©ºçš„ï¼Œè¿™ä¸ªåè®®ä»ç„¶æ˜¯å¯å·¥ä½œçš„ã€‚</p>\n<h3 id=\"XOR-Metricï¼ˆXOR-åº¦é‡ï¼‰\"><a href=\"#XOR-Metricï¼ˆXOR-åº¦é‡ï¼‰\" class=\"headerlink\" title=\"XOR Metricï¼ˆXOR åº¦é‡ï¼‰\"></a>XOR Metricï¼ˆXOR åº¦é‡ï¼‰</h3><p>æ¯ä¸ª Kademlia èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª 160 æ¯”ç‰¹çš„èŠ‚ç‚¹ IDã€‚èŠ‚ç‚¹ ID ç›®å‰åªæ˜¯éšæœºçš„ 160 ä½æ ‡è¯†ç¬¦ï¼Œå°½ç®¡å®ƒä»¬åŒæ ·å¯ä»¥åƒåœ¨ Chord ä¸­é‚£æ ·æ„é€ ã€‚èŠ‚ç‚¹å‘é€çš„æ¯æ¡æ¶ˆæ¯éƒ½åŒ…å«å…¶èŠ‚ç‚¹IDï¼Œå…è®¸æ¥æ”¶æ–¹åœ¨å¿…è¦æ—¶è®°å½•å‘é€æ–¹çš„å­˜åœ¨ã€‚</p>\n<p>é”®åŒæ ·æ˜¯ 160 ä½æ ‡è¯†ç¬¦ã€‚ä¸ºäº†ç»™ç‰¹å®šçš„èŠ‚ç‚¹åˆ†é… key-value é”®å€¼å¯¹ï¼ŒKademlia ä¾èµ–ä¸¤ä¸ªæ ‡è¯†ç¬¦ä¹‹é—´çš„è·ç¦»çš„åº¦é‡ã€‚ç»™å‡ºä¸¤ä¸ª 160 ä½çš„æ ‡è¯†ç¬¦ $x$ å’Œ $y$ï¼ŒKademlia å°† $x$ ä¸ $y$ çš„è·ç¦»å®šä¹‰ä¸º $x$ ä¸ $y$ æŒ‰ä½å¼‚æˆ–åçš„æ•´æ•°å€¼ï¼Œå³ $d(x, y) = x \\oplus y$ã€‚</p>\n<p>æˆ‘ä»¬é¦–å…ˆæ³¨æ„åˆ° XOR è¿ç®—æ˜¯æœ‰æ•ˆçš„ï¼Œå°½ç®¡å±äºéæ¬§å‡ é‡Œå¾·è·ç¦»ã€‚å¼‚æˆ–è¿ç®—æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p>\n<ul>\n<li>$$d(x, x) = 0$$</li>\n<li>$$d(x, y)&gt;0, \\text{ if } x \\neq y$$</li>\n<li>$$\\forall x, y:d(x, y)=d(y, x)$$</li>\n<li>$$d(x,y)+d(y,z) \\geq d(x,z)$$</li>\n<li>$$d(x,y) \\oplus d(y,z) = d(x,z)$$</li>\n<li>$$\\forall a \\geq 0, b \\geq 0: a+b \\geq a \\oplus b$$</li>\n</ul>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ³¨æ„åˆ°å¼‚æˆ–åº¦é‡åˆ»ç”»äº†åŸºäºäºŒå‰æ ‘çš„ç³»ç»Ÿè‰å›¾ä¸­éšå«çš„è·ç¦»æ¦‚å¿µã€‚åœ¨ 160 ä½ ID å®Œå…¨å¡«å……çš„äºŒå‰æ ‘ä¸­ï¼Œä¸¤ä¸ª ID é—´è·ç¦»å¤§å°æ˜¯åŒ…å«å®ƒä»¬çš„æœ€å°å­æ ‘çš„é«˜åº¦ã€‚å½“æ ‘æœªå®Œå…¨å¡«æ»¡æ—¶ï¼Œä¸ ID $x$ æœ€æ¥è¿‘çš„èŠ‚ç‚¹æ˜¯èŠ‚ç‚¹ ID ä¸ $x$ å…±äº«æœ€é•¿å…¬å…±å‰ç¼€çš„èŠ‚ç‚¹ã€‚å¦‚æœæ ‘ä¸­æœ‰ç©ºåˆ†æ”¯ï¼Œåˆ™å¯èƒ½æœ‰å¤šä¸ªå¶å­èŠ‚ç‚¹å…·æœ‰æœ€é•¿çš„å…¬å…±å‰ç¼€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ $x$ æœ€æ¥è¿‘çš„å¶å­å°†å˜ä¸ºç¦»é€šè¿‡ç¿»è½¬ $x$ ä¸­å¯¹åº”äºæ ‘çš„ç©ºåˆ†æ”¯ä¸­çš„ä½å¾—åˆ°çš„ $\\widetilde{x}$ æœ€è¿‘çš„å¶å­ã€‚</p>\n<p>ç±»ä¼¼äº Chord ç®—æ³•çš„é¡ºæ—¶é’ˆåœ†å‘¨åº¦é‡ï¼ŒXOR ä¹Ÿæ˜¯å•å‘çš„ã€‚å¯¹äºä»»æ„ç»™å®šçš„ç‚¹ $x$ ä»¥åŠ $âˆ† &gt; 0$ï¼Œä»…å­˜åœ¨ä¸€ä¸ªç‚¹ $y$ ä½¿å¾— $d(x, y) = âˆ†$ã€‚å•å‘æ€§ä¿è¯äº†å¯¹äºç›¸åŒçš„ keyï¼Œæ— è®ºä»å“ªä¸ªåŸç‚¹å¼€å§‹æŸ¥è¯¢ï¼Œéƒ½ä¼šæ²¿ç€ç›¸åŒçš„è·¯å¾„è¿›è¡Œæ”¶æ•›ã€‚è¿™æ ·ï¼Œæ²¿ç€æŸ¥è¯¢è·¯å¾„ç¼“å­˜ key-value é”®å€¼å¯¹å°±èƒ½å‡è½»å­˜æ”¾çƒ­é—¨ key å€¼èŠ‚ç‚¹çš„å‹åŠ›ã€‚ç±»ä¼¼äº Pastry è€Œä¸åŒäº Chordï¼Œ XOR æ‹“æ‰‘æ˜¯å¯¹ç§°çš„ã€‚</p>\n<h3 id=\"Node-Stateï¼ˆèŠ‚ç‚¹çŠ¶æ€ï¼‰\"><a href=\"#Node-Stateï¼ˆèŠ‚ç‚¹çŠ¶æ€ï¼‰\" class=\"headerlink\" title=\"Node Stateï¼ˆèŠ‚ç‚¹çŠ¶æ€ï¼‰\"></a>Node Stateï¼ˆèŠ‚ç‚¹çŠ¶æ€ï¼‰</h3><p>Kademlia èŠ‚ç‚¹å­˜å‚¨äº†å…¶ä»–èŠ‚ç‚¹è”ç³»äººçš„ä¿¡æ¯ä»¥è·¯ç”±æŸ¥è¯¢æ¶ˆæ¯ã€‚å¯¹äºæ¯ä¸ª $0 \\leq i &lt; 160$ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ„å»ºä¸€ä¸ªï¼ˆIP åœ°å€ï¼ŒUDP ç«¯å£ï¼ŒèŠ‚ç‚¹ IDï¼‰çš„ä¸‰å…ƒç»„åˆ—è¡¨ç”¨æ¥å­˜å‚¨ä¸è¯¥èŠ‚ç‚¹ç›¸è· $[2^i$, $2^{i+1})$ çš„èŠ‚ç‚¹ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸º $K$ æ¡¶ã€‚æ¯ä¸ª $K$ æ¡¶å†…èŠ‚ç‚¹æ ¹æ®èŠ‚ç‚¹æœ€åå¯è§æ—¶é—´è¿›è¡Œæ’åºï¼Œæœ€æ—©å¯è§çš„æ”¾ç½®åœ¨å¼€å¤´ï¼Œæœ€è¿‘å¯è§çš„æ”¾ç½®åœ¨æœ«å°¾ã€‚å¯¹äºè¾ƒå°çš„ $i$ å€¼ï¼Œ$K$ æ¡¶é€šå¸¸æ˜¯ç©ºçš„ï¼ˆå› ä¸ºä¸å­˜åœ¨åˆé€‚çš„èŠ‚ç‚¹ï¼‰ã€‚å¯¹äºè¾ƒå¤§çš„ $i$ å€¼ï¼Œåˆ—è¡¨æœ€å¤§å®¹é‡ä¸º $k$ï¼Œ$k$ æ˜¯ä¸€ä¸ªç³»ç»ŸèŒƒå›´å†…çš„å¤åˆ¶å‚æ•°ã€‚ä»…å½“ä»»æ„ç»™å®šçš„ $k$ ä¸ªèŠ‚ç‚¹ä¸ä¼šåœ¨ä¸€ä¸ªå°æ—¶å†…åŒæ—¶å¤±æ•ˆæ—¶ï¼Œ$k$ å€¼æ‰æœ‰æ•ˆï¼Œä¾‹å¦‚ $k = 20$ã€‚</p>\n<p>å½“ä¸€ä¸ª Kademlia èŠ‚ç‚¹æ”¶åˆ°ä»»ä¸€æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„è¯·æ±‚æˆ–è€…å›å¤æ¶ˆæ¯ï¼Œå®ƒä¼šæ ¹æ®å‘é€è€…çš„èŠ‚ç‚¹ ID æ›´æ–° $K$ æ¡¶ã€‚è§„åˆ™å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>å¦‚æœå‘é€èŠ‚ç‚¹å·²ç»å­˜åœ¨æ¥æ”¶æ–¹çš„ $K$ æ¡¶ä¸­ï¼š<ul>\n<li>æ¥æ”¶æ–¹å°†å‘é€èŠ‚ç‚¹ç§»åŠ¨åˆ°ç›¸åº” $K$ æ¡¶çš„å°¾éƒ¨ï¼›</li>\n</ul>\n</li>\n<li>å¦‚æœå‘é€èŠ‚ç‚¹å¹¶æœªå­˜åœ¨æ¥æ”¶æ–¹çš„ $K$ æ¡¶ä¸­ï¼š<ul>\n<li>å¦‚æœ $K$ æ¡¶ä¸­èŠ‚ç‚¹æ•°é‡å°‘äº $k$ ä¸ªï¼Œåˆ™ç›´æ¥å°†å‘é€èŠ‚ç‚¹æ’å…¥è‡³ $K$ æ¡¶å°¾éƒ¨ï¼›</li>\n<li>å¦‚æœ $K$ æ¡¶å·²æ»¡ï¼š<ul>\n<li>å¦‚æœæœ€æ—©å¯è§çš„èŠ‚ç‚¹ä¸èƒ½ ping é€šï¼Œåˆ™ç§»é™¤è¯¥èŠ‚ç‚¹ï¼Œç„¶åå°†å‘é€èŠ‚ç‚¹æ’å…¥è‡³ $K$ æ¡¶å°¾éƒ¨ï¼›</li>\n<li>å¦‚æœæœ€æ—©å¯è§çš„èŠ‚ç‚¹å¯ä»¥ ping é€šï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°å°¾éƒ¨ï¼Œç„¶åä¸¢å¼ƒå‘é€èŠ‚ç‚¹ï¼›</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>$K$ æ¡¶é«˜æ•ˆåœ°å®ç°äº† LRU ç®—æ³•ï¼Œåªæ˜¯æ´»åŠ¨çš„èŠ‚ç‚¹æ°¸è¿œä¸ä¼šä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚è¿™ç§å¯¹ä¸æ—§è”ç³»äººçš„åå¥½æ¥è‡ªäºæˆ‘ä»¬çš„å¯¹äº Saroiu ç­‰äººä» Gnutella ç½‘ç»œæ”¶é›†çš„è¿½è¸ªæ•°æ®çš„åˆ†æã€‚å›¾ 3 å±•ç¤ºäº† Gnutella èŠ‚ç‚¹éšç€å½“å‰æ—¶é—´çš„æ¨ç§»ï¼Œé¢å¤–åœ¨çº¿ä¸€ä¸ªå°æ—¶çš„å¯èƒ½æ€§ã€‚ä¸€ä¸ªèŠ‚ç‚¹åœ¨çº¿æ—¶é—´è¶Šé•¿ï¼Œå®ƒå°±è¶Šå¯èƒ½ç»§ç»­é¢å¤–åœ¨çº¿ä¸€ä¸ªå°æ—¶ã€‚é€šè¿‡ä¿æŒæœ€è€çš„åœ¨çº¿èŠ‚ç‚¹ï¼Œ$K$ æ¡¶æœ€å¤§åŒ–äº†åˆ—è¡¨ä¸­èŠ‚ç‚¹åœ¨çº¿çš„å¯èƒ½æ€§ã€‚</p>\n<p><img src=\"kademlia-3.png\" alt=\"å›¾ä¸‰ï¼šé¢å¤–ä¿æŒä¸€å°æ—¶åœ¨çº¿çš„å¯èƒ½æ€§å…³äºæ—¶é—´çš„å‡½æ•°ã€‚X è½´ä»£è¡¨åˆ†é’Ÿï¼ŒY è½´è¡¨ç¤ºä¿æŒåœ¨çº¿ $x$ åˆ†é’Ÿçš„èŠ‚ç‚¹ç»§ç»­ä¿æŒåœ¨çº¿åˆ° $x + 60$ åˆ†é’Ÿæ—¶åˆ»çš„å¯èƒ½æ€§\"></p>\n<p>$K$ æ¡¶é‡‡ç”¨è¿™æ ·çš„æ›´æ–°ç­–ç•¥çš„å¦ä¸€ä¸ªä¼˜ç‚¹åœ¨äºå¯ä»¥æŠµæŒ¡ç‰¹å®šçš„ DoS æ”»å‡»ã€‚æ”»å‡»è€…ä¸èƒ½ä½¿ç”¨æ–°çš„èŠ‚ç‚¹æ³›æ´ªç³»ç»Ÿæ¥åˆ·æ–°èŠ‚ç‚¹çš„è·¯ç”±çŠ¶æ€ã€‚åªæœ‰å½“æ—§çš„èŠ‚ç‚¹ç¦»å¼€äº†ç³»ç»Ÿï¼ŒKademlia æ‰ä¼šæ’å…¥æ–°çš„èŠ‚ç‚¹ã€‚</p>\n<h3 id=\"Kademlia-protocolï¼ˆKademlia-åè®®ï¼‰\"><a href=\"#Kademlia-protocolï¼ˆKademlia-åè®®ï¼‰\" class=\"headerlink\" title=\"Kademlia protocolï¼ˆKademlia åè®®ï¼‰\"></a>Kademlia protocolï¼ˆKademlia åè®®ï¼‰</h3><p>Kademlia åè®®ç”±å››ä¸ª RPC è°ƒç”¨ç»„æˆï¼š<em>PING</em>, <em>STORE</em>, <em>FIND_NODE</em>, <em>FIND_VALUE</em>ã€‚</p>\n<ul>\n<li><em>PING</em> ç”¨äºæ¢æµ‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦åœ¨çº¿ã€‚</li>\n<li><em>STORE</em> ç”¨äºé€šçŸ¥ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€ä¸ª key-value å¯¹ä»¥ä¾¿ä¹‹åè·å–ã€‚</li>\n<li><em>FIND_NODE</em> ä½¿ç”¨ä¸€ä¸ª 160 æ¯”ç‰¹çš„ ID ä½œä¸ºå‚æ•°ã€‚è°ƒç”¨å¯¹è±¡è¿”å›ä¸€ä¸ªå…¶çŸ¥æ™“çš„è·ç¦»ç›®æ ‡ ID æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ä¿¡æ¯ &lt;IP åœ°å€ï¼ŒUDP ç«¯å£ï¼ŒèŠ‚ç‚¹ ID&gt; ä¸‰å…ƒç»„ã€‚è¿™ $k$ ä¸ªä¸‰å…ƒç»„å¯èƒ½æ¥è‡ªå•ä¸ª $K$ æ¡¶ï¼Œä¹Ÿå¯èƒ½å› ä¸ºè·ç¦»æœ€è¿‘çš„ $K$ æ¡¶æœªæ»¡è€Œå–è‡ªå¤šä¸ª $K$ æ¡¶ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼ŒRPC è°ƒç”¨æ¥æ”¶è€…å¿…é¡»è¿”å› $k$ ä¸ªèŠ‚ç‚¹ï¼Œé™¤éè¯¥èŠ‚ç‚¹çŸ¥æ™“èŠ‚ç‚¹æ€»æ•°å°äº $k$ ä¸ªã€‚</li>\n<li><em>FIND_VALUE</em> è°ƒç”¨å’Œ <em>FIND_NODE</em> ä¸€æ ·ï¼Œä¸è¿‡å½“è°ƒç”¨çš„æ¥æ”¶è€…å­˜æœ‰è¯·æ±‚è€…æ‰€è¯·æ±‚çš„é”®çš„æ—¶å€™ï¼Œå®ƒå°†è¿”å›ç›¸åº”é”®çš„å€¼ã€‚</li>\n</ul>\n<p>åœ¨æ‰€æœ‰çš„ RPC ä¸­ï¼Œæ¥æ”¶è€…å¿…é¡»è¿”å›ä¸€ä¸ª 160 æ¯”ç‰¹çš„éšæœº RPC IDï¼Œä»¥é˜²æ­¢åœ°å€ä¼ªé€ ï¼ˆï¼Ÿï¼‰ã€‚å¯ä»¥å°† PING æ¶ˆæ¯é™„åŠ åœ¨ RPC æ¶ˆæ¯çš„å›å¤ä¸­ä»¥ç¡®å®šå‘é€è€…çš„ç½‘ç»œåœ°å€ã€‚</p>\n<h4 id=\"ä¸´è¿‘-ID-èŠ‚ç‚¹æŸ¥æ‰¾\"><a href=\"#ä¸´è¿‘-ID-èŠ‚ç‚¹æŸ¥æ‰¾\" class=\"headerlink\" title=\"ä¸´è¿‘ ID èŠ‚ç‚¹æŸ¥æ‰¾\"></a>ä¸´è¿‘ ID èŠ‚ç‚¹æŸ¥æ‰¾</h4><p>Kademlia èŠ‚ç‚¹éœ€è¦å®ç°çš„æœ€é‡è¦çš„è¿‡ç¨‹å°±æ˜¯æ ¹æ®ä¸€ä¸ªèŠ‚ç‚¹ ID æ‰¾åˆ°ä¸å®ƒæœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªè¿‡ç¨‹ä¸º <em>èŠ‚ç‚¹æŸ¥æ‰¾</em>ï¼ŒKademlia ä½¿ç”¨é€’å½’å®Œæˆè¿™ä¸ªå·¥ä½œã€‚ç”±æŸ¥æ‰¾éœ€æ±‚çš„èµ·å§‹èŠ‚ç‚¹å…ˆä»ç¦»ç›®æ ‡èŠ‚ç‚¹ ID æœ€è¿‘çš„éç©º $K$ æ¡¶ä¸­å–å‡º $Î±$ ä¸ªèŠ‚ç‚¹ï¼ˆå¦‚æœ $K$ æ¡¶ä¸­èŠ‚ç‚¹ä¸è¶³ $Î±$ ä¸ªï¼Œåˆ™ä»å…¶ä»– $K$ æ¡¶ä¸­å–æ»¡ $Î±$ ä¸ªï¼‰ã€‚èµ·å§‹æ¥åœ°å¹¶è¡Œå‘è¿™ $Î±$ ä¸ªèŠ‚ç‚¹å‘é€ <em>FIND_NODE</em> RPC è°ƒç”¨ã€‚$Î±$ æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§å‚æ•°ï¼Œä¾‹å¦‚ 3ã€‚</p>\n<p>åœ¨é€’å½’è°ƒç”¨é˜¶æ®µï¼Œåˆå§‹èŠ‚ç‚¹æ ¹æ® $Î±$ ä¸ªèŠ‚ç‚¹è¿”å›çš„èŠ‚ç‚¹åˆ—è¡¨å†æ¬¡å‘é€ <em>FIND_NODE</em> è¯·æ±‚ï¼ˆé€’å½’è°ƒç”¨åœ¨æ‰€æœ‰ $Î±$ ä¸ªèŠ‚ç‚¹å®Œæˆè¿”å›å‰å°±å¯ä»¥å¼€å§‹ï¼‰ã€‚èµ·å§‹èŠ‚ç‚¹ä»å…¶ä»–èŠ‚ç‚¹è¿”å›çš„å¤§å°ä¸º $k$ çš„èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰å‡º $Î±$ ä¸ªä¹‹å‰æ²¡æœ‰æŸ¥è¯¢è¿‡çš„èŠ‚ç‚¹ï¼Œå‘å®ƒä»¬å‘é€ <em>FIND_NODE</em> RPC è°ƒç”¨ã€‚å¤±è´¥çš„èŠ‚ç‚¹å°†ä¸å†ä¼šçº³å…¥è€ƒè™‘èŒƒå›´ã€‚å¦‚æœæœ‰ä¸€è½® <em>FIND_NODE</em> è°ƒç”¨ä¸­è¿”å›çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸æ¯”ä¹‹å‰çŸ¥æ™“çš„ $k$ ä¸ªèŠ‚ç‚¹æ›´åŠ æ¥è¿‘ï¼Œåˆ™å½“åˆå§‹èŠ‚ç‚¹å®Œæˆå¯¹æœ€è¿‘çš„è¿™ä¸ª $k$ ä¸ªèŠ‚ç‚¹çš„æŸ¥è¯¢å¹¶å¾—åˆ°å“åº”ä¹‹åï¼ŒæŸ¥è¯¢ç»“æŸã€‚å½“ $a=1$ï¼ŒæŸ¥è¯¢ç®—æ³•åœ¨ä¿¡æ¯å¼€é”€å’Œæ•…éšœèŠ‚ç‚¹çš„æ£€æŸ¥å»¶è¿Ÿä¸Šä¸ Chord ç±»ä¼¼ã€‚ä½†æ˜¯ Kademlia å¯ä»¥çµæ´»åœ°ä» $k$ ä¸ªèŠ‚ç‚¹ä¸­é€‰æ‹©ä»»ä¸€ä¸€ä¸ªå‘é€è¯·æ±‚ä»¥é™ä½æŸ¥è¯¢å»¶è¿Ÿã€‚</p>\n<h4 id=\"å­˜å‚¨é”®å€¼å¯¹ä¸é‡æ–°å‘å¸ƒæ—¶é—´\"><a href=\"#å­˜å‚¨é”®å€¼å¯¹ä¸é‡æ–°å‘å¸ƒæ—¶é—´\" class=\"headerlink\" title=\"å­˜å‚¨é”®å€¼å¯¹ä¸é‡æ–°å‘å¸ƒæ—¶é—´\"></a>å­˜å‚¨é”®å€¼å¯¹ä¸é‡æ–°å‘å¸ƒæ—¶é—´</h4><p>ä¸Šè¿°æŸ¥è¯¢è¿‡ç¨‹å®ç°äº†å¤§éƒ¨åˆ†çš„æ“ä½œã€‚ä¸ºäº†å­˜å‚¨ä¸€ä¸ª key-value å¯¹ï¼Œèµ·å§‹èŠ‚ç‚¹é€šè¿‡ä¸Šè¿°æ“ä½œå®šä½åˆ° $k$ ä¸ªç¦» key æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œå¹¶å‘å®ƒä»¬å‘é€ <em>STORE</em> è°ƒç”¨ã€‚å¦å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šåœ¨éœ€è¦çš„æƒ…å†µä¸‹é‡æ–°å‘å¸ƒ key-value ä»¥ä½¿ key-value æŒç»­å­˜åœ¨ã€‚åœ¨ Kademlia å½“å‰çš„åº”ç”¨ä¸­ï¼ˆæ–‡ä»¶åˆ†äº«ï¼‰ï¼Œkey-value çš„åŸå§‹å‘å¸ƒè€…éœ€è¦æ¯ä¸ª 24 å°æ—¶é‡æ–°è¿›è¡Œå‘é€ã€‚å¦åˆ™ï¼Œkey-value å°†åœ¨å‘å¸ƒ 24 å°æ—¶åå¤±æ•ˆï¼Œä»¥é™åˆ¶ç³»ç»Ÿä¸­ä¸å¯ç”¨çš„ç´¢å¼•ä¿¡æ¯ã€‚å¯¹äºå…¶ä»–çš„åº”ç”¨ï¼Œæ¯”å¦‚æ•°å­—è¯ä¹¦æˆ–è€…ç”¨äºå€¼æ˜ å°„çš„åŠ å¯†å“ˆå¸Œï¼Œæ›´é•¿çš„è¿‡æœŸæ—¶é—´ä¹Ÿè®¸ä¼šæ›´åˆé€‚ã€‚</p>\n<h4 id=\"æŸ¥è¯¢é”®å€¼å¯¹ä¸è¿‡æœŸæ—¶é—´\"><a href=\"#æŸ¥è¯¢é”®å€¼å¯¹ä¸è¿‡æœŸæ—¶é—´\" class=\"headerlink\" title=\"æŸ¥è¯¢é”®å€¼å¯¹ä¸è¿‡æœŸæ—¶é—´\"></a>æŸ¥è¯¢é”®å€¼å¯¹ä¸è¿‡æœŸæ—¶é—´</h4><p>ä¸ºäº†æ‰¾åˆ°ä¸€ä¸ª key-value å¯¹ï¼ŒèŠ‚ç‚¹å‘èµ·ä¸€ä¸ªèŠ‚ç‚¹æŸ¥æ‰¾ä»¥æ‰¾åˆ° ID ä¸ key æœ€æ¥è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚å€¼æŸ¥è¯¢ä½¿ç”¨çš„æ˜¯ <em>FIND_VALUE</em> è°ƒç”¨è€Œä¸æ˜¯ <em>FIND_NODE</em> è°ƒç”¨ã€‚è€Œä¸”ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹è¿”å›äº†å€¼ï¼Œåˆ™è¿™ä¸ªè¿‡ç¨‹ç«‹å³ç»“æŸã€‚å‡ºäºç¼“å­˜çš„ç›®çš„ï¼Œä¸€æ—¦æŸ¥æ‰¾æˆåŠŸï¼Œå‘èµ·èŠ‚ç‚¹å°†ä¼šå°† key-value å­˜å‚¨è‡³å…¶çŸ¥æ™“çš„ç›¸å¯¹ key æœ€è¿‘çš„ï¼Œä½†æ˜¯åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰è¿”å›å€¼çš„èŠ‚ç‚¹ã€‚</p>\n<p>ç”±äºæ‹“æ‰‘æ˜¯å•å‘çš„ï¼Œéšåå¯¹äºç›¸åŒ key çš„æŸ¥æ‰¾å¾ˆå¯èƒ½åœ¨æŸ¥è¯¢åˆ°æœ€è¿‘çš„èŠ‚ç‚¹ä¹‹å‰å°±å‘½ä¸­å­˜å‚¨åœ¨éæœ€è¿‘èŠ‚ç‚¹ä¸­ç¼“å­˜ã€‚åœ¨æŸä¸ª key æ´»è·ƒåº¦éå¸¸é«˜çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¯èƒ½ä¼šå°†å…¶å­˜å‚¨åœ¨å¾ˆå¤šèŠ‚ç‚¹ã€‚ä¸ºäº†é¿å…è¿™ç§è¿‡åº¦å­˜å‚¨ï¼Œæˆ‘ä»¬ä¸º key-value è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´ä¸èŠ‚ç‚¹ ID ç›¸å¯¹äº key çš„è·ç¦»æˆæŒ‡æ•°åæ¯”ã€‚è™½ç„¶ç®€å•çš„ LRU ç­–ç•¥ä¼šäº§ç”Ÿç±»ä¼¼çš„ç”Ÿå‘½å‘¨æœŸåˆ†å¸ƒï¼Œä½†æ˜¯æ²¡æœ‰åˆé€‚çš„æ–¹æ³•å»é€‰æ‹©cacheçš„å¤§å°ï¼Œå› ä¸ºèŠ‚ç‚¹å¯¹äºç³»ç»Ÿå°†è¦å‚¨å­˜å¤šå°‘å€¼æ²¡æœ‰å…ˆéªŒçŸ¥è¯†ã€‚</p>\n<h4 id=\"K-æ¡¶æ›´æ–°ä¸åŠ å…¥ç½‘ç»œ\"><a href=\"#K-æ¡¶æ›´æ–°ä¸åŠ å…¥ç½‘ç»œ\" class=\"headerlink\" title=\"$K$ æ¡¶æ›´æ–°ä¸åŠ å…¥ç½‘ç»œ\"></a>$K$ æ¡¶æ›´æ–°ä¸åŠ å…¥ç½‘ç»œ</h4><p>$K$ æ¡¶ä¼šæ ¹æ®ç»è¿‡èŠ‚ç‚¹çš„è¯·æ±‚è€Œä¿æŒæ›´æ–°ã€‚ä¸ºäº†è§£å†³å› ä¸ºæŸä¸ªç‰¹æ®Šçš„ ID æ®µé•¿æ—¶é—´æ²¡æœ‰æŸ¥è¯¢çš„ç‰¹æ®Šæƒ…å†µï¼ŒèŠ‚ç‚¹ä¼šåˆ·æ–°é‚£äº›åœ¨è¿‡å»ä¸€å°æ—¶å†…æ²¡æœ‰è¿‡æŸ¥è¯¢è¯·æ±‚çš„ $K$ æ¡¶ã€‚åˆ·æ–°å°±æ˜¯éšæœºé€‰å–ä¸€ä¸ªå¤„åœ¨å½“å‰ $K$ æ¡¶èŒƒå›´çš„ IDï¼Œç„¶åå¯¹å…¶è¿›è¡ŒèŠ‚ç‚¹æŸ¥è¯¢ã€‚</p>\n<p>ä¸ºäº†åŠ å…¥ç½‘ç»œï¼Œä¸€ä¸ªèŠ‚ç‚¹ $u$ å¿…é¡»è¦ä¸ä¸€ä¸ªå·²å­˜åœ¨åœ¨ç½‘ç»œä¸­çš„èŠ‚ç‚¹ w æœ‰è”ç³»ã€‚$u$ å°† w æ’å…¥åˆ°åˆé€‚çš„ $K$ æ¡¶ä¸­ï¼Œéšå $u$ å¯¹è‡ªå·±çš„ nodeID è¿›è¡Œä¸€æ¬¡èŠ‚ç‚¹æŸ¥è¯¢ï¼Œæœ€åï¼Œ$u$ ä¼šè”ç³»åˆ°ç¦»å®ƒé‚»å±…æ›´è¿œçš„èŠ‚ç‚¹ï¼Œç„¶åæ›´æ–°ç›¸åº”çš„ $K$ æ¡¶ã€‚åœ¨åˆ·æ–°è¿‡ç¨‹ä¸­ï¼Œ$u$ å¡«å……äº†è‡ªå·±çš„ $K$ æ¡¶åŒæ—¶ä¹Ÿå°†è‡ªå·±æ’å…¥åˆ°å…¶ä»–èŠ‚ç‚¹çš„ $K$ æ¡¶ä¸­ã€‚</p>\n<h3 id=\"Routing-Tableï¼ˆè·¯ç”±è¡¨ï¼‰\"><a href=\"#Routing-Tableï¼ˆè·¯ç”±è¡¨ï¼‰\" class=\"headerlink\" title=\"Routing Tableï¼ˆè·¯ç”±è¡¨ï¼‰\"></a>Routing Tableï¼ˆè·¯ç”±è¡¨ï¼‰</h3><p>Kademlia çš„åŸºç¡€è·¯ç”±è¡¨ç»“æ„éå¸¸ç›´è§‚ï¼Œä½†æ˜¯éœ€è¦å¯¹é«˜åº¦ä¸å¹³è¡¡çš„æ ‘è¿›è¡Œä¸€äº›ç»†èŠ‚å¤„ç†ã€‚è·¯ç”±è¡¨æ˜¯ä¸€æ£µå¶å­èŠ‚ç‚¹ä¸º $K$ æ¡¶çš„äºŒå‰æ ‘ã€‚æ¯ä¸ª $K$ æ¡¶åŒ…å«äº†ä¸€äº›å…·æœ‰å…¬å…±å‰ç¼€çš„ IDã€‚$K$ æ¡¶å…¬å…±å‰ç¼€å°±æ˜¯å…¶åœ¨äºŒå‰æ ‘ä¸­æ‰€å¤„çš„ä½ç½®ã€‚å¯è§ï¼Œæ¯ä¸ª $K$ æ¡¶è¦†ç›–äº†ä¸€éƒ¨åˆ† ID ç©ºé—´ï¼Œæ‰€æœ‰çš„ $K$ æ¡¶é›†åˆæ— é‡å åœ°è¦†ç›–äº†æ•´ä¸ª 160 æ¯”ç‰¹ ID ç©ºé—´ã€‚</p>\n<p>è·¯ç”±äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹æ˜¯æŒ‰éœ€åŠ¨æ€åˆ†é…çš„ã€‚å›¾ 4 è¡¨ç¤ºäº†è¿™ä¸€ä¸ªè¿‡ç¨‹ã€‚åˆå§‹çŠ¶æ€ä¸‹ï¼ŒèŠ‚ç‚¹ $u$ çš„è·¯ç”±æ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ª $K$ æ¡¶è¦†ç›–äº†æ•´ä¸ª ID ç©ºé—´ã€‚å½“ $u$ å¾—åˆ°äº†ä¸€ä¸ªæ–°çš„è”ç³»äººæ—¶ï¼Œå®ƒå°†æ ¹æ®ä¸æ–°çš„è”ç³»äººçš„è·ç¦»ï¼Œå°è¯•å°†å…¶æ’å…¥åˆ°åˆé€‚çš„ $K$ æ¡¶ä¸­ã€‚æ’å…¥çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>å¦‚æœ $K$ æ¡¶æœªæ»¡ï¼Œæ–°çš„è”ç³»äººå°±ä¼šè¢«ç›´æ¥æ’å…¥ï¼›</li>\n<li>å¦‚æœ $K$ æ¡¶æ»¡äº†ï¼š<ul>\n<li>å¦‚æœ $K$ æ¡¶çš„èŒƒå›´åŒ…æ‹¬äº† $u$ è‡ªèº«çš„ IDï¼Œåˆ™ $K$ æ¡¶å°†ä¼šä¸€åˆ†ä¸ºäºŒï¼ŒåŸ $K$ æ¡¶ä¸­çš„ ID é‡æ–°åˆ†é…åˆ°æ–°çš„ $K$ æ¡¶ä¸­ï¼Œç„¶åå†å°è¯•æ’å…¥ï¼›</li>\n<li>å¦‚æœ $K$ æ¡¶çš„èŒƒå›´ä¸åŒ…æ‹¬ $u$ è‡ªèº«çš„ IDï¼Œæ–°çš„è”ç³»äººå°†ç›´æ¥è¢«ä¸¢å¼ƒï¼›ï¼ˆ3ï¼‰</li>\n</ul>\n</li>\n</ul>\n<p>åœ¨è¿™æ ·é«˜åº¦ä¸å¹³è¡¡çš„äºŒå‰æ ‘ä¸­ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¯¼è‡´è¿™ç§æƒ…å†µä¸‹å¹¶ä¸ä¼šæŒ‰ç…§è§„åˆ™ 3 è¿›è¡Œæ’å…¥ã€‚å‡è®¾ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œ$u$ æ˜¯<strong>å”¯ä¸€</strong>ä¸€ä¸ª ID ä»¥ 000 å¼€å¤´çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶æœ‰è¶…è¿‡ $k$ ä¸ª ID ä»¥ 001 å¼€å¤´çš„èŠ‚ç‚¹ $v_1,v_2â€¦v_kâ€¦v_n$ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ $v$ çš„è·¯ç”±æ ‘ï¼Œ$u$ éƒ½å°†ä¼šè¢«æ’å…¥åˆ°ä¸€ä¸ªç©º $K$ æ¡¶ä¸­ã€‚ä½†æ˜¯ç”±äºæŒ‰ç…§è§„åˆ™ 3ï¼Œ $u$ çš„æ¡¶æ›´æ–°åªä¼šé€šçŸ¥åˆ° $u$ çš„è·¯ç”±æ ‘æ‰€è®°å½•çš„æ‰€æœ‰ $v$ ä¸­çš„ $k$ ä¸ªã€‚ä¸ºäº†é¿å…å‰©ä½™çš„ $v$ æ— æ³•å¾—åˆ° $u$ çš„æ¡¶æ›´æ–°ä¿¡æ¯ï¼ŒKademlia èŠ‚ç‚¹é€šè¿‡æ‹†åˆ†ä»¥ä¿å­˜äº†è¶…è¿‡ $k$ ä¸ªçš„æ‰€æœ‰æœ‰æ•ˆçš„èŠ‚ç‚¹ï¼Œå³ä½¿ä¸æ˜¯å› ä¸º $K$ æ¡¶ä¸­åŒ…æ‹¬äº†è‡ªèº«çš„ IDã€‚å›¾ 5 å±•ç¤ºäº†è¿™ç§é¢å¤–çš„æ‹†åˆ†ã€‚å½“ $u$ åˆ·æ–°äº†æ¡¶ï¼Œæ‰€æœ‰å‰ç¼€ä¸º 001 çš„èŠ‚ç‚¹éƒ½ä¼šçŸ¥æ™“ã€‚</p>\n<p><img src=\"kademlia-4.png\" alt=\"å›¾å››ï¼šè·¯ç”±è¡¨éšæ—¶é—´çš„æ¼”å˜ã€‚ä¸€å¼€å§‹ï¼ŒèŠ‚ç‚¹åªæœ‰ä¸€ä¸ª $K$ æ¡¶ã€‚éšç€ $K$ æ¡¶è¢«å¡«å……ï¼ŒåŒ…å«èŠ‚ç‚¹ ID çš„æ¡¶è¢«ä¸æ–­ä¸€åˆ†ä¸ºäºŒã€‚\"></p>\n<p><img src=\"kademlia-5.png\" alt=\"å›¾äº”ï¼šä¸€ä¸ª ID ä¸º $00...00$ çš„èŠ‚ç‚¹çš„å®½æ¾è·¯ç”±è¡¨ã€‚ä¸ºäº†ç¡®ä¿å…¶çŸ¥æ™“å®ƒå‘¨å›´æœ€å°å­æ ‘ï¼ˆè‡³å°‘ $k$ ä¸ªèŠ‚ç‚¹ï¼‰çš„æ‰€æœ‰è”ç³»äººï¼Œè¿™ä¸ªè·¯ç”±è¡¨è¿›è¡Œäº†é¢å¤–çš„æ‹†åˆ†ã€‚\"></p>\n<h3 id=\"Efficient-Key-Re-publishingï¼ˆKey-çš„é«˜æ•ˆé‡å‘å¸ƒï¼‰\"><a href=\"#Efficient-Key-Re-publishingï¼ˆKey-çš„é«˜æ•ˆé‡å‘å¸ƒï¼‰\" class=\"headerlink\" title=\"Efficient Key Re-publishingï¼ˆKey çš„é«˜æ•ˆé‡å‘å¸ƒï¼‰\"></a>Efficient Key Re-publishingï¼ˆKey çš„é«˜æ•ˆé‡å‘å¸ƒï¼‰</h3><p>ä¸ºäº†ä¿è¯ key-value å¯¹çš„æŒä¹…å­˜åœ¨ï¼ŒèŠ‚ç‚¹å¿…é¡»å‘¨æœŸæ€§é‡å‘å¸ƒ keyã€‚å¦åˆ™ï¼Œä¸¤ç§æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´å¯¹æœ‰æ•ˆ key çš„æŸ¥è¯¢å¤±è´¥ã€‚</p>\n<ul>\n<li>ä¸€äº›è·å¾— key-value å¯¹çš„èŠ‚ç‚¹ç¦»å¼€äº†ç½‘ç»œ</li>\n<li>æ–°çš„ç›¸æ¯”åŸå§‹è¢«å‘å¸ƒè¿‡ key-value å¯¹çš„èŠ‚ç‚¹ ID æ›´è¿‘çš„èŠ‚ç‚¹åŠ å…¥äº†ç½‘ç»œ</li>\n</ul>\n<p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ‹¥æœ‰è¿™ä¸ª key-value å¯¹çš„èŠ‚ç‚¹éœ€è¦å°†å…¶é‡æ–°å‘å¸ƒåˆ°ç¦» key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚</p>\n<p>ä¸ºäº†å¼¥è¡¥èŠ‚ç‚¹ç¦»å¼€ç½‘ç»œçš„æƒ…å†µï¼ŒèŠ‚ç‚¹æ¯éš”ä¸€ä¸ªå°æ—¶é‡æ–°å‘å¸ƒ key-value å¯¹ï¼Œä¸€ä¸ªç›´æ¥çš„å®ç°å°±æ˜¯å°†ä¼šäº§ç”Ÿå¾ˆå¤šæ¶ˆæ¯â€”â€”æ¯ä¸ªå­˜å‚¨è¿™ä¸ª key-value å¯¹çš„èŠ‚ç‚¹ï¼ˆè‡³å¤š $k$ ä¸ªï¼‰é—´éš”ä¸€å°æ—¶ä¼šå‘èµ·ä¸€æ¬¡æŸ¥è¯¢ï¼Œç„¶åå‘å…¶ä»– $k-1$ ä¸ªèŠ‚ç‚¹å‘èµ· <em>STORE</em> è¯·æ±‚ã€‚è¿™ä¸ªé‡æ–°å‘å¸ƒæ“ä½œå¯ä»¥å¤§å¤§ç®€åŒ–ã€‚é¦–å…ˆï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°å¯¹æŸä¸ª key-value å¯¹çš„ <em>STORE</em> è°ƒç”¨ï¼Œå®ƒå‡è®¾è¿™ä¸ª RPC è°ƒç”¨åŒæ ·è¢«å‘é€ç»™äº†å¦å¤– $k-1$ ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹åœ¨ä¸‹ä¸€ä¸ªå°æ—¶ä¸ä¼šå†é‡æ–°å‘å¸ƒæ­¤ key-value å¯¹ã€‚è¿™ä¿è¯äº†çŸ¥é“å¤åˆ¶é—´éš”ä¸æ˜¯å®Œå…¨åŒæ­¥çš„ï¼Œæ¯éš”å°æ—¶å†…åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¼šé‡æ–°å‘å¸ƒ key-value å¯¹ã€‚</p>\n<p>ç¬¬äºŒä¸ªä¼˜åŒ–åœ¨äºåœ¨é‡æ–°å‘å¸ƒ key ä¹‹å‰é¿å…è¿›è¡ŒèŠ‚ç‚¹æŸ¥è¯¢ã€‚åƒä¸Šä¸€èŠ‚æ‰€è¯´çš„ï¼Œä¸ºäº†å¤„ç†ä¸å¹³è¡¡æ ‘ï¼Œåœ¨å¿…è¦çš„æ—¶å€™èŠ‚ç‚¹å°†ä¼šæ‹†åˆ† $K$ æ¡¶æ¥ç¡®ä¿å®ƒå¯¹è‡³å°‘ $k$ ä¸ªèŠ‚ç‚¹çš„å‘¨å›´å­æ ‘å……åˆ†äº†è§£ã€‚å¦‚æœèŠ‚ç‚¹åœ¨é‡æ–°å‘å¸ƒ key-value ä¹‹å‰æ›´æ–°äº†è¯¥ $k$ èŠ‚ç‚¹å­æ ‘çš„æ‰€æœ‰ $K$ æ¡¶ï¼Œå®ƒå°†è‡ªåŠ¨è·çŸ¥è·ç¦»ç»™å®š key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚å¯¹äºè¿™äº› $K$ æ¡¶çš„æ›´æ–°ä»£ä»·å¯ä»¥åˆ†æ‘Šç»™è®¸å¤š key çš„é‡æ–°å‘å¸ƒï¼ˆå¹³å‡è€Œè¨€ï¼Œè¿™æ ·å°±é™ä½äº†å•ä¸ª key é‡æ–°å‘å¸ƒæ—¶çš„ä»£ä»·ï¼‰ã€‚</p>\n<p>è¦ææ¸…æ¥šä¸ºä»€ä¹ˆåœ¨ $u$ æ›´æ–°è§„æ¨¡å¤§äºç­‰äº $k$ çš„å­æ ‘çš„æ‰€æœ‰ $K$ æ¡¶åä¸å†éœ€è¦èŠ‚ç‚¹æŸ¥è¯¢äº†ï¼Œéœ€è¦åˆ†ä¸ºä¸¤ç§æƒ…å†µã€‚å¦‚æœè¦è¢«å……å‘å¸ƒçš„ key åœ¨è¯¥å­æ ‘çš„ ID èŒƒå›´å†…ï¼Œé‚£ä¹ˆå› ä¸ºå­æ ‘çš„è§„æ¨¡è‡³å°‘ä¸º $k$ è€Œä¸” $u$ å…·æœ‰è¯¥å­æ ‘çš„å…¨éƒ¨çŸ¥è¯†ï¼Œæ˜¾ç„¶ $u$ è‚¯å®šçŸ¥é“è·ç¦» key çš„æœ€è¿‘ $k$ ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœè¦è¢«å……å‘å¸ƒçš„ key åœ¨è¯¥å­æ ‘çš„ ID èŒƒå›´å¤–ï¼Œå› ä¸º $u$ æ˜¯ $k$ ä¸ªè·ç¦» key æœ€è¿‘çš„èŠ‚ç‚¹ä¹‹ä¸€ï¼ˆå¦åˆ™ $u$ ä¸ä¼šå­˜å‚¨å…³äºè¯¥ key çš„ä¿¡æ¯ï¼‰ï¼Œæ˜¾ç„¶æ‰€æœ‰è·ç¦»è¯¥ key æ¯”è·ç¦»å­æ ‘æ›´è¿‘ä¸€äº›çš„ $K$ æ¡¶ä¸­çš„å…ƒç´ éƒ½å°‘äº $k$ã€‚å› æ­¤ï¼Œ$u$ å°†ä¼šçŸ¥æ™“æ‰€æœ‰è¿™äº› $K$ æ¡¶ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå†åŠ ä¸Šå…³äºå­æ ‘çš„çŸ¥è¯†ï¼Œå°±å¯ä»¥å¾—åˆ°è·ç¦»è¯¥ key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚</p>\n<p>å½“ä¸€ä¸ªæ–°èŠ‚ç‚¹åŠ å…¥ç½‘ç»œï¼Œå¯¹äºæ¯ä¸ª key-vaule å¯¹æ¥è¯´ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸ºå…¶ $k$ ä¸ªæœ€è¿‘èŠ‚ç‚¹ä¹‹ä¸€ï¼Œé‚£ä¹ˆå¿…é¡»å¯¹å…¶è¿›è¡Œå­˜å‚¨ã€‚ç½‘è·¯ä¸­åŸæœ‰çš„èŠ‚ç‚¹åŒæ ·å¯ä»¥é€šè¿‡å…¶è¾¹ç¼˜å­æ ‘çš„å®Œæ•´çŸ¥è¯†ï¼ŒçŸ¥é“å“ªäº› key-value å¯¹éœ€è¦å­˜å‚¨åœ¨è¯¥æ–°å¢èŠ‚ç‚¹ä¸Šã€‚æ¯ä¸ªäº†è§£åˆ°æ–°èŠ‚ç‚¹çš„èŠ‚ç‚¹éƒ½ä¼šå‘èµ· <em>STORE</em> è°ƒç”¨æŠŠç›¸å…³çš„ key-value å¯¹ä¼ é€åˆ°æ–°èŠ‚ç‚¹ä¹‹ä¸Šã€‚ä¸ºäº†é¿å…é‡å¤çš„ STORE è°ƒç”¨ ï¼Œåªæœ‰é‚£äº›è‡ªèº« ID æ¯”å…¶ä»–èŠ‚ç‚¹ ID æ›´æ¥è¿‘ key çš„èŠ‚ç‚¹æ‰ä¼šè¿›è¡Œ key-value å¯¹çš„ä¼ é€ã€‚</p>\n<h2 id=\"Sketch-of-Proofï¼ˆå¾…è¯‘ï¼‰\"><a href=\"#Sketch-of-Proofï¼ˆå¾…è¯‘ï¼‰\" class=\"headerlink\" title=\"Sketch of Proofï¼ˆå¾…è¯‘ï¼‰\"></a>Sketch of Proofï¼ˆå¾…è¯‘ï¼‰</h2><p>å¾…ç¿»è¯‘</p>\n<h2 id=\"Implementation-Notesï¼ˆå¾…è¯‘ï¼‰\"><a href=\"#Implementation-Notesï¼ˆå¾…è¯‘ï¼‰\" class=\"headerlink\" title=\"Implementation Notesï¼ˆå¾…è¯‘ï¼‰\"></a>Implementation Notesï¼ˆå¾…è¯‘ï¼‰</h2><p>å¾…ç¿»è¯‘</p>\n<h2 id=\"Summaryï¼ˆæ€»ç»“ï¼‰\"><a href=\"#Summaryï¼ˆæ€»ç»“ï¼‰\" class=\"headerlink\" title=\"Summaryï¼ˆæ€»ç»“ï¼‰\"></a>Summaryï¼ˆæ€»ç»“ï¼‰</h2><p>ç”±äºé‡‡ç”¨åŸºäº XOR åº¦é‡çš„æ‹“æ‰‘ï¼ŒKademlia æ˜¯ç¬¬ä¸€ä¸ªç»“åˆäº†å¯è¯æ˜çš„ä¸€è‡´æ€§ï¼Œæ€§èƒ½ï¼Œä½æ—¶å»¶è·¯ç”±ä»¥åŠå•å‘å¯¹ç§°æ‹“æ‰‘çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿã€‚Kademlia è¿˜å¼•å…¥äº†å¹¶å‘å‚æ•° $Î±$ï¼Œå®ƒå…è®¸äººä»¬åœ¨å¸¦å®½ä¸­äº¤æ¢å¸¸æ•°å› å­ï¼Œä»¥å®ç°å¼‚æ­¥æœ€ä½å»¶è¿Ÿè·¯ç”±é€‰æ‹©å’Œæ— å»¶è¿Ÿé”™è¯¯æ¢å¤ã€‚æœ€åï¼ŒKademlia æ˜¯ç¬¬ä¸€ä¸ªåˆ©ç”¨èŠ‚ç‚¹æ•…éšœä¸æ­£å¸¸è¿è¡Œæ—¶é—´æˆåæ¯”å…³ç³»è¿™ä¸€äº‹å®çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h1><ol>\n<li><a href=\"https://blog.csdn.net/hoping/article/details/5307320\" target=\"_blank\" rel=\"noopener\">Kademlia ï¼šä¸€ç§åŸºäº XOR åº¦é‡çš„ P2P ä¿¡æ¯ç³»ç»Ÿ</a></li>\n<li><a href=\"http://www.huamo.online/2018/06/12/P2P%E7%BD%91%E7%BB%9C-Kademlia%E5%8D%8F%E8%AE%AE/\" target=\"_blank\" rel=\"noopener\">P2Pç½‘ç»œâ€“Kademliaåè®®</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>æœ¬æ–‡æ˜¯è®ºæ–‡ <a href=\"http://www.scs.stanford.edu/~dm/home/papers/kpos.pdf\" target=\"_blank\" rel=\"noopener\">Kademlia: A Peer-to-Peer Information System Based on the XOR Metric</a> çš„ç¿»è¯‘ã€‚</p>","more":"<h1 id=\"Kademliaï¼šä¸€ç§åŸºäº-XOR-è·ç¦»çš„-P2P-ä¿¡æ¯ç³»ç»Ÿ\"><a href=\"#Kademliaï¼šä¸€ç§åŸºäº-XOR-è·ç¦»çš„-P2P-ä¿¡æ¯ç³»ç»Ÿ\" class=\"headerlink\" title=\"Kademliaï¼šä¸€ç§åŸºäº XOR è·ç¦»çš„ P2P ä¿¡æ¯ç³»ç»Ÿ\"></a>Kademliaï¼šä¸€ç§åŸºäº XOR è·ç¦»çš„ P2P ä¿¡æ¯ç³»ç»Ÿ</h1><p>ä½œè€…ï¼šPetar Maymounkov ä»¥åŠ David MazieÌ€res</p>\n<h2 id=\"Abstractï¼ˆæ‘˜è¦ï¼‰\"><a href=\"#Abstractï¼ˆæ‘˜è¦ï¼‰\" class=\"headerlink\" title=\"Abstractï¼ˆæ‘˜è¦ï¼‰\"></a>Abstractï¼ˆæ‘˜è¦ï¼‰</h2><p>æˆ‘ä»¬æè¿°äº†ä¸€ç§åœ¨å®¹æ˜“å‡ºé”™çš„ç¯å¢ƒä¸‹ä»å…·æœ‰å¯è¯æ˜çš„å®¹é”™æ€§å’Œæ€§èƒ½çš„ P2P åˆ†å¸ƒå¼æ•£åˆ—è¡¨ã€‚æˆ‘ä»¬çš„ç³»ç»Ÿä½¿ç”¨äº†ä¸€ç§åŸºäº XOR è·ç¦»çš„æ–°å‹æ‹“æ‰‘æ¥è·¯ç”±æŸ¥è¯¢ä¸å®šä½èŠ‚ç‚¹çš„éœ€æ±‚ï¼Œè¯¥æ‹“æ‰‘ç®€åŒ–äº†ç®—æ³•åŠç®—æ³•çš„è¯æ˜ã€‚è¯¥æ‹“æ‰‘æœ‰è¿™æ ·ä¸€ä¸ªç‰¹ç‚¹ï¼šæ¯æ¬¡ä¿¡æ¯äº¤æ¢éƒ½ä¼ é€’æˆ–è€…åŠ å¼ºäº†ï¼ˆèŠ‚ç‚¹é—´ï¼‰æœ‰æ•ˆè”ç³»ã€‚ç³»ç»Ÿæ ¹æ®è¿™ç§è”ç³»æ¥å‘é€å¹¶è¡Œå¼‚æ­¥æŸ¥è¯¢æ¶ˆæ¯ï¼Œä»è€Œåšåˆ°å®¹å¿èŠ‚ç‚¹æ•…éšœåŒæ—¶ä¸å¯¹ç”¨æˆ·é€ æˆè¶…æ—¶ã€‚</p>\n<h2 id=\"Introductionï¼ˆä»‹ç»ï¼‰\"><a href=\"#Introductionï¼ˆä»‹ç»ï¼‰\" class=\"headerlink\" title=\"Introductionï¼ˆä»‹ç»ï¼‰\"></a>Introductionï¼ˆä»‹ç»ï¼‰</h2><p>æœ¬è®ºæ–‡æè¿° Kademlia â€”â€” ä¸€ä¸ª P2P åˆ†å¸ƒå¼æ•£åˆ—è¡¨ï¼ˆDHTï¼‰ã€‚Kademlia æœ‰è®¸å¤šä¹‹å‰çš„ DHT æ— æ³•åŒæ—¶æä¾›çš„ç†æ€§åŠŸèƒ½ã€‚å®ƒæœ€å¤§é™åº¦åœ°å‡å°‘äº†èŠ‚ç‚¹å¿…é¡»å‘é€çš„ç”¨äºäº’ç›¸äº†è§£çš„é…ç½®æ¶ˆæ¯æ•°é‡ã€‚æŸ¥æ‰¾ Key æ—¶é™„å¸¦è‡ªåŠ¨ä¼ æ’­é…ç½®ä¿¡æ¯ã€‚èŠ‚ç‚¹å…·æœ‰è¶³å¤Ÿçš„è®¤çŸ¥ä¸çµæ´»æ€§æ¥é€šè¿‡ä½å»¶è¿Ÿè·¯å¾„è·¯ç”±æŸ¥è¯¢ã€‚Kademlia ä½¿ç”¨å¹¶è¡Œå¼‚æ­¥æŸ¥è¯¢æ¥é¿å…æ¥è‡ªå¤±è´¥èŠ‚ç‚¹çš„è¶…æ—¶å»¶è¿Ÿã€‚èŠ‚ç‚¹è®°å½•å…¶ä»–èŠ‚ç‚¹çš„å­˜åœ¨ä»¥é˜»æŒ¡æŸäº›åŸºæœ¬çš„æ‹’ç»æœåŠ¡æ”»å‡»ã€‚æœ€åï¼Œåªè¦å¯¹è¿è¡Œæ—¶é—´è¿›è¡Œç®€å•çš„å‡è®¾å°±å¯ä»¥å¯¹ Kademlia çš„å‡ ä¸ªé‡è¦ç‰¹æ€§è¿›è¡Œæ­£å¼è¯æ˜ã€‚</p>\n<p>Kademlia é‡‡ç”¨äº†è®¸å¤š DHT ä½¿ç”¨çš„åŸºæœ¬æ–¹æ³•ã€‚å¯†é’¥ä½¿ç”¨ä¸é€æ˜çš„ 160 ä½ç©ºé—´ï¼Œæ¯”å¦‚ SHA-1 æ•£åˆ—ã€‚å‚ä¸çš„è®¡ç®—æœºåœ¨ 160 ä½å¯†é’¥ç©ºé—´ä¸­éƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹ IDã€‚<strong>key-value é”®å€¼å¯¹å­˜å‚¨åœ¨é‚£äº› ID â€œæ¥è¿‘â€ key çš„èŠ‚ç‚¹ä¸Š</strong>ã€‚æœ€ç»ˆï¼Œä¸€ä¸ªåŸºäºèŠ‚ç‚¹ ID çš„è·¯ç”±ç®—æ³•ä½¿å¾—ä»»ä½•èŠ‚ç‚¹å¯ä»¥é€šè¿‡ç»™å‡ºçš„ç›®æ ‡ key æœ‰æ•ˆåœ°å®šä½ key é™„è¿‘çš„èŠ‚ç‚¹ã€‚</p>\n<p>Kademlia çš„ä¼—å¤šä¼˜ç‚¹å¾—ç›Šäºå®ƒåˆ›æ–°åœ°ä½¿ç”¨ XOR æ¥åº¦é‡èŠ‚ç‚¹é—´çš„è·ç¦»ã€‚XOR æ˜¯å¯¹ç§°çš„ï¼Œå…è®¸ Kademlia æ¥æ”¶æ¥è‡ªé‚£äº›æ‹¥æœ‰å®Œå…¨ç›¸åŒçš„è·¯ç”±è¡¨ä¿¡æ¯çš„èŠ‚ç‚¹çš„æŸ¥è¯¢è¯·æ±‚ã€‚åƒæ˜¯ Chord è¿™æ ·æ²¡æœ‰è¿™ç§ç‰¹æ€§çš„ç³»ç»Ÿå°±æ— æ³•ä»æŸ¥è¯¢è¯·æ±‚ä¸­è·å–æœ‰ç”¨çš„è·¯ç”±ä¿¡æ¯ã€‚ç”šè€…ï¼Œä¸å¯¹ç§°ä¼šå¯¼è‡´ä¸¥æ ¼çš„è·¯ç”±è¡¨ã€‚åœ¨ Chord ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¿…é¡»å­˜å‚¨ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p>\n<p>ä¸ºäº†å®šä½æ¥è¿‘ç‰¹å®š ID çš„èŠ‚ç‚¹ï¼ŒKademlia è‡ªå§‹è‡³ç»ˆä»…ä½¿ç”¨ä¸€ä¸ªè·¯ç”±ç®—æ³•ã€‚ç›¸åï¼Œå…¶ä»–ç³»ç»Ÿä½¿ç”¨ä¸€ç§ç®—æ³•æ¥æ¥è¿‘ç›®æ ‡ IDï¼Œä½¿ç”¨å¦ä¸€ç§ç®—æ³•æ¥å®Œæˆæœ€åå‡ è·³ã€‚åœ¨ç°æœ‰çš„ç³»ç»Ÿä¸­ï¼ŒKademlia æœ€åƒ Pastry çš„ç¬¬ä¸€é˜¶æ®µï¼Œè™½ç„¶ä½œè€…æ²¡æœ‰ç”¨è¿™ç§æ–¹å¼æè¿°ï¼Œä½†æ˜¯é€šè¿‡ Kademlia çš„ XOR è·ç¦»å‘ç°ç›®æ ‡ ID çš„èŠ‚ç‚¹æ•°å¯ä»¥å‡å°‘ä¸€åŠã€‚åœ¨ Pastry çš„ç¬¬äºŒé˜¶æ®µï¼Œå®ƒå°†è·ç¦»åº¦é‡åˆ‡æ¢ä¸º ID é—´çš„æ•°å­—å·®å¼‚ã€‚å®ƒè¿˜åœ¨å¤åˆ¶ä¸­ä½¿ç”¨ç¬¬äºŒä¸ªæ•°å­—å·®å¼‚åº¦é‡ã€‚é—æ†¾çš„æ˜¯ï¼Œç¬¬äºŒä¸ªåº¦é‡æ ‡å‡†ä¸­ç›¸è·è¾ƒè¿‘çš„èŠ‚ç‚¹åœ¨ç¬¬ä¸€ä¸ªåº¦é‡æ ‡å‡†ä¸­åˆ™å¯èƒ½ç›¸å·®å¾ˆè¿œï¼Œä»¥è‡´åœ¨ç‰¹å®šèŠ‚ç‚¹ ID å€¼å¤„äº§ç”Ÿäº†ä¸è¿ç»­æ€§ï¼Œä»è€Œé™ä½äº†æ€§èƒ½ï¼Œå¹¶ä½¿å¾—å¯¹æœ€åæƒ…å†µè¡Œä¸ºçš„æ­£å¼åˆ†æå˜å¾—å¤æ‚ã€‚</p>\n<h2 id=\"System-Descriptionï¼ˆç³»ç»Ÿæè¿°ï¼‰\"><a href=\"#System-Descriptionï¼ˆç³»ç»Ÿæè¿°ï¼‰\" class=\"headerlink\" title=\"System Descriptionï¼ˆç³»ç»Ÿæè¿°ï¼‰\"></a>System Descriptionï¼ˆç³»ç»Ÿæè¿°ï¼‰</h2><p>ä¸å…¶ä»– DHT ç›¸åŒç±»ä¼¼ï¼ŒKademlia ç»™èŠ‚ç‚¹åˆ†é…ä¸€ä¸ª 160 ä½çš„é€æ˜ IDï¼Œå¹¶æä¾›ä¸€ä¸ªæŸ¥è¯¢ç®—æ³•ç”¨ä»¥å®šä½æ›´åŠ æ¥è¿‘æŒ‡å®šèŠ‚ç‚¹çš„èŠ‚ç‚¹ï¼Œä»¥å¯¹æ•°çº§åˆ«æ”¶æ•›æŸ¥è¯¢åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚</p>\n<p>Kademlia é«˜æ•ˆåœ°å°†èŠ‚ç‚¹ä½œä¸ºä¸€ä¸ªäºŒå‰æ ‘çš„å¶å­èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„ä½ç½®å–å†³äºå…¶ ID çš„æœ€çŸ­å”¯ä¸€å‰ç¼€ã€‚å›¾ä¸€å±•ç¤ºäº†å”¯ä¸€å‰ç¼€ä¸º 0011 çš„èŠ‚ç‚¹åœ¨æ ‘ä¸­çš„ä½ç½®ã€‚å¯¹äºä»»ä¸€ç»™å®šçš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°†äºŒå‰æ ‘åˆ†ä¸ºä¸€ç³»åˆ—è¿ç»­çš„ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„å­æ ‘ã€‚æœ€é«˜çš„å­æ ‘ç”±ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„æ•´ä¸ªäºŒå‰æ ‘çš„ä¸€åŠç»„æˆã€‚æ¥ä¸‹æ¥çš„å­æ ‘ç”±ä¸åŒ…å«è¯¥èŠ‚ç‚¹çš„å‰©ä½™äºŒå‰æ ‘çš„ä¸€èˆ¬ç»„æˆã€‚åœ¨å›¾ç¤ºä¸­ï¼ŒèŠ‚ç‚¹ 0011 çš„æ‰€æœ‰å­æ ‘è¢«åœˆå‡ºï¼ŒæŒ‰ç…§é«˜åº¦ç”±é«˜åˆ°ä½æ’åºï¼Œå‰ç¼€åˆ†åˆ«æ˜¯ 0, 01, 000 ä»¥åŠ 0010ã€‚</p>\n<p><img src=\"kademlia-1.png\" alt=\"å›¾ä¸€ï¼šKademlia äºŒå‰æ ‘ã€‚é»‘è‰²çš„ç‚¹è¡¨ç¤ºèŠ‚ç‚¹ 0011Â·Â·Â· çš„ä½ç½®ï¼›ç°è‰²çš„åœˆè¡¨ç¤ºèŠ‚ç‚¹ 0011Â·Â·Â· å¿…é¡»ä¸ä¹‹å»ºç«‹è”ç³»çš„å­æ ‘ã€‚\"></p>\n<p>Kademlia åè®®ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥æ™“å…¶æ¯ä¸ªå­æ ‘ä¸­çš„è‡³å°‘ä¸€ä¸ªèŠ‚ç‚¹ã€‚æœ‰äº†è¿™ä¸ªä¿è¯ï¼Œä»»ä¸€èŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡ ID å®šä½åˆ°å¦å¤–çš„èŠ‚ç‚¹ã€‚å›¾äºŒå±•ç¤ºäº†èŠ‚ç‚¹ 0011 é€šè¿‡ä¸æ–­åœ¨å­æ ‘ä¸­æŸ¥è¯¢æœ€ä½³å®ƒæ‰€çŸ¥æ™“çš„æœ€ä½³èŠ‚ç‚¹çš„æ–¹å¼æœ€ç»ˆæ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹ 1110 çš„è¿‡ç¨‹ã€‚</p>\n<p><img src=\"kademlia-2.png\" alt=\"å›¾äºŒï¼šé€šè¿‡ ID å®šä½èŠ‚ç‚¹ã€‚å‰ç¼€ä¸º 0011 çš„èŠ‚ç‚¹é€šè¿‡ä¾æ¬¡çŸ¥æ™“ä¸æŸ¥è¯¢è¶Šæ¥è¶Šè¿‘çš„èŠ‚ç‚¹ä»è€Œæ‰¾åˆ°å‰ç¼€ä¸º 1110 çš„èŠ‚ç‚¹ã€‚å›¾ä¸Šæ–¹çš„çº¿ä»£è¡¨äº† 160 æ¯”ç‰¹çš„ ID ç©ºé—´ï¼Œå¹¶ä¸”å±•ç¤ºäº†æŸ¥è¯¢åˆ°ç›®æ ‡èŠ‚ç‚¹çš„æ•´ä¸ªè¿‡ç¨‹ã€‚å›¾çš„ä¸»ä½“ç”»å‡ºäº†èŠ‚ç‚¹ 1110 å‘å‡ºçš„ RPC æ¶ˆæ¯ï¼Œç¬¬ä¸€ä¸ª RPC æ¶ˆæ¯å‘é€ç»™ 101ï¼Œåç»­çš„ RPC æ¶ˆæ¯å‘é€ç»™å‰ä¸€ä¸ª RPC æ¶ˆæ¯è¿”å›çš„èŠ‚ç‚¹ã€‚\"></p>\n<p>æœ¬èŠ‚çš„å‰©ä½™éƒ¨åˆ†è¡¥å……äº†æŸ¥æ‰¾ç®—æ³•çš„å…·ä½“ç»†èŠ‚ã€‚æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªç²¾ç¡®çš„æ¦‚å¿µæ¥æè¿°èŠ‚ç‚¹é—´çš„è·ç¦»ï¼Œè®©æˆ‘ä»¬æŒ‡å‡ºè·ç¦»æŸä¸ª key æœ€è¿‘çš„ k ä¸ªèŠ‚ç‚¹æä¾›äº†å¯èƒ½ã€‚ç„¶åç»™å‡ºä¸€ä¸ªæŸ¥è¯¢åè®®ï¼Œå³ä½¿æ²¡æœ‰èŠ‚ç‚¹ä¸ç»™å®šçš„ key æ‹¥æœ‰ç›¸åŒçš„å”¯ä¸€å‰ç¼€æˆ–è€…ç»™å®šèŠ‚ç‚¹çš„ä¸€äº›å­æ ‘æ˜¯ç©ºçš„ï¼Œè¿™ä¸ªåè®®ä»ç„¶æ˜¯å¯å·¥ä½œçš„ã€‚</p>\n<h3 id=\"XOR-Metricï¼ˆXOR-åº¦é‡ï¼‰\"><a href=\"#XOR-Metricï¼ˆXOR-åº¦é‡ï¼‰\" class=\"headerlink\" title=\"XOR Metricï¼ˆXOR åº¦é‡ï¼‰\"></a>XOR Metricï¼ˆXOR åº¦é‡ï¼‰</h3><p>æ¯ä¸ª Kademlia èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª 160 æ¯”ç‰¹çš„èŠ‚ç‚¹ IDã€‚èŠ‚ç‚¹ ID ç›®å‰åªæ˜¯éšæœºçš„ 160 ä½æ ‡è¯†ç¬¦ï¼Œå°½ç®¡å®ƒä»¬åŒæ ·å¯ä»¥åƒåœ¨ Chord ä¸­é‚£æ ·æ„é€ ã€‚èŠ‚ç‚¹å‘é€çš„æ¯æ¡æ¶ˆæ¯éƒ½åŒ…å«å…¶èŠ‚ç‚¹IDï¼Œå…è®¸æ¥æ”¶æ–¹åœ¨å¿…è¦æ—¶è®°å½•å‘é€æ–¹çš„å­˜åœ¨ã€‚</p>\n<p>é”®åŒæ ·æ˜¯ 160 ä½æ ‡è¯†ç¬¦ã€‚ä¸ºäº†ç»™ç‰¹å®šçš„èŠ‚ç‚¹åˆ†é… key-value é”®å€¼å¯¹ï¼ŒKademlia ä¾èµ–ä¸¤ä¸ªæ ‡è¯†ç¬¦ä¹‹é—´çš„è·ç¦»çš„åº¦é‡ã€‚ç»™å‡ºä¸¤ä¸ª 160 ä½çš„æ ‡è¯†ç¬¦ $x$ å’Œ $y$ï¼ŒKademlia å°† $x$ ä¸ $y$ çš„è·ç¦»å®šä¹‰ä¸º $x$ ä¸ $y$ æŒ‰ä½å¼‚æˆ–åçš„æ•´æ•°å€¼ï¼Œå³ $d(x, y) = x \\oplus y$ã€‚</p>\n<p>æˆ‘ä»¬é¦–å…ˆæ³¨æ„åˆ° XOR è¿ç®—æ˜¯æœ‰æ•ˆçš„ï¼Œå°½ç®¡å±äºéæ¬§å‡ é‡Œå¾·è·ç¦»ã€‚å¼‚æˆ–è¿ç®—æœ‰ä»¥ä¸‹æ€§è´¨ï¼š</p>\n<ul>\n<li>$$d(x, x) = 0$$</li>\n<li>$$d(x, y)&gt;0, \\text{ if } x \\neq y$$</li>\n<li>$$\\forall x, y:d(x, y)=d(y, x)$$</li>\n<li>$$d(x,y)+d(y,z) \\geq d(x,z)$$</li>\n<li>$$d(x,y) \\oplus d(y,z) = d(x,z)$$</li>\n<li>$$\\forall a \\geq 0, b \\geq 0: a+b \\geq a \\oplus b$$</li>\n</ul>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ³¨æ„åˆ°å¼‚æˆ–åº¦é‡åˆ»ç”»äº†åŸºäºäºŒå‰æ ‘çš„ç³»ç»Ÿè‰å›¾ä¸­éšå«çš„è·ç¦»æ¦‚å¿µã€‚åœ¨ 160 ä½ ID å®Œå…¨å¡«å……çš„äºŒå‰æ ‘ä¸­ï¼Œä¸¤ä¸ª ID é—´è·ç¦»å¤§å°æ˜¯åŒ…å«å®ƒä»¬çš„æœ€å°å­æ ‘çš„é«˜åº¦ã€‚å½“æ ‘æœªå®Œå…¨å¡«æ»¡æ—¶ï¼Œä¸ ID $x$ æœ€æ¥è¿‘çš„èŠ‚ç‚¹æ˜¯èŠ‚ç‚¹ ID ä¸ $x$ å…±äº«æœ€é•¿å…¬å…±å‰ç¼€çš„èŠ‚ç‚¹ã€‚å¦‚æœæ ‘ä¸­æœ‰ç©ºåˆ†æ”¯ï¼Œåˆ™å¯èƒ½æœ‰å¤šä¸ªå¶å­èŠ‚ç‚¹å…·æœ‰æœ€é•¿çš„å…¬å…±å‰ç¼€ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ $x$ æœ€æ¥è¿‘çš„å¶å­å°†å˜ä¸ºç¦»é€šè¿‡ç¿»è½¬ $x$ ä¸­å¯¹åº”äºæ ‘çš„ç©ºåˆ†æ”¯ä¸­çš„ä½å¾—åˆ°çš„ $\\widetilde{x}$ æœ€è¿‘çš„å¶å­ã€‚</p>\n<p>ç±»ä¼¼äº Chord ç®—æ³•çš„é¡ºæ—¶é’ˆåœ†å‘¨åº¦é‡ï¼ŒXOR ä¹Ÿæ˜¯å•å‘çš„ã€‚å¯¹äºä»»æ„ç»™å®šçš„ç‚¹ $x$ ä»¥åŠ $âˆ† &gt; 0$ï¼Œä»…å­˜åœ¨ä¸€ä¸ªç‚¹ $y$ ä½¿å¾— $d(x, y) = âˆ†$ã€‚å•å‘æ€§ä¿è¯äº†å¯¹äºç›¸åŒçš„ keyï¼Œæ— è®ºä»å“ªä¸ªåŸç‚¹å¼€å§‹æŸ¥è¯¢ï¼Œéƒ½ä¼šæ²¿ç€ç›¸åŒçš„è·¯å¾„è¿›è¡Œæ”¶æ•›ã€‚è¿™æ ·ï¼Œæ²¿ç€æŸ¥è¯¢è·¯å¾„ç¼“å­˜ key-value é”®å€¼å¯¹å°±èƒ½å‡è½»å­˜æ”¾çƒ­é—¨ key å€¼èŠ‚ç‚¹çš„å‹åŠ›ã€‚ç±»ä¼¼äº Pastry è€Œä¸åŒäº Chordï¼Œ XOR æ‹“æ‰‘æ˜¯å¯¹ç§°çš„ã€‚</p>\n<h3 id=\"Node-Stateï¼ˆèŠ‚ç‚¹çŠ¶æ€ï¼‰\"><a href=\"#Node-Stateï¼ˆèŠ‚ç‚¹çŠ¶æ€ï¼‰\" class=\"headerlink\" title=\"Node Stateï¼ˆèŠ‚ç‚¹çŠ¶æ€ï¼‰\"></a>Node Stateï¼ˆèŠ‚ç‚¹çŠ¶æ€ï¼‰</h3><p>Kademlia èŠ‚ç‚¹å­˜å‚¨äº†å…¶ä»–èŠ‚ç‚¹è”ç³»äººçš„ä¿¡æ¯ä»¥è·¯ç”±æŸ¥è¯¢æ¶ˆæ¯ã€‚å¯¹äºæ¯ä¸ª $0 \\leq i &lt; 160$ï¼Œæ¯ä¸ªèŠ‚ç‚¹æ„å»ºä¸€ä¸ªï¼ˆIP åœ°å€ï¼ŒUDP ç«¯å£ï¼ŒèŠ‚ç‚¹ IDï¼‰çš„ä¸‰å…ƒç»„åˆ—è¡¨ç”¨æ¥å­˜å‚¨ä¸è¯¥èŠ‚ç‚¹ç›¸è· $[2^i$, $2^{i+1})$ çš„èŠ‚ç‚¹ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸º $K$ æ¡¶ã€‚æ¯ä¸ª $K$ æ¡¶å†…èŠ‚ç‚¹æ ¹æ®èŠ‚ç‚¹æœ€åå¯è§æ—¶é—´è¿›è¡Œæ’åºï¼Œæœ€æ—©å¯è§çš„æ”¾ç½®åœ¨å¼€å¤´ï¼Œæœ€è¿‘å¯è§çš„æ”¾ç½®åœ¨æœ«å°¾ã€‚å¯¹äºè¾ƒå°çš„ $i$ å€¼ï¼Œ$K$ æ¡¶é€šå¸¸æ˜¯ç©ºçš„ï¼ˆå› ä¸ºä¸å­˜åœ¨åˆé€‚çš„èŠ‚ç‚¹ï¼‰ã€‚å¯¹äºè¾ƒå¤§çš„ $i$ å€¼ï¼Œåˆ—è¡¨æœ€å¤§å®¹é‡ä¸º $k$ï¼Œ$k$ æ˜¯ä¸€ä¸ªç³»ç»ŸèŒƒå›´å†…çš„å¤åˆ¶å‚æ•°ã€‚ä»…å½“ä»»æ„ç»™å®šçš„ $k$ ä¸ªèŠ‚ç‚¹ä¸ä¼šåœ¨ä¸€ä¸ªå°æ—¶å†…åŒæ—¶å¤±æ•ˆæ—¶ï¼Œ$k$ å€¼æ‰æœ‰æ•ˆï¼Œä¾‹å¦‚ $k = 20$ã€‚</p>\n<p>å½“ä¸€ä¸ª Kademlia èŠ‚ç‚¹æ”¶åˆ°ä»»ä¸€æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„è¯·æ±‚æˆ–è€…å›å¤æ¶ˆæ¯ï¼Œå®ƒä¼šæ ¹æ®å‘é€è€…çš„èŠ‚ç‚¹ ID æ›´æ–° $K$ æ¡¶ã€‚è§„åˆ™å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>å¦‚æœå‘é€èŠ‚ç‚¹å·²ç»å­˜åœ¨æ¥æ”¶æ–¹çš„ $K$ æ¡¶ä¸­ï¼š<ul>\n<li>æ¥æ”¶æ–¹å°†å‘é€èŠ‚ç‚¹ç§»åŠ¨åˆ°ç›¸åº” $K$ æ¡¶çš„å°¾éƒ¨ï¼›</li>\n</ul>\n</li>\n<li>å¦‚æœå‘é€èŠ‚ç‚¹å¹¶æœªå­˜åœ¨æ¥æ”¶æ–¹çš„ $K$ æ¡¶ä¸­ï¼š<ul>\n<li>å¦‚æœ $K$ æ¡¶ä¸­èŠ‚ç‚¹æ•°é‡å°‘äº $k$ ä¸ªï¼Œåˆ™ç›´æ¥å°†å‘é€èŠ‚ç‚¹æ’å…¥è‡³ $K$ æ¡¶å°¾éƒ¨ï¼›</li>\n<li>å¦‚æœ $K$ æ¡¶å·²æ»¡ï¼š<ul>\n<li>å¦‚æœæœ€æ—©å¯è§çš„èŠ‚ç‚¹ä¸èƒ½ ping é€šï¼Œåˆ™ç§»é™¤è¯¥èŠ‚ç‚¹ï¼Œç„¶åå°†å‘é€èŠ‚ç‚¹æ’å…¥è‡³ $K$ æ¡¶å°¾éƒ¨ï¼›</li>\n<li>å¦‚æœæœ€æ—©å¯è§çš„èŠ‚ç‚¹å¯ä»¥ ping é€šï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹ç§»åŠ¨åˆ°å°¾éƒ¨ï¼Œç„¶åä¸¢å¼ƒå‘é€èŠ‚ç‚¹ï¼›</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>$K$ æ¡¶é«˜æ•ˆåœ°å®ç°äº† LRU ç®—æ³•ï¼Œåªæ˜¯æ´»åŠ¨çš„èŠ‚ç‚¹æ°¸è¿œä¸ä¼šä»åˆ—è¡¨ä¸­ç§»é™¤ã€‚è¿™ç§å¯¹ä¸æ—§è”ç³»äººçš„åå¥½æ¥è‡ªäºæˆ‘ä»¬çš„å¯¹äº Saroiu ç­‰äººä» Gnutella ç½‘ç»œæ”¶é›†çš„è¿½è¸ªæ•°æ®çš„åˆ†æã€‚å›¾ 3 å±•ç¤ºäº† Gnutella èŠ‚ç‚¹éšç€å½“å‰æ—¶é—´çš„æ¨ç§»ï¼Œé¢å¤–åœ¨çº¿ä¸€ä¸ªå°æ—¶çš„å¯èƒ½æ€§ã€‚ä¸€ä¸ªèŠ‚ç‚¹åœ¨çº¿æ—¶é—´è¶Šé•¿ï¼Œå®ƒå°±è¶Šå¯èƒ½ç»§ç»­é¢å¤–åœ¨çº¿ä¸€ä¸ªå°æ—¶ã€‚é€šè¿‡ä¿æŒæœ€è€çš„åœ¨çº¿èŠ‚ç‚¹ï¼Œ$K$ æ¡¶æœ€å¤§åŒ–äº†åˆ—è¡¨ä¸­èŠ‚ç‚¹åœ¨çº¿çš„å¯èƒ½æ€§ã€‚</p>\n<p><img src=\"kademlia-3.png\" alt=\"å›¾ä¸‰ï¼šé¢å¤–ä¿æŒä¸€å°æ—¶åœ¨çº¿çš„å¯èƒ½æ€§å…³äºæ—¶é—´çš„å‡½æ•°ã€‚X è½´ä»£è¡¨åˆ†é’Ÿï¼ŒY è½´è¡¨ç¤ºä¿æŒåœ¨çº¿ $x$ åˆ†é’Ÿçš„èŠ‚ç‚¹ç»§ç»­ä¿æŒåœ¨çº¿åˆ° $x + 60$ åˆ†é’Ÿæ—¶åˆ»çš„å¯èƒ½æ€§\"></p>\n<p>$K$ æ¡¶é‡‡ç”¨è¿™æ ·çš„æ›´æ–°ç­–ç•¥çš„å¦ä¸€ä¸ªä¼˜ç‚¹åœ¨äºå¯ä»¥æŠµæŒ¡ç‰¹å®šçš„ DoS æ”»å‡»ã€‚æ”»å‡»è€…ä¸èƒ½ä½¿ç”¨æ–°çš„èŠ‚ç‚¹æ³›æ´ªç³»ç»Ÿæ¥åˆ·æ–°èŠ‚ç‚¹çš„è·¯ç”±çŠ¶æ€ã€‚åªæœ‰å½“æ—§çš„èŠ‚ç‚¹ç¦»å¼€äº†ç³»ç»Ÿï¼ŒKademlia æ‰ä¼šæ’å…¥æ–°çš„èŠ‚ç‚¹ã€‚</p>\n<h3 id=\"Kademlia-protocolï¼ˆKademlia-åè®®ï¼‰\"><a href=\"#Kademlia-protocolï¼ˆKademlia-åè®®ï¼‰\" class=\"headerlink\" title=\"Kademlia protocolï¼ˆKademlia åè®®ï¼‰\"></a>Kademlia protocolï¼ˆKademlia åè®®ï¼‰</h3><p>Kademlia åè®®ç”±å››ä¸ª RPC è°ƒç”¨ç»„æˆï¼š<em>PING</em>, <em>STORE</em>, <em>FIND_NODE</em>, <em>FIND_VALUE</em>ã€‚</p>\n<ul>\n<li><em>PING</em> ç”¨äºæ¢æµ‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦åœ¨çº¿ã€‚</li>\n<li><em>STORE</em> ç”¨äºé€šçŸ¥ä¸€ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€ä¸ª key-value å¯¹ä»¥ä¾¿ä¹‹åè·å–ã€‚</li>\n<li><em>FIND_NODE</em> ä½¿ç”¨ä¸€ä¸ª 160 æ¯”ç‰¹çš„ ID ä½œä¸ºå‚æ•°ã€‚è°ƒç”¨å¯¹è±¡è¿”å›ä¸€ä¸ªå…¶çŸ¥æ™“çš„è·ç¦»ç›®æ ‡ ID æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ä¿¡æ¯ &lt;IP åœ°å€ï¼ŒUDP ç«¯å£ï¼ŒèŠ‚ç‚¹ ID&gt; ä¸‰å…ƒç»„ã€‚è¿™ $k$ ä¸ªä¸‰å…ƒç»„å¯èƒ½æ¥è‡ªå•ä¸ª $K$ æ¡¶ï¼Œä¹Ÿå¯èƒ½å› ä¸ºè·ç¦»æœ€è¿‘çš„ $K$ æ¡¶æœªæ»¡è€Œå–è‡ªå¤šä¸ª $K$ æ¡¶ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼ŒRPC è°ƒç”¨æ¥æ”¶è€…å¿…é¡»è¿”å› $k$ ä¸ªèŠ‚ç‚¹ï¼Œé™¤éè¯¥èŠ‚ç‚¹çŸ¥æ™“èŠ‚ç‚¹æ€»æ•°å°äº $k$ ä¸ªã€‚</li>\n<li><em>FIND_VALUE</em> è°ƒç”¨å’Œ <em>FIND_NODE</em> ä¸€æ ·ï¼Œä¸è¿‡å½“è°ƒç”¨çš„æ¥æ”¶è€…å­˜æœ‰è¯·æ±‚è€…æ‰€è¯·æ±‚çš„é”®çš„æ—¶å€™ï¼Œå®ƒå°†è¿”å›ç›¸åº”é”®çš„å€¼ã€‚</li>\n</ul>\n<p>åœ¨æ‰€æœ‰çš„ RPC ä¸­ï¼Œæ¥æ”¶è€…å¿…é¡»è¿”å›ä¸€ä¸ª 160 æ¯”ç‰¹çš„éšæœº RPC IDï¼Œä»¥é˜²æ­¢åœ°å€ä¼ªé€ ï¼ˆï¼Ÿï¼‰ã€‚å¯ä»¥å°† PING æ¶ˆæ¯é™„åŠ åœ¨ RPC æ¶ˆæ¯çš„å›å¤ä¸­ä»¥ç¡®å®šå‘é€è€…çš„ç½‘ç»œåœ°å€ã€‚</p>\n<h4 id=\"ä¸´è¿‘-ID-èŠ‚ç‚¹æŸ¥æ‰¾\"><a href=\"#ä¸´è¿‘-ID-èŠ‚ç‚¹æŸ¥æ‰¾\" class=\"headerlink\" title=\"ä¸´è¿‘ ID èŠ‚ç‚¹æŸ¥æ‰¾\"></a>ä¸´è¿‘ ID èŠ‚ç‚¹æŸ¥æ‰¾</h4><p>Kademlia èŠ‚ç‚¹éœ€è¦å®ç°çš„æœ€é‡è¦çš„è¿‡ç¨‹å°±æ˜¯æ ¹æ®ä¸€ä¸ªèŠ‚ç‚¹ ID æ‰¾åˆ°ä¸å®ƒæœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªè¿‡ç¨‹ä¸º <em>èŠ‚ç‚¹æŸ¥æ‰¾</em>ï¼ŒKademlia ä½¿ç”¨é€’å½’å®Œæˆè¿™ä¸ªå·¥ä½œã€‚ç”±æŸ¥æ‰¾éœ€æ±‚çš„èµ·å§‹èŠ‚ç‚¹å…ˆä»ç¦»ç›®æ ‡èŠ‚ç‚¹ ID æœ€è¿‘çš„éç©º $K$ æ¡¶ä¸­å–å‡º $Î±$ ä¸ªèŠ‚ç‚¹ï¼ˆå¦‚æœ $K$ æ¡¶ä¸­èŠ‚ç‚¹ä¸è¶³ $Î±$ ä¸ªï¼Œåˆ™ä»å…¶ä»– $K$ æ¡¶ä¸­å–æ»¡ $Î±$ ä¸ªï¼‰ã€‚èµ·å§‹æ¥åœ°å¹¶è¡Œå‘è¿™ $Î±$ ä¸ªèŠ‚ç‚¹å‘é€ <em>FIND_NODE</em> RPC è°ƒç”¨ã€‚$Î±$ æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§å‚æ•°ï¼Œä¾‹å¦‚ 3ã€‚</p>\n<p>åœ¨é€’å½’è°ƒç”¨é˜¶æ®µï¼Œåˆå§‹èŠ‚ç‚¹æ ¹æ® $Î±$ ä¸ªèŠ‚ç‚¹è¿”å›çš„èŠ‚ç‚¹åˆ—è¡¨å†æ¬¡å‘é€ <em>FIND_NODE</em> è¯·æ±‚ï¼ˆé€’å½’è°ƒç”¨åœ¨æ‰€æœ‰ $Î±$ ä¸ªèŠ‚ç‚¹å®Œæˆè¿”å›å‰å°±å¯ä»¥å¼€å§‹ï¼‰ã€‚èµ·å§‹èŠ‚ç‚¹ä»å…¶ä»–èŠ‚ç‚¹è¿”å›çš„å¤§å°ä¸º $k$ çš„èŠ‚ç‚¹åˆ—è¡¨ä¸­é€‰å‡º $Î±$ ä¸ªä¹‹å‰æ²¡æœ‰æŸ¥è¯¢è¿‡çš„èŠ‚ç‚¹ï¼Œå‘å®ƒä»¬å‘é€ <em>FIND_NODE</em> RPC è°ƒç”¨ã€‚å¤±è´¥çš„èŠ‚ç‚¹å°†ä¸å†ä¼šçº³å…¥è€ƒè™‘èŒƒå›´ã€‚å¦‚æœæœ‰ä¸€è½® <em>FIND_NODE</em> è°ƒç”¨ä¸­è¿”å›çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸æ¯”ä¹‹å‰çŸ¥æ™“çš„ $k$ ä¸ªèŠ‚ç‚¹æ›´åŠ æ¥è¿‘ï¼Œåˆ™å½“åˆå§‹èŠ‚ç‚¹å®Œæˆå¯¹æœ€è¿‘çš„è¿™ä¸ª $k$ ä¸ªèŠ‚ç‚¹çš„æŸ¥è¯¢å¹¶å¾—åˆ°å“åº”ä¹‹åï¼ŒæŸ¥è¯¢ç»“æŸã€‚å½“ $a=1$ï¼ŒæŸ¥è¯¢ç®—æ³•åœ¨ä¿¡æ¯å¼€é”€å’Œæ•…éšœèŠ‚ç‚¹çš„æ£€æŸ¥å»¶è¿Ÿä¸Šä¸ Chord ç±»ä¼¼ã€‚ä½†æ˜¯ Kademlia å¯ä»¥çµæ´»åœ°ä» $k$ ä¸ªèŠ‚ç‚¹ä¸­é€‰æ‹©ä»»ä¸€ä¸€ä¸ªå‘é€è¯·æ±‚ä»¥é™ä½æŸ¥è¯¢å»¶è¿Ÿã€‚</p>\n<h4 id=\"å­˜å‚¨é”®å€¼å¯¹ä¸é‡æ–°å‘å¸ƒæ—¶é—´\"><a href=\"#å­˜å‚¨é”®å€¼å¯¹ä¸é‡æ–°å‘å¸ƒæ—¶é—´\" class=\"headerlink\" title=\"å­˜å‚¨é”®å€¼å¯¹ä¸é‡æ–°å‘å¸ƒæ—¶é—´\"></a>å­˜å‚¨é”®å€¼å¯¹ä¸é‡æ–°å‘å¸ƒæ—¶é—´</h4><p>ä¸Šè¿°æŸ¥è¯¢è¿‡ç¨‹å®ç°äº†å¤§éƒ¨åˆ†çš„æ“ä½œã€‚ä¸ºäº†å­˜å‚¨ä¸€ä¸ª key-value å¯¹ï¼Œèµ·å§‹èŠ‚ç‚¹é€šè¿‡ä¸Šè¿°æ“ä½œå®šä½åˆ° $k$ ä¸ªç¦» key æœ€è¿‘çš„èŠ‚ç‚¹ï¼Œå¹¶å‘å®ƒä»¬å‘é€ <em>STORE</em> è°ƒç”¨ã€‚å¦å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šåœ¨éœ€è¦çš„æƒ…å†µä¸‹é‡æ–°å‘å¸ƒ key-value ä»¥ä½¿ key-value æŒç»­å­˜åœ¨ã€‚åœ¨ Kademlia å½“å‰çš„åº”ç”¨ä¸­ï¼ˆæ–‡ä»¶åˆ†äº«ï¼‰ï¼Œkey-value çš„åŸå§‹å‘å¸ƒè€…éœ€è¦æ¯ä¸ª 24 å°æ—¶é‡æ–°è¿›è¡Œå‘é€ã€‚å¦åˆ™ï¼Œkey-value å°†åœ¨å‘å¸ƒ 24 å°æ—¶åå¤±æ•ˆï¼Œä»¥é™åˆ¶ç³»ç»Ÿä¸­ä¸å¯ç”¨çš„ç´¢å¼•ä¿¡æ¯ã€‚å¯¹äºå…¶ä»–çš„åº”ç”¨ï¼Œæ¯”å¦‚æ•°å­—è¯ä¹¦æˆ–è€…ç”¨äºå€¼æ˜ å°„çš„åŠ å¯†å“ˆå¸Œï¼Œæ›´é•¿çš„è¿‡æœŸæ—¶é—´ä¹Ÿè®¸ä¼šæ›´åˆé€‚ã€‚</p>\n<h4 id=\"æŸ¥è¯¢é”®å€¼å¯¹ä¸è¿‡æœŸæ—¶é—´\"><a href=\"#æŸ¥è¯¢é”®å€¼å¯¹ä¸è¿‡æœŸæ—¶é—´\" class=\"headerlink\" title=\"æŸ¥è¯¢é”®å€¼å¯¹ä¸è¿‡æœŸæ—¶é—´\"></a>æŸ¥è¯¢é”®å€¼å¯¹ä¸è¿‡æœŸæ—¶é—´</h4><p>ä¸ºäº†æ‰¾åˆ°ä¸€ä¸ª key-value å¯¹ï¼ŒèŠ‚ç‚¹å‘èµ·ä¸€ä¸ªèŠ‚ç‚¹æŸ¥æ‰¾ä»¥æ‰¾åˆ° ID ä¸ key æœ€æ¥è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚å€¼æŸ¥è¯¢ä½¿ç”¨çš„æ˜¯ <em>FIND_VALUE</em> è°ƒç”¨è€Œä¸æ˜¯ <em>FIND_NODE</em> è°ƒç”¨ã€‚è€Œä¸”ï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹è¿”å›äº†å€¼ï¼Œåˆ™è¿™ä¸ªè¿‡ç¨‹ç«‹å³ç»“æŸã€‚å‡ºäºç¼“å­˜çš„ç›®çš„ï¼Œä¸€æ—¦æŸ¥æ‰¾æˆåŠŸï¼Œå‘èµ·èŠ‚ç‚¹å°†ä¼šå°† key-value å­˜å‚¨è‡³å…¶çŸ¥æ™“çš„ç›¸å¯¹ key æœ€è¿‘çš„ï¼Œä½†æ˜¯åœ¨æŸ¥æ‰¾è¿‡ç¨‹ä¸­å¹¶æ²¡æœ‰è¿”å›å€¼çš„èŠ‚ç‚¹ã€‚</p>\n<p>ç”±äºæ‹“æ‰‘æ˜¯å•å‘çš„ï¼Œéšåå¯¹äºç›¸åŒ key çš„æŸ¥æ‰¾å¾ˆå¯èƒ½åœ¨æŸ¥è¯¢åˆ°æœ€è¿‘çš„èŠ‚ç‚¹ä¹‹å‰å°±å‘½ä¸­å­˜å‚¨åœ¨éæœ€è¿‘èŠ‚ç‚¹ä¸­ç¼“å­˜ã€‚åœ¨æŸä¸ª key æ´»è·ƒåº¦éå¸¸é«˜çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿå¯èƒ½ä¼šå°†å…¶å­˜å‚¨åœ¨å¾ˆå¤šèŠ‚ç‚¹ã€‚ä¸ºäº†é¿å…è¿™ç§è¿‡åº¦å­˜å‚¨ï¼Œæˆ‘ä»¬ä¸º key-value è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´ä¸èŠ‚ç‚¹ ID ç›¸å¯¹äº key çš„è·ç¦»æˆæŒ‡æ•°åæ¯”ã€‚è™½ç„¶ç®€å•çš„ LRU ç­–ç•¥ä¼šäº§ç”Ÿç±»ä¼¼çš„ç”Ÿå‘½å‘¨æœŸåˆ†å¸ƒï¼Œä½†æ˜¯æ²¡æœ‰åˆé€‚çš„æ–¹æ³•å»é€‰æ‹©cacheçš„å¤§å°ï¼Œå› ä¸ºèŠ‚ç‚¹å¯¹äºç³»ç»Ÿå°†è¦å‚¨å­˜å¤šå°‘å€¼æ²¡æœ‰å…ˆéªŒçŸ¥è¯†ã€‚</p>\n<h4 id=\"K-æ¡¶æ›´æ–°ä¸åŠ å…¥ç½‘ç»œ\"><a href=\"#K-æ¡¶æ›´æ–°ä¸åŠ å…¥ç½‘ç»œ\" class=\"headerlink\" title=\"$K$ æ¡¶æ›´æ–°ä¸åŠ å…¥ç½‘ç»œ\"></a>$K$ æ¡¶æ›´æ–°ä¸åŠ å…¥ç½‘ç»œ</h4><p>$K$ æ¡¶ä¼šæ ¹æ®ç»è¿‡èŠ‚ç‚¹çš„è¯·æ±‚è€Œä¿æŒæ›´æ–°ã€‚ä¸ºäº†è§£å†³å› ä¸ºæŸä¸ªç‰¹æ®Šçš„ ID æ®µé•¿æ—¶é—´æ²¡æœ‰æŸ¥è¯¢çš„ç‰¹æ®Šæƒ…å†µï¼ŒèŠ‚ç‚¹ä¼šåˆ·æ–°é‚£äº›åœ¨è¿‡å»ä¸€å°æ—¶å†…æ²¡æœ‰è¿‡æŸ¥è¯¢è¯·æ±‚çš„ $K$ æ¡¶ã€‚åˆ·æ–°å°±æ˜¯éšæœºé€‰å–ä¸€ä¸ªå¤„åœ¨å½“å‰ $K$ æ¡¶èŒƒå›´çš„ IDï¼Œç„¶åå¯¹å…¶è¿›è¡ŒèŠ‚ç‚¹æŸ¥è¯¢ã€‚</p>\n<p>ä¸ºäº†åŠ å…¥ç½‘ç»œï¼Œä¸€ä¸ªèŠ‚ç‚¹ $u$ å¿…é¡»è¦ä¸ä¸€ä¸ªå·²å­˜åœ¨åœ¨ç½‘ç»œä¸­çš„èŠ‚ç‚¹ w æœ‰è”ç³»ã€‚$u$ å°† w æ’å…¥åˆ°åˆé€‚çš„ $K$ æ¡¶ä¸­ï¼Œéšå $u$ å¯¹è‡ªå·±çš„ nodeID è¿›è¡Œä¸€æ¬¡èŠ‚ç‚¹æŸ¥è¯¢ï¼Œæœ€åï¼Œ$u$ ä¼šè”ç³»åˆ°ç¦»å®ƒé‚»å±…æ›´è¿œçš„èŠ‚ç‚¹ï¼Œç„¶åæ›´æ–°ç›¸åº”çš„ $K$ æ¡¶ã€‚åœ¨åˆ·æ–°è¿‡ç¨‹ä¸­ï¼Œ$u$ å¡«å……äº†è‡ªå·±çš„ $K$ æ¡¶åŒæ—¶ä¹Ÿå°†è‡ªå·±æ’å…¥åˆ°å…¶ä»–èŠ‚ç‚¹çš„ $K$ æ¡¶ä¸­ã€‚</p>\n<h3 id=\"Routing-Tableï¼ˆè·¯ç”±è¡¨ï¼‰\"><a href=\"#Routing-Tableï¼ˆè·¯ç”±è¡¨ï¼‰\" class=\"headerlink\" title=\"Routing Tableï¼ˆè·¯ç”±è¡¨ï¼‰\"></a>Routing Tableï¼ˆè·¯ç”±è¡¨ï¼‰</h3><p>Kademlia çš„åŸºç¡€è·¯ç”±è¡¨ç»“æ„éå¸¸ç›´è§‚ï¼Œä½†æ˜¯éœ€è¦å¯¹é«˜åº¦ä¸å¹³è¡¡çš„æ ‘è¿›è¡Œä¸€äº›ç»†èŠ‚å¤„ç†ã€‚è·¯ç”±è¡¨æ˜¯ä¸€æ£µå¶å­èŠ‚ç‚¹ä¸º $K$ æ¡¶çš„äºŒå‰æ ‘ã€‚æ¯ä¸ª $K$ æ¡¶åŒ…å«äº†ä¸€äº›å…·æœ‰å…¬å…±å‰ç¼€çš„ IDã€‚$K$ æ¡¶å…¬å…±å‰ç¼€å°±æ˜¯å…¶åœ¨äºŒå‰æ ‘ä¸­æ‰€å¤„çš„ä½ç½®ã€‚å¯è§ï¼Œæ¯ä¸ª $K$ æ¡¶è¦†ç›–äº†ä¸€éƒ¨åˆ† ID ç©ºé—´ï¼Œæ‰€æœ‰çš„ $K$ æ¡¶é›†åˆæ— é‡å åœ°è¦†ç›–äº†æ•´ä¸ª 160 æ¯”ç‰¹ ID ç©ºé—´ã€‚</p>\n<p>è·¯ç”±äºŒå‰æ ‘ä¸­çš„èŠ‚ç‚¹æ˜¯æŒ‰éœ€åŠ¨æ€åˆ†é…çš„ã€‚å›¾ 4 è¡¨ç¤ºäº†è¿™ä¸€ä¸ªè¿‡ç¨‹ã€‚åˆå§‹çŠ¶æ€ä¸‹ï¼ŒèŠ‚ç‚¹ $u$ çš„è·¯ç”±æ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ª $K$ æ¡¶è¦†ç›–äº†æ•´ä¸ª ID ç©ºé—´ã€‚å½“ $u$ å¾—åˆ°äº†ä¸€ä¸ªæ–°çš„è”ç³»äººæ—¶ï¼Œå®ƒå°†æ ¹æ®ä¸æ–°çš„è”ç³»äººçš„è·ç¦»ï¼Œå°è¯•å°†å…¶æ’å…¥åˆ°åˆé€‚çš„ $K$ æ¡¶ä¸­ã€‚æ’å…¥çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>å¦‚æœ $K$ æ¡¶æœªæ»¡ï¼Œæ–°çš„è”ç³»äººå°±ä¼šè¢«ç›´æ¥æ’å…¥ï¼›</li>\n<li>å¦‚æœ $K$ æ¡¶æ»¡äº†ï¼š<ul>\n<li>å¦‚æœ $K$ æ¡¶çš„èŒƒå›´åŒ…æ‹¬äº† $u$ è‡ªèº«çš„ IDï¼Œåˆ™ $K$ æ¡¶å°†ä¼šä¸€åˆ†ä¸ºäºŒï¼ŒåŸ $K$ æ¡¶ä¸­çš„ ID é‡æ–°åˆ†é…åˆ°æ–°çš„ $K$ æ¡¶ä¸­ï¼Œç„¶åå†å°è¯•æ’å…¥ï¼›</li>\n<li>å¦‚æœ $K$ æ¡¶çš„èŒƒå›´ä¸åŒ…æ‹¬ $u$ è‡ªèº«çš„ IDï¼Œæ–°çš„è”ç³»äººå°†ç›´æ¥è¢«ä¸¢å¼ƒï¼›ï¼ˆ3ï¼‰</li>\n</ul>\n</li>\n</ul>\n<p>åœ¨è¿™æ ·é«˜åº¦ä¸å¹³è¡¡çš„äºŒå‰æ ‘ä¸­ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¯¼è‡´è¿™ç§æƒ…å†µä¸‹å¹¶ä¸ä¼šæŒ‰ç…§è§„åˆ™ 3 è¿›è¡Œæ’å…¥ã€‚å‡è®¾ä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œ$u$ æ˜¯<strong>å”¯ä¸€</strong>ä¸€ä¸ª ID ä»¥ 000 å¼€å¤´çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶æœ‰è¶…è¿‡ $k$ ä¸ª ID ä»¥ 001 å¼€å¤´çš„èŠ‚ç‚¹ $v_1,v_2â€¦v_kâ€¦v_n$ã€‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ $v$ çš„è·¯ç”±æ ‘ï¼Œ$u$ éƒ½å°†ä¼šè¢«æ’å…¥åˆ°ä¸€ä¸ªç©º $K$ æ¡¶ä¸­ã€‚ä½†æ˜¯ç”±äºæŒ‰ç…§è§„åˆ™ 3ï¼Œ $u$ çš„æ¡¶æ›´æ–°åªä¼šé€šçŸ¥åˆ° $u$ çš„è·¯ç”±æ ‘æ‰€è®°å½•çš„æ‰€æœ‰ $v$ ä¸­çš„ $k$ ä¸ªã€‚ä¸ºäº†é¿å…å‰©ä½™çš„ $v$ æ— æ³•å¾—åˆ° $u$ çš„æ¡¶æ›´æ–°ä¿¡æ¯ï¼ŒKademlia èŠ‚ç‚¹é€šè¿‡æ‹†åˆ†ä»¥ä¿å­˜äº†è¶…è¿‡ $k$ ä¸ªçš„æ‰€æœ‰æœ‰æ•ˆçš„èŠ‚ç‚¹ï¼Œå³ä½¿ä¸æ˜¯å› ä¸º $K$ æ¡¶ä¸­åŒ…æ‹¬äº†è‡ªèº«çš„ IDã€‚å›¾ 5 å±•ç¤ºäº†è¿™ç§é¢å¤–çš„æ‹†åˆ†ã€‚å½“ $u$ åˆ·æ–°äº†æ¡¶ï¼Œæ‰€æœ‰å‰ç¼€ä¸º 001 çš„èŠ‚ç‚¹éƒ½ä¼šçŸ¥æ™“ã€‚</p>\n<p><img src=\"kademlia-4.png\" alt=\"å›¾å››ï¼šè·¯ç”±è¡¨éšæ—¶é—´çš„æ¼”å˜ã€‚ä¸€å¼€å§‹ï¼ŒèŠ‚ç‚¹åªæœ‰ä¸€ä¸ª $K$ æ¡¶ã€‚éšç€ $K$ æ¡¶è¢«å¡«å……ï¼ŒåŒ…å«èŠ‚ç‚¹ ID çš„æ¡¶è¢«ä¸æ–­ä¸€åˆ†ä¸ºäºŒã€‚\"></p>\n<p><img src=\"kademlia-5.png\" alt=\"å›¾äº”ï¼šä¸€ä¸ª ID ä¸º $00...00$ çš„èŠ‚ç‚¹çš„å®½æ¾è·¯ç”±è¡¨ã€‚ä¸ºäº†ç¡®ä¿å…¶çŸ¥æ™“å®ƒå‘¨å›´æœ€å°å­æ ‘ï¼ˆè‡³å°‘ $k$ ä¸ªèŠ‚ç‚¹ï¼‰çš„æ‰€æœ‰è”ç³»äººï¼Œè¿™ä¸ªè·¯ç”±è¡¨è¿›è¡Œäº†é¢å¤–çš„æ‹†åˆ†ã€‚\"></p>\n<h3 id=\"Efficient-Key-Re-publishingï¼ˆKey-çš„é«˜æ•ˆé‡å‘å¸ƒï¼‰\"><a href=\"#Efficient-Key-Re-publishingï¼ˆKey-çš„é«˜æ•ˆé‡å‘å¸ƒï¼‰\" class=\"headerlink\" title=\"Efficient Key Re-publishingï¼ˆKey çš„é«˜æ•ˆé‡å‘å¸ƒï¼‰\"></a>Efficient Key Re-publishingï¼ˆKey çš„é«˜æ•ˆé‡å‘å¸ƒï¼‰</h3><p>ä¸ºäº†ä¿è¯ key-value å¯¹çš„æŒä¹…å­˜åœ¨ï¼ŒèŠ‚ç‚¹å¿…é¡»å‘¨æœŸæ€§é‡å‘å¸ƒ keyã€‚å¦åˆ™ï¼Œä¸¤ç§æƒ…å†µä¸‹å¯èƒ½å¯¼è‡´å¯¹æœ‰æ•ˆ key çš„æŸ¥è¯¢å¤±è´¥ã€‚</p>\n<ul>\n<li>ä¸€äº›è·å¾— key-value å¯¹çš„èŠ‚ç‚¹ç¦»å¼€äº†ç½‘ç»œ</li>\n<li>æ–°çš„ç›¸æ¯”åŸå§‹è¢«å‘å¸ƒè¿‡ key-value å¯¹çš„èŠ‚ç‚¹ ID æ›´è¿‘çš„èŠ‚ç‚¹åŠ å…¥äº†ç½‘ç»œ</li>\n</ul>\n<p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæ‹¥æœ‰è¿™ä¸ª key-value å¯¹çš„èŠ‚ç‚¹éœ€è¦å°†å…¶é‡æ–°å‘å¸ƒåˆ°ç¦» key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚</p>\n<p>ä¸ºäº†å¼¥è¡¥èŠ‚ç‚¹ç¦»å¼€ç½‘ç»œçš„æƒ…å†µï¼ŒèŠ‚ç‚¹æ¯éš”ä¸€ä¸ªå°æ—¶é‡æ–°å‘å¸ƒ key-value å¯¹ï¼Œä¸€ä¸ªç›´æ¥çš„å®ç°å°±æ˜¯å°†ä¼šäº§ç”Ÿå¾ˆå¤šæ¶ˆæ¯â€”â€”æ¯ä¸ªå­˜å‚¨è¿™ä¸ª key-value å¯¹çš„èŠ‚ç‚¹ï¼ˆè‡³å¤š $k$ ä¸ªï¼‰é—´éš”ä¸€å°æ—¶ä¼šå‘èµ·ä¸€æ¬¡æŸ¥è¯¢ï¼Œç„¶åå‘å…¶ä»– $k-1$ ä¸ªèŠ‚ç‚¹å‘èµ· <em>STORE</em> è¯·æ±‚ã€‚è¿™ä¸ªé‡æ–°å‘å¸ƒæ“ä½œå¯ä»¥å¤§å¤§ç®€åŒ–ã€‚é¦–å…ˆï¼Œå½“ä¸€ä¸ªèŠ‚ç‚¹æ”¶åˆ°å¯¹æŸä¸ª key-value å¯¹çš„ <em>STORE</em> è°ƒç”¨ï¼Œå®ƒå‡è®¾è¿™ä¸ª RPC è°ƒç”¨åŒæ ·è¢«å‘é€ç»™äº†å¦å¤– $k-1$ ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹åœ¨ä¸‹ä¸€ä¸ªå°æ—¶ä¸ä¼šå†é‡æ–°å‘å¸ƒæ­¤ key-value å¯¹ã€‚è¿™ä¿è¯äº†çŸ¥é“å¤åˆ¶é—´éš”ä¸æ˜¯å®Œå…¨åŒæ­¥çš„ï¼Œæ¯éš”å°æ—¶å†…åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¼šé‡æ–°å‘å¸ƒ key-value å¯¹ã€‚</p>\n<p>ç¬¬äºŒä¸ªä¼˜åŒ–åœ¨äºåœ¨é‡æ–°å‘å¸ƒ key ä¹‹å‰é¿å…è¿›è¡ŒèŠ‚ç‚¹æŸ¥è¯¢ã€‚åƒä¸Šä¸€èŠ‚æ‰€è¯´çš„ï¼Œä¸ºäº†å¤„ç†ä¸å¹³è¡¡æ ‘ï¼Œåœ¨å¿…è¦çš„æ—¶å€™èŠ‚ç‚¹å°†ä¼šæ‹†åˆ† $K$ æ¡¶æ¥ç¡®ä¿å®ƒå¯¹è‡³å°‘ $k$ ä¸ªèŠ‚ç‚¹çš„å‘¨å›´å­æ ‘å……åˆ†äº†è§£ã€‚å¦‚æœèŠ‚ç‚¹åœ¨é‡æ–°å‘å¸ƒ key-value ä¹‹å‰æ›´æ–°äº†è¯¥ $k$ èŠ‚ç‚¹å­æ ‘çš„æ‰€æœ‰ $K$ æ¡¶ï¼Œå®ƒå°†è‡ªåŠ¨è·çŸ¥è·ç¦»ç»™å®š key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚å¯¹äºè¿™äº› $K$ æ¡¶çš„æ›´æ–°ä»£ä»·å¯ä»¥åˆ†æ‘Šç»™è®¸å¤š key çš„é‡æ–°å‘å¸ƒï¼ˆå¹³å‡è€Œè¨€ï¼Œè¿™æ ·å°±é™ä½äº†å•ä¸ª key é‡æ–°å‘å¸ƒæ—¶çš„ä»£ä»·ï¼‰ã€‚</p>\n<p>è¦ææ¸…æ¥šä¸ºä»€ä¹ˆåœ¨ $u$ æ›´æ–°è§„æ¨¡å¤§äºç­‰äº $k$ çš„å­æ ‘çš„æ‰€æœ‰ $K$ æ¡¶åä¸å†éœ€è¦èŠ‚ç‚¹æŸ¥è¯¢äº†ï¼Œéœ€è¦åˆ†ä¸ºä¸¤ç§æƒ…å†µã€‚å¦‚æœè¦è¢«å……å‘å¸ƒçš„ key åœ¨è¯¥å­æ ‘çš„ ID èŒƒå›´å†…ï¼Œé‚£ä¹ˆå› ä¸ºå­æ ‘çš„è§„æ¨¡è‡³å°‘ä¸º $k$ è€Œä¸” $u$ å…·æœ‰è¯¥å­æ ‘çš„å…¨éƒ¨çŸ¥è¯†ï¼Œæ˜¾ç„¶ $u$ è‚¯å®šçŸ¥é“è·ç¦» key çš„æœ€è¿‘ $k$ ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœè¦è¢«å……å‘å¸ƒçš„ key åœ¨è¯¥å­æ ‘çš„ ID èŒƒå›´å¤–ï¼Œå› ä¸º $u$ æ˜¯ $k$ ä¸ªè·ç¦» key æœ€è¿‘çš„èŠ‚ç‚¹ä¹‹ä¸€ï¼ˆå¦åˆ™ $u$ ä¸ä¼šå­˜å‚¨å…³äºè¯¥ key çš„ä¿¡æ¯ï¼‰ï¼Œæ˜¾ç„¶æ‰€æœ‰è·ç¦»è¯¥ key æ¯”è·ç¦»å­æ ‘æ›´è¿‘ä¸€äº›çš„ $K$ æ¡¶ä¸­çš„å…ƒç´ éƒ½å°‘äº $k$ã€‚å› æ­¤ï¼Œ$u$ å°†ä¼šçŸ¥æ™“æ‰€æœ‰è¿™äº› $K$ æ¡¶ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå†åŠ ä¸Šå…³äºå­æ ‘çš„çŸ¥è¯†ï¼Œå°±å¯ä»¥å¾—åˆ°è·ç¦»è¯¥ key æœ€è¿‘çš„ $k$ ä¸ªèŠ‚ç‚¹ã€‚</p>\n<p>å½“ä¸€ä¸ªæ–°èŠ‚ç‚¹åŠ å…¥ç½‘ç»œï¼Œå¯¹äºæ¯ä¸ª key-vaule å¯¹æ¥è¯´ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹ä¸ºå…¶ $k$ ä¸ªæœ€è¿‘èŠ‚ç‚¹ä¹‹ä¸€ï¼Œé‚£ä¹ˆå¿…é¡»å¯¹å…¶è¿›è¡Œå­˜å‚¨ã€‚ç½‘è·¯ä¸­åŸæœ‰çš„èŠ‚ç‚¹åŒæ ·å¯ä»¥é€šè¿‡å…¶è¾¹ç¼˜å­æ ‘çš„å®Œæ•´çŸ¥è¯†ï¼ŒçŸ¥é“å“ªäº› key-value å¯¹éœ€è¦å­˜å‚¨åœ¨è¯¥æ–°å¢èŠ‚ç‚¹ä¸Šã€‚æ¯ä¸ªäº†è§£åˆ°æ–°èŠ‚ç‚¹çš„èŠ‚ç‚¹éƒ½ä¼šå‘èµ· <em>STORE</em> è°ƒç”¨æŠŠç›¸å…³çš„ key-value å¯¹ä¼ é€åˆ°æ–°èŠ‚ç‚¹ä¹‹ä¸Šã€‚ä¸ºäº†é¿å…é‡å¤çš„ STORE è°ƒç”¨ ï¼Œåªæœ‰é‚£äº›è‡ªèº« ID æ¯”å…¶ä»–èŠ‚ç‚¹ ID æ›´æ¥è¿‘ key çš„èŠ‚ç‚¹æ‰ä¼šè¿›è¡Œ key-value å¯¹çš„ä¼ é€ã€‚</p>\n<h2 id=\"Sketch-of-Proofï¼ˆå¾…è¯‘ï¼‰\"><a href=\"#Sketch-of-Proofï¼ˆå¾…è¯‘ï¼‰\" class=\"headerlink\" title=\"Sketch of Proofï¼ˆå¾…è¯‘ï¼‰\"></a>Sketch of Proofï¼ˆå¾…è¯‘ï¼‰</h2><p>å¾…ç¿»è¯‘</p>\n<h2 id=\"Implementation-Notesï¼ˆå¾…è¯‘ï¼‰\"><a href=\"#Implementation-Notesï¼ˆå¾…è¯‘ï¼‰\" class=\"headerlink\" title=\"Implementation Notesï¼ˆå¾…è¯‘ï¼‰\"></a>Implementation Notesï¼ˆå¾…è¯‘ï¼‰</h2><p>å¾…ç¿»è¯‘</p>\n<h2 id=\"Summaryï¼ˆæ€»ç»“ï¼‰\"><a href=\"#Summaryï¼ˆæ€»ç»“ï¼‰\" class=\"headerlink\" title=\"Summaryï¼ˆæ€»ç»“ï¼‰\"></a>Summaryï¼ˆæ€»ç»“ï¼‰</h2><p>ç”±äºé‡‡ç”¨åŸºäº XOR åº¦é‡çš„æ‹“æ‰‘ï¼ŒKademlia æ˜¯ç¬¬ä¸€ä¸ªç»“åˆäº†å¯è¯æ˜çš„ä¸€è‡´æ€§ï¼Œæ€§èƒ½ï¼Œä½æ—¶å»¶è·¯ç”±ä»¥åŠå•å‘å¯¹ç§°æ‹“æ‰‘çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿã€‚Kademlia è¿˜å¼•å…¥äº†å¹¶å‘å‚æ•° $Î±$ï¼Œå®ƒå…è®¸äººä»¬åœ¨å¸¦å®½ä¸­äº¤æ¢å¸¸æ•°å› å­ï¼Œä»¥å®ç°å¼‚æ­¥æœ€ä½å»¶è¿Ÿè·¯ç”±é€‰æ‹©å’Œæ— å»¶è¿Ÿé”™è¯¯æ¢å¤ã€‚æœ€åï¼ŒKademlia æ˜¯ç¬¬ä¸€ä¸ªåˆ©ç”¨èŠ‚ç‚¹æ•…éšœä¸æ­£å¸¸è¿è¡Œæ—¶é—´æˆåæ¯”å…³ç³»è¿™ä¸€äº‹å®çš„ç‚¹å¯¹ç‚¹ç³»ç»Ÿã€‚</p>\n<h1 id=\"å‚è€ƒ\"><a href=\"#å‚è€ƒ\" class=\"headerlink\" title=\"å‚è€ƒ\"></a>å‚è€ƒ</h1><ol>\n<li><a href=\"https://blog.csdn.net/hoping/article/details/5307320\" target=\"_blank\" rel=\"noopener\">Kademlia ï¼šä¸€ç§åŸºäº XOR åº¦é‡çš„ P2P ä¿¡æ¯ç³»ç»Ÿ</a></li>\n<li><a href=\"http://www.huamo.online/2018/06/12/P2P%E7%BD%91%E7%BB%9C-Kademlia%E5%8D%8F%E8%AE%AE/\" target=\"_blank\" rel=\"noopener\">P2Pç½‘ç»œâ€“Kademliaåè®®</a></li>\n</ol>"},{"title":"TCP æ¸©æ•…çŸ¥æ–°","keywords":[],"date":"2018-07-19T16:00:00.000Z","_content":"ç”Ÿäº§ç¯å¢ƒé‡åˆ°äº›ç½‘ç»œé—®é¢˜ï¼ŒçŸ¥å¯¹ TCP åè®®è¿˜æ˜¯æœ‰äº›ç”Ÿç–ï¼Œåœ¨æ­¤å¤ä¹ è®°å½•ã€‚\n<!-- more -->\n## åè®®\n### æŠ¥æ–‡æ®µæ ¼å¼\nTCP åè®®æŠ¥æ–‡æ®µä¸»è¦ç”±**é¦–éƒ¨ï¼ˆHeaderï¼‰** ä¸**æ•°æ®ï¼ˆDataï¼‰** ä¸¤éƒ¨åˆ†ç»„æˆã€‚åœ¨è®¡ç®—æ ¡éªŒå’Œæ˜¯è¿˜ä¼šåŠ ä¸Šè™šæ‹Ÿçš„ä¼ªé¦–éƒ¨ã€‚æ­¤å¤„ä¸»è¦è¯´æ˜é¦–éƒ¨çš„ç»„æˆã€‚\n![å›¾ 1 TCP Header (From: WikiPedia)](tcp_header.png)\nTCP åœ¨ç½‘ç»œæ¨¡å‹ä¸­å±äºè¿è¾“å±‚ï¼Œç”¨äºæä¾›è¿›ç¨‹ä¸è¿›ç¨‹é—´çš„å­—èŠ‚æµé€šä¿¡æœåŠ¡ï¼Œå› æ­¤éœ€è¦**æº / ç›®ç«¯å£ï¼ˆSource / Destination portï¼‰** ä»¥ç¡®å®šé€šä¿¡åŒæ–¹è¿›ç¨‹ã€‚ä½¿ç”¨**åºå·ï¼ˆSequence numberï¼Œseqï¼‰** è¡¨æ˜æœ¬æŠ¥æ–‡æ®µç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„ç¼–å·ï¼Œåˆå§‹åºå·ç”±åŒæ–¹åœ¨ TCP è¿æ¥å»ºç«‹æ—¶éšæœºç”Ÿæˆã€‚ä½¿ç”¨**ç¡®è®¤å·ï¼ˆAcknowledgment numberï¼Œackï¼‰** è¡¨ç¤ºæ¥å—æ–¹æœŸæœ›ä»å‘é€æ–¹æ¥å—çš„å­—èŠ‚ç¼–å·ã€‚**æ•°æ®åç§»é‡ï¼ˆData Offsetï¼‰** é¡¾åæ€ä¹‰æŠ¥æ–‡æ®µæ•°æ®å¼€å§‹å­—èŠ‚å¤„çš„åç§»é‡ï¼Œå³ TCP header çš„é•¿åº¦ï¼Œç”±äºé€‰é¡¹çš„å­˜åœ¨ï¼Œé¦–éƒ¨é•¿åº¦çš„èŒƒå›´æ˜¯ 20ï½60 Bytesï¼Œä½†æ˜¯è¯¥å­—æ®µåªæœ‰ 4 Bitsï¼Œå› æ­¤è¯¥å­—æ®µæŒ‡å‡ºé¦–éƒ¨é•¿åº¦æœ‰å¤šå°‘ä¸ª 4 Bytesã€‚æ¥ä¸‹æ¥çš„ 3 Bits è¢«**ä¿ç•™ï¼ˆReservedï¼‰** ã€‚éšåä¼šè®¨è®º 9 ä¸ª**æ ‡å¿—ä½ï¼ˆFlagsï¼‰**ã€‚**çª—å£å¤§å°ï¼ˆWindow Sizeï¼‰** å®šä¹‰äº†æ¥å—æ–¹çš„æ¥å—çª—å£å¤§å°ï¼Œç”±æ¥å—æ–¹å†³å®šï¼Œç„¶åå‘ŠçŸ¥å‘é€æ–¹ã€‚åœ¨è®¡ç®—**æ ¡éªŒå’Œï¼ˆChecksumï¼‰** æ—¶éœ€è¦åŠ ä¸Šä¼ªé¦–éƒ¨ï¼Œä¼ªé¦–éƒ¨çš„å†…å®¹åŒ…æ‹¬æºç›® IP åœ°å€ï¼ŒTCP æŠ¥æ–‡æ®µé•¿åº¦ç­‰ã€‚å¦‚æœ URG æ ‡å¿—ä½è¢«è®¾å®šäº†ï¼Œé‚£**ç´§æ€¥æŒ‡é’ˆï¼ˆUrgent pointerï¼‰** ç”¨äºæŒ‡ç¤ºç´§æ€¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚åœ¨æŠ¥æ–‡æ®µæ•°æ®éƒ¨åˆ†ä¸­çš„åç§»é‡ã€‚æœ€åçš„ 40 Bytes ç•™ç»™**é€‰é¡¹ï¼ˆOptionsï¼‰**ã€‚\n### Flags\n - **URG**ï¼šä¸º 1 è¡¨ç¤ºæ•°æ®ä¸­æœ‰ç´§æ€¥æ•°æ®ã€‚è¿™ä¸ªæ ‡è®°æ¯”è¾ƒå°‘è§ï¼Œå¯ä»¥æ‰¾åˆ°çš„ä¸€äº›åº”ç”¨æœ‰ï¼š[FTP](https://stackoverflow.com/questions/24476458/understanding-tcp-urg-flag)ï¼Œ[Telnet](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)ï¼›\n - **ACK**ï¼šä¸º 1 è¡¨ç¤ºç¡®è®¤å·å­—æ®µæœ‰æ•ˆï¼›\n - **PSH**ï¼šä¸º 1 è¡¨ç¤ºæœ‰æ¨é€æ•°æ®ï¼Œè¿™ä¸ªå­—æ®µä¸»è¦å®Œæˆ[ä¸¤ä¸ªåŠŸèƒ½](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)ï¼šå‘é€æ–¹åº”ç”¨å±‚æé†’ TCP éœ€è¦ç«‹å³å‘é€æ•°æ®ï¼›æ¥å—æ–¹ TCP éœ€è¦å°†æ”¶åˆ°çš„æ•°æ®ç«‹å³æäº¤ç»™åº”ç”¨å±‚ï¼›\n - **RST**ï¼šä¸º 1 è¡¨ç¤ºå‡ºç°ä¸¥é‡å·®é”™ã€‚å¯èƒ½éœ€è¦é‡ç°åˆ›å»º TCP è¿æ¥ã€‚è¿˜å¯ä»¥ç”¨äºæ‹’ç»éæ³•çš„æŠ¥æ–‡æ®µå’Œæ‹’ç»è¿æ¥è¯·æ±‚ï¼›\n - **SYN**ï¼šä¸º 1 è¡¨ç¤ºè¿™æ˜¯è¿æ¥è¯·æ±‚æˆ–æ˜¯è¿æ¥æ¥å—è¯·æ±‚ï¼Œç”¨äºåˆ›å»ºè¿æ¥å’Œä½¿é¡ºåºå·åŒæ­¥ï¼›\n - **FIN**ï¼šä¸º 1 è¡¨ç¤ºå‘é€æ–¹æ²¡æœ‰æ•°æ®è¦ä¼ è¾“äº†ï¼Œè¦æ±‚é‡Šæ”¾è¿æ¥ï¼›\n\n## é˜¶æ®µ\nTCP è¿æ¥å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šå»ºç«‹è¿æ¥ï¼Œä¼ è¾“æ•°æ®ï¼Œç»ˆæ­¢è¿æ¥ã€‚å¯ä»¥ç”¨ä¸€ä¸ªæœ‰é™çŠ¶æ€æœºè¡¨ç¤ºï¼š\n![å›¾ 2 TCP è¿æ¥ (From: Computer Networks)<br>å›¾ä¸­ï¼ˆA/Bï¼‰è¿™æ ·çš„æ–‡å­—è¡¨ç¤ºâ€œæ”¶åˆ°Aåæ‰§è¡ŒBï¼ŒAä¸Bå¯ä»¥æ˜¯æ ‡å¿—ä½æˆ–è€…æŒ‡ä»¤â€<br>æ·±å®çº¿è¡¨ç¤º Client çš„è¡Œä¸ºï¼Œæ·±è™šçº¿è¡¨ç¤º Server çš„è¡Œä¸ºï¼Œæµ…è‰²çº¿è¡¨ç¤ºç‰¹æ®Šè¡Œä¸º](tcp_connection.png)\nä¸‹é¢ç»“åˆä¸€ä¸ªç”¨ Rust å†™çš„ Echo Server ä¸æŠ“åŒ…å·¥å…· Wireshark æ¥æ¼”ç¤ºè¿™ä¸‰ä¸ªè¿‡ç¨‹ã€‚ä»£ç å¦‚ä¸‹ï¼š\n{% include_code Echo Server lang:Rust echo_server.rs %}\nEcho Server å¯åŠ¨ä¹‹åä½¿ç”¨ telnet å·¥å…·è¿æ¥è‡³æœåŠ¡å™¨ï¼Œä¸æœåŠ¡å™¨äº¤äº’ä¸¤æ¬¡ï¼Œå³å›æ˜¾ä¸¤æ¬¡å­—ç¬¦ä¸²ï¼Œç„¶åä»é€€å‡º telnetã€‚æŠ“åˆ°çš„åŒ…æˆªå›¾å¦‚ä¸‹ï¼š\n![å›¾ 3 Wireshark æŠ“åŒ…](wireshark.png)\n\nåœ¨ä¸‹é¢çš„è¡¨è¿°ä¸­ï¼Œå®¢æˆ·ç«¯è¡¨ç¤ºåœ¨è¿™ä¸€é˜¶æ®µå…ˆå‘èµ·è¯·æ±‚çš„ä¸€æ–¹ï¼ŒæœåŠ¡ç«¯è¡¨ç¤ºåœ¨è¿™ä¸€é˜¶æ®µå…ˆæ¥å—è¯·æ±‚çš„ä¸€æ–¹ã€‚åœ¨ TCP ä¸­ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œä»–ä»¬å¯ä»¥ç†è§£ä¸ºå¯¹ç­‰çš„ï¼Œåœ¨è¿æ¥å»ºç«‹åï¼Œå®é™…ä¸Šæ²¡æœ‰æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„åŒºåˆ«ã€‚\n### å»ºç«‹è¿æ¥\nå‰ä¸‰ä¸ªåŒ…ä»£è¡¨äº†å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ï¼Œåˆ†ä¸ºä¸‰æ­¥ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å°±å¦‚åŒæŠ“åŒ…æ‰€ç¤ºï¼Œç§°ä¸º**ä¸‰æ¬¡æ¡æ‰‹ï¼ˆ3-way handshakeï¼‰**ã€‚å›¾ 2 ä¸­è¿˜ç”»å‡ºäº†åŒæ–¹åŒæ—¶æ‰“å¼€è¿æ¥ä¸è¿æ¥å¤ä½è¿™ä¸¤ç§æ¯”è¾ƒå°‘è§çš„æƒ…æ™¯ã€‚\n1. å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯ä¸€ä¸ª **SYN** æŠ¥æ–‡ï¼Œç”¨ä»¥å‘ŠçŸ¥æœåŠ¡ç«¯åˆå§‹åºå·ä¸º 0ï¼ˆæ­¤å¤„çš„ Seq ç»è¿‡ Wireshark çš„å¤„ç†ï¼Œå˜æˆäº†ç›¸å¯¹å€¼ï¼‰ï¼Œç„¶åå®¢æˆ·ç«¯è¿›å…¥ ***SYN_SENT*** çŠ¶æ€ã€‚\n2. æœåŠ¡å™¨æ”¶åˆ° 1 ä¸­æŠ¥æ–‡åï¼Œå‘ç»™å®¢æˆ·ç«¯ä¸€ä¸ª **SYN + ACK** æŠ¥æ–‡ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯åˆå§‹åºå·ä¸º 0ï¼Œä¸”æ¥ä¸‹æ¥æœŸæœ›ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„åºå· Ack ä¸º 1ã€‚æœåŠ¡ç«¯è¿›å…¥ ***SYN_RCVD*** çŠ¶æ€ã€‚å¯è§ **SYN æŠ¥æ–‡æ¶ˆè€—äº†ä¸€ä¸ªåºå·**ã€‚\n3. å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å›å¤ **ACK** æŠ¥æ–‡ï¼Œè¿›å…¥ ***ESTABLISHED*** çŠ¶æ€ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡è¿æ¥å»ºç«‹å®Œæˆã€‚å¯è§ **ACK æŠ¥æ–‡åœ¨ä¸æºå¸¦æ•°æ®çš„æƒ…å†µä¸‹ä¸æ¶ˆè€—åºå·**ã€‚\n\n### ä¼ è¾“æ•°æ®\nå›¾ 3 ä¸­ P17ï½P20 ä¸ P72ï½P74 åˆ†åˆ«å±•ç¤ºäº†ä¸¤æ¬¡äº¤äº’è¿‡ç¨‹ã€‚ä»¥ç¬¬äºŒæ¬¡äº¤äº’ä¸ºä¾‹ï¼š\n1. P72 ä¸­ï¼Œå®¢æˆ·ç«¯å°†æƒ³è¦å›æ˜¾å­—ç¬¦ä¸²å‘é€ç»™æœåŠ¡ç«¯ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨è¿™ä¸ªæŠ¥æ–‡æ®µçš„æ•°æ®é¦–å­—èŠ‚åºå·ä¸º 8ï¼Œå¹¶ä¸”å¸Œæœ›ä»æœåŠ¡ç«¯æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºå·æ˜¯ 8ã€‚\n2. æœåŠ¡ç«¯å°†å›æ˜¾çš„å­—ç¬¦ä¸²ä¸å¯¹ P72 çš„ç¡®è®¤ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ã€‚P72 çš„é•¿åº¦ä¸º 9ï¼Œå› æ­¤æŠ¥æ–‡æ®µä¸­æ•°æ®çš„åºå·èŒƒå›´ä¸º [8,17)ï¼Œå› æ­¤åœ¨ P73 ä¸­ Ack ä¸º 17ã€‚\n3. å®¢æˆ·ç«¯ç¡®è®¤ P73ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤æ¬¡äº¤äº’æœ‰æ‰€åŒºåˆ«ï¼šç¬¬ä¸€æ¬¡äº¤äº’æ—¶ï¼ŒæœåŠ¡ç«¯å…ˆè¿”å›äº†ä¸€ä¸ªç¡®è®¤ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå†é¢å¤–å‘é€ä¸€æ¡æºå¸¦å›æ˜¾å†…å®¹çš„æŠ¥æ–‡æ®µã€‚ä½†æ˜¯ç¬¬äºŒæ¬¡äº¤äº’æ—¶çœç•¥äº†å•ç‹¬çš„ç¡®è®¤ã€‚\n### ç»ˆæ­¢è¿æ¥\næ ¹æ®â€œå¹¿å¤§åšä¸»â€å†™ä½œçš„æ–‡ç« ä¸[é—®ç­”ç½‘ç«™çš„è®¨è®º](https://www.zhihu.com/question/50646354)ä»¥åŠå„ç§é¢ç»ï¼ŒåŸºæœ¬ä¸€è‡´è®¤ä¸ºï¼Œç»ˆæ­¢è¿æ¥é€šå¸¸è¢«æˆä¸º**å››æ¬¡æŒ¥æ‰‹ï¼ˆ4-way terminationï¼‰**ï¼Œå³é€šä¿¡åŒæ–¹ä¼šæœ‰å››æ¬¡äº¤äº’ï¼Œä½†æ˜¯å¦‚å›¾ 2 æ‰€ç¤ºï¼Œä¹Ÿå­˜åœ¨**ä¸‰æ¬¡æŒ¥æ‰‹**çš„å¯èƒ½æ€§ï¼Œä¸”æˆ‘æœ¬åœ°çš„å¤šæ¬¡æŠ“åŒ…ä¹Ÿå¦‚å›¾ 3 ä¸€è‡´â€”â€”å‡ä¸ºä¸‰æ¬¡æŒ¥æ‰‹ï¼Œä¸”æ— ä¸€ä¾‹å¤–ã€‚ä¸‹é¢å¯¹å››æ¬¡æŒ¥æ‰‹è¿›è¡Œåˆ†æï¼Œä¸‰æ¬¡æŒ¥æ‰‹å¯ä»¥è¢«å…¶æ¦‚æ‹¬ï¼š\n1. å®¢æˆ·ç«¯å‘èµ·ç»ˆæ­¢è¿æ¥ï¼Œå‘å‡ºä¸€ä¸ª **FIN** æŠ¥æ–‡ç»™æœåŠ¡ç«¯ï¼Œå‡è®¾è¯¥æŠ¥æ–‡çš„ Seq ä¸º Xï¼ŒAck ä¸º Yã€‚ç„¶åå®¢æˆ·ç«¯è¿›å…¥ ***FIN_WAIT1*** çŠ¶æ€ï¼Œé™¤é‡ä¼  FIN æŠ¥æ–‡ä¸å‘é€ ACK ç¡®è®¤ä¹‹å¤–ï¼Œä¸å†å‘é€åº”ç”¨æ•°æ®ç»™æœåŠ¡ç«¯ã€‚\n2. æœåŠ¡ç«¯æ”¶åˆ° FIN æŠ¥æ–‡æ®µåå…ˆå›å¤ä¸€ä¸ª **ACK** æŠ¥æ–‡ï¼Œè¿›å…¥ ***CLOSE_WAIT*** çŠ¶æ€ï¼Œè¯¥æŠ¥æ–‡çš„ Seq ä¸º Yï¼ŒAck ä¸º X+1ã€‚\n3. å®¢æˆ·ç«¯åœ¨æ”¶åˆ° FIN çš„ ACK ä¹‹åè¿›å…¥ ***FIN_WAIT2*** çŠ¶æ€ã€‚æ­¤æ—¶æœåŠ¡ç«¯è¿˜å¯ä»¥ç»§ç»­å°†æœªå‘é€å®Œçš„åº”ç”¨æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ã€‚\n4. æœåŠ¡ç«¯å‘é€å®Œæ•°æ®åå‘é€ä¸€æ¡ **FIN** æŠ¥æ–‡ï¼Œè¿›å…¥ ***LAST_ACK*** çŠ¶æ€ï¼Œè¯¥æŠ¥æ–‡çš„ Seq ä¸º Y+Kï¼ŒAck ä¸º X+1ã€‚\n5. å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ FIN åï¼Œå‘é€æœ€åçš„ **ACK** æŠ¥æ–‡ç»™æœåŠ¡å™¨ï¼Œç„¶åè¿›å…¥ ***TIME_WAIT*** çŠ¶æ€ã€‚å¦‚æœåœ¨ 2MSLï¼ˆæœ€å¤§æŠ¥æ–‡æ®µå¯¿å‘½ï¼Œé€šå¸¸ä¸º30ï½60sï¼‰åå®¢æˆ·ç«¯æ²¡å†æ¬¡æ”¶åˆ° FIN æŠ¥æ–‡ï¼Œåˆ™è¿›å…¥ ***CLOSED*** çŠ¶æ€ï¼Œå¦åˆ™é‡å‘ ACK æŠ¥æ–‡è¿›è¡Œé‡è¯•ã€‚\n6. æœåŠ¡ç«¯åœ¨æ”¶åˆ° ACK æŠ¥æ–‡åè¿›å…¥ ***CLOSED*** çŠ¶æ€ã€‚\n\nä¸‰æ¬¡æŒ¥æ‰‹è¡¨ç°ä¸ºæ­¥éª¤ 2ï½4 åˆå¹¶ä¸ºä¸€æ­¥ï¼Œå³åŒæ—¶å‘é€å¯¹å®¢æˆ·ç«¯ FIN çš„ ACK æŠ¥æ–‡ä¸ æœåŠ¡ç«¯è‡ªå·±çš„ FIN æŠ¥æ–‡ã€‚è¿™æ¡ **FIN+ACK** æŠ¥æ–‡çš„ Seq ä¸º Yï¼ŒAck ä¸º X+1ã€‚\n\nè‡³äºåœ¨ä»€ä¹ˆæƒ…æ™¯ä¸‹å‡ºç°ä¸‰æ¬¡æ¡æ‰‹æˆ–è€…å››æ¬¡æ¡æ‰‹ï¼Œå¤§å¤šæ•°çš„è§‚ç‚¹è®¤ä¸ºå…ˆæ”¶åˆ° FIN æŠ¥æ–‡çš„ä¸€æ–¹è¿˜éœ€è¦å‘ä¸Šå±‚åº”ç”¨è¯¢é—®æ˜¯å¦ä»ç„¶æœ‰æ•°æ®éœ€è¦å‘é€ï¼Œå› ä¸ºè¦ç­‰å¾…ä¸Šå±‚çš„å›å¤ï¼Œæ‰€ä»¥â€œä¸ºä½•ä¸æ—©ç‚¹æŠŠå¯¹ FIN çš„ ACK å‘å‡ºå»å‘¢ï¼Ÿï¼â€è€Œä¸”ç«‹å³ Ack èƒ½é˜²æ­¢å¯¹æ–¹é‡ä¼  FINã€‚ä½†æ˜¯æœ‰æ²¡æœ‰å­˜åœ¨ä¸éœ€è¦è¯¢é—®ä¸Šå±‚æˆ–è€…ä¸éœ€è¦ç«‹å³å›å¤ Ack çš„å¯èƒ½ï¼Œå°±å¦‚åŒä¼ è¾“æ•°æ®å‡ºç°çš„æƒ…å†µä¸€æ ·ï¼Œè¿™äº›åº”è¯¥ä¸ TCP çš„å…·ä½“å®ç°ç›¸å…³ï¼Œç›®å‰èƒ½åŠ›ä¸ç²¾åŠ›æœ‰é™ï¼Œè¿˜æœ‰å¾…å¯¹ [Linux TCP å®ç°æºç ](https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_output.c)è¿›è¡Œé˜…è¯»ã€‚\n## æ»‘åŠ¨çª—å£\næ»‘åŠ¨çª—å£æ˜¯ TCP ä¸­ç”¨äºå®ç°è¯¸å¦‚ ACK ç¡®è®¤ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶çš„æ‰¿è½½ç»“æ„ã€‚å¦‚å›¾æ‰€ç¤º:\n![å›¾ 4 æ»‘åŠ¨çª—å£](sliding_window.png)\nå…ˆå°† TCP çœ‹ä½œæ˜¯ç®€å•çš„å•å‘é€šä¿¡ï¼Œåˆ™å‘é€æ–¹æœ‰ä¸€ä¸ªå‘é€çª—å£ï¼Œæ¥æ”¶æ–¹æœ‰ä¸€ä¸ªæ¥æ”¶çª—å£ã€‚æ­£å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œä¼ è¾“çš„æ˜¯æŠ¥æ–‡æ®µï¼Œçª—å£å¤§å°çš„å•ä½æ˜¯å­—èŠ‚ã€‚ä¸¤ä¸ªçª—å£ä¸­**ç™½è‰²åŒºåŸŸ**ä¸ºç©ºç™½ä½ç½®ï¼Œç­‰å¾…è¢«åº”ç”¨å±‚æˆ–è€…ç½‘ç»œå±‚å¡«æ»¡ï¼›**ç°è‰²åŒºåŸŸ**æ˜¯å·²ç»å‘é€ä½†æ˜¯è¿˜æ²¡æœ‰æ¥å—åˆ°ç¡®è®¤çš„å­—èŠ‚ï¼›**ç²‰è‰²åŒºåŸŸ**åœ¨å‘é€çª—å£ä¸­è¡¨ç¤ºç­‰å¾…è¢«å‘é€çš„å­—èŠ‚ï¼Œåœ¨æ¥æ”¶çª—å£æ±‡æ€»è¡¨ç¤ºç­‰å¾…äº¤ä»˜çš„å­—èŠ‚ã€‚\nå‘é€çª—å£çš„å¤§å°ä¸ºæ¥å—æ–¹é€šè¿‡é¦–éƒ¨ä¸­çª—å£å¤§å°å­—æ®µå‘ŠçŸ¥çš„æ¥æ”¶çª—å£å¤§å° rwnd å’Œä¹‹åä¼šè®²åˆ°çš„æ‹¥å¡çª—å£çš„å¤§å° cwnd ä¸¤è€…ä¸­çš„è¾ƒå°å€¼ï¼Œå³ `min(rwnd , cwnd)`ã€‚æ¥æ”¶çª—å£å¤§å°æ˜¯æ¥æ”¶æ–¹å¯ç”¨ç¼“å­˜ç©ºé—´å¤§å°ï¼Œä¸º `rwnd = ç¼“å­˜å¤§å° - å‡†å¤‡äº¤ä»˜çš„å­—èŠ‚æ•°`ã€‚\n\n## æµé‡æ§åˆ¶\næµé‡æ§åˆ¶ç”¨äºå¹³è¡¡ç”Ÿäº§è€…äº§ç”Ÿæ•°æ®ä¸æ¶ˆè´¹è€…æ¶ˆè€—æ•°æ®çš„é€Ÿåº¦ã€‚TCP ä¸­çš„æµé‡æ§åˆ¶å®ç°çš„ä¸»è¦é€”å¾„æ˜¯ä¸æ–­è°ƒæ•´å‘é€çª—å£çš„å¤§å°å®ç°ã€‚å‘é€ TCP ä¸€æ—¦å‘ç°å‘é€å‘é€çª—å£æ»¡äº†å°±ä¼šå¯¹å‘é€è¿›ç¨‹è¿›è¡Œåé¦ˆã€‚æ¥å—æ–¹æ ¹æ®ä¹‹å‰ä»å‘é€æ–¹æ”¶åˆ°çš„æ•°æ®é‡å’ŒæœåŠ¡å™¨å·²ç»æ¶ˆè€—çš„æ•°æ®é‡å¾—åˆ°è‡ªèº«æ¥æ”¶çª—å£çš„å¤§å°ï¼Œå°†è¿™ä¸ªå€¼å‘ŠçŸ¥å‘é€æ–¹ï¼Œå‘é€æ–¹æ ¹æ®æ”¶åˆ°çš„çª—å£å¤§å°è°ƒæ•´è‡ªèº«çª—å£å¤§å°ã€‚\nè¿˜æœ‰æ­£å¯¹é€šä¿¡åŒæ–¹äº§ç”Ÿæ•°æ®å°æˆ–è€…æ¶ˆè´¹æ•°æ®æ…¢äº§ç”Ÿç³Šæ¶‚çª—å£ç»¼åˆå¾æ—¶ï¼Œæœ‰å…¶ä»–æ–¹é¢çš„æµé‡æ§åˆ¶ã€‚å½“å‘é€æ–¹æ•°æ®é‡ç›¸å¯¹äºé¦–éƒ¨å°å¾ˆå¤šçš„æŠ¥æ–‡å¾ˆå¤šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ **Nagle ç®—æ³•**å‡å°‘è¿™ç§å°æŠ¥æ–‡é‡ã€‚å½“æ¥å—æ–¹æ¶ˆè€—æ•°æ®å¾ˆæ…¢æ—¶ï¼Œæ¯æ¬¡å‘ŠçŸ¥å‘é€æ–¹çš„çª—å£å¤§å°ä¼šæ¯”è¾ƒå°ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿå¾ˆå¤šå°æŠ¥æ–‡ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ **Clark è§£å†³æ–¹æ³•**æˆ–è€…è¿›è¡Œ**æ¨è¿Ÿç¡®è®¤**ã€‚å…³äºè¿™å‡ ç§æ–¹æ¡ˆçš„åˆ†æåŠå…·ä½“çš„ä½¿ç”¨æƒ…æ™¯å¯ä»¥å‚è€ƒ dog520 å¤§ç¥çš„è¿™ç¯‡æ–‡ç« â€”â€”[å†æ¬¡è°ˆè°ˆ TCP çš„ Nagle ç®—æ³•ä¸ TCP_CORK é€‰é¡¹](https://blog.csdn.net/dog250/article/details/21303679)ã€‚\n## å·®é”™æ§åˆ¶\nå·®é”™æ§åˆ¶ç”¨äºæè¿° TCP åœ¨å‘é€æˆ–è€…æ¥å—åˆ°æŠ¥æ–‡æ®µå‘ç”Ÿå¼‚å¸¸æ—¶çš„è¡Œä¸ºï¼Œå…¶ä¸»è¦è¡¨ç°åœ¨å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n1. **æ ¡éªŒå’Œ**ï¼šåœ¨æ¥å—æ–¹ï¼Œå¦‚æœæ”¶åˆ°çš„æŠ¥æ–‡æ®µæœªé€šè¿‡æ ¡éªŒå’Œæ ¡éªŒï¼Œåˆ™ç«‹å³ä¸¢å¼ƒï¼Œåä¹‹ï¼Œåˆ™é€šè¿‡**ç¡®è®¤è§„åˆ™**ï¼ˆä¸‹é¢é©¬ä¸ŠæåŠï¼‰è¿›è¡Œç¡®è®¤ï¼›\n2. **é‡ä¼ **ï¼šåœ¨å‘é€æ–¹ï¼Œå¦‚æœä¸€ä¸ªæŠ¥æ–‡æ®µé‡ä¼ è¶…æ—¶è®¡æ—¶å™¨ï¼ˆRTOï¼‰è¶…æ—¶ï¼Œå³åœ¨ RTO æ—¶é—´ä¹‹åä»ç„¶æœªæ”¶åˆ° ACKï¼Œåˆ™ç«‹å³é‡ä¼ æœªè¢«ç¡®è®¤çš„æœ€å°çš„æŠ¥æ–‡æ®µï¼›å¦‚æœæ”¶åˆ°å››ä¸ªç›¸åŒçš„çš„ ACK ï¼Œåˆ™ç«‹å³é‡ä¼ ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µï¼›\n\n### ç¡®è®¤è§„åˆ™\n1. å½“æ¥å—æ–¹å‘å‘é€æ–¹å‘é€æ•°æ®æŠ¥æ–‡æ®µæ—¶ï¼Œå¿…é¡»**æå¸¦** ACKï¼›\n2. å½“æ¥å—æ–¹æ²¡æœ‰æ•°æ®è¦å‘é€æ—¶ï¼Œä½†æ˜¯æ”¶åˆ°ä¸€ä¸ª**æŒ‰åºåˆ°è¾¾**çš„æŠ¥æ–‡ï¼ŒåŒæ—¶å‰ä¸€ä¸ªæŠ¥æ–‡æ®µä¹Ÿå·²ç»ç¡®è®¤è¿‡äº†ï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹å°±æ¨è¿Ÿå‘é€ç¡®è®¤æŠ¥æ–‡æ®µï¼Œç›´åˆ°å¦ä¸€ä¸ªæŠ¥æ–‡æ®µåˆ°è¾¾æˆ–è€…å»¶è¿Ÿä¸€æ®µæ—¶é—´ä»¥å‡å°‘ ACK æŠ¥æ–‡é‡ï¼›\n3. å½“æ‰€æœŸæœ›çš„æŠ¥æ–‡æ®µåˆ°è¾¾ï¼Œä¸”å‰ä¸€ä¸ª**æŒ‰åºåˆ°è¾¾**çš„æŠ¥æ–‡è¿˜æœªè¢«ç¡®è®¤ï¼Œåˆ™ç«‹å³ ACKï¼ˆACK çš„åºå·ä»ç„¶æ˜¯ä¸‹ä¸€ä¸ªæ­£å¸¸æœŸæœ›çš„åºå·ï¼Œä¸‹åŒï¼‰ï¼›\n4. å½“åºå·æ¯”æœŸæœ›çš„å¤§çš„æŠ¥æ–‡æ®µï¼ˆ**å¤±åº**æŠ¥æ–‡æ®µï¼‰åˆ°è¾¾ï¼Œåˆ™ç«‹å³ ACKï¼Œä¸”å­˜å‚¨è¯¥æŠ¥æ–‡æ®µï¼›\n5. å½“**ä¸¢å¤±**çš„æŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œåˆ™ç«‹å³ ACKï¼›\n6. å½“**é‡å¤**çš„æŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œåˆ™ä¸¢å¼ƒï¼Œä¸”ç«‹å³ ACKï¼›\n\n## æ‹¥å¡æ§åˆ¶\næ‹¥å¡æ§åˆ¶æ˜¯ä¸ºäº†é¿å…å› ä¸ºç½‘ç»œå—é™å¯¼è‡´ç½‘ç»œä¸èƒ½æŒ‰ç…§å‘é€æ–¹äº§ç”Ÿçš„æ•°æ®çš„é€Ÿåº¦å°†æŠ¥æ–‡æ®µäº¤ä»˜ç»™æ¥å—æ–¹ã€‚ä¸æµé‡æ§åˆ¶è€ƒå¯Ÿçš„å¯¹è±¡æ˜¯é€šä¿¡åŒæ–¹ä¸åŒï¼Œæ‹¥å¡æ§åˆ¶çš„è€ƒå¯Ÿå¯¹è±¡æ˜¯é€šä¿¡åŒæ–¹é—´çš„ç½‘ç»œã€‚æ‹¥å¡æ§åˆ¶çš„æ–¹å¼è¡¨ç°åœ¨å‘é€æ–¹çš„æ‹¥å¡çª—å£çš„å˜åŒ–ï¼Œä»è€Œæ§åˆ¶å‘é€æ–¹çš„æ•°æ®å‘é€å¿«æ…¢ã€‚TCP æœ€åˆä½¿ç”¨çš„æ‹¥å¡ç­–ç•¥ç§°ä¸º **TCP Tahoe and Reno**ã€‚\n### Tahoe and Reno\nè¿™ä¸ªæ‹¥å¡ç­–ç•¥ä¸»è¦åˆ†ä¸ºæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€æ‹¥å¡æ£€æµ‹ä¸‰ä¸ªé˜¶æ®µã€‚\n#### æ…¢å¯åŠ¨\nå‡è®¾æ¥æ”¶çª—å£å¤§å°è¿œå¤§äºæ‹¥å¡çª—å£ï¼Œä¸”ä¸è€ƒè™‘å»¶è¿Ÿç¡®è®¤ã€‚æ‹¥å¡çª—å£å¤§å°ä»ä¸€ä¸ªæœ€å¤§æŠ¥æ–‡é•¿åº¦ MSS ï¼ˆè¿æ¥å»ºç«‹æ—¶é€šè¿‡ TCP é€‰é¡¹å‘ŠçŸ¥ï¼‰å¼€å§‹ï¼Œä¹‹åæ¯å½“æœ‰ä¸€ä¸ªæŠ¥æ–‡æ®µè¢«ç¡®è®¤ï¼Œæ‹¥å¡çª—å£å°±å¢å¤§ä¸€ä¸ª MSSã€‚åœ¨è¿™æ ·çš„ç­–ç•¥ä¸‹ï¼Œæ…¢å¯åŠ¨é˜¶æ®µçš„æ‹¥å¡çª—å£å¤§å°å‘ˆæŒ‡æ•°å¢é•¿ã€‚å³ä» `1 -> 2 -> 4 -> 8`ã€‚å½“åˆ°è¾¾æ…¢å¯åŠ¨é—¨é™æ—¶ï¼Œå°±è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚\n#### æ‹¥å¡é¿å…\næ‹¥å¡é¿å…é˜¶æ®µæ‹¥å¡çª—å£å¤§å°ç»§ç»­å¢åŠ ï¼Œä½†æ˜¯é€Ÿåº¦æ”¾æ…¢ï¼Œæ”¹æˆå½“æ•´ä¸ªçª—å£å¤§å°çš„æŠ¥æ–‡æ®µéƒ½è¢«ç¡®è®¤åï¼Œçª—å£å¤§å°æ‰å¢åŠ ä¸€ä¸ª MSSã€‚è¡¨ç°ä¸º `8 -> 9 -> 10 -> 11`ï¼Œå‘ˆç°çº¿æ€§å¢é•¿ã€‚\n#### æ‹¥å¡æ£€æµ‹\nå¦‚æœæ‹¥å¡å‘ç”Ÿäº†ï¼Œå› ä¸ºå‘ç”Ÿåœ¨ç½‘ç»œä¸­è·¯ç”±å™¨å‡ºç°ä¸¢åŒ…ç°è±¡ï¼Œåœ¨æ¥å—æ–¹å¤„çš„è¡¨ç°ä¸ºå‡ºç°ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼Œå¹¶åšå‡ºå¯¹åº”çš„ååº”ï¼š\n1. RTO è®¡æ—¶å™¨è¶…æ—¶ã€‚è¿™è¯´æ˜ç½‘ç»œæ‹¥å¡çš„å¯èƒ½æ€§è¾ƒå¤§ï¼ŒTCP åšå‡ºè¾ƒå¼ºçƒˆçš„ååº”ï¼š\n    a. æŠŠæ…¢å¯åŠ¨é—¨é™å€¼è°ƒæ•´ä¸ºå½“å‰çª—å£å¤§å°çš„ä¸€åŠï¼›\n    b. æŠŠ cwnd é‡æ–°è®¾ç½®ä¸º 1 MSSï¼›\n    c. é‡æ–°è¿›å…¥æ…¢å¯åŠ¨é˜¶æ®µï¼›\n\n2. æ”¶åˆ°å››ä¸ªç›¸åŒçš„ ACKï¼›è¯´æ˜å‡ºç°æ‹¥å¡çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯å‡ºç°äº†ä¸¢åŒ…ï¼ŒTCP åšå‡ºè¾ƒå¼±çš„ååº”ï¼ŒReno ç®—æ³•è¡¨ç°ä¸ºå¿«æ¢å¤ï¼ˆFast recoveryï¼‰ï¼š\n    a. æŠŠæ…¢å¯åŠ¨é—¨é™å€¼è°ƒæ•´ä¸ºå½“å‰çª—å£å¤§å°çš„ä¸€åŠï¼›\n    b. æŠŠ cwnd é‡æ–°è®¾ç½®ä¸ºæ…¢å¯åŠ¨é—¨é™å€¼ï¼›\n    c. é‡æ–°è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µï¼›\n\nå›¾ç¤ºå¦‚ä¸‹ï¼š\n![æ‹¥å¡æ§åˆ¶ç¤ºä¾‹](congestion_control_example.png)\nTahoe ç®—æ³•ä¸ Reno ï¼ˆTahoe çš„æ”¹è¿›ç‰ˆæœ¬ï¼‰çš„åŒºåˆ«åœ¨äºæ”¶åˆ°å››ä¸ªç›¸åŒ ACK æ—¶ï¼ŒTahoe ç®—æ³•çš„ç­–ç•¥å’Œ RTO è®¡æ—¶å™¨è¶…æ—¶æ—¶ä¸€è‡´ã€‚\n### å…¶ä»–æ‹¥å¡ç­–ç•¥\næ‹¥å¡æ§åˆ¶ç­–ç•¥åªéœ€è¦åœ¨å‘é€æ–¹å®ç°å³å¯ï¼Œä¸éœ€è¦æ¥å—æ–¹çš„å‚ä¸ï¼Œå› æ­¤å¯ä»¥ä»…åœ¨å‘é€æ–¹éƒ¨ç½²ä¸€å¥—ç®—æ³•ã€‚ç°åœ¨ TCP ç½‘ç»œä¸Šçš„ç®—æ³•ä¹Ÿåœ¨ä¸æ–­[æ”¹è¿›](https://en.wikipedia.org/wiki/TCP_congestion_control)ï¼Œæ¶Œç°å‡ºè¯¸å¦‚ [**TCP CUBIC**](http://www4.ncsu.edu/~rhee/export/bitcp/cubic-paper.pdf)ã€[**TCP BBR**](https://ai.google/research/pubs/pub45646) è¿™æ ·çš„ç®—æ³•ã€‚\n\n## TCP ä¸­çš„è®¡æ—¶å™¨\n### é‡ä¼ è®¡æ—¶å™¨\né‡ä¼ è®¡æ—¶å™¨çš„è¶…æ—¶æ—¶é—´ä¸º RTOï¼ŒRTO ä¸»è¦æ ¹æ®æµ‹é‡æ‰€å¾—çš„æŠ¥æ–‡æ®µå¾€è¿”æ—¶é—´ RTTmè®¡ç®—è€Œæ¥ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\né¦–å…ˆè®¡ç®—å¹³æ»‘ RTTï¼Œå³RTTsï¼š\n```\nRTTs = RTTm // ç¬¬ä¸€æ¬¡æµ‹é‡\nRTTs = (1 - Î±)RTTs + Î±RTTm // éšåçš„æµ‹é‡\n```\nç„¶åè®¡ç®— RTT çš„åå·® RTTdï¼š\n```\nRTTd = RTTm / 2 // ç¬¬ä¸€æ¬¡æµ‹é‡\nRTTd = (1 - Î²)RTTd + Î²|RTTs - RTTm| // éšåçš„æµ‹é‡\n```\né‡ä¼ è¶…æ—¶ RTO çš„è®¡ç®—å¦‚ä¸‹ï¼š\n```\nRTO = 6s // åŸå§‹å€¼\nRTO = RTTs + 4RTTd // ç¬¬ä¸€æ¬¡æµ‹é‡å\n```\nä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ª RTT åœ¨è¿›è¡Œæµ‹é‡ï¼Œå½“é‡ä¼ å‘ç”Ÿæ—¶ä¼šå½±å“ RTT çš„æµ‹é‡ï¼Œæ ¹æ® **Karn ç®—æ³•**ï¼ŒTCP å¿½ç•¥é‡ä¼ æŠ¥æ–‡çš„ RTTï¼Œè€Œå¯¹äºé‡ä¼ çš„æŠ¥æ–‡ï¼ŒRTO å€¼ä¸ºåŸæŠ¥æ–‡çš„ä¸¤å€ï¼Œå¦‚æœå‘ç”Ÿç¬¬äºŒæ¬¡é‡ä¼ ï¼Œåˆ™ä¸ºå››å€ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n### æŒç»­è®¡æ—¶å™¨\nå½“æ¥å—æ–¹å‘é€çª—å£å€¼ä¸º 0 çš„æŠ¥æ–‡æ®µä¹‹åï¼Œåæ¥å› ä¸ºæ¥æ”¶çª—å£å¢åŠ éœ€è¦é€šå‘Šæ¥çª—å£ä¸ºé 0ï¼Œä½†æ˜¯é€šå‘Šçš„ ACK ä¸¢å¤±ï¼Œè¿™ä¼šå¯¼è‡´å‘é€æ–¹ä¸€ç›´ç­‰å¾…é 0 çª—å£é€šå‘Šï¼Œå¯¼è‡´æ­»é”ã€‚æŒç»­è®¡æ—¶å™¨å°±æ˜¯æ¥å—æ–¹åœ¨æ”¶åˆ° 0 çª—å£é€šå‘Šåå¯ç”¨ï¼Œå¦‚æœè¶…æ—¶åˆ™å‘é€æ¢æµ‹æŠ¥æ–‡ï¼Œä¿ƒä½¿æ¥å—æ–¹é‡ä¼  ACKã€‚\n### Keep-Alive è®¡æ—¶å™¨\nKeep-Alive è®¡æ—¶å™¨ç”¨äºé˜²æ­¢ TCP è¿æ¥é•¿æ—¶é—´ç©ºé—²ï¼Œæ¯å½“æ”¶åˆ°å¯¹æ–¹çš„æŠ¥æ–‡æ®µï¼Œè¿™ä¸ªè®¡æ—¶å™¨å°±å¤ä½ã€‚è¿™ä¸ªè®¡æ—¶å™¨çš„è¶…æ—¶æ—¶é—´é€šå¸¸å¯ä»¥é€šè¿‡æ¥å£è¿›è¡Œè®¾å®šã€‚\n### Time-Wait è®¡æ—¶å™¨\nTime-Wait è®¡æ—¶å™¨å¯¹æœ€åçš„ FIN è¿›è¡Œç¡®è®¤æ—¶å¯åŠ¨çš„è¶…æ—¶è®¡æ—¶å™¨ã€‚å¦‚æœåœ¨æ—¶å¸¸ä¸º 2MSL çš„è®¡æ—¶å™¨è¶…æ—¶å‰å†æ¬¡æ”¶åˆ° FINï¼Œåˆ™é‡ä¼  ACKï¼Œå¦åˆ™è¿æ¥å½»åº•å…³é—­ã€‚\n\n## ä¼ è¾“å±‚çš„[æœªæ¥](https://blog.apnic.net/2017/12/12/internet-protocols-changing/)\n[QIUC](https://www.chromium.org/quic) äº†è§£ä¸€ä¸‹ä¸‹ï¼Ÿ\n\n## å‚è€ƒèµ„æ–™\n1. [TCP/IP åè®®æ— ç¬¬å››ç‰ˆ](https://book.douban.com/subject/5386194/)\n2. [Andrew S.Tanenbaum - Computer Networks 5th](https://book.douban.com/subject/5344443/)\n3. [WikiPedia - Transmission Control Protocol](https://en.wikipedia.org/wiki/Transmission_Control_Protocol)\n4. [WikiPedia - TCP congestion control](https://en.wikipedia.org/wiki/TCP_congestion_contro)\n5. [TCP Flags: PSH and URG](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)\n6. [KTH - Internetworking Lecture 4](https://www.nada.kth.se/kurser/kth/2D1392/05/lectures/lecture_4.pdf)\n7. [ä¸€ä¸ª TCP FIN_WAIT2 çŠ¶æ€ç»†èŠ‚å¼•å‘çš„æ„Ÿæ…¨](https://blog.csdn.net/dog250/article/details/81256550)","source":"_posts/tcp.md","raw":"---\ntitle: TCP æ¸©æ•…çŸ¥æ–°\nkeywords: []\ndate: 2018/7/20\ntags: [Network]\ncategories:\n---\nç”Ÿäº§ç¯å¢ƒé‡åˆ°äº›ç½‘ç»œé—®é¢˜ï¼ŒçŸ¥å¯¹ TCP åè®®è¿˜æ˜¯æœ‰äº›ç”Ÿç–ï¼Œåœ¨æ­¤å¤ä¹ è®°å½•ã€‚\n<!-- more -->\n## åè®®\n### æŠ¥æ–‡æ®µæ ¼å¼\nTCP åè®®æŠ¥æ–‡æ®µä¸»è¦ç”±**é¦–éƒ¨ï¼ˆHeaderï¼‰** ä¸**æ•°æ®ï¼ˆDataï¼‰** ä¸¤éƒ¨åˆ†ç»„æˆã€‚åœ¨è®¡ç®—æ ¡éªŒå’Œæ˜¯è¿˜ä¼šåŠ ä¸Šè™šæ‹Ÿçš„ä¼ªé¦–éƒ¨ã€‚æ­¤å¤„ä¸»è¦è¯´æ˜é¦–éƒ¨çš„ç»„æˆã€‚\n![å›¾ 1 TCP Header (From: WikiPedia)](tcp_header.png)\nTCP åœ¨ç½‘ç»œæ¨¡å‹ä¸­å±äºè¿è¾“å±‚ï¼Œç”¨äºæä¾›è¿›ç¨‹ä¸è¿›ç¨‹é—´çš„å­—èŠ‚æµé€šä¿¡æœåŠ¡ï¼Œå› æ­¤éœ€è¦**æº / ç›®ç«¯å£ï¼ˆSource / Destination portï¼‰** ä»¥ç¡®å®šé€šä¿¡åŒæ–¹è¿›ç¨‹ã€‚ä½¿ç”¨**åºå·ï¼ˆSequence numberï¼Œseqï¼‰** è¡¨æ˜æœ¬æŠ¥æ–‡æ®µç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„ç¼–å·ï¼Œåˆå§‹åºå·ç”±åŒæ–¹åœ¨ TCP è¿æ¥å»ºç«‹æ—¶éšæœºç”Ÿæˆã€‚ä½¿ç”¨**ç¡®è®¤å·ï¼ˆAcknowledgment numberï¼Œackï¼‰** è¡¨ç¤ºæ¥å—æ–¹æœŸæœ›ä»å‘é€æ–¹æ¥å—çš„å­—èŠ‚ç¼–å·ã€‚**æ•°æ®åç§»é‡ï¼ˆData Offsetï¼‰** é¡¾åæ€ä¹‰æŠ¥æ–‡æ®µæ•°æ®å¼€å§‹å­—èŠ‚å¤„çš„åç§»é‡ï¼Œå³ TCP header çš„é•¿åº¦ï¼Œç”±äºé€‰é¡¹çš„å­˜åœ¨ï¼Œé¦–éƒ¨é•¿åº¦çš„èŒƒå›´æ˜¯ 20ï½60 Bytesï¼Œä½†æ˜¯è¯¥å­—æ®µåªæœ‰ 4 Bitsï¼Œå› æ­¤è¯¥å­—æ®µæŒ‡å‡ºé¦–éƒ¨é•¿åº¦æœ‰å¤šå°‘ä¸ª 4 Bytesã€‚æ¥ä¸‹æ¥çš„ 3 Bits è¢«**ä¿ç•™ï¼ˆReservedï¼‰** ã€‚éšåä¼šè®¨è®º 9 ä¸ª**æ ‡å¿—ä½ï¼ˆFlagsï¼‰**ã€‚**çª—å£å¤§å°ï¼ˆWindow Sizeï¼‰** å®šä¹‰äº†æ¥å—æ–¹çš„æ¥å—çª—å£å¤§å°ï¼Œç”±æ¥å—æ–¹å†³å®šï¼Œç„¶åå‘ŠçŸ¥å‘é€æ–¹ã€‚åœ¨è®¡ç®—**æ ¡éªŒå’Œï¼ˆChecksumï¼‰** æ—¶éœ€è¦åŠ ä¸Šä¼ªé¦–éƒ¨ï¼Œä¼ªé¦–éƒ¨çš„å†…å®¹åŒ…æ‹¬æºç›® IP åœ°å€ï¼ŒTCP æŠ¥æ–‡æ®µé•¿åº¦ç­‰ã€‚å¦‚æœ URG æ ‡å¿—ä½è¢«è®¾å®šäº†ï¼Œé‚£**ç´§æ€¥æŒ‡é’ˆï¼ˆUrgent pointerï¼‰** ç”¨äºæŒ‡ç¤ºç´§æ€¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚åœ¨æŠ¥æ–‡æ®µæ•°æ®éƒ¨åˆ†ä¸­çš„åç§»é‡ã€‚æœ€åçš„ 40 Bytes ç•™ç»™**é€‰é¡¹ï¼ˆOptionsï¼‰**ã€‚\n### Flags\n - **URG**ï¼šä¸º 1 è¡¨ç¤ºæ•°æ®ä¸­æœ‰ç´§æ€¥æ•°æ®ã€‚è¿™ä¸ªæ ‡è®°æ¯”è¾ƒå°‘è§ï¼Œå¯ä»¥æ‰¾åˆ°çš„ä¸€äº›åº”ç”¨æœ‰ï¼š[FTP](https://stackoverflow.com/questions/24476458/understanding-tcp-urg-flag)ï¼Œ[Telnet](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)ï¼›\n - **ACK**ï¼šä¸º 1 è¡¨ç¤ºç¡®è®¤å·å­—æ®µæœ‰æ•ˆï¼›\n - **PSH**ï¼šä¸º 1 è¡¨ç¤ºæœ‰æ¨é€æ•°æ®ï¼Œè¿™ä¸ªå­—æ®µä¸»è¦å®Œæˆ[ä¸¤ä¸ªåŠŸèƒ½](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)ï¼šå‘é€æ–¹åº”ç”¨å±‚æé†’ TCP éœ€è¦ç«‹å³å‘é€æ•°æ®ï¼›æ¥å—æ–¹ TCP éœ€è¦å°†æ”¶åˆ°çš„æ•°æ®ç«‹å³æäº¤ç»™åº”ç”¨å±‚ï¼›\n - **RST**ï¼šä¸º 1 è¡¨ç¤ºå‡ºç°ä¸¥é‡å·®é”™ã€‚å¯èƒ½éœ€è¦é‡ç°åˆ›å»º TCP è¿æ¥ã€‚è¿˜å¯ä»¥ç”¨äºæ‹’ç»éæ³•çš„æŠ¥æ–‡æ®µå’Œæ‹’ç»è¿æ¥è¯·æ±‚ï¼›\n - **SYN**ï¼šä¸º 1 è¡¨ç¤ºè¿™æ˜¯è¿æ¥è¯·æ±‚æˆ–æ˜¯è¿æ¥æ¥å—è¯·æ±‚ï¼Œç”¨äºåˆ›å»ºè¿æ¥å’Œä½¿é¡ºåºå·åŒæ­¥ï¼›\n - **FIN**ï¼šä¸º 1 è¡¨ç¤ºå‘é€æ–¹æ²¡æœ‰æ•°æ®è¦ä¼ è¾“äº†ï¼Œè¦æ±‚é‡Šæ”¾è¿æ¥ï¼›\n\n## é˜¶æ®µ\nTCP è¿æ¥å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šå»ºç«‹è¿æ¥ï¼Œä¼ è¾“æ•°æ®ï¼Œç»ˆæ­¢è¿æ¥ã€‚å¯ä»¥ç”¨ä¸€ä¸ªæœ‰é™çŠ¶æ€æœºè¡¨ç¤ºï¼š\n![å›¾ 2 TCP è¿æ¥ (From: Computer Networks)<br>å›¾ä¸­ï¼ˆA/Bï¼‰è¿™æ ·çš„æ–‡å­—è¡¨ç¤ºâ€œæ”¶åˆ°Aåæ‰§è¡ŒBï¼ŒAä¸Bå¯ä»¥æ˜¯æ ‡å¿—ä½æˆ–è€…æŒ‡ä»¤â€<br>æ·±å®çº¿è¡¨ç¤º Client çš„è¡Œä¸ºï¼Œæ·±è™šçº¿è¡¨ç¤º Server çš„è¡Œä¸ºï¼Œæµ…è‰²çº¿è¡¨ç¤ºç‰¹æ®Šè¡Œä¸º](tcp_connection.png)\nä¸‹é¢ç»“åˆä¸€ä¸ªç”¨ Rust å†™çš„ Echo Server ä¸æŠ“åŒ…å·¥å…· Wireshark æ¥æ¼”ç¤ºè¿™ä¸‰ä¸ªè¿‡ç¨‹ã€‚ä»£ç å¦‚ä¸‹ï¼š\n{% include_code Echo Server lang:Rust echo_server.rs %}\nEcho Server å¯åŠ¨ä¹‹åä½¿ç”¨ telnet å·¥å…·è¿æ¥è‡³æœåŠ¡å™¨ï¼Œä¸æœåŠ¡å™¨äº¤äº’ä¸¤æ¬¡ï¼Œå³å›æ˜¾ä¸¤æ¬¡å­—ç¬¦ä¸²ï¼Œç„¶åä»é€€å‡º telnetã€‚æŠ“åˆ°çš„åŒ…æˆªå›¾å¦‚ä¸‹ï¼š\n![å›¾ 3 Wireshark æŠ“åŒ…](wireshark.png)\n\nåœ¨ä¸‹é¢çš„è¡¨è¿°ä¸­ï¼Œå®¢æˆ·ç«¯è¡¨ç¤ºåœ¨è¿™ä¸€é˜¶æ®µå…ˆå‘èµ·è¯·æ±‚çš„ä¸€æ–¹ï¼ŒæœåŠ¡ç«¯è¡¨ç¤ºåœ¨è¿™ä¸€é˜¶æ®µå…ˆæ¥å—è¯·æ±‚çš„ä¸€æ–¹ã€‚åœ¨ TCP ä¸­ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œä»–ä»¬å¯ä»¥ç†è§£ä¸ºå¯¹ç­‰çš„ï¼Œåœ¨è¿æ¥å»ºç«‹åï¼Œå®é™…ä¸Šæ²¡æœ‰æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„åŒºåˆ«ã€‚\n### å»ºç«‹è¿æ¥\nå‰ä¸‰ä¸ªåŒ…ä»£è¡¨äº†å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ï¼Œåˆ†ä¸ºä¸‰æ­¥ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å°±å¦‚åŒæŠ“åŒ…æ‰€ç¤ºï¼Œç§°ä¸º**ä¸‰æ¬¡æ¡æ‰‹ï¼ˆ3-way handshakeï¼‰**ã€‚å›¾ 2 ä¸­è¿˜ç”»å‡ºäº†åŒæ–¹åŒæ—¶æ‰“å¼€è¿æ¥ä¸è¿æ¥å¤ä½è¿™ä¸¤ç§æ¯”è¾ƒå°‘è§çš„æƒ…æ™¯ã€‚\n1. å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯ä¸€ä¸ª **SYN** æŠ¥æ–‡ï¼Œç”¨ä»¥å‘ŠçŸ¥æœåŠ¡ç«¯åˆå§‹åºå·ä¸º 0ï¼ˆæ­¤å¤„çš„ Seq ç»è¿‡ Wireshark çš„å¤„ç†ï¼Œå˜æˆäº†ç›¸å¯¹å€¼ï¼‰ï¼Œç„¶åå®¢æˆ·ç«¯è¿›å…¥ ***SYN_SENT*** çŠ¶æ€ã€‚\n2. æœåŠ¡å™¨æ”¶åˆ° 1 ä¸­æŠ¥æ–‡åï¼Œå‘ç»™å®¢æˆ·ç«¯ä¸€ä¸ª **SYN + ACK** æŠ¥æ–‡ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯åˆå§‹åºå·ä¸º 0ï¼Œä¸”æ¥ä¸‹æ¥æœŸæœ›ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„åºå· Ack ä¸º 1ã€‚æœåŠ¡ç«¯è¿›å…¥ ***SYN_RCVD*** çŠ¶æ€ã€‚å¯è§ **SYN æŠ¥æ–‡æ¶ˆè€—äº†ä¸€ä¸ªåºå·**ã€‚\n3. å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å›å¤ **ACK** æŠ¥æ–‡ï¼Œè¿›å…¥ ***ESTABLISHED*** çŠ¶æ€ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡è¿æ¥å»ºç«‹å®Œæˆã€‚å¯è§ **ACK æŠ¥æ–‡åœ¨ä¸æºå¸¦æ•°æ®çš„æƒ…å†µä¸‹ä¸æ¶ˆè€—åºå·**ã€‚\n\n### ä¼ è¾“æ•°æ®\nå›¾ 3 ä¸­ P17ï½P20 ä¸ P72ï½P74 åˆ†åˆ«å±•ç¤ºäº†ä¸¤æ¬¡äº¤äº’è¿‡ç¨‹ã€‚ä»¥ç¬¬äºŒæ¬¡äº¤äº’ä¸ºä¾‹ï¼š\n1. P72 ä¸­ï¼Œå®¢æˆ·ç«¯å°†æƒ³è¦å›æ˜¾å­—ç¬¦ä¸²å‘é€ç»™æœåŠ¡ç«¯ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨è¿™ä¸ªæŠ¥æ–‡æ®µçš„æ•°æ®é¦–å­—èŠ‚åºå·ä¸º 8ï¼Œå¹¶ä¸”å¸Œæœ›ä»æœåŠ¡ç«¯æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºå·æ˜¯ 8ã€‚\n2. æœåŠ¡ç«¯å°†å›æ˜¾çš„å­—ç¬¦ä¸²ä¸å¯¹ P72 çš„ç¡®è®¤ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ã€‚P72 çš„é•¿åº¦ä¸º 9ï¼Œå› æ­¤æŠ¥æ–‡æ®µä¸­æ•°æ®çš„åºå·èŒƒå›´ä¸º [8,17)ï¼Œå› æ­¤åœ¨ P73 ä¸­ Ack ä¸º 17ã€‚\n3. å®¢æˆ·ç«¯ç¡®è®¤ P73ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤æ¬¡äº¤äº’æœ‰æ‰€åŒºåˆ«ï¼šç¬¬ä¸€æ¬¡äº¤äº’æ—¶ï¼ŒæœåŠ¡ç«¯å…ˆè¿”å›äº†ä¸€ä¸ªç¡®è®¤ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå†é¢å¤–å‘é€ä¸€æ¡æºå¸¦å›æ˜¾å†…å®¹çš„æŠ¥æ–‡æ®µã€‚ä½†æ˜¯ç¬¬äºŒæ¬¡äº¤äº’æ—¶çœç•¥äº†å•ç‹¬çš„ç¡®è®¤ã€‚\n### ç»ˆæ­¢è¿æ¥\næ ¹æ®â€œå¹¿å¤§åšä¸»â€å†™ä½œçš„æ–‡ç« ä¸[é—®ç­”ç½‘ç«™çš„è®¨è®º](https://www.zhihu.com/question/50646354)ä»¥åŠå„ç§é¢ç»ï¼ŒåŸºæœ¬ä¸€è‡´è®¤ä¸ºï¼Œç»ˆæ­¢è¿æ¥é€šå¸¸è¢«æˆä¸º**å››æ¬¡æŒ¥æ‰‹ï¼ˆ4-way terminationï¼‰**ï¼Œå³é€šä¿¡åŒæ–¹ä¼šæœ‰å››æ¬¡äº¤äº’ï¼Œä½†æ˜¯å¦‚å›¾ 2 æ‰€ç¤ºï¼Œä¹Ÿå­˜åœ¨**ä¸‰æ¬¡æŒ¥æ‰‹**çš„å¯èƒ½æ€§ï¼Œä¸”æˆ‘æœ¬åœ°çš„å¤šæ¬¡æŠ“åŒ…ä¹Ÿå¦‚å›¾ 3 ä¸€è‡´â€”â€”å‡ä¸ºä¸‰æ¬¡æŒ¥æ‰‹ï¼Œä¸”æ— ä¸€ä¾‹å¤–ã€‚ä¸‹é¢å¯¹å››æ¬¡æŒ¥æ‰‹è¿›è¡Œåˆ†æï¼Œä¸‰æ¬¡æŒ¥æ‰‹å¯ä»¥è¢«å…¶æ¦‚æ‹¬ï¼š\n1. å®¢æˆ·ç«¯å‘èµ·ç»ˆæ­¢è¿æ¥ï¼Œå‘å‡ºä¸€ä¸ª **FIN** æŠ¥æ–‡ç»™æœåŠ¡ç«¯ï¼Œå‡è®¾è¯¥æŠ¥æ–‡çš„ Seq ä¸º Xï¼ŒAck ä¸º Yã€‚ç„¶åå®¢æˆ·ç«¯è¿›å…¥ ***FIN_WAIT1*** çŠ¶æ€ï¼Œé™¤é‡ä¼  FIN æŠ¥æ–‡ä¸å‘é€ ACK ç¡®è®¤ä¹‹å¤–ï¼Œä¸å†å‘é€åº”ç”¨æ•°æ®ç»™æœåŠ¡ç«¯ã€‚\n2. æœåŠ¡ç«¯æ”¶åˆ° FIN æŠ¥æ–‡æ®µåå…ˆå›å¤ä¸€ä¸ª **ACK** æŠ¥æ–‡ï¼Œè¿›å…¥ ***CLOSE_WAIT*** çŠ¶æ€ï¼Œè¯¥æŠ¥æ–‡çš„ Seq ä¸º Yï¼ŒAck ä¸º X+1ã€‚\n3. å®¢æˆ·ç«¯åœ¨æ”¶åˆ° FIN çš„ ACK ä¹‹åè¿›å…¥ ***FIN_WAIT2*** çŠ¶æ€ã€‚æ­¤æ—¶æœåŠ¡ç«¯è¿˜å¯ä»¥ç»§ç»­å°†æœªå‘é€å®Œçš„åº”ç”¨æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ã€‚\n4. æœåŠ¡ç«¯å‘é€å®Œæ•°æ®åå‘é€ä¸€æ¡ **FIN** æŠ¥æ–‡ï¼Œè¿›å…¥ ***LAST_ACK*** çŠ¶æ€ï¼Œè¯¥æŠ¥æ–‡çš„ Seq ä¸º Y+Kï¼ŒAck ä¸º X+1ã€‚\n5. å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ FIN åï¼Œå‘é€æœ€åçš„ **ACK** æŠ¥æ–‡ç»™æœåŠ¡å™¨ï¼Œç„¶åè¿›å…¥ ***TIME_WAIT*** çŠ¶æ€ã€‚å¦‚æœåœ¨ 2MSLï¼ˆæœ€å¤§æŠ¥æ–‡æ®µå¯¿å‘½ï¼Œé€šå¸¸ä¸º30ï½60sï¼‰åå®¢æˆ·ç«¯æ²¡å†æ¬¡æ”¶åˆ° FIN æŠ¥æ–‡ï¼Œåˆ™è¿›å…¥ ***CLOSED*** çŠ¶æ€ï¼Œå¦åˆ™é‡å‘ ACK æŠ¥æ–‡è¿›è¡Œé‡è¯•ã€‚\n6. æœåŠ¡ç«¯åœ¨æ”¶åˆ° ACK æŠ¥æ–‡åè¿›å…¥ ***CLOSED*** çŠ¶æ€ã€‚\n\nä¸‰æ¬¡æŒ¥æ‰‹è¡¨ç°ä¸ºæ­¥éª¤ 2ï½4 åˆå¹¶ä¸ºä¸€æ­¥ï¼Œå³åŒæ—¶å‘é€å¯¹å®¢æˆ·ç«¯ FIN çš„ ACK æŠ¥æ–‡ä¸ æœåŠ¡ç«¯è‡ªå·±çš„ FIN æŠ¥æ–‡ã€‚è¿™æ¡ **FIN+ACK** æŠ¥æ–‡çš„ Seq ä¸º Yï¼ŒAck ä¸º X+1ã€‚\n\nè‡³äºåœ¨ä»€ä¹ˆæƒ…æ™¯ä¸‹å‡ºç°ä¸‰æ¬¡æ¡æ‰‹æˆ–è€…å››æ¬¡æ¡æ‰‹ï¼Œå¤§å¤šæ•°çš„è§‚ç‚¹è®¤ä¸ºå…ˆæ”¶åˆ° FIN æŠ¥æ–‡çš„ä¸€æ–¹è¿˜éœ€è¦å‘ä¸Šå±‚åº”ç”¨è¯¢é—®æ˜¯å¦ä»ç„¶æœ‰æ•°æ®éœ€è¦å‘é€ï¼Œå› ä¸ºè¦ç­‰å¾…ä¸Šå±‚çš„å›å¤ï¼Œæ‰€ä»¥â€œä¸ºä½•ä¸æ—©ç‚¹æŠŠå¯¹ FIN çš„ ACK å‘å‡ºå»å‘¢ï¼Ÿï¼â€è€Œä¸”ç«‹å³ Ack èƒ½é˜²æ­¢å¯¹æ–¹é‡ä¼  FINã€‚ä½†æ˜¯æœ‰æ²¡æœ‰å­˜åœ¨ä¸éœ€è¦è¯¢é—®ä¸Šå±‚æˆ–è€…ä¸éœ€è¦ç«‹å³å›å¤ Ack çš„å¯èƒ½ï¼Œå°±å¦‚åŒä¼ è¾“æ•°æ®å‡ºç°çš„æƒ…å†µä¸€æ ·ï¼Œè¿™äº›åº”è¯¥ä¸ TCP çš„å…·ä½“å®ç°ç›¸å…³ï¼Œç›®å‰èƒ½åŠ›ä¸ç²¾åŠ›æœ‰é™ï¼Œè¿˜æœ‰å¾…å¯¹ [Linux TCP å®ç°æºç ](https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_output.c)è¿›è¡Œé˜…è¯»ã€‚\n## æ»‘åŠ¨çª—å£\næ»‘åŠ¨çª—å£æ˜¯ TCP ä¸­ç”¨äºå®ç°è¯¸å¦‚ ACK ç¡®è®¤ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶çš„æ‰¿è½½ç»“æ„ã€‚å¦‚å›¾æ‰€ç¤º:\n![å›¾ 4 æ»‘åŠ¨çª—å£](sliding_window.png)\nå…ˆå°† TCP çœ‹ä½œæ˜¯ç®€å•çš„å•å‘é€šä¿¡ï¼Œåˆ™å‘é€æ–¹æœ‰ä¸€ä¸ªå‘é€çª—å£ï¼Œæ¥æ”¶æ–¹æœ‰ä¸€ä¸ªæ¥æ”¶çª—å£ã€‚æ­£å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œä¼ è¾“çš„æ˜¯æŠ¥æ–‡æ®µï¼Œçª—å£å¤§å°çš„å•ä½æ˜¯å­—èŠ‚ã€‚ä¸¤ä¸ªçª—å£ä¸­**ç™½è‰²åŒºåŸŸ**ä¸ºç©ºç™½ä½ç½®ï¼Œç­‰å¾…è¢«åº”ç”¨å±‚æˆ–è€…ç½‘ç»œå±‚å¡«æ»¡ï¼›**ç°è‰²åŒºåŸŸ**æ˜¯å·²ç»å‘é€ä½†æ˜¯è¿˜æ²¡æœ‰æ¥å—åˆ°ç¡®è®¤çš„å­—èŠ‚ï¼›**ç²‰è‰²åŒºåŸŸ**åœ¨å‘é€çª—å£ä¸­è¡¨ç¤ºç­‰å¾…è¢«å‘é€çš„å­—èŠ‚ï¼Œåœ¨æ¥æ”¶çª—å£æ±‡æ€»è¡¨ç¤ºç­‰å¾…äº¤ä»˜çš„å­—èŠ‚ã€‚\nå‘é€çª—å£çš„å¤§å°ä¸ºæ¥å—æ–¹é€šè¿‡é¦–éƒ¨ä¸­çª—å£å¤§å°å­—æ®µå‘ŠçŸ¥çš„æ¥æ”¶çª—å£å¤§å° rwnd å’Œä¹‹åä¼šè®²åˆ°çš„æ‹¥å¡çª—å£çš„å¤§å° cwnd ä¸¤è€…ä¸­çš„è¾ƒå°å€¼ï¼Œå³ `min(rwnd , cwnd)`ã€‚æ¥æ”¶çª—å£å¤§å°æ˜¯æ¥æ”¶æ–¹å¯ç”¨ç¼“å­˜ç©ºé—´å¤§å°ï¼Œä¸º `rwnd = ç¼“å­˜å¤§å° - å‡†å¤‡äº¤ä»˜çš„å­—èŠ‚æ•°`ã€‚\n\n## æµé‡æ§åˆ¶\næµé‡æ§åˆ¶ç”¨äºå¹³è¡¡ç”Ÿäº§è€…äº§ç”Ÿæ•°æ®ä¸æ¶ˆè´¹è€…æ¶ˆè€—æ•°æ®çš„é€Ÿåº¦ã€‚TCP ä¸­çš„æµé‡æ§åˆ¶å®ç°çš„ä¸»è¦é€”å¾„æ˜¯ä¸æ–­è°ƒæ•´å‘é€çª—å£çš„å¤§å°å®ç°ã€‚å‘é€ TCP ä¸€æ—¦å‘ç°å‘é€å‘é€çª—å£æ»¡äº†å°±ä¼šå¯¹å‘é€è¿›ç¨‹è¿›è¡Œåé¦ˆã€‚æ¥å—æ–¹æ ¹æ®ä¹‹å‰ä»å‘é€æ–¹æ”¶åˆ°çš„æ•°æ®é‡å’ŒæœåŠ¡å™¨å·²ç»æ¶ˆè€—çš„æ•°æ®é‡å¾—åˆ°è‡ªèº«æ¥æ”¶çª—å£çš„å¤§å°ï¼Œå°†è¿™ä¸ªå€¼å‘ŠçŸ¥å‘é€æ–¹ï¼Œå‘é€æ–¹æ ¹æ®æ”¶åˆ°çš„çª—å£å¤§å°è°ƒæ•´è‡ªèº«çª—å£å¤§å°ã€‚\nè¿˜æœ‰æ­£å¯¹é€šä¿¡åŒæ–¹äº§ç”Ÿæ•°æ®å°æˆ–è€…æ¶ˆè´¹æ•°æ®æ…¢äº§ç”Ÿç³Šæ¶‚çª—å£ç»¼åˆå¾æ—¶ï¼Œæœ‰å…¶ä»–æ–¹é¢çš„æµé‡æ§åˆ¶ã€‚å½“å‘é€æ–¹æ•°æ®é‡ç›¸å¯¹äºé¦–éƒ¨å°å¾ˆå¤šçš„æŠ¥æ–‡å¾ˆå¤šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ **Nagle ç®—æ³•**å‡å°‘è¿™ç§å°æŠ¥æ–‡é‡ã€‚å½“æ¥å—æ–¹æ¶ˆè€—æ•°æ®å¾ˆæ…¢æ—¶ï¼Œæ¯æ¬¡å‘ŠçŸ¥å‘é€æ–¹çš„çª—å£å¤§å°ä¼šæ¯”è¾ƒå°ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿå¾ˆå¤šå°æŠ¥æ–‡ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ **Clark è§£å†³æ–¹æ³•**æˆ–è€…è¿›è¡Œ**æ¨è¿Ÿç¡®è®¤**ã€‚å…³äºè¿™å‡ ç§æ–¹æ¡ˆçš„åˆ†æåŠå…·ä½“çš„ä½¿ç”¨æƒ…æ™¯å¯ä»¥å‚è€ƒ dog520 å¤§ç¥çš„è¿™ç¯‡æ–‡ç« â€”â€”[å†æ¬¡è°ˆè°ˆ TCP çš„ Nagle ç®—æ³•ä¸ TCP_CORK é€‰é¡¹](https://blog.csdn.net/dog250/article/details/21303679)ã€‚\n## å·®é”™æ§åˆ¶\nå·®é”™æ§åˆ¶ç”¨äºæè¿° TCP åœ¨å‘é€æˆ–è€…æ¥å—åˆ°æŠ¥æ–‡æ®µå‘ç”Ÿå¼‚å¸¸æ—¶çš„è¡Œä¸ºï¼Œå…¶ä¸»è¦è¡¨ç°åœ¨å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n1. **æ ¡éªŒå’Œ**ï¼šåœ¨æ¥å—æ–¹ï¼Œå¦‚æœæ”¶åˆ°çš„æŠ¥æ–‡æ®µæœªé€šè¿‡æ ¡éªŒå’Œæ ¡éªŒï¼Œåˆ™ç«‹å³ä¸¢å¼ƒï¼Œåä¹‹ï¼Œåˆ™é€šè¿‡**ç¡®è®¤è§„åˆ™**ï¼ˆä¸‹é¢é©¬ä¸ŠæåŠï¼‰è¿›è¡Œç¡®è®¤ï¼›\n2. **é‡ä¼ **ï¼šåœ¨å‘é€æ–¹ï¼Œå¦‚æœä¸€ä¸ªæŠ¥æ–‡æ®µé‡ä¼ è¶…æ—¶è®¡æ—¶å™¨ï¼ˆRTOï¼‰è¶…æ—¶ï¼Œå³åœ¨ RTO æ—¶é—´ä¹‹åä»ç„¶æœªæ”¶åˆ° ACKï¼Œåˆ™ç«‹å³é‡ä¼ æœªè¢«ç¡®è®¤çš„æœ€å°çš„æŠ¥æ–‡æ®µï¼›å¦‚æœæ”¶åˆ°å››ä¸ªç›¸åŒçš„çš„ ACK ï¼Œåˆ™ç«‹å³é‡ä¼ ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µï¼›\n\n### ç¡®è®¤è§„åˆ™\n1. å½“æ¥å—æ–¹å‘å‘é€æ–¹å‘é€æ•°æ®æŠ¥æ–‡æ®µæ—¶ï¼Œå¿…é¡»**æå¸¦** ACKï¼›\n2. å½“æ¥å—æ–¹æ²¡æœ‰æ•°æ®è¦å‘é€æ—¶ï¼Œä½†æ˜¯æ”¶åˆ°ä¸€ä¸ª**æŒ‰åºåˆ°è¾¾**çš„æŠ¥æ–‡ï¼ŒåŒæ—¶å‰ä¸€ä¸ªæŠ¥æ–‡æ®µä¹Ÿå·²ç»ç¡®è®¤è¿‡äº†ï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹å°±æ¨è¿Ÿå‘é€ç¡®è®¤æŠ¥æ–‡æ®µï¼Œç›´åˆ°å¦ä¸€ä¸ªæŠ¥æ–‡æ®µåˆ°è¾¾æˆ–è€…å»¶è¿Ÿä¸€æ®µæ—¶é—´ä»¥å‡å°‘ ACK æŠ¥æ–‡é‡ï¼›\n3. å½“æ‰€æœŸæœ›çš„æŠ¥æ–‡æ®µåˆ°è¾¾ï¼Œä¸”å‰ä¸€ä¸ª**æŒ‰åºåˆ°è¾¾**çš„æŠ¥æ–‡è¿˜æœªè¢«ç¡®è®¤ï¼Œåˆ™ç«‹å³ ACKï¼ˆACK çš„åºå·ä»ç„¶æ˜¯ä¸‹ä¸€ä¸ªæ­£å¸¸æœŸæœ›çš„åºå·ï¼Œä¸‹åŒï¼‰ï¼›\n4. å½“åºå·æ¯”æœŸæœ›çš„å¤§çš„æŠ¥æ–‡æ®µï¼ˆ**å¤±åº**æŠ¥æ–‡æ®µï¼‰åˆ°è¾¾ï¼Œåˆ™ç«‹å³ ACKï¼Œä¸”å­˜å‚¨è¯¥æŠ¥æ–‡æ®µï¼›\n5. å½“**ä¸¢å¤±**çš„æŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œåˆ™ç«‹å³ ACKï¼›\n6. å½“**é‡å¤**çš„æŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œåˆ™ä¸¢å¼ƒï¼Œä¸”ç«‹å³ ACKï¼›\n\n## æ‹¥å¡æ§åˆ¶\næ‹¥å¡æ§åˆ¶æ˜¯ä¸ºäº†é¿å…å› ä¸ºç½‘ç»œå—é™å¯¼è‡´ç½‘ç»œä¸èƒ½æŒ‰ç…§å‘é€æ–¹äº§ç”Ÿçš„æ•°æ®çš„é€Ÿåº¦å°†æŠ¥æ–‡æ®µäº¤ä»˜ç»™æ¥å—æ–¹ã€‚ä¸æµé‡æ§åˆ¶è€ƒå¯Ÿçš„å¯¹è±¡æ˜¯é€šä¿¡åŒæ–¹ä¸åŒï¼Œæ‹¥å¡æ§åˆ¶çš„è€ƒå¯Ÿå¯¹è±¡æ˜¯é€šä¿¡åŒæ–¹é—´çš„ç½‘ç»œã€‚æ‹¥å¡æ§åˆ¶çš„æ–¹å¼è¡¨ç°åœ¨å‘é€æ–¹çš„æ‹¥å¡çª—å£çš„å˜åŒ–ï¼Œä»è€Œæ§åˆ¶å‘é€æ–¹çš„æ•°æ®å‘é€å¿«æ…¢ã€‚TCP æœ€åˆä½¿ç”¨çš„æ‹¥å¡ç­–ç•¥ç§°ä¸º **TCP Tahoe and Reno**ã€‚\n### Tahoe and Reno\nè¿™ä¸ªæ‹¥å¡ç­–ç•¥ä¸»è¦åˆ†ä¸ºæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€æ‹¥å¡æ£€æµ‹ä¸‰ä¸ªé˜¶æ®µã€‚\n#### æ…¢å¯åŠ¨\nå‡è®¾æ¥æ”¶çª—å£å¤§å°è¿œå¤§äºæ‹¥å¡çª—å£ï¼Œä¸”ä¸è€ƒè™‘å»¶è¿Ÿç¡®è®¤ã€‚æ‹¥å¡çª—å£å¤§å°ä»ä¸€ä¸ªæœ€å¤§æŠ¥æ–‡é•¿åº¦ MSS ï¼ˆè¿æ¥å»ºç«‹æ—¶é€šè¿‡ TCP é€‰é¡¹å‘ŠçŸ¥ï¼‰å¼€å§‹ï¼Œä¹‹åæ¯å½“æœ‰ä¸€ä¸ªæŠ¥æ–‡æ®µè¢«ç¡®è®¤ï¼Œæ‹¥å¡çª—å£å°±å¢å¤§ä¸€ä¸ª MSSã€‚åœ¨è¿™æ ·çš„ç­–ç•¥ä¸‹ï¼Œæ…¢å¯åŠ¨é˜¶æ®µçš„æ‹¥å¡çª—å£å¤§å°å‘ˆæŒ‡æ•°å¢é•¿ã€‚å³ä» `1 -> 2 -> 4 -> 8`ã€‚å½“åˆ°è¾¾æ…¢å¯åŠ¨é—¨é™æ—¶ï¼Œå°±è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚\n#### æ‹¥å¡é¿å…\næ‹¥å¡é¿å…é˜¶æ®µæ‹¥å¡çª—å£å¤§å°ç»§ç»­å¢åŠ ï¼Œä½†æ˜¯é€Ÿåº¦æ”¾æ…¢ï¼Œæ”¹æˆå½“æ•´ä¸ªçª—å£å¤§å°çš„æŠ¥æ–‡æ®µéƒ½è¢«ç¡®è®¤åï¼Œçª—å£å¤§å°æ‰å¢åŠ ä¸€ä¸ª MSSã€‚è¡¨ç°ä¸º `8 -> 9 -> 10 -> 11`ï¼Œå‘ˆç°çº¿æ€§å¢é•¿ã€‚\n#### æ‹¥å¡æ£€æµ‹\nå¦‚æœæ‹¥å¡å‘ç”Ÿäº†ï¼Œå› ä¸ºå‘ç”Ÿåœ¨ç½‘ç»œä¸­è·¯ç”±å™¨å‡ºç°ä¸¢åŒ…ç°è±¡ï¼Œåœ¨æ¥å—æ–¹å¤„çš„è¡¨ç°ä¸ºå‡ºç°ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼Œå¹¶åšå‡ºå¯¹åº”çš„ååº”ï¼š\n1. RTO è®¡æ—¶å™¨è¶…æ—¶ã€‚è¿™è¯´æ˜ç½‘ç»œæ‹¥å¡çš„å¯èƒ½æ€§è¾ƒå¤§ï¼ŒTCP åšå‡ºè¾ƒå¼ºçƒˆçš„ååº”ï¼š\n    a. æŠŠæ…¢å¯åŠ¨é—¨é™å€¼è°ƒæ•´ä¸ºå½“å‰çª—å£å¤§å°çš„ä¸€åŠï¼›\n    b. æŠŠ cwnd é‡æ–°è®¾ç½®ä¸º 1 MSSï¼›\n    c. é‡æ–°è¿›å…¥æ…¢å¯åŠ¨é˜¶æ®µï¼›\n\n2. æ”¶åˆ°å››ä¸ªç›¸åŒçš„ ACKï¼›è¯´æ˜å‡ºç°æ‹¥å¡çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯å‡ºç°äº†ä¸¢åŒ…ï¼ŒTCP åšå‡ºè¾ƒå¼±çš„ååº”ï¼ŒReno ç®—æ³•è¡¨ç°ä¸ºå¿«æ¢å¤ï¼ˆFast recoveryï¼‰ï¼š\n    a. æŠŠæ…¢å¯åŠ¨é—¨é™å€¼è°ƒæ•´ä¸ºå½“å‰çª—å£å¤§å°çš„ä¸€åŠï¼›\n    b. æŠŠ cwnd é‡æ–°è®¾ç½®ä¸ºæ…¢å¯åŠ¨é—¨é™å€¼ï¼›\n    c. é‡æ–°è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µï¼›\n\nå›¾ç¤ºå¦‚ä¸‹ï¼š\n![æ‹¥å¡æ§åˆ¶ç¤ºä¾‹](congestion_control_example.png)\nTahoe ç®—æ³•ä¸ Reno ï¼ˆTahoe çš„æ”¹è¿›ç‰ˆæœ¬ï¼‰çš„åŒºåˆ«åœ¨äºæ”¶åˆ°å››ä¸ªç›¸åŒ ACK æ—¶ï¼ŒTahoe ç®—æ³•çš„ç­–ç•¥å’Œ RTO è®¡æ—¶å™¨è¶…æ—¶æ—¶ä¸€è‡´ã€‚\n### å…¶ä»–æ‹¥å¡ç­–ç•¥\næ‹¥å¡æ§åˆ¶ç­–ç•¥åªéœ€è¦åœ¨å‘é€æ–¹å®ç°å³å¯ï¼Œä¸éœ€è¦æ¥å—æ–¹çš„å‚ä¸ï¼Œå› æ­¤å¯ä»¥ä»…åœ¨å‘é€æ–¹éƒ¨ç½²ä¸€å¥—ç®—æ³•ã€‚ç°åœ¨ TCP ç½‘ç»œä¸Šçš„ç®—æ³•ä¹Ÿåœ¨ä¸æ–­[æ”¹è¿›](https://en.wikipedia.org/wiki/TCP_congestion_control)ï¼Œæ¶Œç°å‡ºè¯¸å¦‚ [**TCP CUBIC**](http://www4.ncsu.edu/~rhee/export/bitcp/cubic-paper.pdf)ã€[**TCP BBR**](https://ai.google/research/pubs/pub45646) è¿™æ ·çš„ç®—æ³•ã€‚\n\n## TCP ä¸­çš„è®¡æ—¶å™¨\n### é‡ä¼ è®¡æ—¶å™¨\né‡ä¼ è®¡æ—¶å™¨çš„è¶…æ—¶æ—¶é—´ä¸º RTOï¼ŒRTO ä¸»è¦æ ¹æ®æµ‹é‡æ‰€å¾—çš„æŠ¥æ–‡æ®µå¾€è¿”æ—¶é—´ RTTmè®¡ç®—è€Œæ¥ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\né¦–å…ˆè®¡ç®—å¹³æ»‘ RTTï¼Œå³RTTsï¼š\n```\nRTTs = RTTm // ç¬¬ä¸€æ¬¡æµ‹é‡\nRTTs = (1 - Î±)RTTs + Î±RTTm // éšåçš„æµ‹é‡\n```\nç„¶åè®¡ç®— RTT çš„åå·® RTTdï¼š\n```\nRTTd = RTTm / 2 // ç¬¬ä¸€æ¬¡æµ‹é‡\nRTTd = (1 - Î²)RTTd + Î²|RTTs - RTTm| // éšåçš„æµ‹é‡\n```\né‡ä¼ è¶…æ—¶ RTO çš„è®¡ç®—å¦‚ä¸‹ï¼š\n```\nRTO = 6s // åŸå§‹å€¼\nRTO = RTTs + 4RTTd // ç¬¬ä¸€æ¬¡æµ‹é‡å\n```\nä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ª RTT åœ¨è¿›è¡Œæµ‹é‡ï¼Œå½“é‡ä¼ å‘ç”Ÿæ—¶ä¼šå½±å“ RTT çš„æµ‹é‡ï¼Œæ ¹æ® **Karn ç®—æ³•**ï¼ŒTCP å¿½ç•¥é‡ä¼ æŠ¥æ–‡çš„ RTTï¼Œè€Œå¯¹äºé‡ä¼ çš„æŠ¥æ–‡ï¼ŒRTO å€¼ä¸ºåŸæŠ¥æ–‡çš„ä¸¤å€ï¼Œå¦‚æœå‘ç”Ÿç¬¬äºŒæ¬¡é‡ä¼ ï¼Œåˆ™ä¸ºå››å€ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n### æŒç»­è®¡æ—¶å™¨\nå½“æ¥å—æ–¹å‘é€çª—å£å€¼ä¸º 0 çš„æŠ¥æ–‡æ®µä¹‹åï¼Œåæ¥å› ä¸ºæ¥æ”¶çª—å£å¢åŠ éœ€è¦é€šå‘Šæ¥çª—å£ä¸ºé 0ï¼Œä½†æ˜¯é€šå‘Šçš„ ACK ä¸¢å¤±ï¼Œè¿™ä¼šå¯¼è‡´å‘é€æ–¹ä¸€ç›´ç­‰å¾…é 0 çª—å£é€šå‘Šï¼Œå¯¼è‡´æ­»é”ã€‚æŒç»­è®¡æ—¶å™¨å°±æ˜¯æ¥å—æ–¹åœ¨æ”¶åˆ° 0 çª—å£é€šå‘Šåå¯ç”¨ï¼Œå¦‚æœè¶…æ—¶åˆ™å‘é€æ¢æµ‹æŠ¥æ–‡ï¼Œä¿ƒä½¿æ¥å—æ–¹é‡ä¼  ACKã€‚\n### Keep-Alive è®¡æ—¶å™¨\nKeep-Alive è®¡æ—¶å™¨ç”¨äºé˜²æ­¢ TCP è¿æ¥é•¿æ—¶é—´ç©ºé—²ï¼Œæ¯å½“æ”¶åˆ°å¯¹æ–¹çš„æŠ¥æ–‡æ®µï¼Œè¿™ä¸ªè®¡æ—¶å™¨å°±å¤ä½ã€‚è¿™ä¸ªè®¡æ—¶å™¨çš„è¶…æ—¶æ—¶é—´é€šå¸¸å¯ä»¥é€šè¿‡æ¥å£è¿›è¡Œè®¾å®šã€‚\n### Time-Wait è®¡æ—¶å™¨\nTime-Wait è®¡æ—¶å™¨å¯¹æœ€åçš„ FIN è¿›è¡Œç¡®è®¤æ—¶å¯åŠ¨çš„è¶…æ—¶è®¡æ—¶å™¨ã€‚å¦‚æœåœ¨æ—¶å¸¸ä¸º 2MSL çš„è®¡æ—¶å™¨è¶…æ—¶å‰å†æ¬¡æ”¶åˆ° FINï¼Œåˆ™é‡ä¼  ACKï¼Œå¦åˆ™è¿æ¥å½»åº•å…³é—­ã€‚\n\n## ä¼ è¾“å±‚çš„[æœªæ¥](https://blog.apnic.net/2017/12/12/internet-protocols-changing/)\n[QIUC](https://www.chromium.org/quic) äº†è§£ä¸€ä¸‹ä¸‹ï¼Ÿ\n\n## å‚è€ƒèµ„æ–™\n1. [TCP/IP åè®®æ— ç¬¬å››ç‰ˆ](https://book.douban.com/subject/5386194/)\n2. [Andrew S.Tanenbaum - Computer Networks 5th](https://book.douban.com/subject/5344443/)\n3. [WikiPedia - Transmission Control Protocol](https://en.wikipedia.org/wiki/Transmission_Control_Protocol)\n4. [WikiPedia - TCP congestion control](https://en.wikipedia.org/wiki/TCP_congestion_contro)\n5. [TCP Flags: PSH and URG](http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/)\n6. [KTH - Internetworking Lecture 4](https://www.nada.kth.se/kurser/kth/2D1392/05/lectures/lecture_4.pdf)\n7. [ä¸€ä¸ª TCP FIN_WAIT2 çŠ¶æ€ç»†èŠ‚å¼•å‘çš„æ„Ÿæ…¨](https://blog.csdn.net/dog250/article/details/81256550)","slug":"tcp","published":1,"updated":"2020-07-18T06:30:19.523Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuhi000bw80vngyhn847","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>ç”Ÿäº§ç¯å¢ƒé‡åˆ°äº›ç½‘ç»œé—®é¢˜ï¼ŒçŸ¥å¯¹ TCP åè®®è¿˜æ˜¯æœ‰äº›ç”Ÿç–ï¼Œåœ¨æ­¤å¤ä¹ è®°å½•ã€‚</p>\n<a id=\"more\"></a>\n<h2 id=\"åè®®\"><a href=\"#åè®®\" class=\"headerlink\" title=\"åè®®\"></a>åè®®</h2><h3 id=\"æŠ¥æ–‡æ®µæ ¼å¼\"><a href=\"#æŠ¥æ–‡æ®µæ ¼å¼\" class=\"headerlink\" title=\"æŠ¥æ–‡æ®µæ ¼å¼\"></a>æŠ¥æ–‡æ®µæ ¼å¼</h3><p>TCP åè®®æŠ¥æ–‡æ®µä¸»è¦ç”±<strong>é¦–éƒ¨ï¼ˆHeaderï¼‰</strong> ä¸<strong>æ•°æ®ï¼ˆDataï¼‰</strong> ä¸¤éƒ¨åˆ†ç»„æˆã€‚åœ¨è®¡ç®—æ ¡éªŒå’Œæ˜¯è¿˜ä¼šåŠ ä¸Šè™šæ‹Ÿçš„ä¼ªé¦–éƒ¨ã€‚æ­¤å¤„ä¸»è¦è¯´æ˜é¦–éƒ¨çš„ç»„æˆã€‚<br><img src=\"tcp_header.png\" alt=\"å›¾ 1 TCP Header (From: WikiPedia)\"><br>TCP åœ¨ç½‘ç»œæ¨¡å‹ä¸­å±äºè¿è¾“å±‚ï¼Œç”¨äºæä¾›è¿›ç¨‹ä¸è¿›ç¨‹é—´çš„å­—èŠ‚æµé€šä¿¡æœåŠ¡ï¼Œå› æ­¤éœ€è¦<strong>æº / ç›®ç«¯å£ï¼ˆSource / Destination portï¼‰</strong> ä»¥ç¡®å®šé€šä¿¡åŒæ–¹è¿›ç¨‹ã€‚ä½¿ç”¨<strong>åºå·ï¼ˆSequence numberï¼Œseqï¼‰</strong> è¡¨æ˜æœ¬æŠ¥æ–‡æ®µç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„ç¼–å·ï¼Œåˆå§‹åºå·ç”±åŒæ–¹åœ¨ TCP è¿æ¥å»ºç«‹æ—¶éšæœºç”Ÿæˆã€‚ä½¿ç”¨<strong>ç¡®è®¤å·ï¼ˆAcknowledgment numberï¼Œackï¼‰</strong> è¡¨ç¤ºæ¥å—æ–¹æœŸæœ›ä»å‘é€æ–¹æ¥å—çš„å­—èŠ‚ç¼–å·ã€‚<strong>æ•°æ®åç§»é‡ï¼ˆData Offsetï¼‰</strong> é¡¾åæ€ä¹‰æŠ¥æ–‡æ®µæ•°æ®å¼€å§‹å­—èŠ‚å¤„çš„åç§»é‡ï¼Œå³ TCP header çš„é•¿åº¦ï¼Œç”±äºé€‰é¡¹çš„å­˜åœ¨ï¼Œé¦–éƒ¨é•¿åº¦çš„èŒƒå›´æ˜¯ 20ï½60 Bytesï¼Œä½†æ˜¯è¯¥å­—æ®µåªæœ‰ 4 Bitsï¼Œå› æ­¤è¯¥å­—æ®µæŒ‡å‡ºé¦–éƒ¨é•¿åº¦æœ‰å¤šå°‘ä¸ª 4 Bytesã€‚æ¥ä¸‹æ¥çš„ 3 Bits è¢«<strong>ä¿ç•™ï¼ˆReservedï¼‰</strong> ã€‚éšåä¼šè®¨è®º 9 ä¸ª<strong>æ ‡å¿—ä½ï¼ˆFlagsï¼‰</strong>ã€‚<strong>çª—å£å¤§å°ï¼ˆWindow Sizeï¼‰</strong> å®šä¹‰äº†æ¥å—æ–¹çš„æ¥å—çª—å£å¤§å°ï¼Œç”±æ¥å—æ–¹å†³å®šï¼Œç„¶åå‘ŠçŸ¥å‘é€æ–¹ã€‚åœ¨è®¡ç®—<strong>æ ¡éªŒå’Œï¼ˆChecksumï¼‰</strong> æ—¶éœ€è¦åŠ ä¸Šä¼ªé¦–éƒ¨ï¼Œä¼ªé¦–éƒ¨çš„å†…å®¹åŒ…æ‹¬æºç›® IP åœ°å€ï¼ŒTCP æŠ¥æ–‡æ®µé•¿åº¦ç­‰ã€‚å¦‚æœ URG æ ‡å¿—ä½è¢«è®¾å®šäº†ï¼Œé‚£<strong>ç´§æ€¥æŒ‡é’ˆï¼ˆUrgent pointerï¼‰</strong> ç”¨äºæŒ‡ç¤ºç´§æ€¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚åœ¨æŠ¥æ–‡æ®µæ•°æ®éƒ¨åˆ†ä¸­çš„åç§»é‡ã€‚æœ€åçš„ 40 Bytes ç•™ç»™<strong>é€‰é¡¹ï¼ˆOptionsï¼‰</strong>ã€‚</p>\n<h3 id=\"Flags\"><a href=\"#Flags\" class=\"headerlink\" title=\"Flags\"></a>Flags</h3><ul>\n<li><strong>URG</strong>ï¼šä¸º 1 è¡¨ç¤ºæ•°æ®ä¸­æœ‰ç´§æ€¥æ•°æ®ã€‚è¿™ä¸ªæ ‡è®°æ¯”è¾ƒå°‘è§ï¼Œå¯ä»¥æ‰¾åˆ°çš„ä¸€äº›åº”ç”¨æœ‰ï¼š<a href=\"https://stackoverflow.com/questions/24476458/understanding-tcp-urg-flag\" target=\"_blank\" rel=\"noopener\">FTP</a>ï¼Œ<a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">Telnet</a>ï¼›</li>\n<li><strong>ACK</strong>ï¼šä¸º 1 è¡¨ç¤ºç¡®è®¤å·å­—æ®µæœ‰æ•ˆï¼›</li>\n<li><strong>PSH</strong>ï¼šä¸º 1 è¡¨ç¤ºæœ‰æ¨é€æ•°æ®ï¼Œè¿™ä¸ªå­—æ®µä¸»è¦å®Œæˆ<a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">ä¸¤ä¸ªåŠŸèƒ½</a>ï¼šå‘é€æ–¹åº”ç”¨å±‚æé†’ TCP éœ€è¦ç«‹å³å‘é€æ•°æ®ï¼›æ¥å—æ–¹ TCP éœ€è¦å°†æ”¶åˆ°çš„æ•°æ®ç«‹å³æäº¤ç»™åº”ç”¨å±‚ï¼›</li>\n<li><strong>RST</strong>ï¼šä¸º 1 è¡¨ç¤ºå‡ºç°ä¸¥é‡å·®é”™ã€‚å¯èƒ½éœ€è¦é‡ç°åˆ›å»º TCP è¿æ¥ã€‚è¿˜å¯ä»¥ç”¨äºæ‹’ç»éæ³•çš„æŠ¥æ–‡æ®µå’Œæ‹’ç»è¿æ¥è¯·æ±‚ï¼›</li>\n<li><strong>SYN</strong>ï¼šä¸º 1 è¡¨ç¤ºè¿™æ˜¯è¿æ¥è¯·æ±‚æˆ–æ˜¯è¿æ¥æ¥å—è¯·æ±‚ï¼Œç”¨äºåˆ›å»ºè¿æ¥å’Œä½¿é¡ºåºå·åŒæ­¥ï¼›</li>\n<li><strong>FIN</strong>ï¼šä¸º 1 è¡¨ç¤ºå‘é€æ–¹æ²¡æœ‰æ•°æ®è¦ä¼ è¾“äº†ï¼Œè¦æ±‚é‡Šæ”¾è¿æ¥ï¼›</li>\n</ul>\n<h2 id=\"é˜¶æ®µ\"><a href=\"#é˜¶æ®µ\" class=\"headerlink\" title=\"é˜¶æ®µ\"></a>é˜¶æ®µ</h2><p>TCP è¿æ¥å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šå»ºç«‹è¿æ¥ï¼Œä¼ è¾“æ•°æ®ï¼Œç»ˆæ­¢è¿æ¥ã€‚å¯ä»¥ç”¨ä¸€ä¸ªæœ‰é™çŠ¶æ€æœºè¡¨ç¤ºï¼š<br><img src=\"tcp_connection.png\" alt=\"å›¾ 2 TCP è¿æ¥ (From: Computer Networks)&lt;br&gt;å›¾ä¸­ï¼ˆA/Bï¼‰è¿™æ ·çš„æ–‡å­—è¡¨ç¤ºâ€œæ”¶åˆ°Aåæ‰§è¡ŒBï¼ŒAä¸Bå¯ä»¥æ˜¯æ ‡å¿—ä½æˆ–è€…æŒ‡ä»¤â€&lt;br&gt;æ·±å®çº¿è¡¨ç¤º Client çš„è¡Œä¸ºï¼Œæ·±è™šçº¿è¡¨ç¤º Server çš„è¡Œä¸ºï¼Œæµ…è‰²çº¿è¡¨ç¤ºç‰¹æ®Šè¡Œä¸º\"><br>ä¸‹é¢ç»“åˆä¸€ä¸ªç”¨ Rust å†™çš„ Echo Server ä¸æŠ“åŒ…å·¥å…· Wireshark æ¥æ¼”ç¤ºè¿™ä¸‰ä¸ªè¿‡ç¨‹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight rust\"><figcaption><span>Echo Server</span><a href=\"/downloads/code/echo_server.rs\">view raw</a></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::net::{TcpListener, TcpStream};</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::thread;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::Read;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::Write;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() {</span><br><span class=\"line\">    <span class=\"keyword\">let</span> listener = TcpListener::bind(<span class=\"string\">\"::1:9999\"</span>).unwrap();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> stream <span class=\"keyword\">in</span> listener.incoming() {</span><br><span class=\"line\">        <span class=\"keyword\">match</span> stream {</span><br><span class=\"line\">            <span class=\"literal\">Ok</span>(stream) =&gt; {</span><br><span class=\"line\">                thread::spawn(|| {</span><br><span class=\"line\">                    handle_client(stream);</span><br><span class=\"line\">                });</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"literal\">Err</span>(_) =&gt; {</span><br><span class=\"line\">                <span class=\"built_in\">println!</span>(<span class=\"string\">\"Error\"</span>);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">handle_client</span></span>(<span class=\"keyword\">mut</span> stream: TcpStream) {</span><br><span class=\"line\">    <span class=\"keyword\">loop</span> {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"keyword\">mut</span> read = [<span class=\"number\">0</span>; <span class=\"number\">1024</span>];</span><br><span class=\"line\">        <span class=\"keyword\">match</span> stream.read(&amp;<span class=\"keyword\">mut</span> read) {</span><br><span class=\"line\">            <span class=\"literal\">Ok</span>(n) =&gt; {</span><br><span class=\"line\">                <span class=\"keyword\">if</span> n == <span class=\"number\">0</span> {</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                }</span><br><span class=\"line\">                stream.write(&amp;read[<span class=\"number\">0</span>..n]).unwrap();</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"literal\">Err</span>(err) =&gt; {</span><br><span class=\"line\">                <span class=\"built_in\">panic!</span>(err);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Echo Server å¯åŠ¨ä¹‹åä½¿ç”¨ telnet å·¥å…·è¿æ¥è‡³æœåŠ¡å™¨ï¼Œä¸æœåŠ¡å™¨äº¤äº’ä¸¤æ¬¡ï¼Œå³å›æ˜¾ä¸¤æ¬¡å­—ç¬¦ä¸²ï¼Œç„¶åä»é€€å‡º telnetã€‚æŠ“åˆ°çš„åŒ…æˆªå›¾å¦‚ä¸‹ï¼š<br><img src=\"wireshark.png\" alt=\"å›¾ 3 Wireshark æŠ“åŒ…\"></p>\n<p>åœ¨ä¸‹é¢çš„è¡¨è¿°ä¸­ï¼Œå®¢æˆ·ç«¯è¡¨ç¤ºåœ¨è¿™ä¸€é˜¶æ®µå…ˆå‘èµ·è¯·æ±‚çš„ä¸€æ–¹ï¼ŒæœåŠ¡ç«¯è¡¨ç¤ºåœ¨è¿™ä¸€é˜¶æ®µå…ˆæ¥å—è¯·æ±‚çš„ä¸€æ–¹ã€‚åœ¨ TCP ä¸­ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œä»–ä»¬å¯ä»¥ç†è§£ä¸ºå¯¹ç­‰çš„ï¼Œåœ¨è¿æ¥å»ºç«‹åï¼Œå®é™…ä¸Šæ²¡æœ‰æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„åŒºåˆ«ã€‚</p>\n<h3 id=\"å»ºç«‹è¿æ¥\"><a href=\"#å»ºç«‹è¿æ¥\" class=\"headerlink\" title=\"å»ºç«‹è¿æ¥\"></a>å»ºç«‹è¿æ¥</h3><p>å‰ä¸‰ä¸ªåŒ…ä»£è¡¨äº†å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ï¼Œåˆ†ä¸ºä¸‰æ­¥ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å°±å¦‚åŒæŠ“åŒ…æ‰€ç¤ºï¼Œç§°ä¸º<strong>ä¸‰æ¬¡æ¡æ‰‹ï¼ˆ3-way handshakeï¼‰</strong>ã€‚å›¾ 2 ä¸­è¿˜ç”»å‡ºäº†åŒæ–¹åŒæ—¶æ‰“å¼€è¿æ¥ä¸è¿æ¥å¤ä½è¿™ä¸¤ç§æ¯”è¾ƒå°‘è§çš„æƒ…æ™¯ã€‚</p>\n<ol>\n<li>å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯ä¸€ä¸ª <strong>SYN</strong> æŠ¥æ–‡ï¼Œç”¨ä»¥å‘ŠçŸ¥æœåŠ¡ç«¯åˆå§‹åºå·ä¸º 0ï¼ˆæ­¤å¤„çš„ Seq ç»è¿‡ Wireshark çš„å¤„ç†ï¼Œå˜æˆäº†ç›¸å¯¹å€¼ï¼‰ï¼Œç„¶åå®¢æˆ·ç«¯è¿›å…¥ <strong><em>SYN_SENT</em></strong> çŠ¶æ€ã€‚</li>\n<li>æœåŠ¡å™¨æ”¶åˆ° 1 ä¸­æŠ¥æ–‡åï¼Œå‘ç»™å®¢æˆ·ç«¯ä¸€ä¸ª <strong>SYN + ACK</strong> æŠ¥æ–‡ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯åˆå§‹åºå·ä¸º 0ï¼Œä¸”æ¥ä¸‹æ¥æœŸæœ›ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„åºå· Ack ä¸º 1ã€‚æœåŠ¡ç«¯è¿›å…¥ <strong><em>SYN_RCVD</em></strong> çŠ¶æ€ã€‚å¯è§ <strong>SYN æŠ¥æ–‡æ¶ˆè€—äº†ä¸€ä¸ªåºå·</strong>ã€‚</li>\n<li>å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å›å¤ <strong>ACK</strong> æŠ¥æ–‡ï¼Œè¿›å…¥ <strong><em>ESTABLISHED</em></strong> çŠ¶æ€ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡è¿æ¥å»ºç«‹å®Œæˆã€‚å¯è§ <strong>ACK æŠ¥æ–‡åœ¨ä¸æºå¸¦æ•°æ®çš„æƒ…å†µä¸‹ä¸æ¶ˆè€—åºå·</strong>ã€‚</li>\n</ol>\n<h3 id=\"ä¼ è¾“æ•°æ®\"><a href=\"#ä¼ è¾“æ•°æ®\" class=\"headerlink\" title=\"ä¼ è¾“æ•°æ®\"></a>ä¼ è¾“æ•°æ®</h3><p>å›¾ 3 ä¸­ P17ï½P20 ä¸ P72ï½P74 åˆ†åˆ«å±•ç¤ºäº†ä¸¤æ¬¡äº¤äº’è¿‡ç¨‹ã€‚ä»¥ç¬¬äºŒæ¬¡äº¤äº’ä¸ºä¾‹ï¼š</p>\n<ol>\n<li>P72 ä¸­ï¼Œå®¢æˆ·ç«¯å°†æƒ³è¦å›æ˜¾å­—ç¬¦ä¸²å‘é€ç»™æœåŠ¡ç«¯ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨è¿™ä¸ªæŠ¥æ–‡æ®µçš„æ•°æ®é¦–å­—èŠ‚åºå·ä¸º 8ï¼Œå¹¶ä¸”å¸Œæœ›ä»æœåŠ¡ç«¯æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºå·æ˜¯ 8ã€‚</li>\n<li>æœåŠ¡ç«¯å°†å›æ˜¾çš„å­—ç¬¦ä¸²ä¸å¯¹ P72 çš„ç¡®è®¤ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ã€‚P72 çš„é•¿åº¦ä¸º 9ï¼Œå› æ­¤æŠ¥æ–‡æ®µä¸­æ•°æ®çš„åºå·èŒƒå›´ä¸º [8,17)ï¼Œå› æ­¤åœ¨ P73 ä¸­ Ack ä¸º 17ã€‚</li>\n<li>å®¢æˆ·ç«¯ç¡®è®¤ P73ã€‚</li>\n</ol>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤æ¬¡äº¤äº’æœ‰æ‰€åŒºåˆ«ï¼šç¬¬ä¸€æ¬¡äº¤äº’æ—¶ï¼ŒæœåŠ¡ç«¯å…ˆè¿”å›äº†ä¸€ä¸ªç¡®è®¤ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå†é¢å¤–å‘é€ä¸€æ¡æºå¸¦å›æ˜¾å†…å®¹çš„æŠ¥æ–‡æ®µã€‚ä½†æ˜¯ç¬¬äºŒæ¬¡äº¤äº’æ—¶çœç•¥äº†å•ç‹¬çš„ç¡®è®¤ã€‚</p>\n<h3 id=\"ç»ˆæ­¢è¿æ¥\"><a href=\"#ç»ˆæ­¢è¿æ¥\" class=\"headerlink\" title=\"ç»ˆæ­¢è¿æ¥\"></a>ç»ˆæ­¢è¿æ¥</h3><p>æ ¹æ®â€œå¹¿å¤§åšä¸»â€å†™ä½œçš„æ–‡ç« ä¸<a href=\"https://www.zhihu.com/question/50646354\" target=\"_blank\" rel=\"noopener\">é—®ç­”ç½‘ç«™çš„è®¨è®º</a>ä»¥åŠå„ç§é¢ç»ï¼ŒåŸºæœ¬ä¸€è‡´è®¤ä¸ºï¼Œç»ˆæ­¢è¿æ¥é€šå¸¸è¢«æˆä¸º<strong>å››æ¬¡æŒ¥æ‰‹ï¼ˆ4-way terminationï¼‰</strong>ï¼Œå³é€šä¿¡åŒæ–¹ä¼šæœ‰å››æ¬¡äº¤äº’ï¼Œä½†æ˜¯å¦‚å›¾ 2 æ‰€ç¤ºï¼Œä¹Ÿå­˜åœ¨<strong>ä¸‰æ¬¡æŒ¥æ‰‹</strong>çš„å¯èƒ½æ€§ï¼Œä¸”æˆ‘æœ¬åœ°çš„å¤šæ¬¡æŠ“åŒ…ä¹Ÿå¦‚å›¾ 3 ä¸€è‡´â€”â€”å‡ä¸ºä¸‰æ¬¡æŒ¥æ‰‹ï¼Œä¸”æ— ä¸€ä¾‹å¤–ã€‚ä¸‹é¢å¯¹å››æ¬¡æŒ¥æ‰‹è¿›è¡Œåˆ†æï¼Œä¸‰æ¬¡æŒ¥æ‰‹å¯ä»¥è¢«å…¶æ¦‚æ‹¬ï¼š</p>\n<ol>\n<li>å®¢æˆ·ç«¯å‘èµ·ç»ˆæ­¢è¿æ¥ï¼Œå‘å‡ºä¸€ä¸ª <strong>FIN</strong> æŠ¥æ–‡ç»™æœåŠ¡ç«¯ï¼Œå‡è®¾è¯¥æŠ¥æ–‡çš„ Seq ä¸º Xï¼ŒAck ä¸º Yã€‚ç„¶åå®¢æˆ·ç«¯è¿›å…¥ <strong><em>FIN_WAIT1</em></strong> çŠ¶æ€ï¼Œé™¤é‡ä¼  FIN æŠ¥æ–‡ä¸å‘é€ ACK ç¡®è®¤ä¹‹å¤–ï¼Œä¸å†å‘é€åº”ç”¨æ•°æ®ç»™æœåŠ¡ç«¯ã€‚</li>\n<li>æœåŠ¡ç«¯æ”¶åˆ° FIN æŠ¥æ–‡æ®µåå…ˆå›å¤ä¸€ä¸ª <strong>ACK</strong> æŠ¥æ–‡ï¼Œè¿›å…¥ <strong><em>CLOSE_WAIT</em></strong> çŠ¶æ€ï¼Œè¯¥æŠ¥æ–‡çš„ Seq ä¸º Yï¼ŒAck ä¸º X+1ã€‚</li>\n<li>å®¢æˆ·ç«¯åœ¨æ”¶åˆ° FIN çš„ ACK ä¹‹åè¿›å…¥ <strong><em>FIN_WAIT2</em></strong> çŠ¶æ€ã€‚æ­¤æ—¶æœåŠ¡ç«¯è¿˜å¯ä»¥ç»§ç»­å°†æœªå‘é€å®Œçš„åº”ç”¨æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li>\n<li>æœåŠ¡ç«¯å‘é€å®Œæ•°æ®åå‘é€ä¸€æ¡ <strong>FIN</strong> æŠ¥æ–‡ï¼Œè¿›å…¥ <strong><em>LAST_ACK</em></strong> çŠ¶æ€ï¼Œè¯¥æŠ¥æ–‡çš„ Seq ä¸º Y+Kï¼ŒAck ä¸º X+1ã€‚</li>\n<li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ FIN åï¼Œå‘é€æœ€åçš„ <strong>ACK</strong> æŠ¥æ–‡ç»™æœåŠ¡å™¨ï¼Œç„¶åè¿›å…¥ <strong><em>TIME_WAIT</em></strong> çŠ¶æ€ã€‚å¦‚æœåœ¨ 2MSLï¼ˆæœ€å¤§æŠ¥æ–‡æ®µå¯¿å‘½ï¼Œé€šå¸¸ä¸º30ï½60sï¼‰åå®¢æˆ·ç«¯æ²¡å†æ¬¡æ”¶åˆ° FIN æŠ¥æ–‡ï¼Œåˆ™è¿›å…¥ <strong><em>CLOSED</em></strong> çŠ¶æ€ï¼Œå¦åˆ™é‡å‘ ACK æŠ¥æ–‡è¿›è¡Œé‡è¯•ã€‚</li>\n<li>æœåŠ¡ç«¯åœ¨æ”¶åˆ° ACK æŠ¥æ–‡åè¿›å…¥ <strong><em>CLOSED</em></strong> çŠ¶æ€ã€‚</li>\n</ol>\n<p>ä¸‰æ¬¡æŒ¥æ‰‹è¡¨ç°ä¸ºæ­¥éª¤ 2ï½4 åˆå¹¶ä¸ºä¸€æ­¥ï¼Œå³åŒæ—¶å‘é€å¯¹å®¢æˆ·ç«¯ FIN çš„ ACK æŠ¥æ–‡ä¸ æœåŠ¡ç«¯è‡ªå·±çš„ FIN æŠ¥æ–‡ã€‚è¿™æ¡ <strong>FIN+ACK</strong> æŠ¥æ–‡çš„ Seq ä¸º Yï¼ŒAck ä¸º X+1ã€‚</p>\n<p>è‡³äºåœ¨ä»€ä¹ˆæƒ…æ™¯ä¸‹å‡ºç°ä¸‰æ¬¡æ¡æ‰‹æˆ–è€…å››æ¬¡æ¡æ‰‹ï¼Œå¤§å¤šæ•°çš„è§‚ç‚¹è®¤ä¸ºå…ˆæ”¶åˆ° FIN æŠ¥æ–‡çš„ä¸€æ–¹è¿˜éœ€è¦å‘ä¸Šå±‚åº”ç”¨è¯¢é—®æ˜¯å¦ä»ç„¶æœ‰æ•°æ®éœ€è¦å‘é€ï¼Œå› ä¸ºè¦ç­‰å¾…ä¸Šå±‚çš„å›å¤ï¼Œæ‰€ä»¥â€œä¸ºä½•ä¸æ—©ç‚¹æŠŠå¯¹ FIN çš„ ACK å‘å‡ºå»å‘¢ï¼Ÿï¼â€è€Œä¸”ç«‹å³ Ack èƒ½é˜²æ­¢å¯¹æ–¹é‡ä¼  FINã€‚ä½†æ˜¯æœ‰æ²¡æœ‰å­˜åœ¨ä¸éœ€è¦è¯¢é—®ä¸Šå±‚æˆ–è€…ä¸éœ€è¦ç«‹å³å›å¤ Ack çš„å¯èƒ½ï¼Œå°±å¦‚åŒä¼ è¾“æ•°æ®å‡ºç°çš„æƒ…å†µä¸€æ ·ï¼Œè¿™äº›åº”è¯¥ä¸ TCP çš„å…·ä½“å®ç°ç›¸å…³ï¼Œç›®å‰èƒ½åŠ›ä¸ç²¾åŠ›æœ‰é™ï¼Œè¿˜æœ‰å¾…å¯¹ <a href=\"https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_output.c\" target=\"_blank\" rel=\"noopener\">Linux TCP å®ç°æºç </a>è¿›è¡Œé˜…è¯»ã€‚</p>\n<h2 id=\"æ»‘åŠ¨çª—å£\"><a href=\"#æ»‘åŠ¨çª—å£\" class=\"headerlink\" title=\"æ»‘åŠ¨çª—å£\"></a>æ»‘åŠ¨çª—å£</h2><p>æ»‘åŠ¨çª—å£æ˜¯ TCP ä¸­ç”¨äºå®ç°è¯¸å¦‚ ACK ç¡®è®¤ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶çš„æ‰¿è½½ç»“æ„ã€‚å¦‚å›¾æ‰€ç¤º:<br><img src=\"sliding_window.png\" alt=\"å›¾ 4 æ»‘åŠ¨çª—å£\"><br>å…ˆå°† TCP çœ‹ä½œæ˜¯ç®€å•çš„å•å‘é€šä¿¡ï¼Œåˆ™å‘é€æ–¹æœ‰ä¸€ä¸ªå‘é€çª—å£ï¼Œæ¥æ”¶æ–¹æœ‰ä¸€ä¸ªæ¥æ”¶çª—å£ã€‚æ­£å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œä¼ è¾“çš„æ˜¯æŠ¥æ–‡æ®µï¼Œçª—å£å¤§å°çš„å•ä½æ˜¯å­—èŠ‚ã€‚ä¸¤ä¸ªçª—å£ä¸­<strong>ç™½è‰²åŒºåŸŸ</strong>ä¸ºç©ºç™½ä½ç½®ï¼Œç­‰å¾…è¢«åº”ç”¨å±‚æˆ–è€…ç½‘ç»œå±‚å¡«æ»¡ï¼›<strong>ç°è‰²åŒºåŸŸ</strong>æ˜¯å·²ç»å‘é€ä½†æ˜¯è¿˜æ²¡æœ‰æ¥å—åˆ°ç¡®è®¤çš„å­—èŠ‚ï¼›<strong>ç²‰è‰²åŒºåŸŸ</strong>åœ¨å‘é€çª—å£ä¸­è¡¨ç¤ºç­‰å¾…è¢«å‘é€çš„å­—èŠ‚ï¼Œåœ¨æ¥æ”¶çª—å£æ±‡æ€»è¡¨ç¤ºç­‰å¾…äº¤ä»˜çš„å­—èŠ‚ã€‚<br>å‘é€çª—å£çš„å¤§å°ä¸ºæ¥å—æ–¹é€šè¿‡é¦–éƒ¨ä¸­çª—å£å¤§å°å­—æ®µå‘ŠçŸ¥çš„æ¥æ”¶çª—å£å¤§å° rwnd å’Œä¹‹åä¼šè®²åˆ°çš„æ‹¥å¡çª—å£çš„å¤§å° cwnd ä¸¤è€…ä¸­çš„è¾ƒå°å€¼ï¼Œå³ <code>min(rwnd , cwnd)</code>ã€‚æ¥æ”¶çª—å£å¤§å°æ˜¯æ¥æ”¶æ–¹å¯ç”¨ç¼“å­˜ç©ºé—´å¤§å°ï¼Œä¸º <code>rwnd = ç¼“å­˜å¤§å° - å‡†å¤‡äº¤ä»˜çš„å­—èŠ‚æ•°</code>ã€‚</p>\n<h2 id=\"æµé‡æ§åˆ¶\"><a href=\"#æµé‡æ§åˆ¶\" class=\"headerlink\" title=\"æµé‡æ§åˆ¶\"></a>æµé‡æ§åˆ¶</h2><p>æµé‡æ§åˆ¶ç”¨äºå¹³è¡¡ç”Ÿäº§è€…äº§ç”Ÿæ•°æ®ä¸æ¶ˆè´¹è€…æ¶ˆè€—æ•°æ®çš„é€Ÿåº¦ã€‚TCP ä¸­çš„æµé‡æ§åˆ¶å®ç°çš„ä¸»è¦é€”å¾„æ˜¯ä¸æ–­è°ƒæ•´å‘é€çª—å£çš„å¤§å°å®ç°ã€‚å‘é€ TCP ä¸€æ—¦å‘ç°å‘é€å‘é€çª—å£æ»¡äº†å°±ä¼šå¯¹å‘é€è¿›ç¨‹è¿›è¡Œåé¦ˆã€‚æ¥å—æ–¹æ ¹æ®ä¹‹å‰ä»å‘é€æ–¹æ”¶åˆ°çš„æ•°æ®é‡å’ŒæœåŠ¡å™¨å·²ç»æ¶ˆè€—çš„æ•°æ®é‡å¾—åˆ°è‡ªèº«æ¥æ”¶çª—å£çš„å¤§å°ï¼Œå°†è¿™ä¸ªå€¼å‘ŠçŸ¥å‘é€æ–¹ï¼Œå‘é€æ–¹æ ¹æ®æ”¶åˆ°çš„çª—å£å¤§å°è°ƒæ•´è‡ªèº«çª—å£å¤§å°ã€‚<br>è¿˜æœ‰æ­£å¯¹é€šä¿¡åŒæ–¹äº§ç”Ÿæ•°æ®å°æˆ–è€…æ¶ˆè´¹æ•°æ®æ…¢äº§ç”Ÿç³Šæ¶‚çª—å£ç»¼åˆå¾æ—¶ï¼Œæœ‰å…¶ä»–æ–¹é¢çš„æµé‡æ§åˆ¶ã€‚å½“å‘é€æ–¹æ•°æ®é‡ç›¸å¯¹äºé¦–éƒ¨å°å¾ˆå¤šçš„æŠ¥æ–‡å¾ˆå¤šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <strong>Nagle ç®—æ³•</strong>å‡å°‘è¿™ç§å°æŠ¥æ–‡é‡ã€‚å½“æ¥å—æ–¹æ¶ˆè€—æ•°æ®å¾ˆæ…¢æ—¶ï¼Œæ¯æ¬¡å‘ŠçŸ¥å‘é€æ–¹çš„çª—å£å¤§å°ä¼šæ¯”è¾ƒå°ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿå¾ˆå¤šå°æŠ¥æ–‡ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ <strong>Clark è§£å†³æ–¹æ³•</strong>æˆ–è€…è¿›è¡Œ<strong>æ¨è¿Ÿç¡®è®¤</strong>ã€‚å…³äºè¿™å‡ ç§æ–¹æ¡ˆçš„åˆ†æåŠå…·ä½“çš„ä½¿ç”¨æƒ…æ™¯å¯ä»¥å‚è€ƒ dog520 å¤§ç¥çš„è¿™ç¯‡æ–‡ç« â€”â€”<a href=\"https://blog.csdn.net/dog250/article/details/21303679\" target=\"_blank\" rel=\"noopener\">å†æ¬¡è°ˆè°ˆ TCP çš„ Nagle ç®—æ³•ä¸ TCP_CORK é€‰é¡¹</a>ã€‚</p>\n<h2 id=\"å·®é”™æ§åˆ¶\"><a href=\"#å·®é”™æ§åˆ¶\" class=\"headerlink\" title=\"å·®é”™æ§åˆ¶\"></a>å·®é”™æ§åˆ¶</h2><p>å·®é”™æ§åˆ¶ç”¨äºæè¿° TCP åœ¨å‘é€æˆ–è€…æ¥å—åˆ°æŠ¥æ–‡æ®µå‘ç”Ÿå¼‚å¸¸æ—¶çš„è¡Œä¸ºï¼Œå…¶ä¸»è¦è¡¨ç°åœ¨å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>\n<ol>\n<li><strong>æ ¡éªŒå’Œ</strong>ï¼šåœ¨æ¥å—æ–¹ï¼Œå¦‚æœæ”¶åˆ°çš„æŠ¥æ–‡æ®µæœªé€šè¿‡æ ¡éªŒå’Œæ ¡éªŒï¼Œåˆ™ç«‹å³ä¸¢å¼ƒï¼Œåä¹‹ï¼Œåˆ™é€šè¿‡<strong>ç¡®è®¤è§„åˆ™</strong>ï¼ˆä¸‹é¢é©¬ä¸ŠæåŠï¼‰è¿›è¡Œç¡®è®¤ï¼›</li>\n<li><strong>é‡ä¼ </strong>ï¼šåœ¨å‘é€æ–¹ï¼Œå¦‚æœä¸€ä¸ªæŠ¥æ–‡æ®µé‡ä¼ è¶…æ—¶è®¡æ—¶å™¨ï¼ˆRTOï¼‰è¶…æ—¶ï¼Œå³åœ¨ RTO æ—¶é—´ä¹‹åä»ç„¶æœªæ”¶åˆ° ACKï¼Œåˆ™ç«‹å³é‡ä¼ æœªè¢«ç¡®è®¤çš„æœ€å°çš„æŠ¥æ–‡æ®µï¼›å¦‚æœæ”¶åˆ°å››ä¸ªç›¸åŒçš„çš„ ACK ï¼Œåˆ™ç«‹å³é‡ä¼ ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µï¼›</li>\n</ol>\n<h3 id=\"ç¡®è®¤è§„åˆ™\"><a href=\"#ç¡®è®¤è§„åˆ™\" class=\"headerlink\" title=\"ç¡®è®¤è§„åˆ™\"></a>ç¡®è®¤è§„åˆ™</h3><ol>\n<li>å½“æ¥å—æ–¹å‘å‘é€æ–¹å‘é€æ•°æ®æŠ¥æ–‡æ®µæ—¶ï¼Œå¿…é¡»<strong>æå¸¦</strong> ACKï¼›</li>\n<li>å½“æ¥å—æ–¹æ²¡æœ‰æ•°æ®è¦å‘é€æ—¶ï¼Œä½†æ˜¯æ”¶åˆ°ä¸€ä¸ª<strong>æŒ‰åºåˆ°è¾¾</strong>çš„æŠ¥æ–‡ï¼ŒåŒæ—¶å‰ä¸€ä¸ªæŠ¥æ–‡æ®µä¹Ÿå·²ç»ç¡®è®¤è¿‡äº†ï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹å°±æ¨è¿Ÿå‘é€ç¡®è®¤æŠ¥æ–‡æ®µï¼Œç›´åˆ°å¦ä¸€ä¸ªæŠ¥æ–‡æ®µåˆ°è¾¾æˆ–è€…å»¶è¿Ÿä¸€æ®µæ—¶é—´ä»¥å‡å°‘ ACK æŠ¥æ–‡é‡ï¼›</li>\n<li>å½“æ‰€æœŸæœ›çš„æŠ¥æ–‡æ®µåˆ°è¾¾ï¼Œä¸”å‰ä¸€ä¸ª<strong>æŒ‰åºåˆ°è¾¾</strong>çš„æŠ¥æ–‡è¿˜æœªè¢«ç¡®è®¤ï¼Œåˆ™ç«‹å³ ACKï¼ˆACK çš„åºå·ä»ç„¶æ˜¯ä¸‹ä¸€ä¸ªæ­£å¸¸æœŸæœ›çš„åºå·ï¼Œä¸‹åŒï¼‰ï¼›</li>\n<li>å½“åºå·æ¯”æœŸæœ›çš„å¤§çš„æŠ¥æ–‡æ®µï¼ˆ<strong>å¤±åº</strong>æŠ¥æ–‡æ®µï¼‰åˆ°è¾¾ï¼Œåˆ™ç«‹å³ ACKï¼Œä¸”å­˜å‚¨è¯¥æŠ¥æ–‡æ®µï¼›</li>\n<li>å½“<strong>ä¸¢å¤±</strong>çš„æŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œåˆ™ç«‹å³ ACKï¼›</li>\n<li>å½“<strong>é‡å¤</strong>çš„æŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œåˆ™ä¸¢å¼ƒï¼Œä¸”ç«‹å³ ACKï¼›</li>\n</ol>\n<h2 id=\"æ‹¥å¡æ§åˆ¶\"><a href=\"#æ‹¥å¡æ§åˆ¶\" class=\"headerlink\" title=\"æ‹¥å¡æ§åˆ¶\"></a>æ‹¥å¡æ§åˆ¶</h2><p>æ‹¥å¡æ§åˆ¶æ˜¯ä¸ºäº†é¿å…å› ä¸ºç½‘ç»œå—é™å¯¼è‡´ç½‘ç»œä¸èƒ½æŒ‰ç…§å‘é€æ–¹äº§ç”Ÿçš„æ•°æ®çš„é€Ÿåº¦å°†æŠ¥æ–‡æ®µäº¤ä»˜ç»™æ¥å—æ–¹ã€‚ä¸æµé‡æ§åˆ¶è€ƒå¯Ÿçš„å¯¹è±¡æ˜¯é€šä¿¡åŒæ–¹ä¸åŒï¼Œæ‹¥å¡æ§åˆ¶çš„è€ƒå¯Ÿå¯¹è±¡æ˜¯é€šä¿¡åŒæ–¹é—´çš„ç½‘ç»œã€‚æ‹¥å¡æ§åˆ¶çš„æ–¹å¼è¡¨ç°åœ¨å‘é€æ–¹çš„æ‹¥å¡çª—å£çš„å˜åŒ–ï¼Œä»è€Œæ§åˆ¶å‘é€æ–¹çš„æ•°æ®å‘é€å¿«æ…¢ã€‚TCP æœ€åˆä½¿ç”¨çš„æ‹¥å¡ç­–ç•¥ç§°ä¸º <strong>TCP Tahoe and Reno</strong>ã€‚</p>\n<h3 id=\"Tahoe-and-Reno\"><a href=\"#Tahoe-and-Reno\" class=\"headerlink\" title=\"Tahoe and Reno\"></a>Tahoe and Reno</h3><p>è¿™ä¸ªæ‹¥å¡ç­–ç•¥ä¸»è¦åˆ†ä¸ºæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€æ‹¥å¡æ£€æµ‹ä¸‰ä¸ªé˜¶æ®µã€‚</p>\n<h4 id=\"æ…¢å¯åŠ¨\"><a href=\"#æ…¢å¯åŠ¨\" class=\"headerlink\" title=\"æ…¢å¯åŠ¨\"></a>æ…¢å¯åŠ¨</h4><p>å‡è®¾æ¥æ”¶çª—å£å¤§å°è¿œå¤§äºæ‹¥å¡çª—å£ï¼Œä¸”ä¸è€ƒè™‘å»¶è¿Ÿç¡®è®¤ã€‚æ‹¥å¡çª—å£å¤§å°ä»ä¸€ä¸ªæœ€å¤§æŠ¥æ–‡é•¿åº¦ MSS ï¼ˆè¿æ¥å»ºç«‹æ—¶é€šè¿‡ TCP é€‰é¡¹å‘ŠçŸ¥ï¼‰å¼€å§‹ï¼Œä¹‹åæ¯å½“æœ‰ä¸€ä¸ªæŠ¥æ–‡æ®µè¢«ç¡®è®¤ï¼Œæ‹¥å¡çª—å£å°±å¢å¤§ä¸€ä¸ª MSSã€‚åœ¨è¿™æ ·çš„ç­–ç•¥ä¸‹ï¼Œæ…¢å¯åŠ¨é˜¶æ®µçš„æ‹¥å¡çª—å£å¤§å°å‘ˆæŒ‡æ•°å¢é•¿ã€‚å³ä» <code>1 -&gt; 2 -&gt; 4 -&gt; 8</code>ã€‚å½“åˆ°è¾¾æ…¢å¯åŠ¨é—¨é™æ—¶ï¼Œå°±è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚</p>\n<h4 id=\"æ‹¥å¡é¿å…\"><a href=\"#æ‹¥å¡é¿å…\" class=\"headerlink\" title=\"æ‹¥å¡é¿å…\"></a>æ‹¥å¡é¿å…</h4><p>æ‹¥å¡é¿å…é˜¶æ®µæ‹¥å¡çª—å£å¤§å°ç»§ç»­å¢åŠ ï¼Œä½†æ˜¯é€Ÿåº¦æ”¾æ…¢ï¼Œæ”¹æˆå½“æ•´ä¸ªçª—å£å¤§å°çš„æŠ¥æ–‡æ®µéƒ½è¢«ç¡®è®¤åï¼Œçª—å£å¤§å°æ‰å¢åŠ ä¸€ä¸ª MSSã€‚è¡¨ç°ä¸º <code>8 -&gt; 9 -&gt; 10 -&gt; 11</code>ï¼Œå‘ˆç°çº¿æ€§å¢é•¿ã€‚</p>\n<h4 id=\"æ‹¥å¡æ£€æµ‹\"><a href=\"#æ‹¥å¡æ£€æµ‹\" class=\"headerlink\" title=\"æ‹¥å¡æ£€æµ‹\"></a>æ‹¥å¡æ£€æµ‹</h4><p>å¦‚æœæ‹¥å¡å‘ç”Ÿäº†ï¼Œå› ä¸ºå‘ç”Ÿåœ¨ç½‘ç»œä¸­è·¯ç”±å™¨å‡ºç°ä¸¢åŒ…ç°è±¡ï¼Œåœ¨æ¥å—æ–¹å¤„çš„è¡¨ç°ä¸ºå‡ºç°ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼Œå¹¶åšå‡ºå¯¹åº”çš„ååº”ï¼š</p>\n<ol>\n<li><p>RTO è®¡æ—¶å™¨è¶…æ—¶ã€‚è¿™è¯´æ˜ç½‘ç»œæ‹¥å¡çš„å¯èƒ½æ€§è¾ƒå¤§ï¼ŒTCP åšå‡ºè¾ƒå¼ºçƒˆçš„ååº”ï¼š<br> a. æŠŠæ…¢å¯åŠ¨é—¨é™å€¼è°ƒæ•´ä¸ºå½“å‰çª—å£å¤§å°çš„ä¸€åŠï¼›<br> b. æŠŠ cwnd é‡æ–°è®¾ç½®ä¸º 1 MSSï¼›<br> c. é‡æ–°è¿›å…¥æ…¢å¯åŠ¨é˜¶æ®µï¼›</p>\n</li>\n<li><p>æ”¶åˆ°å››ä¸ªç›¸åŒçš„ ACKï¼›è¯´æ˜å‡ºç°æ‹¥å¡çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯å‡ºç°äº†ä¸¢åŒ…ï¼ŒTCP åšå‡ºè¾ƒå¼±çš„ååº”ï¼ŒReno ç®—æ³•è¡¨ç°ä¸ºå¿«æ¢å¤ï¼ˆFast recoveryï¼‰ï¼š<br> a. æŠŠæ…¢å¯åŠ¨é—¨é™å€¼è°ƒæ•´ä¸ºå½“å‰çª—å£å¤§å°çš„ä¸€åŠï¼›<br> b. æŠŠ cwnd é‡æ–°è®¾ç½®ä¸ºæ…¢å¯åŠ¨é—¨é™å€¼ï¼›<br> c. é‡æ–°è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µï¼›</p>\n</li>\n</ol>\n<p>å›¾ç¤ºå¦‚ä¸‹ï¼š<br><img src=\"congestion_control_example.png\" alt=\"æ‹¥å¡æ§åˆ¶ç¤ºä¾‹\"><br>Tahoe ç®—æ³•ä¸ Reno ï¼ˆTahoe çš„æ”¹è¿›ç‰ˆæœ¬ï¼‰çš„åŒºåˆ«åœ¨äºæ”¶åˆ°å››ä¸ªç›¸åŒ ACK æ—¶ï¼ŒTahoe ç®—æ³•çš„ç­–ç•¥å’Œ RTO è®¡æ—¶å™¨è¶…æ—¶æ—¶ä¸€è‡´ã€‚</p>\n<h3 id=\"å…¶ä»–æ‹¥å¡ç­–ç•¥\"><a href=\"#å…¶ä»–æ‹¥å¡ç­–ç•¥\" class=\"headerlink\" title=\"å…¶ä»–æ‹¥å¡ç­–ç•¥\"></a>å…¶ä»–æ‹¥å¡ç­–ç•¥</h3><p>æ‹¥å¡æ§åˆ¶ç­–ç•¥åªéœ€è¦åœ¨å‘é€æ–¹å®ç°å³å¯ï¼Œä¸éœ€è¦æ¥å—æ–¹çš„å‚ä¸ï¼Œå› æ­¤å¯ä»¥ä»…åœ¨å‘é€æ–¹éƒ¨ç½²ä¸€å¥—ç®—æ³•ã€‚ç°åœ¨ TCP ç½‘ç»œä¸Šçš„ç®—æ³•ä¹Ÿåœ¨ä¸æ–­<a href=\"https://en.wikipedia.org/wiki/TCP_congestion_control\" target=\"_blank\" rel=\"noopener\">æ”¹è¿›</a>ï¼Œæ¶Œç°å‡ºè¯¸å¦‚ <a href=\"http://www4.ncsu.edu/~rhee/export/bitcp/cubic-paper.pdf\" target=\"_blank\" rel=\"noopener\"><strong>TCP CUBIC</strong></a>ã€<a href=\"https://ai.google/research/pubs/pub45646\" target=\"_blank\" rel=\"noopener\"><strong>TCP BBR</strong></a> è¿™æ ·çš„ç®—æ³•ã€‚</p>\n<h2 id=\"TCP-ä¸­çš„è®¡æ—¶å™¨\"><a href=\"#TCP-ä¸­çš„è®¡æ—¶å™¨\" class=\"headerlink\" title=\"TCP ä¸­çš„è®¡æ—¶å™¨\"></a>TCP ä¸­çš„è®¡æ—¶å™¨</h2><h3 id=\"é‡ä¼ è®¡æ—¶å™¨\"><a href=\"#é‡ä¼ è®¡æ—¶å™¨\" class=\"headerlink\" title=\"é‡ä¼ è®¡æ—¶å™¨\"></a>é‡ä¼ è®¡æ—¶å™¨</h3><p>é‡ä¼ è®¡æ—¶å™¨çš„è¶…æ—¶æ—¶é—´ä¸º RTOï¼ŒRTO ä¸»è¦æ ¹æ®æµ‹é‡æ‰€å¾—çš„æŠ¥æ–‡æ®µå¾€è¿”æ—¶é—´ RTTmè®¡ç®—è€Œæ¥ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>\n<p>é¦–å…ˆè®¡ç®—å¹³æ»‘ RTTï¼Œå³RTTsï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTTs = RTTm // ç¬¬ä¸€æ¬¡æµ‹é‡</span><br><span class=\"line\">RTTs = (1 - Î±)RTTs + Î±RTTm // éšåçš„æµ‹é‡</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åè®¡ç®— RTT çš„åå·® RTTdï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTTd = RTTm / 2 // ç¬¬ä¸€æ¬¡æµ‹é‡</span><br><span class=\"line\">RTTd = (1 - Î²)RTTd + Î²|RTTs - RTTm| // éšåçš„æµ‹é‡</span><br></pre></td></tr></table></figure>\n\n<p>é‡ä¼ è¶…æ—¶ RTO çš„è®¡ç®—å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTO = 6s // åŸå§‹å€¼</span><br><span class=\"line\">RTO = RTTs + 4RTTd // ç¬¬ä¸€æ¬¡æµ‹é‡å</span><br></pre></td></tr></table></figure>\n\n<p>ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ª RTT åœ¨è¿›è¡Œæµ‹é‡ï¼Œå½“é‡ä¼ å‘ç”Ÿæ—¶ä¼šå½±å“ RTT çš„æµ‹é‡ï¼Œæ ¹æ® <strong>Karn ç®—æ³•</strong>ï¼ŒTCP å¿½ç•¥é‡ä¼ æŠ¥æ–‡çš„ RTTï¼Œè€Œå¯¹äºé‡ä¼ çš„æŠ¥æ–‡ï¼ŒRTO å€¼ä¸ºåŸæŠ¥æ–‡çš„ä¸¤å€ï¼Œå¦‚æœå‘ç”Ÿç¬¬äºŒæ¬¡é‡ä¼ ï¼Œåˆ™ä¸ºå››å€ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>\n<h3 id=\"æŒç»­è®¡æ—¶å™¨\"><a href=\"#æŒç»­è®¡æ—¶å™¨\" class=\"headerlink\" title=\"æŒç»­è®¡æ—¶å™¨\"></a>æŒç»­è®¡æ—¶å™¨</h3><p>å½“æ¥å—æ–¹å‘é€çª—å£å€¼ä¸º 0 çš„æŠ¥æ–‡æ®µä¹‹åï¼Œåæ¥å› ä¸ºæ¥æ”¶çª—å£å¢åŠ éœ€è¦é€šå‘Šæ¥çª—å£ä¸ºé 0ï¼Œä½†æ˜¯é€šå‘Šçš„ ACK ä¸¢å¤±ï¼Œè¿™ä¼šå¯¼è‡´å‘é€æ–¹ä¸€ç›´ç­‰å¾…é 0 çª—å£é€šå‘Šï¼Œå¯¼è‡´æ­»é”ã€‚æŒç»­è®¡æ—¶å™¨å°±æ˜¯æ¥å—æ–¹åœ¨æ”¶åˆ° 0 çª—å£é€šå‘Šåå¯ç”¨ï¼Œå¦‚æœè¶…æ—¶åˆ™å‘é€æ¢æµ‹æŠ¥æ–‡ï¼Œä¿ƒä½¿æ¥å—æ–¹é‡ä¼  ACKã€‚</p>\n<h3 id=\"Keep-Alive-è®¡æ—¶å™¨\"><a href=\"#Keep-Alive-è®¡æ—¶å™¨\" class=\"headerlink\" title=\"Keep-Alive è®¡æ—¶å™¨\"></a>Keep-Alive è®¡æ—¶å™¨</h3><p>Keep-Alive è®¡æ—¶å™¨ç”¨äºé˜²æ­¢ TCP è¿æ¥é•¿æ—¶é—´ç©ºé—²ï¼Œæ¯å½“æ”¶åˆ°å¯¹æ–¹çš„æŠ¥æ–‡æ®µï¼Œè¿™ä¸ªè®¡æ—¶å™¨å°±å¤ä½ã€‚è¿™ä¸ªè®¡æ—¶å™¨çš„è¶…æ—¶æ—¶é—´é€šå¸¸å¯ä»¥é€šè¿‡æ¥å£è¿›è¡Œè®¾å®šã€‚</p>\n<h3 id=\"Time-Wait-è®¡æ—¶å™¨\"><a href=\"#Time-Wait-è®¡æ—¶å™¨\" class=\"headerlink\" title=\"Time-Wait è®¡æ—¶å™¨\"></a>Time-Wait è®¡æ—¶å™¨</h3><p>Time-Wait è®¡æ—¶å™¨å¯¹æœ€åçš„ FIN è¿›è¡Œç¡®è®¤æ—¶å¯åŠ¨çš„è¶…æ—¶è®¡æ—¶å™¨ã€‚å¦‚æœåœ¨æ—¶å¸¸ä¸º 2MSL çš„è®¡æ—¶å™¨è¶…æ—¶å‰å†æ¬¡æ”¶åˆ° FINï¼Œåˆ™é‡ä¼  ACKï¼Œå¦åˆ™è¿æ¥å½»åº•å…³é—­ã€‚</p>\n<h2 id=\"ä¼ è¾“å±‚çš„æœªæ¥\"><a href=\"#ä¼ è¾“å±‚çš„æœªæ¥\" class=\"headerlink\" title=\"ä¼ è¾“å±‚çš„æœªæ¥\"></a>ä¼ è¾“å±‚çš„<a href=\"https://blog.apnic.net/2017/12/12/internet-protocols-changing/\" target=\"_blank\" rel=\"noopener\">æœªæ¥</a></h2><p><a href=\"https://www.chromium.org/quic\" target=\"_blank\" rel=\"noopener\">QIUC</a> äº†è§£ä¸€ä¸‹ä¸‹ï¼Ÿ</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://book.douban.com/subject/5386194/\" target=\"_blank\" rel=\"noopener\">TCP/IP åè®®æ— ç¬¬å››ç‰ˆ</a></li>\n<li><a href=\"https://book.douban.com/subject/5344443/\" target=\"_blank\" rel=\"noopener\">Andrew S.Tanenbaum - Computer Networks 5th</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Transmission_Control_Protocol\" target=\"_blank\" rel=\"noopener\">WikiPedia - Transmission Control Protocol</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/TCP_congestion_contro\" target=\"_blank\" rel=\"noopener\">WikiPedia - TCP congestion control</a></li>\n<li><a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">TCP Flags: PSH and URG</a></li>\n<li><a href=\"https://www.nada.kth.se/kurser/kth/2D1392/05/lectures/lecture_4.pdf\" target=\"_blank\" rel=\"noopener\">KTH - Internetworking Lecture 4</a></li>\n<li><a href=\"https://blog.csdn.net/dog250/article/details/81256550\" target=\"_blank\" rel=\"noopener\">ä¸€ä¸ª TCP FIN_WAIT2 çŠ¶æ€ç»†èŠ‚å¼•å‘çš„æ„Ÿæ…¨</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>ç”Ÿäº§ç¯å¢ƒé‡åˆ°äº›ç½‘ç»œé—®é¢˜ï¼ŒçŸ¥å¯¹ TCP åè®®è¿˜æ˜¯æœ‰äº›ç”Ÿç–ï¼Œåœ¨æ­¤å¤ä¹ è®°å½•ã€‚</p>","more":"<h2 id=\"åè®®\"><a href=\"#åè®®\" class=\"headerlink\" title=\"åè®®\"></a>åè®®</h2><h3 id=\"æŠ¥æ–‡æ®µæ ¼å¼\"><a href=\"#æŠ¥æ–‡æ®µæ ¼å¼\" class=\"headerlink\" title=\"æŠ¥æ–‡æ®µæ ¼å¼\"></a>æŠ¥æ–‡æ®µæ ¼å¼</h3><p>TCP åè®®æŠ¥æ–‡æ®µä¸»è¦ç”±<strong>é¦–éƒ¨ï¼ˆHeaderï¼‰</strong> ä¸<strong>æ•°æ®ï¼ˆDataï¼‰</strong> ä¸¤éƒ¨åˆ†ç»„æˆã€‚åœ¨è®¡ç®—æ ¡éªŒå’Œæ˜¯è¿˜ä¼šåŠ ä¸Šè™šæ‹Ÿçš„ä¼ªé¦–éƒ¨ã€‚æ­¤å¤„ä¸»è¦è¯´æ˜é¦–éƒ¨çš„ç»„æˆã€‚<br><img src=\"tcp_header.png\" alt=\"å›¾ 1 TCP Header (From: WikiPedia)\"><br>TCP åœ¨ç½‘ç»œæ¨¡å‹ä¸­å±äºè¿è¾“å±‚ï¼Œç”¨äºæä¾›è¿›ç¨‹ä¸è¿›ç¨‹é—´çš„å­—èŠ‚æµé€šä¿¡æœåŠ¡ï¼Œå› æ­¤éœ€è¦<strong>æº / ç›®ç«¯å£ï¼ˆSource / Destination portï¼‰</strong> ä»¥ç¡®å®šé€šä¿¡åŒæ–¹è¿›ç¨‹ã€‚ä½¿ç”¨<strong>åºå·ï¼ˆSequence numberï¼Œseqï¼‰</strong> è¡¨æ˜æœ¬æŠ¥æ–‡æ®µç¬¬ä¸€ä¸ªæ•°æ®å­—èŠ‚çš„ç¼–å·ï¼Œåˆå§‹åºå·ç”±åŒæ–¹åœ¨ TCP è¿æ¥å»ºç«‹æ—¶éšæœºç”Ÿæˆã€‚ä½¿ç”¨<strong>ç¡®è®¤å·ï¼ˆAcknowledgment numberï¼Œackï¼‰</strong> è¡¨ç¤ºæ¥å—æ–¹æœŸæœ›ä»å‘é€æ–¹æ¥å—çš„å­—èŠ‚ç¼–å·ã€‚<strong>æ•°æ®åç§»é‡ï¼ˆData Offsetï¼‰</strong> é¡¾åæ€ä¹‰æŠ¥æ–‡æ®µæ•°æ®å¼€å§‹å­—èŠ‚å¤„çš„åç§»é‡ï¼Œå³ TCP header çš„é•¿åº¦ï¼Œç”±äºé€‰é¡¹çš„å­˜åœ¨ï¼Œé¦–éƒ¨é•¿åº¦çš„èŒƒå›´æ˜¯ 20ï½60 Bytesï¼Œä½†æ˜¯è¯¥å­—æ®µåªæœ‰ 4 Bitsï¼Œå› æ­¤è¯¥å­—æ®µæŒ‡å‡ºé¦–éƒ¨é•¿åº¦æœ‰å¤šå°‘ä¸ª 4 Bytesã€‚æ¥ä¸‹æ¥çš„ 3 Bits è¢«<strong>ä¿ç•™ï¼ˆReservedï¼‰</strong> ã€‚éšåä¼šè®¨è®º 9 ä¸ª<strong>æ ‡å¿—ä½ï¼ˆFlagsï¼‰</strong>ã€‚<strong>çª—å£å¤§å°ï¼ˆWindow Sizeï¼‰</strong> å®šä¹‰äº†æ¥å—æ–¹çš„æ¥å—çª—å£å¤§å°ï¼Œç”±æ¥å—æ–¹å†³å®šï¼Œç„¶åå‘ŠçŸ¥å‘é€æ–¹ã€‚åœ¨è®¡ç®—<strong>æ ¡éªŒå’Œï¼ˆChecksumï¼‰</strong> æ—¶éœ€è¦åŠ ä¸Šä¼ªé¦–éƒ¨ï¼Œä¼ªé¦–éƒ¨çš„å†…å®¹åŒ…æ‹¬æºç›® IP åœ°å€ï¼ŒTCP æŠ¥æ–‡æ®µé•¿åº¦ç­‰ã€‚å¦‚æœ URG æ ‡å¿—ä½è¢«è®¾å®šäº†ï¼Œé‚£<strong>ç´§æ€¥æŒ‡é’ˆï¼ˆUrgent pointerï¼‰</strong> ç”¨äºæŒ‡ç¤ºç´§æ€¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚åœ¨æŠ¥æ–‡æ®µæ•°æ®éƒ¨åˆ†ä¸­çš„åç§»é‡ã€‚æœ€åçš„ 40 Bytes ç•™ç»™<strong>é€‰é¡¹ï¼ˆOptionsï¼‰</strong>ã€‚</p>\n<h3 id=\"Flags\"><a href=\"#Flags\" class=\"headerlink\" title=\"Flags\"></a>Flags</h3><ul>\n<li><strong>URG</strong>ï¼šä¸º 1 è¡¨ç¤ºæ•°æ®ä¸­æœ‰ç´§æ€¥æ•°æ®ã€‚è¿™ä¸ªæ ‡è®°æ¯”è¾ƒå°‘è§ï¼Œå¯ä»¥æ‰¾åˆ°çš„ä¸€äº›åº”ç”¨æœ‰ï¼š<a href=\"https://stackoverflow.com/questions/24476458/understanding-tcp-urg-flag\" target=\"_blank\" rel=\"noopener\">FTP</a>ï¼Œ<a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">Telnet</a>ï¼›</li>\n<li><strong>ACK</strong>ï¼šä¸º 1 è¡¨ç¤ºç¡®è®¤å·å­—æ®µæœ‰æ•ˆï¼›</li>\n<li><strong>PSH</strong>ï¼šä¸º 1 è¡¨ç¤ºæœ‰æ¨é€æ•°æ®ï¼Œè¿™ä¸ªå­—æ®µä¸»è¦å®Œæˆ<a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">ä¸¤ä¸ªåŠŸèƒ½</a>ï¼šå‘é€æ–¹åº”ç”¨å±‚æé†’ TCP éœ€è¦ç«‹å³å‘é€æ•°æ®ï¼›æ¥å—æ–¹ TCP éœ€è¦å°†æ”¶åˆ°çš„æ•°æ®ç«‹å³æäº¤ç»™åº”ç”¨å±‚ï¼›</li>\n<li><strong>RST</strong>ï¼šä¸º 1 è¡¨ç¤ºå‡ºç°ä¸¥é‡å·®é”™ã€‚å¯èƒ½éœ€è¦é‡ç°åˆ›å»º TCP è¿æ¥ã€‚è¿˜å¯ä»¥ç”¨äºæ‹’ç»éæ³•çš„æŠ¥æ–‡æ®µå’Œæ‹’ç»è¿æ¥è¯·æ±‚ï¼›</li>\n<li><strong>SYN</strong>ï¼šä¸º 1 è¡¨ç¤ºè¿™æ˜¯è¿æ¥è¯·æ±‚æˆ–æ˜¯è¿æ¥æ¥å—è¯·æ±‚ï¼Œç”¨äºåˆ›å»ºè¿æ¥å’Œä½¿é¡ºåºå·åŒæ­¥ï¼›</li>\n<li><strong>FIN</strong>ï¼šä¸º 1 è¡¨ç¤ºå‘é€æ–¹æ²¡æœ‰æ•°æ®è¦ä¼ è¾“äº†ï¼Œè¦æ±‚é‡Šæ”¾è¿æ¥ï¼›</li>\n</ul>\n<h2 id=\"é˜¶æ®µ\"><a href=\"#é˜¶æ®µ\" class=\"headerlink\" title=\"é˜¶æ®µ\"></a>é˜¶æ®µ</h2><p>TCP è¿æ¥å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼šå»ºç«‹è¿æ¥ï¼Œä¼ è¾“æ•°æ®ï¼Œç»ˆæ­¢è¿æ¥ã€‚å¯ä»¥ç”¨ä¸€ä¸ªæœ‰é™çŠ¶æ€æœºè¡¨ç¤ºï¼š<br><img src=\"tcp_connection.png\" alt=\"å›¾ 2 TCP è¿æ¥ (From: Computer Networks)&lt;br&gt;å›¾ä¸­ï¼ˆA/Bï¼‰è¿™æ ·çš„æ–‡å­—è¡¨ç¤ºâ€œæ”¶åˆ°Aåæ‰§è¡ŒBï¼ŒAä¸Bå¯ä»¥æ˜¯æ ‡å¿—ä½æˆ–è€…æŒ‡ä»¤â€&lt;br&gt;æ·±å®çº¿è¡¨ç¤º Client çš„è¡Œä¸ºï¼Œæ·±è™šçº¿è¡¨ç¤º Server çš„è¡Œä¸ºï¼Œæµ…è‰²çº¿è¡¨ç¤ºç‰¹æ®Šè¡Œä¸º\"><br>ä¸‹é¢ç»“åˆä¸€ä¸ªç”¨ Rust å†™çš„ Echo Server ä¸æŠ“åŒ…å·¥å…· Wireshark æ¥æ¼”ç¤ºè¿™ä¸‰ä¸ªè¿‡ç¨‹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight rust\"><figcaption><span>Echo Server</span><a href=\"/downloads/code/echo_server.rs\">view raw</a></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">use</span> std::net::{TcpListener, TcpStream};</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::thread;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::Read;</span><br><span class=\"line\"><span class=\"keyword\">use</span> std::io::Write;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">pub</span> <span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">main</span></span>() {</span><br><span class=\"line\">    <span class=\"keyword\">let</span> listener = TcpListener::bind(<span class=\"string\">\"::1:9999\"</span>).unwrap();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> stream <span class=\"keyword\">in</span> listener.incoming() {</span><br><span class=\"line\">        <span class=\"keyword\">match</span> stream {</span><br><span class=\"line\">            <span class=\"literal\">Ok</span>(stream) =&gt; {</span><br><span class=\"line\">                thread::spawn(|| {</span><br><span class=\"line\">                    handle_client(stream);</span><br><span class=\"line\">                });</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"literal\">Err</span>(_) =&gt; {</span><br><span class=\"line\">                <span class=\"built_in\">println!</span>(<span class=\"string\">\"Error\"</span>);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">fn</span> <span class=\"title\">handle_client</span></span>(<span class=\"keyword\">mut</span> stream: TcpStream) {</span><br><span class=\"line\">    <span class=\"keyword\">loop</span> {</span><br><span class=\"line\">        <span class=\"keyword\">let</span> <span class=\"keyword\">mut</span> read = [<span class=\"number\">0</span>; <span class=\"number\">1024</span>];</span><br><span class=\"line\">        <span class=\"keyword\">match</span> stream.read(&amp;<span class=\"keyword\">mut</span> read) {</span><br><span class=\"line\">            <span class=\"literal\">Ok</span>(n) =&gt; {</span><br><span class=\"line\">                <span class=\"keyword\">if</span> n == <span class=\"number\">0</span> {</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                }</span><br><span class=\"line\">                stream.write(&amp;read[<span class=\"number\">0</span>..n]).unwrap();</span><br><span class=\"line\">            }</span><br><span class=\"line\">            <span class=\"literal\">Err</span>(err) =&gt; {</span><br><span class=\"line\">                <span class=\"built_in\">panic!</span>(err);</span><br><span class=\"line\">            }</span><br><span class=\"line\">        }</span><br><span class=\"line\">    }</span><br><span class=\"line\">}</span><br></pre></td></tr></table></figure>\n<p>Echo Server å¯åŠ¨ä¹‹åä½¿ç”¨ telnet å·¥å…·è¿æ¥è‡³æœåŠ¡å™¨ï¼Œä¸æœåŠ¡å™¨äº¤äº’ä¸¤æ¬¡ï¼Œå³å›æ˜¾ä¸¤æ¬¡å­—ç¬¦ä¸²ï¼Œç„¶åä»é€€å‡º telnetã€‚æŠ“åˆ°çš„åŒ…æˆªå›¾å¦‚ä¸‹ï¼š<br><img src=\"wireshark.png\" alt=\"å›¾ 3 Wireshark æŠ“åŒ…\"></p>\n<p>åœ¨ä¸‹é¢çš„è¡¨è¿°ä¸­ï¼Œå®¢æˆ·ç«¯è¡¨ç¤ºåœ¨è¿™ä¸€é˜¶æ®µå…ˆå‘èµ·è¯·æ±‚çš„ä¸€æ–¹ï¼ŒæœåŠ¡ç«¯è¡¨ç¤ºåœ¨è¿™ä¸€é˜¶æ®µå…ˆæ¥å—è¯·æ±‚çš„ä¸€æ–¹ã€‚åœ¨ TCP ä¸­ï¼ŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¹‹é—´å¯ä»¥è¿›è¡ŒåŒå‘é€šä¿¡ï¼Œä»–ä»¬å¯ä»¥ç†è§£ä¸ºå¯¹ç­‰çš„ï¼Œåœ¨è¿æ¥å»ºç«‹åï¼Œå®é™…ä¸Šæ²¡æœ‰æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„åŒºåˆ«ã€‚</p>\n<h3 id=\"å»ºç«‹è¿æ¥\"><a href=\"#å»ºç«‹è¿æ¥\" class=\"headerlink\" title=\"å»ºç«‹è¿æ¥\"></a>å»ºç«‹è¿æ¥</h3><p>å‰ä¸‰ä¸ªåŒ…ä»£è¡¨äº†å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ï¼Œåˆ†ä¸ºä¸‰æ­¥ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å°±å¦‚åŒæŠ“åŒ…æ‰€ç¤ºï¼Œç§°ä¸º<strong>ä¸‰æ¬¡æ¡æ‰‹ï¼ˆ3-way handshakeï¼‰</strong>ã€‚å›¾ 2 ä¸­è¿˜ç”»å‡ºäº†åŒæ–¹åŒæ—¶æ‰“å¼€è¿æ¥ä¸è¿æ¥å¤ä½è¿™ä¸¤ç§æ¯”è¾ƒå°‘è§çš„æƒ…æ™¯ã€‚</p>\n<ol>\n<li>å®¢æˆ·ç«¯å‘é€ç»™æœåŠ¡ç«¯ä¸€ä¸ª <strong>SYN</strong> æŠ¥æ–‡ï¼Œç”¨ä»¥å‘ŠçŸ¥æœåŠ¡ç«¯åˆå§‹åºå·ä¸º 0ï¼ˆæ­¤å¤„çš„ Seq ç»è¿‡ Wireshark çš„å¤„ç†ï¼Œå˜æˆäº†ç›¸å¯¹å€¼ï¼‰ï¼Œç„¶åå®¢æˆ·ç«¯è¿›å…¥ <strong><em>SYN_SENT</em></strong> çŠ¶æ€ã€‚</li>\n<li>æœåŠ¡å™¨æ”¶åˆ° 1 ä¸­æŠ¥æ–‡åï¼Œå‘ç»™å®¢æˆ·ç«¯ä¸€ä¸ª <strong>SYN + ACK</strong> æŠ¥æ–‡ï¼Œå‘ŠçŸ¥å®¢æˆ·ç«¯åˆå§‹åºå·ä¸º 0ï¼Œä¸”æ¥ä¸‹æ¥æœŸæœ›ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„åºå· Ack ä¸º 1ã€‚æœåŠ¡ç«¯è¿›å…¥ <strong><em>SYN_RCVD</em></strong> çŠ¶æ€ã€‚å¯è§ <strong>SYN æŠ¥æ–‡æ¶ˆè€—äº†ä¸€ä¸ªåºå·</strong>ã€‚</li>\n<li>å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å›å¤ <strong>ACK</strong> æŠ¥æ–‡ï¼Œè¿›å…¥ <strong><em>ESTABLISHED</em></strong> çŠ¶æ€ï¼ŒæœåŠ¡ç«¯åœ¨æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡è¿æ¥å»ºç«‹å®Œæˆã€‚å¯è§ <strong>ACK æŠ¥æ–‡åœ¨ä¸æºå¸¦æ•°æ®çš„æƒ…å†µä¸‹ä¸æ¶ˆè€—åºå·</strong>ã€‚</li>\n</ol>\n<h3 id=\"ä¼ è¾“æ•°æ®\"><a href=\"#ä¼ è¾“æ•°æ®\" class=\"headerlink\" title=\"ä¼ è¾“æ•°æ®\"></a>ä¼ è¾“æ•°æ®</h3><p>å›¾ 3 ä¸­ P17ï½P20 ä¸ P72ï½P74 åˆ†åˆ«å±•ç¤ºäº†ä¸¤æ¬¡äº¤äº’è¿‡ç¨‹ã€‚ä»¥ç¬¬äºŒæ¬¡äº¤äº’ä¸ºä¾‹ï¼š</p>\n<ol>\n<li>P72 ä¸­ï¼Œå®¢æˆ·ç«¯å°†æƒ³è¦å›æ˜¾å­—ç¬¦ä¸²å‘é€ç»™æœåŠ¡ç«¯ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨è¿™ä¸ªæŠ¥æ–‡æ®µçš„æ•°æ®é¦–å­—èŠ‚åºå·ä¸º 8ï¼Œå¹¶ä¸”å¸Œæœ›ä»æœåŠ¡ç«¯æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºå·æ˜¯ 8ã€‚</li>\n<li>æœåŠ¡ç«¯å°†å›æ˜¾çš„å­—ç¬¦ä¸²ä¸å¯¹ P72 çš„ç¡®è®¤ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ã€‚P72 çš„é•¿åº¦ä¸º 9ï¼Œå› æ­¤æŠ¥æ–‡æ®µä¸­æ•°æ®çš„åºå·èŒƒå›´ä¸º [8,17)ï¼Œå› æ­¤åœ¨ P73 ä¸­ Ack ä¸º 17ã€‚</li>\n<li>å®¢æˆ·ç«¯ç¡®è®¤ P73ã€‚</li>\n</ol>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤æ¬¡äº¤äº’æœ‰æ‰€åŒºåˆ«ï¼šç¬¬ä¸€æ¬¡äº¤äº’æ—¶ï¼ŒæœåŠ¡ç«¯å…ˆè¿”å›äº†ä¸€ä¸ªç¡®è®¤ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå†é¢å¤–å‘é€ä¸€æ¡æºå¸¦å›æ˜¾å†…å®¹çš„æŠ¥æ–‡æ®µã€‚ä½†æ˜¯ç¬¬äºŒæ¬¡äº¤äº’æ—¶çœç•¥äº†å•ç‹¬çš„ç¡®è®¤ã€‚</p>\n<h3 id=\"ç»ˆæ­¢è¿æ¥\"><a href=\"#ç»ˆæ­¢è¿æ¥\" class=\"headerlink\" title=\"ç»ˆæ­¢è¿æ¥\"></a>ç»ˆæ­¢è¿æ¥</h3><p>æ ¹æ®â€œå¹¿å¤§åšä¸»â€å†™ä½œçš„æ–‡ç« ä¸<a href=\"https://www.zhihu.com/question/50646354\" target=\"_blank\" rel=\"noopener\">é—®ç­”ç½‘ç«™çš„è®¨è®º</a>ä»¥åŠå„ç§é¢ç»ï¼ŒåŸºæœ¬ä¸€è‡´è®¤ä¸ºï¼Œç»ˆæ­¢è¿æ¥é€šå¸¸è¢«æˆä¸º<strong>å››æ¬¡æŒ¥æ‰‹ï¼ˆ4-way terminationï¼‰</strong>ï¼Œå³é€šä¿¡åŒæ–¹ä¼šæœ‰å››æ¬¡äº¤äº’ï¼Œä½†æ˜¯å¦‚å›¾ 2 æ‰€ç¤ºï¼Œä¹Ÿå­˜åœ¨<strong>ä¸‰æ¬¡æŒ¥æ‰‹</strong>çš„å¯èƒ½æ€§ï¼Œä¸”æˆ‘æœ¬åœ°çš„å¤šæ¬¡æŠ“åŒ…ä¹Ÿå¦‚å›¾ 3 ä¸€è‡´â€”â€”å‡ä¸ºä¸‰æ¬¡æŒ¥æ‰‹ï¼Œä¸”æ— ä¸€ä¾‹å¤–ã€‚ä¸‹é¢å¯¹å››æ¬¡æŒ¥æ‰‹è¿›è¡Œåˆ†æï¼Œä¸‰æ¬¡æŒ¥æ‰‹å¯ä»¥è¢«å…¶æ¦‚æ‹¬ï¼š</p>\n<ol>\n<li>å®¢æˆ·ç«¯å‘èµ·ç»ˆæ­¢è¿æ¥ï¼Œå‘å‡ºä¸€ä¸ª <strong>FIN</strong> æŠ¥æ–‡ç»™æœåŠ¡ç«¯ï¼Œå‡è®¾è¯¥æŠ¥æ–‡çš„ Seq ä¸º Xï¼ŒAck ä¸º Yã€‚ç„¶åå®¢æˆ·ç«¯è¿›å…¥ <strong><em>FIN_WAIT1</em></strong> çŠ¶æ€ï¼Œé™¤é‡ä¼  FIN æŠ¥æ–‡ä¸å‘é€ ACK ç¡®è®¤ä¹‹å¤–ï¼Œä¸å†å‘é€åº”ç”¨æ•°æ®ç»™æœåŠ¡ç«¯ã€‚</li>\n<li>æœåŠ¡ç«¯æ”¶åˆ° FIN æŠ¥æ–‡æ®µåå…ˆå›å¤ä¸€ä¸ª <strong>ACK</strong> æŠ¥æ–‡ï¼Œè¿›å…¥ <strong><em>CLOSE_WAIT</em></strong> çŠ¶æ€ï¼Œè¯¥æŠ¥æ–‡çš„ Seq ä¸º Yï¼ŒAck ä¸º X+1ã€‚</li>\n<li>å®¢æˆ·ç«¯åœ¨æ”¶åˆ° FIN çš„ ACK ä¹‹åè¿›å…¥ <strong><em>FIN_WAIT2</em></strong> çŠ¶æ€ã€‚æ­¤æ—¶æœåŠ¡ç«¯è¿˜å¯ä»¥ç»§ç»­å°†æœªå‘é€å®Œçš„åº”ç”¨æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li>\n<li>æœåŠ¡ç«¯å‘é€å®Œæ•°æ®åå‘é€ä¸€æ¡ <strong>FIN</strong> æŠ¥æ–‡ï¼Œè¿›å…¥ <strong><em>LAST_ACK</em></strong> çŠ¶æ€ï¼Œè¯¥æŠ¥æ–‡çš„ Seq ä¸º Y+Kï¼ŒAck ä¸º X+1ã€‚</li>\n<li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡ç«¯çš„ FIN åï¼Œå‘é€æœ€åçš„ <strong>ACK</strong> æŠ¥æ–‡ç»™æœåŠ¡å™¨ï¼Œç„¶åè¿›å…¥ <strong><em>TIME_WAIT</em></strong> çŠ¶æ€ã€‚å¦‚æœåœ¨ 2MSLï¼ˆæœ€å¤§æŠ¥æ–‡æ®µå¯¿å‘½ï¼Œé€šå¸¸ä¸º30ï½60sï¼‰åå®¢æˆ·ç«¯æ²¡å†æ¬¡æ”¶åˆ° FIN æŠ¥æ–‡ï¼Œåˆ™è¿›å…¥ <strong><em>CLOSED</em></strong> çŠ¶æ€ï¼Œå¦åˆ™é‡å‘ ACK æŠ¥æ–‡è¿›è¡Œé‡è¯•ã€‚</li>\n<li>æœåŠ¡ç«¯åœ¨æ”¶åˆ° ACK æŠ¥æ–‡åè¿›å…¥ <strong><em>CLOSED</em></strong> çŠ¶æ€ã€‚</li>\n</ol>\n<p>ä¸‰æ¬¡æŒ¥æ‰‹è¡¨ç°ä¸ºæ­¥éª¤ 2ï½4 åˆå¹¶ä¸ºä¸€æ­¥ï¼Œå³åŒæ—¶å‘é€å¯¹å®¢æˆ·ç«¯ FIN çš„ ACK æŠ¥æ–‡ä¸ æœåŠ¡ç«¯è‡ªå·±çš„ FIN æŠ¥æ–‡ã€‚è¿™æ¡ <strong>FIN+ACK</strong> æŠ¥æ–‡çš„ Seq ä¸º Yï¼ŒAck ä¸º X+1ã€‚</p>\n<p>è‡³äºåœ¨ä»€ä¹ˆæƒ…æ™¯ä¸‹å‡ºç°ä¸‰æ¬¡æ¡æ‰‹æˆ–è€…å››æ¬¡æ¡æ‰‹ï¼Œå¤§å¤šæ•°çš„è§‚ç‚¹è®¤ä¸ºå…ˆæ”¶åˆ° FIN æŠ¥æ–‡çš„ä¸€æ–¹è¿˜éœ€è¦å‘ä¸Šå±‚åº”ç”¨è¯¢é—®æ˜¯å¦ä»ç„¶æœ‰æ•°æ®éœ€è¦å‘é€ï¼Œå› ä¸ºè¦ç­‰å¾…ä¸Šå±‚çš„å›å¤ï¼Œæ‰€ä»¥â€œä¸ºä½•ä¸æ—©ç‚¹æŠŠå¯¹ FIN çš„ ACK å‘å‡ºå»å‘¢ï¼Ÿï¼â€è€Œä¸”ç«‹å³ Ack èƒ½é˜²æ­¢å¯¹æ–¹é‡ä¼  FINã€‚ä½†æ˜¯æœ‰æ²¡æœ‰å­˜åœ¨ä¸éœ€è¦è¯¢é—®ä¸Šå±‚æˆ–è€…ä¸éœ€è¦ç«‹å³å›å¤ Ack çš„å¯èƒ½ï¼Œå°±å¦‚åŒä¼ è¾“æ•°æ®å‡ºç°çš„æƒ…å†µä¸€æ ·ï¼Œè¿™äº›åº”è¯¥ä¸ TCP çš„å…·ä½“å®ç°ç›¸å…³ï¼Œç›®å‰èƒ½åŠ›ä¸ç²¾åŠ›æœ‰é™ï¼Œè¿˜æœ‰å¾…å¯¹ <a href=\"https://github.com/torvalds/linux/blob/master/net/ipv4/tcp_output.c\" target=\"_blank\" rel=\"noopener\">Linux TCP å®ç°æºç </a>è¿›è¡Œé˜…è¯»ã€‚</p>\n<h2 id=\"æ»‘åŠ¨çª—å£\"><a href=\"#æ»‘åŠ¨çª—å£\" class=\"headerlink\" title=\"æ»‘åŠ¨çª—å£\"></a>æ»‘åŠ¨çª—å£</h2><p>æ»‘åŠ¨çª—å£æ˜¯ TCP ä¸­ç”¨äºå®ç°è¯¸å¦‚ ACK ç¡®è®¤ã€æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶çš„æ‰¿è½½ç»“æ„ã€‚å¦‚å›¾æ‰€ç¤º:<br><img src=\"sliding_window.png\" alt=\"å›¾ 4 æ»‘åŠ¨çª—å£\"><br>å…ˆå°† TCP çœ‹ä½œæ˜¯ç®€å•çš„å•å‘é€šä¿¡ï¼Œåˆ™å‘é€æ–¹æœ‰ä¸€ä¸ªå‘é€çª—å£ï¼Œæ¥æ”¶æ–¹æœ‰ä¸€ä¸ªæ¥æ”¶çª—å£ã€‚æ­£å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œä¼ è¾“çš„æ˜¯æŠ¥æ–‡æ®µï¼Œçª—å£å¤§å°çš„å•ä½æ˜¯å­—èŠ‚ã€‚ä¸¤ä¸ªçª—å£ä¸­<strong>ç™½è‰²åŒºåŸŸ</strong>ä¸ºç©ºç™½ä½ç½®ï¼Œç­‰å¾…è¢«åº”ç”¨å±‚æˆ–è€…ç½‘ç»œå±‚å¡«æ»¡ï¼›<strong>ç°è‰²åŒºåŸŸ</strong>æ˜¯å·²ç»å‘é€ä½†æ˜¯è¿˜æ²¡æœ‰æ¥å—åˆ°ç¡®è®¤çš„å­—èŠ‚ï¼›<strong>ç²‰è‰²åŒºåŸŸ</strong>åœ¨å‘é€çª—å£ä¸­è¡¨ç¤ºç­‰å¾…è¢«å‘é€çš„å­—èŠ‚ï¼Œåœ¨æ¥æ”¶çª—å£æ±‡æ€»è¡¨ç¤ºç­‰å¾…äº¤ä»˜çš„å­—èŠ‚ã€‚<br>å‘é€çª—å£çš„å¤§å°ä¸ºæ¥å—æ–¹é€šè¿‡é¦–éƒ¨ä¸­çª—å£å¤§å°å­—æ®µå‘ŠçŸ¥çš„æ¥æ”¶çª—å£å¤§å° rwnd å’Œä¹‹åä¼šè®²åˆ°çš„æ‹¥å¡çª—å£çš„å¤§å° cwnd ä¸¤è€…ä¸­çš„è¾ƒå°å€¼ï¼Œå³ <code>min(rwnd , cwnd)</code>ã€‚æ¥æ”¶çª—å£å¤§å°æ˜¯æ¥æ”¶æ–¹å¯ç”¨ç¼“å­˜ç©ºé—´å¤§å°ï¼Œä¸º <code>rwnd = ç¼“å­˜å¤§å° - å‡†å¤‡äº¤ä»˜çš„å­—èŠ‚æ•°</code>ã€‚</p>\n<h2 id=\"æµé‡æ§åˆ¶\"><a href=\"#æµé‡æ§åˆ¶\" class=\"headerlink\" title=\"æµé‡æ§åˆ¶\"></a>æµé‡æ§åˆ¶</h2><p>æµé‡æ§åˆ¶ç”¨äºå¹³è¡¡ç”Ÿäº§è€…äº§ç”Ÿæ•°æ®ä¸æ¶ˆè´¹è€…æ¶ˆè€—æ•°æ®çš„é€Ÿåº¦ã€‚TCP ä¸­çš„æµé‡æ§åˆ¶å®ç°çš„ä¸»è¦é€”å¾„æ˜¯ä¸æ–­è°ƒæ•´å‘é€çª—å£çš„å¤§å°å®ç°ã€‚å‘é€ TCP ä¸€æ—¦å‘ç°å‘é€å‘é€çª—å£æ»¡äº†å°±ä¼šå¯¹å‘é€è¿›ç¨‹è¿›è¡Œåé¦ˆã€‚æ¥å—æ–¹æ ¹æ®ä¹‹å‰ä»å‘é€æ–¹æ”¶åˆ°çš„æ•°æ®é‡å’ŒæœåŠ¡å™¨å·²ç»æ¶ˆè€—çš„æ•°æ®é‡å¾—åˆ°è‡ªèº«æ¥æ”¶çª—å£çš„å¤§å°ï¼Œå°†è¿™ä¸ªå€¼å‘ŠçŸ¥å‘é€æ–¹ï¼Œå‘é€æ–¹æ ¹æ®æ”¶åˆ°çš„çª—å£å¤§å°è°ƒæ•´è‡ªèº«çª—å£å¤§å°ã€‚<br>è¿˜æœ‰æ­£å¯¹é€šä¿¡åŒæ–¹äº§ç”Ÿæ•°æ®å°æˆ–è€…æ¶ˆè´¹æ•°æ®æ…¢äº§ç”Ÿç³Šæ¶‚çª—å£ç»¼åˆå¾æ—¶ï¼Œæœ‰å…¶ä»–æ–¹é¢çš„æµé‡æ§åˆ¶ã€‚å½“å‘é€æ–¹æ•°æ®é‡ç›¸å¯¹äºé¦–éƒ¨å°å¾ˆå¤šçš„æŠ¥æ–‡å¾ˆå¤šæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <strong>Nagle ç®—æ³•</strong>å‡å°‘è¿™ç§å°æŠ¥æ–‡é‡ã€‚å½“æ¥å—æ–¹æ¶ˆè€—æ•°æ®å¾ˆæ…¢æ—¶ï¼Œæ¯æ¬¡å‘ŠçŸ¥å‘é€æ–¹çš„çª—å£å¤§å°ä¼šæ¯”è¾ƒå°ï¼Œä¹Ÿå¯èƒ½äº§ç”Ÿå¾ˆå¤šå°æŠ¥æ–‡ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨ <strong>Clark è§£å†³æ–¹æ³•</strong>æˆ–è€…è¿›è¡Œ<strong>æ¨è¿Ÿç¡®è®¤</strong>ã€‚å…³äºè¿™å‡ ç§æ–¹æ¡ˆçš„åˆ†æåŠå…·ä½“çš„ä½¿ç”¨æƒ…æ™¯å¯ä»¥å‚è€ƒ dog520 å¤§ç¥çš„è¿™ç¯‡æ–‡ç« â€”â€”<a href=\"https://blog.csdn.net/dog250/article/details/21303679\" target=\"_blank\" rel=\"noopener\">å†æ¬¡è°ˆè°ˆ TCP çš„ Nagle ç®—æ³•ä¸ TCP_CORK é€‰é¡¹</a>ã€‚</p>\n<h2 id=\"å·®é”™æ§åˆ¶\"><a href=\"#å·®é”™æ§åˆ¶\" class=\"headerlink\" title=\"å·®é”™æ§åˆ¶\"></a>å·®é”™æ§åˆ¶</h2><p>å·®é”™æ§åˆ¶ç”¨äºæè¿° TCP åœ¨å‘é€æˆ–è€…æ¥å—åˆ°æŠ¥æ–‡æ®µå‘ç”Ÿå¼‚å¸¸æ—¶çš„è¡Œä¸ºï¼Œå…¶ä¸»è¦è¡¨ç°åœ¨å¦‚ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>\n<ol>\n<li><strong>æ ¡éªŒå’Œ</strong>ï¼šåœ¨æ¥å—æ–¹ï¼Œå¦‚æœæ”¶åˆ°çš„æŠ¥æ–‡æ®µæœªé€šè¿‡æ ¡éªŒå’Œæ ¡éªŒï¼Œåˆ™ç«‹å³ä¸¢å¼ƒï¼Œåä¹‹ï¼Œåˆ™é€šè¿‡<strong>ç¡®è®¤è§„åˆ™</strong>ï¼ˆä¸‹é¢é©¬ä¸ŠæåŠï¼‰è¿›è¡Œç¡®è®¤ï¼›</li>\n<li><strong>é‡ä¼ </strong>ï¼šåœ¨å‘é€æ–¹ï¼Œå¦‚æœä¸€ä¸ªæŠ¥æ–‡æ®µé‡ä¼ è¶…æ—¶è®¡æ—¶å™¨ï¼ˆRTOï¼‰è¶…æ—¶ï¼Œå³åœ¨ RTO æ—¶é—´ä¹‹åä»ç„¶æœªæ”¶åˆ° ACKï¼Œåˆ™ç«‹å³é‡ä¼ æœªè¢«ç¡®è®¤çš„æœ€å°çš„æŠ¥æ–‡æ®µï¼›å¦‚æœæ”¶åˆ°å››ä¸ªç›¸åŒçš„çš„ ACK ï¼Œåˆ™ç«‹å³é‡ä¼ ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µï¼›</li>\n</ol>\n<h3 id=\"ç¡®è®¤è§„åˆ™\"><a href=\"#ç¡®è®¤è§„åˆ™\" class=\"headerlink\" title=\"ç¡®è®¤è§„åˆ™\"></a>ç¡®è®¤è§„åˆ™</h3><ol>\n<li>å½“æ¥å—æ–¹å‘å‘é€æ–¹å‘é€æ•°æ®æŠ¥æ–‡æ®µæ—¶ï¼Œå¿…é¡»<strong>æå¸¦</strong> ACKï¼›</li>\n<li>å½“æ¥å—æ–¹æ²¡æœ‰æ•°æ®è¦å‘é€æ—¶ï¼Œä½†æ˜¯æ”¶åˆ°ä¸€ä¸ª<strong>æŒ‰åºåˆ°è¾¾</strong>çš„æŠ¥æ–‡ï¼ŒåŒæ—¶å‰ä¸€ä¸ªæŠ¥æ–‡æ®µä¹Ÿå·²ç»ç¡®è®¤è¿‡äº†ï¼Œé‚£ä¹ˆæ¥æ”¶æ–¹å°±æ¨è¿Ÿå‘é€ç¡®è®¤æŠ¥æ–‡æ®µï¼Œç›´åˆ°å¦ä¸€ä¸ªæŠ¥æ–‡æ®µåˆ°è¾¾æˆ–è€…å»¶è¿Ÿä¸€æ®µæ—¶é—´ä»¥å‡å°‘ ACK æŠ¥æ–‡é‡ï¼›</li>\n<li>å½“æ‰€æœŸæœ›çš„æŠ¥æ–‡æ®µåˆ°è¾¾ï¼Œä¸”å‰ä¸€ä¸ª<strong>æŒ‰åºåˆ°è¾¾</strong>çš„æŠ¥æ–‡è¿˜æœªè¢«ç¡®è®¤ï¼Œåˆ™ç«‹å³ ACKï¼ˆACK çš„åºå·ä»ç„¶æ˜¯ä¸‹ä¸€ä¸ªæ­£å¸¸æœŸæœ›çš„åºå·ï¼Œä¸‹åŒï¼‰ï¼›</li>\n<li>å½“åºå·æ¯”æœŸæœ›çš„å¤§çš„æŠ¥æ–‡æ®µï¼ˆ<strong>å¤±åº</strong>æŠ¥æ–‡æ®µï¼‰åˆ°è¾¾ï¼Œåˆ™ç«‹å³ ACKï¼Œä¸”å­˜å‚¨è¯¥æŠ¥æ–‡æ®µï¼›</li>\n<li>å½“<strong>ä¸¢å¤±</strong>çš„æŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œåˆ™ç«‹å³ ACKï¼›</li>\n<li>å½“<strong>é‡å¤</strong>çš„æŠ¥æ–‡æ®µåˆ°è¾¾æ—¶ï¼Œåˆ™ä¸¢å¼ƒï¼Œä¸”ç«‹å³ ACKï¼›</li>\n</ol>\n<h2 id=\"æ‹¥å¡æ§åˆ¶\"><a href=\"#æ‹¥å¡æ§åˆ¶\" class=\"headerlink\" title=\"æ‹¥å¡æ§åˆ¶\"></a>æ‹¥å¡æ§åˆ¶</h2><p>æ‹¥å¡æ§åˆ¶æ˜¯ä¸ºäº†é¿å…å› ä¸ºç½‘ç»œå—é™å¯¼è‡´ç½‘ç»œä¸èƒ½æŒ‰ç…§å‘é€æ–¹äº§ç”Ÿçš„æ•°æ®çš„é€Ÿåº¦å°†æŠ¥æ–‡æ®µäº¤ä»˜ç»™æ¥å—æ–¹ã€‚ä¸æµé‡æ§åˆ¶è€ƒå¯Ÿçš„å¯¹è±¡æ˜¯é€šä¿¡åŒæ–¹ä¸åŒï¼Œæ‹¥å¡æ§åˆ¶çš„è€ƒå¯Ÿå¯¹è±¡æ˜¯é€šä¿¡åŒæ–¹é—´çš„ç½‘ç»œã€‚æ‹¥å¡æ§åˆ¶çš„æ–¹å¼è¡¨ç°åœ¨å‘é€æ–¹çš„æ‹¥å¡çª—å£çš„å˜åŒ–ï¼Œä»è€Œæ§åˆ¶å‘é€æ–¹çš„æ•°æ®å‘é€å¿«æ…¢ã€‚TCP æœ€åˆä½¿ç”¨çš„æ‹¥å¡ç­–ç•¥ç§°ä¸º <strong>TCP Tahoe and Reno</strong>ã€‚</p>\n<h3 id=\"Tahoe-and-Reno\"><a href=\"#Tahoe-and-Reno\" class=\"headerlink\" title=\"Tahoe and Reno\"></a>Tahoe and Reno</h3><p>è¿™ä¸ªæ‹¥å¡ç­–ç•¥ä¸»è¦åˆ†ä¸ºæ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€æ‹¥å¡æ£€æµ‹ä¸‰ä¸ªé˜¶æ®µã€‚</p>\n<h4 id=\"æ…¢å¯åŠ¨\"><a href=\"#æ…¢å¯åŠ¨\" class=\"headerlink\" title=\"æ…¢å¯åŠ¨\"></a>æ…¢å¯åŠ¨</h4><p>å‡è®¾æ¥æ”¶çª—å£å¤§å°è¿œå¤§äºæ‹¥å¡çª—å£ï¼Œä¸”ä¸è€ƒè™‘å»¶è¿Ÿç¡®è®¤ã€‚æ‹¥å¡çª—å£å¤§å°ä»ä¸€ä¸ªæœ€å¤§æŠ¥æ–‡é•¿åº¦ MSS ï¼ˆè¿æ¥å»ºç«‹æ—¶é€šè¿‡ TCP é€‰é¡¹å‘ŠçŸ¥ï¼‰å¼€å§‹ï¼Œä¹‹åæ¯å½“æœ‰ä¸€ä¸ªæŠ¥æ–‡æ®µè¢«ç¡®è®¤ï¼Œæ‹¥å¡çª—å£å°±å¢å¤§ä¸€ä¸ª MSSã€‚åœ¨è¿™æ ·çš„ç­–ç•¥ä¸‹ï¼Œæ…¢å¯åŠ¨é˜¶æ®µçš„æ‹¥å¡çª—å£å¤§å°å‘ˆæŒ‡æ•°å¢é•¿ã€‚å³ä» <code>1 -&gt; 2 -&gt; 4 -&gt; 8</code>ã€‚å½“åˆ°è¾¾æ…¢å¯åŠ¨é—¨é™æ—¶ï¼Œå°±è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚</p>\n<h4 id=\"æ‹¥å¡é¿å…\"><a href=\"#æ‹¥å¡é¿å…\" class=\"headerlink\" title=\"æ‹¥å¡é¿å…\"></a>æ‹¥å¡é¿å…</h4><p>æ‹¥å¡é¿å…é˜¶æ®µæ‹¥å¡çª—å£å¤§å°ç»§ç»­å¢åŠ ï¼Œä½†æ˜¯é€Ÿåº¦æ”¾æ…¢ï¼Œæ”¹æˆå½“æ•´ä¸ªçª—å£å¤§å°çš„æŠ¥æ–‡æ®µéƒ½è¢«ç¡®è®¤åï¼Œçª—å£å¤§å°æ‰å¢åŠ ä¸€ä¸ª MSSã€‚è¡¨ç°ä¸º <code>8 -&gt; 9 -&gt; 10 -&gt; 11</code>ï¼Œå‘ˆç°çº¿æ€§å¢é•¿ã€‚</p>\n<h4 id=\"æ‹¥å¡æ£€æµ‹\"><a href=\"#æ‹¥å¡æ£€æµ‹\" class=\"headerlink\" title=\"æ‹¥å¡æ£€æµ‹\"></a>æ‹¥å¡æ£€æµ‹</h4><p>å¦‚æœæ‹¥å¡å‘ç”Ÿäº†ï¼Œå› ä¸ºå‘ç”Ÿåœ¨ç½‘ç»œä¸­è·¯ç”±å™¨å‡ºç°ä¸¢åŒ…ç°è±¡ï¼Œåœ¨æ¥å—æ–¹å¤„çš„è¡¨ç°ä¸ºå‡ºç°ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼Œå¹¶åšå‡ºå¯¹åº”çš„ååº”ï¼š</p>\n<ol>\n<li><p>RTO è®¡æ—¶å™¨è¶…æ—¶ã€‚è¿™è¯´æ˜ç½‘ç»œæ‹¥å¡çš„å¯èƒ½æ€§è¾ƒå¤§ï¼ŒTCP åšå‡ºè¾ƒå¼ºçƒˆçš„ååº”ï¼š<br> a. æŠŠæ…¢å¯åŠ¨é—¨é™å€¼è°ƒæ•´ä¸ºå½“å‰çª—å£å¤§å°çš„ä¸€åŠï¼›<br> b. æŠŠ cwnd é‡æ–°è®¾ç½®ä¸º 1 MSSï¼›<br> c. é‡æ–°è¿›å…¥æ…¢å¯åŠ¨é˜¶æ®µï¼›</p>\n</li>\n<li><p>æ”¶åˆ°å››ä¸ªç›¸åŒçš„ ACKï¼›è¯´æ˜å‡ºç°æ‹¥å¡çš„å¯èƒ½æ€§è¾ƒå°ï¼Œä½†æ˜¯å‡ºç°äº†ä¸¢åŒ…ï¼ŒTCP åšå‡ºè¾ƒå¼±çš„ååº”ï¼ŒReno ç®—æ³•è¡¨ç°ä¸ºå¿«æ¢å¤ï¼ˆFast recoveryï¼‰ï¼š<br> a. æŠŠæ…¢å¯åŠ¨é—¨é™å€¼è°ƒæ•´ä¸ºå½“å‰çª—å£å¤§å°çš„ä¸€åŠï¼›<br> b. æŠŠ cwnd é‡æ–°è®¾ç½®ä¸ºæ…¢å¯åŠ¨é—¨é™å€¼ï¼›<br> c. é‡æ–°è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µï¼›</p>\n</li>\n</ol>\n<p>å›¾ç¤ºå¦‚ä¸‹ï¼š<br><img src=\"congestion_control_example.png\" alt=\"æ‹¥å¡æ§åˆ¶ç¤ºä¾‹\"><br>Tahoe ç®—æ³•ä¸ Reno ï¼ˆTahoe çš„æ”¹è¿›ç‰ˆæœ¬ï¼‰çš„åŒºåˆ«åœ¨äºæ”¶åˆ°å››ä¸ªç›¸åŒ ACK æ—¶ï¼ŒTahoe ç®—æ³•çš„ç­–ç•¥å’Œ RTO è®¡æ—¶å™¨è¶…æ—¶æ—¶ä¸€è‡´ã€‚</p>\n<h3 id=\"å…¶ä»–æ‹¥å¡ç­–ç•¥\"><a href=\"#å…¶ä»–æ‹¥å¡ç­–ç•¥\" class=\"headerlink\" title=\"å…¶ä»–æ‹¥å¡ç­–ç•¥\"></a>å…¶ä»–æ‹¥å¡ç­–ç•¥</h3><p>æ‹¥å¡æ§åˆ¶ç­–ç•¥åªéœ€è¦åœ¨å‘é€æ–¹å®ç°å³å¯ï¼Œä¸éœ€è¦æ¥å—æ–¹çš„å‚ä¸ï¼Œå› æ­¤å¯ä»¥ä»…åœ¨å‘é€æ–¹éƒ¨ç½²ä¸€å¥—ç®—æ³•ã€‚ç°åœ¨ TCP ç½‘ç»œä¸Šçš„ç®—æ³•ä¹Ÿåœ¨ä¸æ–­<a href=\"https://en.wikipedia.org/wiki/TCP_congestion_control\" target=\"_blank\" rel=\"noopener\">æ”¹è¿›</a>ï¼Œæ¶Œç°å‡ºè¯¸å¦‚ <a href=\"http://www4.ncsu.edu/~rhee/export/bitcp/cubic-paper.pdf\" target=\"_blank\" rel=\"noopener\"><strong>TCP CUBIC</strong></a>ã€<a href=\"https://ai.google/research/pubs/pub45646\" target=\"_blank\" rel=\"noopener\"><strong>TCP BBR</strong></a> è¿™æ ·çš„ç®—æ³•ã€‚</p>\n<h2 id=\"TCP-ä¸­çš„è®¡æ—¶å™¨\"><a href=\"#TCP-ä¸­çš„è®¡æ—¶å™¨\" class=\"headerlink\" title=\"TCP ä¸­çš„è®¡æ—¶å™¨\"></a>TCP ä¸­çš„è®¡æ—¶å™¨</h2><h3 id=\"é‡ä¼ è®¡æ—¶å™¨\"><a href=\"#é‡ä¼ è®¡æ—¶å™¨\" class=\"headerlink\" title=\"é‡ä¼ è®¡æ—¶å™¨\"></a>é‡ä¼ è®¡æ—¶å™¨</h3><p>é‡ä¼ è®¡æ—¶å™¨çš„è¶…æ—¶æ—¶é—´ä¸º RTOï¼ŒRTO ä¸»è¦æ ¹æ®æµ‹é‡æ‰€å¾—çš„æŠ¥æ–‡æ®µå¾€è¿”æ—¶é—´ RTTmè®¡ç®—è€Œæ¥ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>\n<p>é¦–å…ˆè®¡ç®—å¹³æ»‘ RTTï¼Œå³RTTsï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTTs = RTTm // ç¬¬ä¸€æ¬¡æµ‹é‡</span><br><span class=\"line\">RTTs = (1 - Î±)RTTs + Î±RTTm // éšåçš„æµ‹é‡</span><br></pre></td></tr></table></figure>\n\n<p>ç„¶åè®¡ç®— RTT çš„åå·® RTTdï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTTd = RTTm / 2 // ç¬¬ä¸€æ¬¡æµ‹é‡</span><br><span class=\"line\">RTTd = (1 - Î²)RTTd + Î²|RTTs - RTTm| // éšåçš„æµ‹é‡</span><br></pre></td></tr></table></figure>\n\n<p>é‡ä¼ è¶…æ—¶ RTO çš„è®¡ç®—å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">RTO = 6s // åŸå§‹å€¼</span><br><span class=\"line\">RTO = RTTs + 4RTTd // ç¬¬ä¸€æ¬¡æµ‹é‡å</span><br></pre></td></tr></table></figure>\n\n<p>ä»»æ„æ—¶åˆ»åªæœ‰ä¸€ä¸ª RTT åœ¨è¿›è¡Œæµ‹é‡ï¼Œå½“é‡ä¼ å‘ç”Ÿæ—¶ä¼šå½±å“ RTT çš„æµ‹é‡ï¼Œæ ¹æ® <strong>Karn ç®—æ³•</strong>ï¼ŒTCP å¿½ç•¥é‡ä¼ æŠ¥æ–‡çš„ RTTï¼Œè€Œå¯¹äºé‡ä¼ çš„æŠ¥æ–‡ï¼ŒRTO å€¼ä¸ºåŸæŠ¥æ–‡çš„ä¸¤å€ï¼Œå¦‚æœå‘ç”Ÿç¬¬äºŒæ¬¡é‡ä¼ ï¼Œåˆ™ä¸ºå››å€ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>\n<h3 id=\"æŒç»­è®¡æ—¶å™¨\"><a href=\"#æŒç»­è®¡æ—¶å™¨\" class=\"headerlink\" title=\"æŒç»­è®¡æ—¶å™¨\"></a>æŒç»­è®¡æ—¶å™¨</h3><p>å½“æ¥å—æ–¹å‘é€çª—å£å€¼ä¸º 0 çš„æŠ¥æ–‡æ®µä¹‹åï¼Œåæ¥å› ä¸ºæ¥æ”¶çª—å£å¢åŠ éœ€è¦é€šå‘Šæ¥çª—å£ä¸ºé 0ï¼Œä½†æ˜¯é€šå‘Šçš„ ACK ä¸¢å¤±ï¼Œè¿™ä¼šå¯¼è‡´å‘é€æ–¹ä¸€ç›´ç­‰å¾…é 0 çª—å£é€šå‘Šï¼Œå¯¼è‡´æ­»é”ã€‚æŒç»­è®¡æ—¶å™¨å°±æ˜¯æ¥å—æ–¹åœ¨æ”¶åˆ° 0 çª—å£é€šå‘Šåå¯ç”¨ï¼Œå¦‚æœè¶…æ—¶åˆ™å‘é€æ¢æµ‹æŠ¥æ–‡ï¼Œä¿ƒä½¿æ¥å—æ–¹é‡ä¼  ACKã€‚</p>\n<h3 id=\"Keep-Alive-è®¡æ—¶å™¨\"><a href=\"#Keep-Alive-è®¡æ—¶å™¨\" class=\"headerlink\" title=\"Keep-Alive è®¡æ—¶å™¨\"></a>Keep-Alive è®¡æ—¶å™¨</h3><p>Keep-Alive è®¡æ—¶å™¨ç”¨äºé˜²æ­¢ TCP è¿æ¥é•¿æ—¶é—´ç©ºé—²ï¼Œæ¯å½“æ”¶åˆ°å¯¹æ–¹çš„æŠ¥æ–‡æ®µï¼Œè¿™ä¸ªè®¡æ—¶å™¨å°±å¤ä½ã€‚è¿™ä¸ªè®¡æ—¶å™¨çš„è¶…æ—¶æ—¶é—´é€šå¸¸å¯ä»¥é€šè¿‡æ¥å£è¿›è¡Œè®¾å®šã€‚</p>\n<h3 id=\"Time-Wait-è®¡æ—¶å™¨\"><a href=\"#Time-Wait-è®¡æ—¶å™¨\" class=\"headerlink\" title=\"Time-Wait è®¡æ—¶å™¨\"></a>Time-Wait è®¡æ—¶å™¨</h3><p>Time-Wait è®¡æ—¶å™¨å¯¹æœ€åçš„ FIN è¿›è¡Œç¡®è®¤æ—¶å¯åŠ¨çš„è¶…æ—¶è®¡æ—¶å™¨ã€‚å¦‚æœåœ¨æ—¶å¸¸ä¸º 2MSL çš„è®¡æ—¶å™¨è¶…æ—¶å‰å†æ¬¡æ”¶åˆ° FINï¼Œåˆ™é‡ä¼  ACKï¼Œå¦åˆ™è¿æ¥å½»åº•å…³é—­ã€‚</p>\n<h2 id=\"ä¼ è¾“å±‚çš„æœªæ¥\"><a href=\"#ä¼ è¾“å±‚çš„æœªæ¥\" class=\"headerlink\" title=\"ä¼ è¾“å±‚çš„æœªæ¥\"></a>ä¼ è¾“å±‚çš„<a href=\"https://blog.apnic.net/2017/12/12/internet-protocols-changing/\" target=\"_blank\" rel=\"noopener\">æœªæ¥</a></h2><p><a href=\"https://www.chromium.org/quic\" target=\"_blank\" rel=\"noopener\">QIUC</a> äº†è§£ä¸€ä¸‹ä¸‹ï¼Ÿ</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"https://book.douban.com/subject/5386194/\" target=\"_blank\" rel=\"noopener\">TCP/IP åè®®æ— ç¬¬å››ç‰ˆ</a></li>\n<li><a href=\"https://book.douban.com/subject/5344443/\" target=\"_blank\" rel=\"noopener\">Andrew S.Tanenbaum - Computer Networks 5th</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/Transmission_Control_Protocol\" target=\"_blank\" rel=\"noopener\">WikiPedia - Transmission Control Protocol</a></li>\n<li><a href=\"https://en.wikipedia.org/wiki/TCP_congestion_contro\" target=\"_blank\" rel=\"noopener\">WikiPedia - TCP congestion control</a></li>\n<li><a href=\"http://packetlife.net/blog/2011/mar/2/tcp-flags-psh-and-urg/\" target=\"_blank\" rel=\"noopener\">TCP Flags: PSH and URG</a></li>\n<li><a href=\"https://www.nada.kth.se/kurser/kth/2D1392/05/lectures/lecture_4.pdf\" target=\"_blank\" rel=\"noopener\">KTH - Internetworking Lecture 4</a></li>\n<li><a href=\"https://blog.csdn.net/dog250/article/details/81256550\" target=\"_blank\" rel=\"noopener\">ä¸€ä¸ª TCP FIN_WAIT2 çŠ¶æ€ç»†èŠ‚å¼•å‘çš„æ„Ÿæ…¨</a></li>\n</ol>"},{"title":"ÂµTP åè®® â€”â€” å¯¹ BEP29 çš„ç®€è¦ç†è§£","keywords":[],"date":"2018-08-04T09:05:00.000Z","_content":"åœ¨ {% post_link tcp %}ä¸­å›é¡¾äº† TCPï¼Œè€Œè¿™ç¯‡æ–‡ç« ä¸»è¦è®²ç”¨äº BT ç½‘ç»œçš„åŸºäº UDP çš„è¿è¾“å±‚åè®® ÂµTPï¼ŒåŒæ—¶é¡ºä¾¿å›é¡¾ UDPã€‚ä¸‹é¢çš„å†…å®¹æ›´å¤šæ˜¯åŸºäºå¯¹ [BEP29](http://www.bittorrent.org/beps/bep_0029.html) çš„ç†è§£ã€‚\n## åå­—æ¢ç©¶\nâ€ƒâ€ƒÂµTP çš„ä¸»è¦æ–‡æ¡£ BEP29 çš„åˆ›å»ºäº 2009 å¹´ï¼Œå§‘ä¸”è®¤ä¸ºè¿™ä¹Ÿæ˜¯è®¾è®¡å®Œæˆçš„å¤§è‡´æ—¶é—´ï¼ŒÂµTP åœ¨ uTorrent çš„ 1.8 ä¸­é¦–æ¬¡åŠ å…¥ï¼ˆ2009 å¹´ï¼‰è¿™ä¸ªäº‹å®ä¹Ÿä½è¯äº†è¿™ç‚¹ã€‚å®ƒçš„è®¾è®¡è€…åŒ…æ‹¬ï¼š\n - [Ludvig Strigeus](https://en.wikipedia.org/wiki/Ludvig_Strigeus)ï¼ˆÎ¼Torrent ä½œè€…ï¼ŒBitTorrent å…¬å¸ 2006 å¹´æ”¶è´­ Î¼Torrentï¼Œç›®å‰åœ¨ Spotify å·¥ä½œï¼‰\n - Greg Hazel\n - [Stanislav Shalunov](https://www.linkedin.com/in/shalunov)ï¼ˆÂµTP ä¸­çš„æ‹¥å¡ç®—æ³• [LEDBAT](https://tools.ietf.org/html/rfc6817) ä¸»è¦ä½œè€…ï¼Œåæ¥è¿˜åˆ›é€ äº†å¯ä»¥è„±ç¦»ç°æœ‰èœ‚çªç½‘ç»œä½¿ç”¨çš„ IM åº”ç”¨ [FireChat](https://www.opengarden.com/firechat.html) â€”â€” å®ƒè¢«å¤šæ¬¡ç”¨åˆ°â€å ä¸­â€è¿™æ ·çš„å…¬æ°‘è¿åŠ¨ä¸­ï¼‰\n - Arvid Norbergï¼ˆlibtorrent å¼€å‘è€…ï¼Œç›®å‰åœ¨ [Blockstream](https://blockstream.com/) å·¥ä½œï¼‰\n - Bram Cohenï¼ˆBitTorrent ä½œè€…ï¼‰\n\n## è®¾è®¡åŸå› \nâ€ƒâ€ƒåœ¨è¿‡å»å¤šå¹´å‰ï¼Œå¦‚æœä½¿ç”¨ BT è¿›è¡Œä¸‹è½½çƒ­é—¨èµ„æºçš„è¯å¯ä»¥æ„Ÿå—åˆ°åˆ°é€Ÿåº¦é£å¿«ï¼Œä½†æ˜¯åŒæ—¶å¸¦æ¥çš„é—®é¢˜å°±æ˜¯å¦‚æœæƒ³è¦åŒæ—¶çœ‹åœ¨çº¿è§†é¢‘å°±ä¼šå¸¦æ¥å¡é¡¿ã€‚é—®é¢˜åœ¨äº DSL å’Œ modem çš„å¾€å¾€æœ‰ä¸€ä¸ªå’Œå®ƒä»¬çš„å‘é€é€Ÿç‡ä¸æˆæ¯”ä¾‹çš„å‘é€ç¼“å†²åŒºï¼Œä¸æˆæ¯”ä¾‹åˆ°å¯ä»¥å®¹çº³å‡ ç§’é’Ÿçš„æ•°æ®é‡ã€‚è€Œ BT å¾€å¾€ä¼šä¸è®¸å¤š peer å»ºç«‹ TCP è¿æ¥ï¼Œåœ¨ TCP å°†å¸¦å®½å‡åŒ€åœ°åˆ†é…åˆ°æ¯ä¸ªè¿æ¥çš„å‰æä¸‹ï¼ŒBT å°±å ç”¨äº†è¾ƒå¤šçš„å¸¦å®½ï¼Œä½†æ˜¯å…¶ä»–è¯¸å¦‚æµè§ˆç½‘é¡µã€å³æ—¶é€šè®¯è¿™äº›åœºæ™¯çš„ä¼˜å…ˆçº§å®é™…ä¸Šåº”è¯¥è¦æ¯” BT ä¼ è¾“æ›´é«˜äº›ï¼Œä½†æ˜¯å› ä¸º BT å’Œ ç‰©ç†å±‚çš„è¿™ç§ç‰¹æ€§å¯¼è‡´äº†å…¶ä»–æœåŠ¡æœ‰å»¶è¿Ÿï¼Œå½±å“äº†ä½¿ç”¨ BT æ—¶å…¶ä»–æœåŠ¡çš„ä½“éªŒã€‚\nâ€ƒâ€ƒÂµTP é€šè¿‡å°† modem çš„ç¼“å†²é˜Ÿåˆ—çš„å¤§å°ä½œä¸ºä¸€ä¸ªæ§åˆ¶å› å­æ¥è°ƒæ•´å‘é€é€Ÿç‡ï¼Œå½“é˜Ÿåˆ—è¿‡å¤§æ—¶ï¼Œå°†ä¼šæ”¾æ…¢å‘é€é€Ÿåº¦ã€‚è¿™ç§ç­–ç•¥ä½¿å¾— BT åœ¨æ²¡æœ‰ç«äº‰çš„æƒ…å†µä¸‹å¯ä»¥å……åˆ†åˆ©ç”¨ä¸Šä¼ å¸¦å®½ï¼Œåœ¨æœ‰å¤§é‡å…¶ä»–æµé‡çš„æƒ…å†µä¸‹åˆ™æ”¾æ…¢å‘é€é€Ÿç‡ã€‚\nâ€ƒâ€ƒä¸Šè¿°æ—¶ Bittorrent æ–‡æ¡£ä¸­çš„è¯´æ³•ï¼Œä½†æ˜¯å®é™…ä¸Š ÂµTP æ˜¯åŸºäºåŒ…çš„å»¶æ—¶çš„ï¼Œè€Œä¸æ˜¯åŸºäºé˜Ÿåˆ—å¤§å°çš„ã€‚è€Œä¸” ÂµTP å…·ä½“å¯¹æ‹¥å¡ç®—æ³• LEDBAT çš„å®ç°æœ‰ä¸åœ¨ IETF äº’è”ç½‘è‰æ¡ˆ [RFC 6817](https://tools.ietf.org/html/rfc6817) ä¸­çš„æè¿°æœ‰æ‰€åŒºåˆ«ï¼ˆè¿™é‡Œçš„å®ç°æŒ‡ C++ ç‰ˆæœ¬çš„ [libutp](https://github.com/bittorrent/libutp)ï¼Œå„ä¸ªç‰ˆæœ¬çš„å®ç°ä¸å®Œå…¨ä¸€è‡´ï¼‰ã€‚\n\n## UDP å’Œ ÂµTP é¦–éƒ¨\nâ€ƒâ€ƒä¸ºäº†æ–¹ä¾¿ä¸ TCP åšç®€å•çš„å¯¹æ¯”ï¼ŒæŠŠ UDP çš„é¦–éƒ¨ï¼ˆå‰å››ä¸ªå­—èŠ‚ï¼‰ä¸ ÂµTP çš„é¦–éƒ¨ï¼ˆå‰©ä½™éƒ¨åˆ†ï¼‰æ”¾åœ¨äº†ä¸€ä¸ªå›¾ä¸­ç¤ºæ„ã€‚ä» UDP é¦–éƒ¨å­—æ®µæ•°é‡çš†å¯ä»¥å‘ç° UDP åè®®ç›¸å¯¹ TCP åè®®æ˜¯å¦‚æ­¤ç®€å•ï¼Œä»¥è‡³äºæˆ‘ä»¬wå¯ä»¥å°† TCP åè®®çœ‹æˆæ˜¯ç±»ä¼¼ ÂµTP åè®®ä¸€æ ·çš„åŸºäº UDP åè®®çš„è¿è¾“å±‚åè®®ã€‚\n![UDP Header And ÂµTP Header](udp_utp_header.png)\n\n### UDP é¦–éƒ¨\n - **æº / ç›®ç«¯å£ï¼ˆSource / Destination portï¼‰**ï¼šç”¨äºç¡®è®¤é€šä¿¡è¿›ç¨‹åŒæ–¹ã€‚æºç«¯å£æ˜¯å¯é€‰çš„ï¼Œå¦‚æœè®¾ç½®äº†æºç«¯å£ï¼Œåˆ™æ¥æ”¶æ–¹å°†å…¶è§†ä¸ºå›å¤ç«¯å£ã€‚å¦‚æœä¸éœ€è¦å›å¤å°±ä¸éœ€è¦è®¾ç½®ï¼›\n - **æ€»é•¿åº¦ï¼ˆLengthï¼‰**ï¼šå®šä¹‰äº† UDP ç”¨æˆ·æ•°æ®æŠ¥çš„æ€»é•¿åº¦ï¼ŒåŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ã€‚TCP é¦–éƒ¨ä¸­æ˜¯æ²¡æœ‰æ‰€è°“â€œæŠ¥æ–‡æ®µæ€»é•¿åº¦â€çš„å­—æ®µçš„ï¼Œé•¿åº¦å¯ä»¥é€šè¿‡ IP å±‚çš„é•¿åº¦å‡å» IP é¦–éƒ¨é•¿åº¦è®¡ç®—æ‰€å¾—ï¼Œæ‰€ä»¥ä¸€å®šç¨‹åº¦ä¸Šæ—¶å†—ä½™çš„ï¼Œå¯ä»¥å‚è€ƒ Stack OverFlow ä¸Šçš„[ç›¸å…³è®¨è®º](https://stackoverflow.com/a/16748680/5091903)ï¼›\n - **æ ¡éªŒå’Œï¼ˆChecksumï¼‰**ï¼šç”¨äºå¯¹æ•´ä¸ªç”¨æˆ·æ•°æ®æŠ¥çš„æ ¡éªŒï¼Œé€šè¿‡ IP ä½é¦–éƒ¨ä¸å’Œç”¨æˆ·æ•°æ®æŠ¥è®¡ç®—å¾—åˆ°ï¼›\n\nå¯è§ UDP é¦–éƒ¨çš„è¿™äº›å­—æ®µåœ¨ç†è®ºä¸Šå¯ä»¥æ˜¯ TCP é¦–éƒ¨å­—æ®µçš„å­é›†ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç²—ç•¥åœ°è®² **TCP æ˜¯åŸºäº UDP çš„ä¼ è¾“å±‚åè®®ã€‚**\nUDP æœåŠ¡æ˜¯ä¸€ä¸ªâ€œå°½åŠ›è€Œä¸ºâ€çš„æœåŠ¡ï¼Œå®ƒ**æ²¡æœ‰æµé‡æ§åˆ¶**ï¼Œ**åªèƒ½é€šè¿‡æ ¡éªŒå’Œè¿›è¡Œå·®é”™æ§åˆ¶ï¼Œä¸¢åŒ…ä¸ä¼šçŸ¥æ™“ï¼Œä¹Ÿä¸ä¼šé‡ä¼ **ï¼Œä¹Ÿ**æ²¡æœ‰æ‹¥å¡æ§åˆ¶**ã€‚\n### ÂµTP é¦–éƒ¨\n - **version**ï¼šç‰ˆæœ¬å·ï¼Œç°åœ¨ä¸º 1ï¼Œ[è¿˜æœ‰ä¸€ä¸ªåŸå§‹ç‰ˆæœ¬å· 0 å­˜åœ¨](https://github.com/boundary/wireshark/blob/master/epan/dissectors/packet-bt-utp.c)\n - **connection_id**ï¼šç”¨äºæ ‡è®°è¿æ¥ã€‚[è¿™ä¸ªå­—æ®µæ˜¯å¿…é¡»çš„ä¹ˆ?](http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/#utp-context%E7%9A%84%E6%88%90%E5%91%98)ï¼›\n - **timestamp_microseconds**ï¼šå‘é€æ•°æ®åŒ…çš„æ—¶é—´ï¼Œå’Œè®¡ç®—å»¶è¿Ÿæ—¶é—´ï¼Œrtt ç›¸å…³ï¼›\n - **timestamp_difference_microseconds**ï¼šå½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡æ”¶åˆ°çš„åŒ…ä¸­çš„ timestamp_microseconds ä¹‹å·®ï¼›\n - **wnd_size**ï¼šè¡¨ç¤ºå¦ä¸€ç«¯å»ºè®®çš„çª—å£å¤§å°ï¼Œç›¸å½“äº TCP ä¸­çš„æ¥æ”¶çª—å£ï¼›\n - **extension**ï¼šä»£è¡¨ç¬¬ä¸€ä¸ªæ‰©å±•çš„ç±»å‹ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰æ‰©å±•ï¼Œ1 è¡¨ç¤º Selective ACKsï¼ˆé€‰æ‹©ç¡®è®¤æ‰©å±•ï¼‰ã€‚\n - **type**ï¼šæ•°æ®åŒ…çš„ç±»å‹ã€‚å¯ä»¥æœ‰ï¼š\n     - ST_DATA  = 0ï¼šæ‰¿è½½æœ‰æ•ˆæ•°æ®çš„æ•°æ®åŒ…ï¼›\n     - ST_FIN   = 1ï¼šç»ˆæ­¢è¿æ¥ã€‚æ˜¯é€šä¿¡å•æ–¹å‘é€çš„æœ€åä¸€ä¸ªåŒ…ï¼Œç±»ä¼¼äº TCP çš„ FIN æ ‡è®°ã€‚ä½†æ˜¯å‘é€ ST_FIN çš„ä¸€æ–¹è¿˜æ˜¯ä¼šç­‰å¾…å¯èƒ½ä¸¢å¤±æˆ–è€…å¤±åºåˆ°è¾¾çš„åŒ…ï¼Œå³ä½¿æ”¶åˆ°äº†å¯¹æ–¹çš„ ST_FIN åŒ…ï¼›\n     - ST_STATE = 2ï¼šç”¨äºæŠ¥å‘ŠçŠ¶æ€ï¼Œä¼ è¾“ä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„ ACKã€‚å’Œ TCP ä¸­æœªæºå¸¦æ•°æ®çš„ ACK åŒ…ä¸€æ ·ï¼Œå®ƒä¸æ¶ˆè€—åºå·ï¼›\n     - ST_RESET = 3ï¼šå¼ºåˆ¶é‡ç½®è¿æ¥ã€‚ç±»ä¼¼ TCP çš„ RST æ ‡è®°ã€‚\n     - ST_SYN   = 4ï¼šå‘èµ·è¿æ¥ã€‚ç±»ä¼¼ TCP çš„ SYN æ ‡è®°ã€‚å‘èµ·æ–¹ä¼šéšæœºä¸€ä¸ª connection_id ID ç”¨äºç»™æ¥æ”¶æ–¹åç»­çš„å›å¤ä½¿ç”¨ã€‚ç„¶åå‘èµ·æ–¹ä¹‹åçš„åŒ…ä¸­ä¼ è¾“çš„ connection_id ä¸º ID + 1ï¼›\n - **seq_nr**ï¼šè¡¨ç¤ºè¿™ä¸ªæ•°æ®åŒ…çš„åºå·ã€‚æ³¨æ„å’Œ TCP ä¸­ä»£è¡¨å­—å·å·çš„åºå·æœ‰æ‰€ä¸åŒã€‚åˆå§‹åºå·åŒæ ·ä¹Ÿæ˜¯éšæœºç”Ÿæˆã€‚\n - **ack_nr**ï¼šè¡¨ç¤ºæœ€åæ”¶åˆ°çš„æ•°æ®åŒ…çš„seq_nrï¼›\n\n## è¿æ¥è¿‡ç¨‹\nâ€ƒâ€ƒå›¾ç¤ºä¸ºä¸€æ¬¡åœ¨ qBittorrent ä¸­å¯¹ä¸€ä¸ªç§å­å¼€å§‹ BT ä¸‹è½½äºŒåç§’å·¦å³ååœæ­¢ä¸‹è½½æ—¶ï¼Œä¸å…¶ä¸­ä¸€ä¸ª peer çš„äº¤äº’è¿‡ç¨‹ã€‚\n![è¿æ¥è¿‡ç¨‹ï¼ˆä»¥ connection_id ä¸º 8671 å’Œ 8672 çš„è¿™ä¸€ä¸ªè¿‡ç¨‹ä¸ºä¾‹ï¼‰](wireshark.png)\n\n## ä¸¢åŒ…\nå’Œä¸¢åŒ…å¤„ç†æœ‰ä¸€ä¸ªå’Œçª—å£ç›¸å…³çš„å˜é‡éœ€è¦å…ˆè¿›è¡Œè¯´æ˜ï¼š\n - ***max_window***ï¼šå®šä¹‰äº†æœªè¢«ç¡®è®¤çš„å­—èŠ‚çš„ä¸Šé™ï¼Œç›¸å½“ä¸ TCP ä¸­çš„æ‹¥å¡çª—å£ï¼›\n - ***wnd_size***ï¼šåŒé¦–éƒ¨ä¸­çš„ wnd_sizeï¼Œå’Œ TCP ä¸­ç›¸åŒï¼Œå®é™…çš„å‘é€çª—å£å¤§å°ä¸º `min(max_windows, wnd_size)`ï¼›\n - ***cur_window***ï¼šè¡¨ç¤ºå½“å‰æœªè¢«ç¡®è®¤çš„å­—èŠ‚çš„æ•°é‡ï¼›\n\nå½“éœ€è¦å‘é€æ•°æ®åŒ…æ—¶ï¼Œä»…å½“ `cur_window + packet_size <= min(max_windows, wnd_size)` æˆç«‹ï¼Œè¿™ä¸ªæ•°æ®åŒ…æ‰èƒ½è¢«å‘é€ã€‚\n\n - å½“åºå·ä¸º `seq_nr - cur_window` çš„æ•°æ®åŒ…ï¼ˆå‘é€é˜Ÿåˆ—ä¸­å¹´é¾„æœ€å¤§çš„æœªè¢«ç¡®è®¤çš„æ•°æ®åŒ…ï¼Œä¸‹ä¸€ä¸ªç†è®ºä¸Šéœ€è¦è¢«ç¡®è®¤çš„å°±æ˜¯å®ƒï¼‰æ²¡æœ‰è¢«ç¡®è®¤ï¼Œä½†æ˜¯å·²ç»æœ‰è‡³å°‘ä¸‰ä¸ªåºå·å¤§äºå®ƒçš„æ•°æ®åŒ…é€šè¿‡ Selective ACK è¢«ç¡®è®¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®åŒ…è¢«è®¤ä¸ºæ˜¯ä¸¢å¤±äº†ã€‚\n - å¦‚æœ `ack_nr + 1` è¿™ä¸ªåŒ…å·²ç»å‘é€äº†ï¼Œè€Œæ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ `ack_nr` çš„ ACKï¼Œé‚£ä¹ˆ `ack_nr + 1`è¿™ä¸ªåŒ…è¢«è®¤ä¸ºæ˜¯ä¸¢å¤±äº†ã€‚\n\nå¦‚æœæ£€æµ‹åˆ°ä¸¢åŒ…ï¼Œé‚£ä¹ˆæ‹¥å¡çª—å£ **max_window** å¤§å°å‡åŠã€‚\n## è¶…æ—¶\nÂµTP çš„è¶…æ—¶è®¡æ—¶å’Œ TCP ä¸­ RTO è®¡æ—¶å™¨ä¸å¤ªä¸€æ ·ï¼ŒRTO è®¡æ—¶å™¨ä¸»è¦ç”¨äºå¯¹ ACK çš„è®¡æ—¶ï¼Œä½†æ˜¯ã€€ÂµTP çš„è®¡æ—¶å™¨åˆ™æ˜¯æŒ‡æ¥æ”¶ä»»ä½•æ•°æ®åŒ…è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…æ—¶æ—¶é—´å†…æ²¡æœ‰ä»»ä½•æ•°æ®åŒ…åˆ°è¾¾åˆ™è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œåˆ™ **packet_size** å’Œ **max_window** å°†éƒ½ä¼šè¢«è®¾ç½®ä¸ºæœ€å°æ•°æ®åŒ…å¤§å°ï¼ˆ150 å­—èŠ‚ï¼‰ã€‚ **ï¼ˆç–‘é—®ï¼Ÿï¼špacket_size çš„è°ƒæ•´ç­–ç•¥æ˜¯ä»€ä¹ˆï¼‰**\n\n### è¶…æ—¶æ—¶é—´çš„è®¡ç®—\næ¯å½“æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„ ACKï¼Œå°±ä¼šæ›´æ–°å¾€è¿”æ—¶é—´ï¼ˆä¸è€ƒè™‘é‡ä¼ çš„åŒ…ï¼‰ï¼Œå¾€è¿”æ—¶é—´ç”¨äºè®¡ç®—è¶…æ—¶æ—¶é—´ã€‚å…ˆè¯´æ˜ä¸‹ç›¸å…³çš„å˜é‡ï¼š\n - ***rtt***ï¼šå¾€è¿”æ—¶é—´ï¼›\n - ***rtt_var***ï¼šå¾€è¿”æ—¶é—´å·®å¼‚ï¼›\n - ***packet_rtt***ï¼šå½“å‰æ”¶åˆ° ACK å¯¹åº”çš„åŒ…çš„å¾€è¿”æ—¶é—´ï¼Œå³å½“å‰æ—¶é—´å‡å»è¿™ä¸ªåŒ…å‘é€æ—¶çš„æ—¶é—´ï¼Œå³é¦–éƒ¨ä¸­çš„ timestamp å­—æ®µè®°å½•çš„å€¼ã€‚\n - ***timeout***ï¼šè¶…æ—¶æ—¶é—´ï¼›\n\né€šè¿‡ä»¥ä¸‹å…¬å¼æ›´æ–° rttï¼š\n```\ndelta = rtt - packet_rtt\nrtt_var += (abs(delta) - rtt_var) / 4;\nrtt += (packet_rtt - rtt) / 8;\n```\næ­£å¸¸æƒ…å†µä¸‹é€šè¿‡ rtt è®¡ç®—å¾—åˆ° timeoutï¼ˆç¬¬ä¸€æ¬¡ç”±äºæ²¡æœ‰ rttï¼Œtimeout ä½¿ç”¨åˆå§‹å€¼ 1000 msï¼Œï¼‰ï¼š\n```\ntimeout = max(rtt + rtt_var * 4, 500);\n```\nå¦‚æœé‡åˆ°è¶…æ—¶ï¼Œåˆ™ timeout ç¿»å€ã€‚\n\n## æ‹¥å¡æ§åˆ¶\nåœ¨**ä¸¢åŒ…**å’Œ**è¶…æ—¶**éƒ¨åˆ†å·²ç»æ¶‰åŠåˆ°æ‹¥å¡çª—å£çš„è°ƒæ•´äº†ã€‚ÂµTP çš„æ‹¥å¡æ§åˆ¶å¯ä»¥ç†è§£ä¸ºä¸€ç§åŸºäºå»¶è¿Ÿçš„è´Ÿåé¦ˆæ‹¥å¡æ§åˆ¶ï¼Œé€šè¿‡å»¶è¿Ÿçš„å˜åŒ–æ§åˆ¶çª—å£å¤§å°çš„å˜åŒ–ï¼Œè¾¾åˆ°æ‹¥å¡æ§åˆ¶ç›®çš„ã€‚è®¡ç®—çª—å£å¤§å°è¿‡ç¨‹ä¸­çš„ç›¸å…³å¸¸é‡å’Œå˜é‡çš„å®šä¹‰å¦‚ä¸‹ï¼š\n - ***CONTROL_TARGET***ï¼šÂµTP æ‰€èƒ½æ¥æ”¶çš„ä¸Šè¡Œç¼“å†²å»¶è¿Ÿï¼Œç°åœ¨æ˜¯ 100 msï¼›\n - ***base_delay***ï¼šä¸¤åˆ†é’Ÿå†…çš„æ”¶åˆ°çš„æ•°æ®åŒ…çš„æœ€ä½å»¶è¿Ÿï¼›\n - ***our_delay***ï¼šå½“å‰çš„æ•°æ®åŒ…å»¶è¿Ÿï¼›\n - ***off_target***ï¼šå®é™…å»¶è¿Ÿå’Œç›®æ ‡å»¶è¿Ÿçš„å·®è·ã€‚å³`CONTROL_TARGET - our_delay`ï¼›\n - ***outstanding_packet***ï¼šå·²ç»è¢«å‘é€ä½†æ˜¯æœªè¢«ç¡®è®¤çš„æ•°æ®åŒ…ï¼›\n\nå…·ä½“è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š\n```\ndelay_factor = off_target / CCONTROL_TARGET;\nwindow_factor = outstanding_packet / max_window;\nscaled_gain = MAX_CWND_INCREASE_PACKETS_PER_RTT * delay_factor * window_factor;\n\nmax_window += scaled_gain;\n```\nå½“ `off_target > 0` æ—¶ï¼Œå½“å‰åŒ…çš„å»¶è¿Ÿæ—¶é—´æ¯”è®¾å®šçš„è¿˜å°ä¸€äº›ï¼Œé‚£ä¹ˆçª—å£ä¼šç¼©å°ï¼Œå‘é€é€Ÿç‡å°±ä¼šæ”¾æ…¢ï¼›åä¹‹ï¼Œçª—å£å¢åŠ ï¼Œé€Ÿç‡åŠ å¿«ã€‚\n\n\n## å‚è€ƒèµ„æ–™\n1. [BitTorrent Enhancement Proposal 29 - ÂµTorrent transport protocol](http://www.bittorrent.org/beps/bep_0029.html)\n2. [RFC 6817 - Low Extra Delay Background Transport (LEDBAT)](https://tools.ietf.org/html/rfc6817)\n3. [Calvin's Marbles - libutpæºç ç®€æ](http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/)","source":"_posts/Âµtp.md","raw":"---\ntitle: ÂµTP åè®® â€”â€” å¯¹ BEP29 çš„ç®€è¦ç†è§£\nkeywords: []\ndate: 2018/08/04 17:05:00\ntags: [Network, BT]\ncategories:\n---\nåœ¨ {% post_link tcp %}ä¸­å›é¡¾äº† TCPï¼Œè€Œè¿™ç¯‡æ–‡ç« ä¸»è¦è®²ç”¨äº BT ç½‘ç»œçš„åŸºäº UDP çš„è¿è¾“å±‚åè®® ÂµTPï¼ŒåŒæ—¶é¡ºä¾¿å›é¡¾ UDPã€‚ä¸‹é¢çš„å†…å®¹æ›´å¤šæ˜¯åŸºäºå¯¹ [BEP29](http://www.bittorrent.org/beps/bep_0029.html) çš„ç†è§£ã€‚\n## åå­—æ¢ç©¶\nâ€ƒâ€ƒÂµTP çš„ä¸»è¦æ–‡æ¡£ BEP29 çš„åˆ›å»ºäº 2009 å¹´ï¼Œå§‘ä¸”è®¤ä¸ºè¿™ä¹Ÿæ˜¯è®¾è®¡å®Œæˆçš„å¤§è‡´æ—¶é—´ï¼ŒÂµTP åœ¨ uTorrent çš„ 1.8 ä¸­é¦–æ¬¡åŠ å…¥ï¼ˆ2009 å¹´ï¼‰è¿™ä¸ªäº‹å®ä¹Ÿä½è¯äº†è¿™ç‚¹ã€‚å®ƒçš„è®¾è®¡è€…åŒ…æ‹¬ï¼š\n - [Ludvig Strigeus](https://en.wikipedia.org/wiki/Ludvig_Strigeus)ï¼ˆÎ¼Torrent ä½œè€…ï¼ŒBitTorrent å…¬å¸ 2006 å¹´æ”¶è´­ Î¼Torrentï¼Œç›®å‰åœ¨ Spotify å·¥ä½œï¼‰\n - Greg Hazel\n - [Stanislav Shalunov](https://www.linkedin.com/in/shalunov)ï¼ˆÂµTP ä¸­çš„æ‹¥å¡ç®—æ³• [LEDBAT](https://tools.ietf.org/html/rfc6817) ä¸»è¦ä½œè€…ï¼Œåæ¥è¿˜åˆ›é€ äº†å¯ä»¥è„±ç¦»ç°æœ‰èœ‚çªç½‘ç»œä½¿ç”¨çš„ IM åº”ç”¨ [FireChat](https://www.opengarden.com/firechat.html) â€”â€” å®ƒè¢«å¤šæ¬¡ç”¨åˆ°â€å ä¸­â€è¿™æ ·çš„å…¬æ°‘è¿åŠ¨ä¸­ï¼‰\n - Arvid Norbergï¼ˆlibtorrent å¼€å‘è€…ï¼Œç›®å‰åœ¨ [Blockstream](https://blockstream.com/) å·¥ä½œï¼‰\n - Bram Cohenï¼ˆBitTorrent ä½œè€…ï¼‰\n\n## è®¾è®¡åŸå› \nâ€ƒâ€ƒåœ¨è¿‡å»å¤šå¹´å‰ï¼Œå¦‚æœä½¿ç”¨ BT è¿›è¡Œä¸‹è½½çƒ­é—¨èµ„æºçš„è¯å¯ä»¥æ„Ÿå—åˆ°åˆ°é€Ÿåº¦é£å¿«ï¼Œä½†æ˜¯åŒæ—¶å¸¦æ¥çš„é—®é¢˜å°±æ˜¯å¦‚æœæƒ³è¦åŒæ—¶çœ‹åœ¨çº¿è§†é¢‘å°±ä¼šå¸¦æ¥å¡é¡¿ã€‚é—®é¢˜åœ¨äº DSL å’Œ modem çš„å¾€å¾€æœ‰ä¸€ä¸ªå’Œå®ƒä»¬çš„å‘é€é€Ÿç‡ä¸æˆæ¯”ä¾‹çš„å‘é€ç¼“å†²åŒºï¼Œä¸æˆæ¯”ä¾‹åˆ°å¯ä»¥å®¹çº³å‡ ç§’é’Ÿçš„æ•°æ®é‡ã€‚è€Œ BT å¾€å¾€ä¼šä¸è®¸å¤š peer å»ºç«‹ TCP è¿æ¥ï¼Œåœ¨ TCP å°†å¸¦å®½å‡åŒ€åœ°åˆ†é…åˆ°æ¯ä¸ªè¿æ¥çš„å‰æä¸‹ï¼ŒBT å°±å ç”¨äº†è¾ƒå¤šçš„å¸¦å®½ï¼Œä½†æ˜¯å…¶ä»–è¯¸å¦‚æµè§ˆç½‘é¡µã€å³æ—¶é€šè®¯è¿™äº›åœºæ™¯çš„ä¼˜å…ˆçº§å®é™…ä¸Šåº”è¯¥è¦æ¯” BT ä¼ è¾“æ›´é«˜äº›ï¼Œä½†æ˜¯å› ä¸º BT å’Œ ç‰©ç†å±‚çš„è¿™ç§ç‰¹æ€§å¯¼è‡´äº†å…¶ä»–æœåŠ¡æœ‰å»¶è¿Ÿï¼Œå½±å“äº†ä½¿ç”¨ BT æ—¶å…¶ä»–æœåŠ¡çš„ä½“éªŒã€‚\nâ€ƒâ€ƒÂµTP é€šè¿‡å°† modem çš„ç¼“å†²é˜Ÿåˆ—çš„å¤§å°ä½œä¸ºä¸€ä¸ªæ§åˆ¶å› å­æ¥è°ƒæ•´å‘é€é€Ÿç‡ï¼Œå½“é˜Ÿåˆ—è¿‡å¤§æ—¶ï¼Œå°†ä¼šæ”¾æ…¢å‘é€é€Ÿåº¦ã€‚è¿™ç§ç­–ç•¥ä½¿å¾— BT åœ¨æ²¡æœ‰ç«äº‰çš„æƒ…å†µä¸‹å¯ä»¥å……åˆ†åˆ©ç”¨ä¸Šä¼ å¸¦å®½ï¼Œåœ¨æœ‰å¤§é‡å…¶ä»–æµé‡çš„æƒ…å†µä¸‹åˆ™æ”¾æ…¢å‘é€é€Ÿç‡ã€‚\nâ€ƒâ€ƒä¸Šè¿°æ—¶ Bittorrent æ–‡æ¡£ä¸­çš„è¯´æ³•ï¼Œä½†æ˜¯å®é™…ä¸Š ÂµTP æ˜¯åŸºäºåŒ…çš„å»¶æ—¶çš„ï¼Œè€Œä¸æ˜¯åŸºäºé˜Ÿåˆ—å¤§å°çš„ã€‚è€Œä¸” ÂµTP å…·ä½“å¯¹æ‹¥å¡ç®—æ³• LEDBAT çš„å®ç°æœ‰ä¸åœ¨ IETF äº’è”ç½‘è‰æ¡ˆ [RFC 6817](https://tools.ietf.org/html/rfc6817) ä¸­çš„æè¿°æœ‰æ‰€åŒºåˆ«ï¼ˆè¿™é‡Œçš„å®ç°æŒ‡ C++ ç‰ˆæœ¬çš„ [libutp](https://github.com/bittorrent/libutp)ï¼Œå„ä¸ªç‰ˆæœ¬çš„å®ç°ä¸å®Œå…¨ä¸€è‡´ï¼‰ã€‚\n\n## UDP å’Œ ÂµTP é¦–éƒ¨\nâ€ƒâ€ƒä¸ºäº†æ–¹ä¾¿ä¸ TCP åšç®€å•çš„å¯¹æ¯”ï¼ŒæŠŠ UDP çš„é¦–éƒ¨ï¼ˆå‰å››ä¸ªå­—èŠ‚ï¼‰ä¸ ÂµTP çš„é¦–éƒ¨ï¼ˆå‰©ä½™éƒ¨åˆ†ï¼‰æ”¾åœ¨äº†ä¸€ä¸ªå›¾ä¸­ç¤ºæ„ã€‚ä» UDP é¦–éƒ¨å­—æ®µæ•°é‡çš†å¯ä»¥å‘ç° UDP åè®®ç›¸å¯¹ TCP åè®®æ˜¯å¦‚æ­¤ç®€å•ï¼Œä»¥è‡³äºæˆ‘ä»¬wå¯ä»¥å°† TCP åè®®çœ‹æˆæ˜¯ç±»ä¼¼ ÂµTP åè®®ä¸€æ ·çš„åŸºäº UDP åè®®çš„è¿è¾“å±‚åè®®ã€‚\n![UDP Header And ÂµTP Header](udp_utp_header.png)\n\n### UDP é¦–éƒ¨\n - **æº / ç›®ç«¯å£ï¼ˆSource / Destination portï¼‰**ï¼šç”¨äºç¡®è®¤é€šä¿¡è¿›ç¨‹åŒæ–¹ã€‚æºç«¯å£æ˜¯å¯é€‰çš„ï¼Œå¦‚æœè®¾ç½®äº†æºç«¯å£ï¼Œåˆ™æ¥æ”¶æ–¹å°†å…¶è§†ä¸ºå›å¤ç«¯å£ã€‚å¦‚æœä¸éœ€è¦å›å¤å°±ä¸éœ€è¦è®¾ç½®ï¼›\n - **æ€»é•¿åº¦ï¼ˆLengthï¼‰**ï¼šå®šä¹‰äº† UDP ç”¨æˆ·æ•°æ®æŠ¥çš„æ€»é•¿åº¦ï¼ŒåŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ã€‚TCP é¦–éƒ¨ä¸­æ˜¯æ²¡æœ‰æ‰€è°“â€œæŠ¥æ–‡æ®µæ€»é•¿åº¦â€çš„å­—æ®µçš„ï¼Œé•¿åº¦å¯ä»¥é€šè¿‡ IP å±‚çš„é•¿åº¦å‡å» IP é¦–éƒ¨é•¿åº¦è®¡ç®—æ‰€å¾—ï¼Œæ‰€ä»¥ä¸€å®šç¨‹åº¦ä¸Šæ—¶å†—ä½™çš„ï¼Œå¯ä»¥å‚è€ƒ Stack OverFlow ä¸Šçš„[ç›¸å…³è®¨è®º](https://stackoverflow.com/a/16748680/5091903)ï¼›\n - **æ ¡éªŒå’Œï¼ˆChecksumï¼‰**ï¼šç”¨äºå¯¹æ•´ä¸ªç”¨æˆ·æ•°æ®æŠ¥çš„æ ¡éªŒï¼Œé€šè¿‡ IP ä½é¦–éƒ¨ä¸å’Œç”¨æˆ·æ•°æ®æŠ¥è®¡ç®—å¾—åˆ°ï¼›\n\nå¯è§ UDP é¦–éƒ¨çš„è¿™äº›å­—æ®µåœ¨ç†è®ºä¸Šå¯ä»¥æ˜¯ TCP é¦–éƒ¨å­—æ®µçš„å­é›†ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç²—ç•¥åœ°è®² **TCP æ˜¯åŸºäº UDP çš„ä¼ è¾“å±‚åè®®ã€‚**\nUDP æœåŠ¡æ˜¯ä¸€ä¸ªâ€œå°½åŠ›è€Œä¸ºâ€çš„æœåŠ¡ï¼Œå®ƒ**æ²¡æœ‰æµé‡æ§åˆ¶**ï¼Œ**åªèƒ½é€šè¿‡æ ¡éªŒå’Œè¿›è¡Œå·®é”™æ§åˆ¶ï¼Œä¸¢åŒ…ä¸ä¼šçŸ¥æ™“ï¼Œä¹Ÿä¸ä¼šé‡ä¼ **ï¼Œä¹Ÿ**æ²¡æœ‰æ‹¥å¡æ§åˆ¶**ã€‚\n### ÂµTP é¦–éƒ¨\n - **version**ï¼šç‰ˆæœ¬å·ï¼Œç°åœ¨ä¸º 1ï¼Œ[è¿˜æœ‰ä¸€ä¸ªåŸå§‹ç‰ˆæœ¬å· 0 å­˜åœ¨](https://github.com/boundary/wireshark/blob/master/epan/dissectors/packet-bt-utp.c)\n - **connection_id**ï¼šç”¨äºæ ‡è®°è¿æ¥ã€‚[è¿™ä¸ªå­—æ®µæ˜¯å¿…é¡»çš„ä¹ˆ?](http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/#utp-context%E7%9A%84%E6%88%90%E5%91%98)ï¼›\n - **timestamp_microseconds**ï¼šå‘é€æ•°æ®åŒ…çš„æ—¶é—´ï¼Œå’Œè®¡ç®—å»¶è¿Ÿæ—¶é—´ï¼Œrtt ç›¸å…³ï¼›\n - **timestamp_difference_microseconds**ï¼šå½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡æ”¶åˆ°çš„åŒ…ä¸­çš„ timestamp_microseconds ä¹‹å·®ï¼›\n - **wnd_size**ï¼šè¡¨ç¤ºå¦ä¸€ç«¯å»ºè®®çš„çª—å£å¤§å°ï¼Œç›¸å½“äº TCP ä¸­çš„æ¥æ”¶çª—å£ï¼›\n - **extension**ï¼šä»£è¡¨ç¬¬ä¸€ä¸ªæ‰©å±•çš„ç±»å‹ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰æ‰©å±•ï¼Œ1 è¡¨ç¤º Selective ACKsï¼ˆé€‰æ‹©ç¡®è®¤æ‰©å±•ï¼‰ã€‚\n - **type**ï¼šæ•°æ®åŒ…çš„ç±»å‹ã€‚å¯ä»¥æœ‰ï¼š\n     - ST_DATA  = 0ï¼šæ‰¿è½½æœ‰æ•ˆæ•°æ®çš„æ•°æ®åŒ…ï¼›\n     - ST_FIN   = 1ï¼šç»ˆæ­¢è¿æ¥ã€‚æ˜¯é€šä¿¡å•æ–¹å‘é€çš„æœ€åä¸€ä¸ªåŒ…ï¼Œç±»ä¼¼äº TCP çš„ FIN æ ‡è®°ã€‚ä½†æ˜¯å‘é€ ST_FIN çš„ä¸€æ–¹è¿˜æ˜¯ä¼šç­‰å¾…å¯èƒ½ä¸¢å¤±æˆ–è€…å¤±åºåˆ°è¾¾çš„åŒ…ï¼Œå³ä½¿æ”¶åˆ°äº†å¯¹æ–¹çš„ ST_FIN åŒ…ï¼›\n     - ST_STATE = 2ï¼šç”¨äºæŠ¥å‘ŠçŠ¶æ€ï¼Œä¼ è¾“ä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„ ACKã€‚å’Œ TCP ä¸­æœªæºå¸¦æ•°æ®çš„ ACK åŒ…ä¸€æ ·ï¼Œå®ƒä¸æ¶ˆè€—åºå·ï¼›\n     - ST_RESET = 3ï¼šå¼ºåˆ¶é‡ç½®è¿æ¥ã€‚ç±»ä¼¼ TCP çš„ RST æ ‡è®°ã€‚\n     - ST_SYN   = 4ï¼šå‘èµ·è¿æ¥ã€‚ç±»ä¼¼ TCP çš„ SYN æ ‡è®°ã€‚å‘èµ·æ–¹ä¼šéšæœºä¸€ä¸ª connection_id ID ç”¨äºç»™æ¥æ”¶æ–¹åç»­çš„å›å¤ä½¿ç”¨ã€‚ç„¶åå‘èµ·æ–¹ä¹‹åçš„åŒ…ä¸­ä¼ è¾“çš„ connection_id ä¸º ID + 1ï¼›\n - **seq_nr**ï¼šè¡¨ç¤ºè¿™ä¸ªæ•°æ®åŒ…çš„åºå·ã€‚æ³¨æ„å’Œ TCP ä¸­ä»£è¡¨å­—å·å·çš„åºå·æœ‰æ‰€ä¸åŒã€‚åˆå§‹åºå·åŒæ ·ä¹Ÿæ˜¯éšæœºç”Ÿæˆã€‚\n - **ack_nr**ï¼šè¡¨ç¤ºæœ€åæ”¶åˆ°çš„æ•°æ®åŒ…çš„seq_nrï¼›\n\n## è¿æ¥è¿‡ç¨‹\nâ€ƒâ€ƒå›¾ç¤ºä¸ºä¸€æ¬¡åœ¨ qBittorrent ä¸­å¯¹ä¸€ä¸ªç§å­å¼€å§‹ BT ä¸‹è½½äºŒåç§’å·¦å³ååœæ­¢ä¸‹è½½æ—¶ï¼Œä¸å…¶ä¸­ä¸€ä¸ª peer çš„äº¤äº’è¿‡ç¨‹ã€‚\n![è¿æ¥è¿‡ç¨‹ï¼ˆä»¥ connection_id ä¸º 8671 å’Œ 8672 çš„è¿™ä¸€ä¸ªè¿‡ç¨‹ä¸ºä¾‹ï¼‰](wireshark.png)\n\n## ä¸¢åŒ…\nå’Œä¸¢åŒ…å¤„ç†æœ‰ä¸€ä¸ªå’Œçª—å£ç›¸å…³çš„å˜é‡éœ€è¦å…ˆè¿›è¡Œè¯´æ˜ï¼š\n - ***max_window***ï¼šå®šä¹‰äº†æœªè¢«ç¡®è®¤çš„å­—èŠ‚çš„ä¸Šé™ï¼Œç›¸å½“ä¸ TCP ä¸­çš„æ‹¥å¡çª—å£ï¼›\n - ***wnd_size***ï¼šåŒé¦–éƒ¨ä¸­çš„ wnd_sizeï¼Œå’Œ TCP ä¸­ç›¸åŒï¼Œå®é™…çš„å‘é€çª—å£å¤§å°ä¸º `min(max_windows, wnd_size)`ï¼›\n - ***cur_window***ï¼šè¡¨ç¤ºå½“å‰æœªè¢«ç¡®è®¤çš„å­—èŠ‚çš„æ•°é‡ï¼›\n\nå½“éœ€è¦å‘é€æ•°æ®åŒ…æ—¶ï¼Œä»…å½“ `cur_window + packet_size <= min(max_windows, wnd_size)` æˆç«‹ï¼Œè¿™ä¸ªæ•°æ®åŒ…æ‰èƒ½è¢«å‘é€ã€‚\n\n - å½“åºå·ä¸º `seq_nr - cur_window` çš„æ•°æ®åŒ…ï¼ˆå‘é€é˜Ÿåˆ—ä¸­å¹´é¾„æœ€å¤§çš„æœªè¢«ç¡®è®¤çš„æ•°æ®åŒ…ï¼Œä¸‹ä¸€ä¸ªç†è®ºä¸Šéœ€è¦è¢«ç¡®è®¤çš„å°±æ˜¯å®ƒï¼‰æ²¡æœ‰è¢«ç¡®è®¤ï¼Œä½†æ˜¯å·²ç»æœ‰è‡³å°‘ä¸‰ä¸ªåºå·å¤§äºå®ƒçš„æ•°æ®åŒ…é€šè¿‡ Selective ACK è¢«ç¡®è®¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®åŒ…è¢«è®¤ä¸ºæ˜¯ä¸¢å¤±äº†ã€‚\n - å¦‚æœ `ack_nr + 1` è¿™ä¸ªåŒ…å·²ç»å‘é€äº†ï¼Œè€Œæ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ `ack_nr` çš„ ACKï¼Œé‚£ä¹ˆ `ack_nr + 1`è¿™ä¸ªåŒ…è¢«è®¤ä¸ºæ˜¯ä¸¢å¤±äº†ã€‚\n\nå¦‚æœæ£€æµ‹åˆ°ä¸¢åŒ…ï¼Œé‚£ä¹ˆæ‹¥å¡çª—å£ **max_window** å¤§å°å‡åŠã€‚\n## è¶…æ—¶\nÂµTP çš„è¶…æ—¶è®¡æ—¶å’Œ TCP ä¸­ RTO è®¡æ—¶å™¨ä¸å¤ªä¸€æ ·ï¼ŒRTO è®¡æ—¶å™¨ä¸»è¦ç”¨äºå¯¹ ACK çš„è®¡æ—¶ï¼Œä½†æ˜¯ã€€ÂµTP çš„è®¡æ—¶å™¨åˆ™æ˜¯æŒ‡æ¥æ”¶ä»»ä½•æ•°æ®åŒ…è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…æ—¶æ—¶é—´å†…æ²¡æœ‰ä»»ä½•æ•°æ®åŒ…åˆ°è¾¾åˆ™è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œåˆ™ **packet_size** å’Œ **max_window** å°†éƒ½ä¼šè¢«è®¾ç½®ä¸ºæœ€å°æ•°æ®åŒ…å¤§å°ï¼ˆ150 å­—èŠ‚ï¼‰ã€‚ **ï¼ˆç–‘é—®ï¼Ÿï¼špacket_size çš„è°ƒæ•´ç­–ç•¥æ˜¯ä»€ä¹ˆï¼‰**\n\n### è¶…æ—¶æ—¶é—´çš„è®¡ç®—\næ¯å½“æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„ ACKï¼Œå°±ä¼šæ›´æ–°å¾€è¿”æ—¶é—´ï¼ˆä¸è€ƒè™‘é‡ä¼ çš„åŒ…ï¼‰ï¼Œå¾€è¿”æ—¶é—´ç”¨äºè®¡ç®—è¶…æ—¶æ—¶é—´ã€‚å…ˆè¯´æ˜ä¸‹ç›¸å…³çš„å˜é‡ï¼š\n - ***rtt***ï¼šå¾€è¿”æ—¶é—´ï¼›\n - ***rtt_var***ï¼šå¾€è¿”æ—¶é—´å·®å¼‚ï¼›\n - ***packet_rtt***ï¼šå½“å‰æ”¶åˆ° ACK å¯¹åº”çš„åŒ…çš„å¾€è¿”æ—¶é—´ï¼Œå³å½“å‰æ—¶é—´å‡å»è¿™ä¸ªåŒ…å‘é€æ—¶çš„æ—¶é—´ï¼Œå³é¦–éƒ¨ä¸­çš„ timestamp å­—æ®µè®°å½•çš„å€¼ã€‚\n - ***timeout***ï¼šè¶…æ—¶æ—¶é—´ï¼›\n\né€šè¿‡ä»¥ä¸‹å…¬å¼æ›´æ–° rttï¼š\n```\ndelta = rtt - packet_rtt\nrtt_var += (abs(delta) - rtt_var) / 4;\nrtt += (packet_rtt - rtt) / 8;\n```\næ­£å¸¸æƒ…å†µä¸‹é€šè¿‡ rtt è®¡ç®—å¾—åˆ° timeoutï¼ˆç¬¬ä¸€æ¬¡ç”±äºæ²¡æœ‰ rttï¼Œtimeout ä½¿ç”¨åˆå§‹å€¼ 1000 msï¼Œï¼‰ï¼š\n```\ntimeout = max(rtt + rtt_var * 4, 500);\n```\nå¦‚æœé‡åˆ°è¶…æ—¶ï¼Œåˆ™ timeout ç¿»å€ã€‚\n\n## æ‹¥å¡æ§åˆ¶\nåœ¨**ä¸¢åŒ…**å’Œ**è¶…æ—¶**éƒ¨åˆ†å·²ç»æ¶‰åŠåˆ°æ‹¥å¡çª—å£çš„è°ƒæ•´äº†ã€‚ÂµTP çš„æ‹¥å¡æ§åˆ¶å¯ä»¥ç†è§£ä¸ºä¸€ç§åŸºäºå»¶è¿Ÿçš„è´Ÿåé¦ˆæ‹¥å¡æ§åˆ¶ï¼Œé€šè¿‡å»¶è¿Ÿçš„å˜åŒ–æ§åˆ¶çª—å£å¤§å°çš„å˜åŒ–ï¼Œè¾¾åˆ°æ‹¥å¡æ§åˆ¶ç›®çš„ã€‚è®¡ç®—çª—å£å¤§å°è¿‡ç¨‹ä¸­çš„ç›¸å…³å¸¸é‡å’Œå˜é‡çš„å®šä¹‰å¦‚ä¸‹ï¼š\n - ***CONTROL_TARGET***ï¼šÂµTP æ‰€èƒ½æ¥æ”¶çš„ä¸Šè¡Œç¼“å†²å»¶è¿Ÿï¼Œç°åœ¨æ˜¯ 100 msï¼›\n - ***base_delay***ï¼šä¸¤åˆ†é’Ÿå†…çš„æ”¶åˆ°çš„æ•°æ®åŒ…çš„æœ€ä½å»¶è¿Ÿï¼›\n - ***our_delay***ï¼šå½“å‰çš„æ•°æ®åŒ…å»¶è¿Ÿï¼›\n - ***off_target***ï¼šå®é™…å»¶è¿Ÿå’Œç›®æ ‡å»¶è¿Ÿçš„å·®è·ã€‚å³`CONTROL_TARGET - our_delay`ï¼›\n - ***outstanding_packet***ï¼šå·²ç»è¢«å‘é€ä½†æ˜¯æœªè¢«ç¡®è®¤çš„æ•°æ®åŒ…ï¼›\n\nå…·ä½“è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š\n```\ndelay_factor = off_target / CCONTROL_TARGET;\nwindow_factor = outstanding_packet / max_window;\nscaled_gain = MAX_CWND_INCREASE_PACKETS_PER_RTT * delay_factor * window_factor;\n\nmax_window += scaled_gain;\n```\nå½“ `off_target > 0` æ—¶ï¼Œå½“å‰åŒ…çš„å»¶è¿Ÿæ—¶é—´æ¯”è®¾å®šçš„è¿˜å°ä¸€äº›ï¼Œé‚£ä¹ˆçª—å£ä¼šç¼©å°ï¼Œå‘é€é€Ÿç‡å°±ä¼šæ”¾æ…¢ï¼›åä¹‹ï¼Œçª—å£å¢åŠ ï¼Œé€Ÿç‡åŠ å¿«ã€‚\n\n\n## å‚è€ƒèµ„æ–™\n1. [BitTorrent Enhancement Proposal 29 - ÂµTorrent transport protocol](http://www.bittorrent.org/beps/bep_0029.html)\n2. [RFC 6817 - Low Extra Delay Background Transport (LEDBAT)](https://tools.ietf.org/html/rfc6817)\n3. [Calvin's Marbles - libutpæºç ç®€æ](http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/)","slug":"Âµtp","published":1,"updated":"2020-07-18T06:30:19.531Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcraiuhj000cw80vneqqt73n","content":"<link rel=\"stylesheet\" type=\"text/css\" href=\"https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css\"><p>åœ¨ <a href=\"/2018/07/20/tcp/\" title=\"TCP æ¸©æ•…çŸ¥æ–°\">TCP æ¸©æ•…çŸ¥æ–°</a>ä¸­å›é¡¾äº† TCPï¼Œè€Œè¿™ç¯‡æ–‡ç« ä¸»è¦è®²ç”¨äº BT ç½‘ç»œçš„åŸºäº UDP çš„è¿è¾“å±‚åè®® ÂµTPï¼ŒåŒæ—¶é¡ºä¾¿å›é¡¾ UDPã€‚ä¸‹é¢çš„å†…å®¹æ›´å¤šæ˜¯åŸºäºå¯¹ <a href=\"http://www.bittorrent.org/beps/bep_0029.html\" target=\"_blank\" rel=\"noopener\">BEP29</a> çš„ç†è§£ã€‚</p>\n<h2 id=\"åå­—æ¢ç©¶\"><a href=\"#åå­—æ¢ç©¶\" class=\"headerlink\" title=\"åå­—æ¢ç©¶\"></a>åå­—æ¢ç©¶</h2><p>â€ƒâ€ƒÂµTP çš„ä¸»è¦æ–‡æ¡£ BEP29 çš„åˆ›å»ºäº 2009 å¹´ï¼Œå§‘ä¸”è®¤ä¸ºè¿™ä¹Ÿæ˜¯è®¾è®¡å®Œæˆçš„å¤§è‡´æ—¶é—´ï¼ŒÂµTP åœ¨ uTorrent çš„ 1.8 ä¸­é¦–æ¬¡åŠ å…¥ï¼ˆ2009 å¹´ï¼‰è¿™ä¸ªäº‹å®ä¹Ÿä½è¯äº†è¿™ç‚¹ã€‚å®ƒçš„è®¾è®¡è€…åŒ…æ‹¬ï¼š</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Ludvig_Strigeus\" target=\"_blank\" rel=\"noopener\">Ludvig Strigeus</a>ï¼ˆÎ¼Torrent ä½œè€…ï¼ŒBitTorrent å…¬å¸ 2006 å¹´æ”¶è´­ Î¼Torrentï¼Œç›®å‰åœ¨ Spotify å·¥ä½œï¼‰</li>\n<li>Greg Hazel</li>\n<li><a href=\"https://www.linkedin.com/in/shalunov\" target=\"_blank\" rel=\"noopener\">Stanislav Shalunov</a>ï¼ˆÂµTP ä¸­çš„æ‹¥å¡ç®—æ³• <a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">LEDBAT</a> ä¸»è¦ä½œè€…ï¼Œåæ¥è¿˜åˆ›é€ äº†å¯ä»¥è„±ç¦»ç°æœ‰èœ‚çªç½‘ç»œä½¿ç”¨çš„ IM åº”ç”¨ <a href=\"https://www.opengarden.com/firechat.html\" target=\"_blank\" rel=\"noopener\">FireChat</a> â€”â€” å®ƒè¢«å¤šæ¬¡ç”¨åˆ°â€å ä¸­â€è¿™æ ·çš„å…¬æ°‘è¿åŠ¨ä¸­ï¼‰</li>\n<li>Arvid Norbergï¼ˆlibtorrent å¼€å‘è€…ï¼Œç›®å‰åœ¨ <a href=\"https://blockstream.com/\" target=\"_blank\" rel=\"noopener\">Blockstream</a> å·¥ä½œï¼‰</li>\n<li>Bram Cohenï¼ˆBitTorrent ä½œè€…ï¼‰</li>\n</ul>\n<h2 id=\"è®¾è®¡åŸå› \"><a href=\"#è®¾è®¡åŸå› \" class=\"headerlink\" title=\"è®¾è®¡åŸå› \"></a>è®¾è®¡åŸå› </h2><p>â€ƒâ€ƒåœ¨è¿‡å»å¤šå¹´å‰ï¼Œå¦‚æœä½¿ç”¨ BT è¿›è¡Œä¸‹è½½çƒ­é—¨èµ„æºçš„è¯å¯ä»¥æ„Ÿå—åˆ°åˆ°é€Ÿåº¦é£å¿«ï¼Œä½†æ˜¯åŒæ—¶å¸¦æ¥çš„é—®é¢˜å°±æ˜¯å¦‚æœæƒ³è¦åŒæ—¶çœ‹åœ¨çº¿è§†é¢‘å°±ä¼šå¸¦æ¥å¡é¡¿ã€‚é—®é¢˜åœ¨äº DSL å’Œ modem çš„å¾€å¾€æœ‰ä¸€ä¸ªå’Œå®ƒä»¬çš„å‘é€é€Ÿç‡ä¸æˆæ¯”ä¾‹çš„å‘é€ç¼“å†²åŒºï¼Œä¸æˆæ¯”ä¾‹åˆ°å¯ä»¥å®¹çº³å‡ ç§’é’Ÿçš„æ•°æ®é‡ã€‚è€Œ BT å¾€å¾€ä¼šä¸è®¸å¤š peer å»ºç«‹ TCP è¿æ¥ï¼Œåœ¨ TCP å°†å¸¦å®½å‡åŒ€åœ°åˆ†é…åˆ°æ¯ä¸ªè¿æ¥çš„å‰æä¸‹ï¼ŒBT å°±å ç”¨äº†è¾ƒå¤šçš„å¸¦å®½ï¼Œä½†æ˜¯å…¶ä»–è¯¸å¦‚æµè§ˆç½‘é¡µã€å³æ—¶é€šè®¯è¿™äº›åœºæ™¯çš„ä¼˜å…ˆçº§å®é™…ä¸Šåº”è¯¥è¦æ¯” BT ä¼ è¾“æ›´é«˜äº›ï¼Œä½†æ˜¯å› ä¸º BT å’Œ ç‰©ç†å±‚çš„è¿™ç§ç‰¹æ€§å¯¼è‡´äº†å…¶ä»–æœåŠ¡æœ‰å»¶è¿Ÿï¼Œå½±å“äº†ä½¿ç”¨ BT æ—¶å…¶ä»–æœåŠ¡çš„ä½“éªŒã€‚<br>â€ƒâ€ƒÂµTP é€šè¿‡å°† modem çš„ç¼“å†²é˜Ÿåˆ—çš„å¤§å°ä½œä¸ºä¸€ä¸ªæ§åˆ¶å› å­æ¥è°ƒæ•´å‘é€é€Ÿç‡ï¼Œå½“é˜Ÿåˆ—è¿‡å¤§æ—¶ï¼Œå°†ä¼šæ”¾æ…¢å‘é€é€Ÿåº¦ã€‚è¿™ç§ç­–ç•¥ä½¿å¾— BT åœ¨æ²¡æœ‰ç«äº‰çš„æƒ…å†µä¸‹å¯ä»¥å……åˆ†åˆ©ç”¨ä¸Šä¼ å¸¦å®½ï¼Œåœ¨æœ‰å¤§é‡å…¶ä»–æµé‡çš„æƒ…å†µä¸‹åˆ™æ”¾æ…¢å‘é€é€Ÿç‡ã€‚<br>â€ƒâ€ƒä¸Šè¿°æ—¶ Bittorrent æ–‡æ¡£ä¸­çš„è¯´æ³•ï¼Œä½†æ˜¯å®é™…ä¸Š ÂµTP æ˜¯åŸºäºåŒ…çš„å»¶æ—¶çš„ï¼Œè€Œä¸æ˜¯åŸºäºé˜Ÿåˆ—å¤§å°çš„ã€‚è€Œä¸” ÂµTP å…·ä½“å¯¹æ‹¥å¡ç®—æ³• LEDBAT çš„å®ç°æœ‰ä¸åœ¨ IETF äº’è”ç½‘è‰æ¡ˆ <a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">RFC 6817</a> ä¸­çš„æè¿°æœ‰æ‰€åŒºåˆ«ï¼ˆè¿™é‡Œçš„å®ç°æŒ‡ C++ ç‰ˆæœ¬çš„ <a href=\"https://github.com/bittorrent/libutp\" target=\"_blank\" rel=\"noopener\">libutp</a>ï¼Œå„ä¸ªç‰ˆæœ¬çš„å®ç°ä¸å®Œå…¨ä¸€è‡´ï¼‰ã€‚</p>\n<h2 id=\"UDP-å’Œ-ÂµTP-é¦–éƒ¨\"><a href=\"#UDP-å’Œ-ÂµTP-é¦–éƒ¨\" class=\"headerlink\" title=\"UDP å’Œ ÂµTP é¦–éƒ¨\"></a>UDP å’Œ ÂµTP é¦–éƒ¨</h2><p>â€ƒâ€ƒä¸ºäº†æ–¹ä¾¿ä¸ TCP åšç®€å•çš„å¯¹æ¯”ï¼ŒæŠŠ UDP çš„é¦–éƒ¨ï¼ˆå‰å››ä¸ªå­—èŠ‚ï¼‰ä¸ ÂµTP çš„é¦–éƒ¨ï¼ˆå‰©ä½™éƒ¨åˆ†ï¼‰æ”¾åœ¨äº†ä¸€ä¸ªå›¾ä¸­ç¤ºæ„ã€‚ä» UDP é¦–éƒ¨å­—æ®µæ•°é‡çš†å¯ä»¥å‘ç° UDP åè®®ç›¸å¯¹ TCP åè®®æ˜¯å¦‚æ­¤ç®€å•ï¼Œä»¥è‡³äºæˆ‘ä»¬wå¯ä»¥å°† TCP åè®®çœ‹æˆæ˜¯ç±»ä¼¼ ÂµTP åè®®ä¸€æ ·çš„åŸºäº UDP åè®®çš„è¿è¾“å±‚åè®®ã€‚<br><img src=\"udp_utp_header.png\" alt=\"UDP Header And ÂµTP Header\"></p>\n<h3 id=\"UDP-é¦–éƒ¨\"><a href=\"#UDP-é¦–éƒ¨\" class=\"headerlink\" title=\"UDP é¦–éƒ¨\"></a>UDP é¦–éƒ¨</h3><ul>\n<li><strong>æº / ç›®ç«¯å£ï¼ˆSource / Destination portï¼‰</strong>ï¼šç”¨äºç¡®è®¤é€šä¿¡è¿›ç¨‹åŒæ–¹ã€‚æºç«¯å£æ˜¯å¯é€‰çš„ï¼Œå¦‚æœè®¾ç½®äº†æºç«¯å£ï¼Œåˆ™æ¥æ”¶æ–¹å°†å…¶è§†ä¸ºå›å¤ç«¯å£ã€‚å¦‚æœä¸éœ€è¦å›å¤å°±ä¸éœ€è¦è®¾ç½®ï¼›</li>\n<li><strong>æ€»é•¿åº¦ï¼ˆLengthï¼‰</strong>ï¼šå®šä¹‰äº† UDP ç”¨æˆ·æ•°æ®æŠ¥çš„æ€»é•¿åº¦ï¼ŒåŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ã€‚TCP é¦–éƒ¨ä¸­æ˜¯æ²¡æœ‰æ‰€è°“â€œæŠ¥æ–‡æ®µæ€»é•¿åº¦â€çš„å­—æ®µçš„ï¼Œé•¿åº¦å¯ä»¥é€šè¿‡ IP å±‚çš„é•¿åº¦å‡å» IP é¦–éƒ¨é•¿åº¦è®¡ç®—æ‰€å¾—ï¼Œæ‰€ä»¥ä¸€å®šç¨‹åº¦ä¸Šæ—¶å†—ä½™çš„ï¼Œå¯ä»¥å‚è€ƒ Stack OverFlow ä¸Šçš„<a href=\"https://stackoverflow.com/a/16748680/5091903\" target=\"_blank\" rel=\"noopener\">ç›¸å…³è®¨è®º</a>ï¼›</li>\n<li><strong>æ ¡éªŒå’Œï¼ˆChecksumï¼‰</strong>ï¼šç”¨äºå¯¹æ•´ä¸ªç”¨æˆ·æ•°æ®æŠ¥çš„æ ¡éªŒï¼Œé€šè¿‡ IP ä½é¦–éƒ¨ä¸å’Œç”¨æˆ·æ•°æ®æŠ¥è®¡ç®—å¾—åˆ°ï¼›</li>\n</ul>\n<p>å¯è§ UDP é¦–éƒ¨çš„è¿™äº›å­—æ®µåœ¨ç†è®ºä¸Šå¯ä»¥æ˜¯ TCP é¦–éƒ¨å­—æ®µçš„å­é›†ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç²—ç•¥åœ°è®² <strong>TCP æ˜¯åŸºäº UDP çš„ä¼ è¾“å±‚åè®®ã€‚</strong><br>UDP æœåŠ¡æ˜¯ä¸€ä¸ªâ€œå°½åŠ›è€Œä¸ºâ€çš„æœåŠ¡ï¼Œå®ƒ<strong>æ²¡æœ‰æµé‡æ§åˆ¶</strong>ï¼Œ<strong>åªèƒ½é€šè¿‡æ ¡éªŒå’Œè¿›è¡Œå·®é”™æ§åˆ¶ï¼Œä¸¢åŒ…ä¸ä¼šçŸ¥æ™“ï¼Œä¹Ÿä¸ä¼šé‡ä¼ </strong>ï¼Œä¹Ÿ<strong>æ²¡æœ‰æ‹¥å¡æ§åˆ¶</strong>ã€‚</p>\n<h3 id=\"ÂµTP-é¦–éƒ¨\"><a href=\"#ÂµTP-é¦–éƒ¨\" class=\"headerlink\" title=\"ÂµTP é¦–éƒ¨\"></a>ÂµTP é¦–éƒ¨</h3><ul>\n<li><strong>version</strong>ï¼šç‰ˆæœ¬å·ï¼Œç°åœ¨ä¸º 1ï¼Œ<a href=\"https://github.com/boundary/wireshark/blob/master/epan/dissectors/packet-bt-utp.c\" target=\"_blank\" rel=\"noopener\">è¿˜æœ‰ä¸€ä¸ªåŸå§‹ç‰ˆæœ¬å· 0 å­˜åœ¨</a></li>\n<li><strong>connection_id</strong>ï¼šç”¨äºæ ‡è®°è¿æ¥ã€‚<a href=\"http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/#utp-context%E7%9A%84%E6%88%90%E5%91%98\" target=\"_blank\" rel=\"noopener\">è¿™ä¸ªå­—æ®µæ˜¯å¿…é¡»çš„ä¹ˆ?</a>ï¼›</li>\n<li><strong>timestamp_microseconds</strong>ï¼šå‘é€æ•°æ®åŒ…çš„æ—¶é—´ï¼Œå’Œè®¡ç®—å»¶è¿Ÿæ—¶é—´ï¼Œrtt ç›¸å…³ï¼›</li>\n<li><strong>timestamp_difference_microseconds</strong>ï¼šå½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡æ”¶åˆ°çš„åŒ…ä¸­çš„ timestamp_microseconds ä¹‹å·®ï¼›</li>\n<li><strong>wnd_size</strong>ï¼šè¡¨ç¤ºå¦ä¸€ç«¯å»ºè®®çš„çª—å£å¤§å°ï¼Œç›¸å½“äº TCP ä¸­çš„æ¥æ”¶çª—å£ï¼›</li>\n<li><strong>extension</strong>ï¼šä»£è¡¨ç¬¬ä¸€ä¸ªæ‰©å±•çš„ç±»å‹ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰æ‰©å±•ï¼Œ1 è¡¨ç¤º Selective ACKsï¼ˆé€‰æ‹©ç¡®è®¤æ‰©å±•ï¼‰ã€‚</li>\n<li><strong>type</strong>ï¼šæ•°æ®åŒ…çš„ç±»å‹ã€‚å¯ä»¥æœ‰ï¼š<ul>\n<li>ST_DATA  = 0ï¼šæ‰¿è½½æœ‰æ•ˆæ•°æ®çš„æ•°æ®åŒ…ï¼›</li>\n<li>ST_FIN   = 1ï¼šç»ˆæ­¢è¿æ¥ã€‚æ˜¯é€šä¿¡å•æ–¹å‘é€çš„æœ€åä¸€ä¸ªåŒ…ï¼Œç±»ä¼¼äº TCP çš„ FIN æ ‡è®°ã€‚ä½†æ˜¯å‘é€ ST_FIN çš„ä¸€æ–¹è¿˜æ˜¯ä¼šç­‰å¾…å¯èƒ½ä¸¢å¤±æˆ–è€…å¤±åºåˆ°è¾¾çš„åŒ…ï¼Œå³ä½¿æ”¶åˆ°äº†å¯¹æ–¹çš„ ST_FIN åŒ…ï¼›</li>\n<li>ST_STATE = 2ï¼šç”¨äºæŠ¥å‘ŠçŠ¶æ€ï¼Œä¼ è¾“ä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„ ACKã€‚å’Œ TCP ä¸­æœªæºå¸¦æ•°æ®çš„ ACK åŒ…ä¸€æ ·ï¼Œå®ƒä¸æ¶ˆè€—åºå·ï¼›</li>\n<li>ST_RESET = 3ï¼šå¼ºåˆ¶é‡ç½®è¿æ¥ã€‚ç±»ä¼¼ TCP çš„ RST æ ‡è®°ã€‚</li>\n<li>ST_SYN   = 4ï¼šå‘èµ·è¿æ¥ã€‚ç±»ä¼¼ TCP çš„ SYN æ ‡è®°ã€‚å‘èµ·æ–¹ä¼šéšæœºä¸€ä¸ª connection_id ID ç”¨äºç»™æ¥æ”¶æ–¹åç»­çš„å›å¤ä½¿ç”¨ã€‚ç„¶åå‘èµ·æ–¹ä¹‹åçš„åŒ…ä¸­ä¼ è¾“çš„ connection_id ä¸º ID + 1ï¼›</li>\n</ul>\n</li>\n<li><strong>seq_nr</strong>ï¼šè¡¨ç¤ºè¿™ä¸ªæ•°æ®åŒ…çš„åºå·ã€‚æ³¨æ„å’Œ TCP ä¸­ä»£è¡¨å­—å·å·çš„åºå·æœ‰æ‰€ä¸åŒã€‚åˆå§‹åºå·åŒæ ·ä¹Ÿæ˜¯éšæœºç”Ÿæˆã€‚</li>\n<li><strong>ack_nr</strong>ï¼šè¡¨ç¤ºæœ€åæ”¶åˆ°çš„æ•°æ®åŒ…çš„seq_nrï¼›</li>\n</ul>\n<h2 id=\"è¿æ¥è¿‡ç¨‹\"><a href=\"#è¿æ¥è¿‡ç¨‹\" class=\"headerlink\" title=\"è¿æ¥è¿‡ç¨‹\"></a>è¿æ¥è¿‡ç¨‹</h2><p>â€ƒâ€ƒå›¾ç¤ºä¸ºä¸€æ¬¡åœ¨ qBittorrent ä¸­å¯¹ä¸€ä¸ªç§å­å¼€å§‹ BT ä¸‹è½½äºŒåç§’å·¦å³ååœæ­¢ä¸‹è½½æ—¶ï¼Œä¸å…¶ä¸­ä¸€ä¸ª peer çš„äº¤äº’è¿‡ç¨‹ã€‚<br><img src=\"wireshark.png\" alt=\"è¿æ¥è¿‡ç¨‹ï¼ˆä»¥ connection_id ä¸º 8671 å’Œ 8672 çš„è¿™ä¸€ä¸ªè¿‡ç¨‹ä¸ºä¾‹ï¼‰\"></p>\n<h2 id=\"ä¸¢åŒ…\"><a href=\"#ä¸¢åŒ…\" class=\"headerlink\" title=\"ä¸¢åŒ…\"></a>ä¸¢åŒ…</h2><p>å’Œä¸¢åŒ…å¤„ç†æœ‰ä¸€ä¸ªå’Œçª—å£ç›¸å…³çš„å˜é‡éœ€è¦å…ˆè¿›è¡Œè¯´æ˜ï¼š</p>\n<ul>\n<li><strong><em>max_window</em></strong>ï¼šå®šä¹‰äº†æœªè¢«ç¡®è®¤çš„å­—èŠ‚çš„ä¸Šé™ï¼Œç›¸å½“ä¸ TCP ä¸­çš„æ‹¥å¡çª—å£ï¼›</li>\n<li><strong><em>wnd_size</em></strong>ï¼šåŒé¦–éƒ¨ä¸­çš„ wnd_sizeï¼Œå’Œ TCP ä¸­ç›¸åŒï¼Œå®é™…çš„å‘é€çª—å£å¤§å°ä¸º <code>min(max_windows, wnd_size)</code>ï¼›</li>\n<li><strong><em>cur_window</em></strong>ï¼šè¡¨ç¤ºå½“å‰æœªè¢«ç¡®è®¤çš„å­—èŠ‚çš„æ•°é‡ï¼›</li>\n</ul>\n<p>å½“éœ€è¦å‘é€æ•°æ®åŒ…æ—¶ï¼Œä»…å½“ <code>cur_window + packet_size &lt;= min(max_windows, wnd_size)</code> æˆç«‹ï¼Œè¿™ä¸ªæ•°æ®åŒ…æ‰èƒ½è¢«å‘é€ã€‚</p>\n<ul>\n<li>å½“åºå·ä¸º <code>seq_nr - cur_window</code> çš„æ•°æ®åŒ…ï¼ˆå‘é€é˜Ÿåˆ—ä¸­å¹´é¾„æœ€å¤§çš„æœªè¢«ç¡®è®¤çš„æ•°æ®åŒ…ï¼Œä¸‹ä¸€ä¸ªç†è®ºä¸Šéœ€è¦è¢«ç¡®è®¤çš„å°±æ˜¯å®ƒï¼‰æ²¡æœ‰è¢«ç¡®è®¤ï¼Œä½†æ˜¯å·²ç»æœ‰è‡³å°‘ä¸‰ä¸ªåºå·å¤§äºå®ƒçš„æ•°æ®åŒ…é€šè¿‡ Selective ACK è¢«ç¡®è®¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®åŒ…è¢«è®¤ä¸ºæ˜¯ä¸¢å¤±äº†ã€‚</li>\n<li>å¦‚æœ <code>ack_nr + 1</code> è¿™ä¸ªåŒ…å·²ç»å‘é€äº†ï¼Œè€Œæ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ <code>ack_nr</code> çš„ ACKï¼Œé‚£ä¹ˆ <code>ack_nr + 1</code>è¿™ä¸ªåŒ…è¢«è®¤ä¸ºæ˜¯ä¸¢å¤±äº†ã€‚</li>\n</ul>\n<p>å¦‚æœæ£€æµ‹åˆ°ä¸¢åŒ…ï¼Œé‚£ä¹ˆæ‹¥å¡çª—å£ <strong>max_window</strong> å¤§å°å‡åŠã€‚</p>\n<h2 id=\"è¶…æ—¶\"><a href=\"#è¶…æ—¶\" class=\"headerlink\" title=\"è¶…æ—¶\"></a>è¶…æ—¶</h2><p>ÂµTP çš„è¶…æ—¶è®¡æ—¶å’Œ TCP ä¸­ RTO è®¡æ—¶å™¨ä¸å¤ªä¸€æ ·ï¼ŒRTO è®¡æ—¶å™¨ä¸»è¦ç”¨äºå¯¹ ACK çš„è®¡æ—¶ï¼Œä½†æ˜¯ã€€ÂµTP çš„è®¡æ—¶å™¨åˆ™æ˜¯æŒ‡æ¥æ”¶ä»»ä½•æ•°æ®åŒ…è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…æ—¶æ—¶é—´å†…æ²¡æœ‰ä»»ä½•æ•°æ®åŒ…åˆ°è¾¾åˆ™è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œåˆ™ <strong>packet_size</strong> å’Œ <strong>max_window</strong> å°†éƒ½ä¼šè¢«è®¾ç½®ä¸ºæœ€å°æ•°æ®åŒ…å¤§å°ï¼ˆ150 å­—èŠ‚ï¼‰ã€‚ <strong>ï¼ˆç–‘é—®ï¼Ÿï¼špacket_size çš„è°ƒæ•´ç­–ç•¥æ˜¯ä»€ä¹ˆï¼‰</strong></p>\n<h3 id=\"è¶…æ—¶æ—¶é—´çš„è®¡ç®—\"><a href=\"#è¶…æ—¶æ—¶é—´çš„è®¡ç®—\" class=\"headerlink\" title=\"è¶…æ—¶æ—¶é—´çš„è®¡ç®—\"></a>è¶…æ—¶æ—¶é—´çš„è®¡ç®—</h3><p>æ¯å½“æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„ ACKï¼Œå°±ä¼šæ›´æ–°å¾€è¿”æ—¶é—´ï¼ˆä¸è€ƒè™‘é‡ä¼ çš„åŒ…ï¼‰ï¼Œå¾€è¿”æ—¶é—´ç”¨äºè®¡ç®—è¶…æ—¶æ—¶é—´ã€‚å…ˆè¯´æ˜ä¸‹ç›¸å…³çš„å˜é‡ï¼š</p>\n<ul>\n<li><strong><em>rtt</em></strong>ï¼šå¾€è¿”æ—¶é—´ï¼›</li>\n<li><strong><em>rtt_var</em></strong>ï¼šå¾€è¿”æ—¶é—´å·®å¼‚ï¼›</li>\n<li><strong><em>packet_rtt</em></strong>ï¼šå½“å‰æ”¶åˆ° ACK å¯¹åº”çš„åŒ…çš„å¾€è¿”æ—¶é—´ï¼Œå³å½“å‰æ—¶é—´å‡å»è¿™ä¸ªåŒ…å‘é€æ—¶çš„æ—¶é—´ï¼Œå³é¦–éƒ¨ä¸­çš„ timestamp å­—æ®µè®°å½•çš„å€¼ã€‚</li>\n<li><strong><em>timeout</em></strong>ï¼šè¶…æ—¶æ—¶é—´ï¼›</li>\n</ul>\n<p>é€šè¿‡ä»¥ä¸‹å…¬å¼æ›´æ–° rttï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">delta = rtt - packet_rtt</span><br><span class=\"line\">rtt_var += (abs(delta) - rtt_var) / 4;</span><br><span class=\"line\">rtt += (packet_rtt - rtt) / 8;</span><br></pre></td></tr></table></figure>\n\n<p>æ­£å¸¸æƒ…å†µä¸‹é€šè¿‡ rtt è®¡ç®—å¾—åˆ° timeoutï¼ˆç¬¬ä¸€æ¬¡ç”±äºæ²¡æœ‰ rttï¼Œtimeout ä½¿ç”¨åˆå§‹å€¼ 1000 msï¼Œï¼‰ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">timeout = max(rtt + rtt_var * 4, 500);</span><br></pre></td></tr></table></figure>\n\n<p>å¦‚æœé‡åˆ°è¶…æ—¶ï¼Œåˆ™ timeout ç¿»å€ã€‚</p>\n<h2 id=\"æ‹¥å¡æ§åˆ¶\"><a href=\"#æ‹¥å¡æ§åˆ¶\" class=\"headerlink\" title=\"æ‹¥å¡æ§åˆ¶\"></a>æ‹¥å¡æ§åˆ¶</h2><p>åœ¨<strong>ä¸¢åŒ…</strong>å’Œ<strong>è¶…æ—¶</strong>éƒ¨åˆ†å·²ç»æ¶‰åŠåˆ°æ‹¥å¡çª—å£çš„è°ƒæ•´äº†ã€‚ÂµTP çš„æ‹¥å¡æ§åˆ¶å¯ä»¥ç†è§£ä¸ºä¸€ç§åŸºäºå»¶è¿Ÿçš„è´Ÿåé¦ˆæ‹¥å¡æ§åˆ¶ï¼Œé€šè¿‡å»¶è¿Ÿçš„å˜åŒ–æ§åˆ¶çª—å£å¤§å°çš„å˜åŒ–ï¼Œè¾¾åˆ°æ‹¥å¡æ§åˆ¶ç›®çš„ã€‚è®¡ç®—çª—å£å¤§å°è¿‡ç¨‹ä¸­çš„ç›¸å…³å¸¸é‡å’Œå˜é‡çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>\n<ul>\n<li><strong><em>CONTROL_TARGET</em></strong>ï¼šÂµTP æ‰€èƒ½æ¥æ”¶çš„ä¸Šè¡Œç¼“å†²å»¶è¿Ÿï¼Œç°åœ¨æ˜¯ 100 msï¼›</li>\n<li><strong><em>base_delay</em></strong>ï¼šä¸¤åˆ†é’Ÿå†…çš„æ”¶åˆ°çš„æ•°æ®åŒ…çš„æœ€ä½å»¶è¿Ÿï¼›</li>\n<li><strong><em>our_delay</em></strong>ï¼šå½“å‰çš„æ•°æ®åŒ…å»¶è¿Ÿï¼›</li>\n<li><strong><em>off_target</em></strong>ï¼šå®é™…å»¶è¿Ÿå’Œç›®æ ‡å»¶è¿Ÿçš„å·®è·ã€‚å³<code>CONTROL_TARGET - our_delay</code>ï¼›</li>\n<li><strong><em>outstanding_packet</em></strong>ï¼šå·²ç»è¢«å‘é€ä½†æ˜¯æœªè¢«ç¡®è®¤çš„æ•°æ®åŒ…ï¼›</li>\n</ul>\n<p>å…·ä½“è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">delay_factor = off_target / CCONTROL_TARGET;</span><br><span class=\"line\">window_factor = outstanding_packet / max_window;</span><br><span class=\"line\">scaled_gain = MAX_CWND_INCREASE_PACKETS_PER_RTT * delay_factor * window_factor;</span><br><span class=\"line\"></span><br><span class=\"line\">max_window += scaled_gain;</span><br></pre></td></tr></table></figure>\n\n<p>å½“ <code>off_target &gt; 0</code> æ—¶ï¼Œå½“å‰åŒ…çš„å»¶è¿Ÿæ—¶é—´æ¯”è®¾å®šçš„è¿˜å°ä¸€äº›ï¼Œé‚£ä¹ˆçª—å£ä¼šç¼©å°ï¼Œå‘é€é€Ÿç‡å°±ä¼šæ”¾æ…¢ï¼›åä¹‹ï¼Œçª—å£å¢åŠ ï¼Œé€Ÿç‡åŠ å¿«ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"http://www.bittorrent.org/beps/bep_0029.html\" target=\"_blank\" rel=\"noopener\">BitTorrent Enhancement Proposal 29 - ÂµTorrent transport protocol</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">RFC 6817 - Low Extra Delay Background Transport (LEDBAT)</a></li>\n<li><a href=\"http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/\" target=\"_blank\" rel=\"noopener\">Calvinâ€™s Marbles - libutpæºç ç®€æ</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"","more":"<p>åœ¨ <a href=\"/2018/07/20/tcp/\" title=\"TCP æ¸©æ•…çŸ¥æ–°\">TCP æ¸©æ•…çŸ¥æ–°</a>ä¸­å›é¡¾äº† TCPï¼Œè€Œè¿™ç¯‡æ–‡ç« ä¸»è¦è®²ç”¨äº BT ç½‘ç»œçš„åŸºäº UDP çš„è¿è¾“å±‚åè®® ÂµTPï¼ŒåŒæ—¶é¡ºä¾¿å›é¡¾ UDPã€‚ä¸‹é¢çš„å†…å®¹æ›´å¤šæ˜¯åŸºäºå¯¹ <a href=\"http://www.bittorrent.org/beps/bep_0029.html\" target=\"_blank\" rel=\"noopener\">BEP29</a> çš„ç†è§£ã€‚</p>\n<h2 id=\"åå­—æ¢ç©¶\"><a href=\"#åå­—æ¢ç©¶\" class=\"headerlink\" title=\"åå­—æ¢ç©¶\"></a>åå­—æ¢ç©¶</h2><p>â€ƒâ€ƒÂµTP çš„ä¸»è¦æ–‡æ¡£ BEP29 çš„åˆ›å»ºäº 2009 å¹´ï¼Œå§‘ä¸”è®¤ä¸ºè¿™ä¹Ÿæ˜¯è®¾è®¡å®Œæˆçš„å¤§è‡´æ—¶é—´ï¼ŒÂµTP åœ¨ uTorrent çš„ 1.8 ä¸­é¦–æ¬¡åŠ å…¥ï¼ˆ2009 å¹´ï¼‰è¿™ä¸ªäº‹å®ä¹Ÿä½è¯äº†è¿™ç‚¹ã€‚å®ƒçš„è®¾è®¡è€…åŒ…æ‹¬ï¼š</p>\n<ul>\n<li><a href=\"https://en.wikipedia.org/wiki/Ludvig_Strigeus\" target=\"_blank\" rel=\"noopener\">Ludvig Strigeus</a>ï¼ˆÎ¼Torrent ä½œè€…ï¼ŒBitTorrent å…¬å¸ 2006 å¹´æ”¶è´­ Î¼Torrentï¼Œç›®å‰åœ¨ Spotify å·¥ä½œï¼‰</li>\n<li>Greg Hazel</li>\n<li><a href=\"https://www.linkedin.com/in/shalunov\" target=\"_blank\" rel=\"noopener\">Stanislav Shalunov</a>ï¼ˆÂµTP ä¸­çš„æ‹¥å¡ç®—æ³• <a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">LEDBAT</a> ä¸»è¦ä½œè€…ï¼Œåæ¥è¿˜åˆ›é€ äº†å¯ä»¥è„±ç¦»ç°æœ‰èœ‚çªç½‘ç»œä½¿ç”¨çš„ IM åº”ç”¨ <a href=\"https://www.opengarden.com/firechat.html\" target=\"_blank\" rel=\"noopener\">FireChat</a> â€”â€” å®ƒè¢«å¤šæ¬¡ç”¨åˆ°â€å ä¸­â€è¿™æ ·çš„å…¬æ°‘è¿åŠ¨ä¸­ï¼‰</li>\n<li>Arvid Norbergï¼ˆlibtorrent å¼€å‘è€…ï¼Œç›®å‰åœ¨ <a href=\"https://blockstream.com/\" target=\"_blank\" rel=\"noopener\">Blockstream</a> å·¥ä½œï¼‰</li>\n<li>Bram Cohenï¼ˆBitTorrent ä½œè€…ï¼‰</li>\n</ul>\n<h2 id=\"è®¾è®¡åŸå› \"><a href=\"#è®¾è®¡åŸå› \" class=\"headerlink\" title=\"è®¾è®¡åŸå› \"></a>è®¾è®¡åŸå› </h2><p>â€ƒâ€ƒåœ¨è¿‡å»å¤šå¹´å‰ï¼Œå¦‚æœä½¿ç”¨ BT è¿›è¡Œä¸‹è½½çƒ­é—¨èµ„æºçš„è¯å¯ä»¥æ„Ÿå—åˆ°åˆ°é€Ÿåº¦é£å¿«ï¼Œä½†æ˜¯åŒæ—¶å¸¦æ¥çš„é—®é¢˜å°±æ˜¯å¦‚æœæƒ³è¦åŒæ—¶çœ‹åœ¨çº¿è§†é¢‘å°±ä¼šå¸¦æ¥å¡é¡¿ã€‚é—®é¢˜åœ¨äº DSL å’Œ modem çš„å¾€å¾€æœ‰ä¸€ä¸ªå’Œå®ƒä»¬çš„å‘é€é€Ÿç‡ä¸æˆæ¯”ä¾‹çš„å‘é€ç¼“å†²åŒºï¼Œä¸æˆæ¯”ä¾‹åˆ°å¯ä»¥å®¹çº³å‡ ç§’é’Ÿçš„æ•°æ®é‡ã€‚è€Œ BT å¾€å¾€ä¼šä¸è®¸å¤š peer å»ºç«‹ TCP è¿æ¥ï¼Œåœ¨ TCP å°†å¸¦å®½å‡åŒ€åœ°åˆ†é…åˆ°æ¯ä¸ªè¿æ¥çš„å‰æä¸‹ï¼ŒBT å°±å ç”¨äº†è¾ƒå¤šçš„å¸¦å®½ï¼Œä½†æ˜¯å…¶ä»–è¯¸å¦‚æµè§ˆç½‘é¡µã€å³æ—¶é€šè®¯è¿™äº›åœºæ™¯çš„ä¼˜å…ˆçº§å®é™…ä¸Šåº”è¯¥è¦æ¯” BT ä¼ è¾“æ›´é«˜äº›ï¼Œä½†æ˜¯å› ä¸º BT å’Œ ç‰©ç†å±‚çš„è¿™ç§ç‰¹æ€§å¯¼è‡´äº†å…¶ä»–æœåŠ¡æœ‰å»¶è¿Ÿï¼Œå½±å“äº†ä½¿ç”¨ BT æ—¶å…¶ä»–æœåŠ¡çš„ä½“éªŒã€‚<br>â€ƒâ€ƒÂµTP é€šè¿‡å°† modem çš„ç¼“å†²é˜Ÿåˆ—çš„å¤§å°ä½œä¸ºä¸€ä¸ªæ§åˆ¶å› å­æ¥è°ƒæ•´å‘é€é€Ÿç‡ï¼Œå½“é˜Ÿåˆ—è¿‡å¤§æ—¶ï¼Œå°†ä¼šæ”¾æ…¢å‘é€é€Ÿåº¦ã€‚è¿™ç§ç­–ç•¥ä½¿å¾— BT åœ¨æ²¡æœ‰ç«äº‰çš„æƒ…å†µä¸‹å¯ä»¥å……åˆ†åˆ©ç”¨ä¸Šä¼ å¸¦å®½ï¼Œåœ¨æœ‰å¤§é‡å…¶ä»–æµé‡çš„æƒ…å†µä¸‹åˆ™æ”¾æ…¢å‘é€é€Ÿç‡ã€‚<br>â€ƒâ€ƒä¸Šè¿°æ—¶ Bittorrent æ–‡æ¡£ä¸­çš„è¯´æ³•ï¼Œä½†æ˜¯å®é™…ä¸Š ÂµTP æ˜¯åŸºäºåŒ…çš„å»¶æ—¶çš„ï¼Œè€Œä¸æ˜¯åŸºäºé˜Ÿåˆ—å¤§å°çš„ã€‚è€Œä¸” ÂµTP å…·ä½“å¯¹æ‹¥å¡ç®—æ³• LEDBAT çš„å®ç°æœ‰ä¸åœ¨ IETF äº’è”ç½‘è‰æ¡ˆ <a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">RFC 6817</a> ä¸­çš„æè¿°æœ‰æ‰€åŒºåˆ«ï¼ˆè¿™é‡Œçš„å®ç°æŒ‡ C++ ç‰ˆæœ¬çš„ <a href=\"https://github.com/bittorrent/libutp\" target=\"_blank\" rel=\"noopener\">libutp</a>ï¼Œå„ä¸ªç‰ˆæœ¬çš„å®ç°ä¸å®Œå…¨ä¸€è‡´ï¼‰ã€‚</p>\n<h2 id=\"UDP-å’Œ-ÂµTP-é¦–éƒ¨\"><a href=\"#UDP-å’Œ-ÂµTP-é¦–éƒ¨\" class=\"headerlink\" title=\"UDP å’Œ ÂµTP é¦–éƒ¨\"></a>UDP å’Œ ÂµTP é¦–éƒ¨</h2><p>â€ƒâ€ƒä¸ºäº†æ–¹ä¾¿ä¸ TCP åšç®€å•çš„å¯¹æ¯”ï¼ŒæŠŠ UDP çš„é¦–éƒ¨ï¼ˆå‰å››ä¸ªå­—èŠ‚ï¼‰ä¸ ÂµTP çš„é¦–éƒ¨ï¼ˆå‰©ä½™éƒ¨åˆ†ï¼‰æ”¾åœ¨äº†ä¸€ä¸ªå›¾ä¸­ç¤ºæ„ã€‚ä» UDP é¦–éƒ¨å­—æ®µæ•°é‡çš†å¯ä»¥å‘ç° UDP åè®®ç›¸å¯¹ TCP åè®®æ˜¯å¦‚æ­¤ç®€å•ï¼Œä»¥è‡³äºæˆ‘ä»¬wå¯ä»¥å°† TCP åè®®çœ‹æˆæ˜¯ç±»ä¼¼ ÂµTP åè®®ä¸€æ ·çš„åŸºäº UDP åè®®çš„è¿è¾“å±‚åè®®ã€‚<br><img src=\"udp_utp_header.png\" alt=\"UDP Header And ÂµTP Header\"></p>\n<h3 id=\"UDP-é¦–éƒ¨\"><a href=\"#UDP-é¦–éƒ¨\" class=\"headerlink\" title=\"UDP é¦–éƒ¨\"></a>UDP é¦–éƒ¨</h3><ul>\n<li><strong>æº / ç›®ç«¯å£ï¼ˆSource / Destination portï¼‰</strong>ï¼šç”¨äºç¡®è®¤é€šä¿¡è¿›ç¨‹åŒæ–¹ã€‚æºç«¯å£æ˜¯å¯é€‰çš„ï¼Œå¦‚æœè®¾ç½®äº†æºç«¯å£ï¼Œåˆ™æ¥æ”¶æ–¹å°†å…¶è§†ä¸ºå›å¤ç«¯å£ã€‚å¦‚æœä¸éœ€è¦å›å¤å°±ä¸éœ€è¦è®¾ç½®ï¼›</li>\n<li><strong>æ€»é•¿åº¦ï¼ˆLengthï¼‰</strong>ï¼šå®šä¹‰äº† UDP ç”¨æˆ·æ•°æ®æŠ¥çš„æ€»é•¿åº¦ï¼ŒåŒ…æ‹¬é¦–éƒ¨å’Œæ•°æ®ã€‚TCP é¦–éƒ¨ä¸­æ˜¯æ²¡æœ‰æ‰€è°“â€œæŠ¥æ–‡æ®µæ€»é•¿åº¦â€çš„å­—æ®µçš„ï¼Œé•¿åº¦å¯ä»¥é€šè¿‡ IP å±‚çš„é•¿åº¦å‡å» IP é¦–éƒ¨é•¿åº¦è®¡ç®—æ‰€å¾—ï¼Œæ‰€ä»¥ä¸€å®šç¨‹åº¦ä¸Šæ—¶å†—ä½™çš„ï¼Œå¯ä»¥å‚è€ƒ Stack OverFlow ä¸Šçš„<a href=\"https://stackoverflow.com/a/16748680/5091903\" target=\"_blank\" rel=\"noopener\">ç›¸å…³è®¨è®º</a>ï¼›</li>\n<li><strong>æ ¡éªŒå’Œï¼ˆChecksumï¼‰</strong>ï¼šç”¨äºå¯¹æ•´ä¸ªç”¨æˆ·æ•°æ®æŠ¥çš„æ ¡éªŒï¼Œé€šè¿‡ IP ä½é¦–éƒ¨ä¸å’Œç”¨æˆ·æ•°æ®æŠ¥è®¡ç®—å¾—åˆ°ï¼›</li>\n</ul>\n<p>å¯è§ UDP é¦–éƒ¨çš„è¿™äº›å­—æ®µåœ¨ç†è®ºä¸Šå¯ä»¥æ˜¯ TCP é¦–éƒ¨å­—æ®µçš„å­é›†ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç²—ç•¥åœ°è®² <strong>TCP æ˜¯åŸºäº UDP çš„ä¼ è¾“å±‚åè®®ã€‚</strong><br>UDP æœåŠ¡æ˜¯ä¸€ä¸ªâ€œå°½åŠ›è€Œä¸ºâ€çš„æœåŠ¡ï¼Œå®ƒ<strong>æ²¡æœ‰æµé‡æ§åˆ¶</strong>ï¼Œ<strong>åªèƒ½é€šè¿‡æ ¡éªŒå’Œè¿›è¡Œå·®é”™æ§åˆ¶ï¼Œä¸¢åŒ…ä¸ä¼šçŸ¥æ™“ï¼Œä¹Ÿä¸ä¼šé‡ä¼ </strong>ï¼Œä¹Ÿ<strong>æ²¡æœ‰æ‹¥å¡æ§åˆ¶</strong>ã€‚</p>\n<h3 id=\"ÂµTP-é¦–éƒ¨\"><a href=\"#ÂµTP-é¦–éƒ¨\" class=\"headerlink\" title=\"ÂµTP é¦–éƒ¨\"></a>ÂµTP é¦–éƒ¨</h3><ul>\n<li><strong>version</strong>ï¼šç‰ˆæœ¬å·ï¼Œç°åœ¨ä¸º 1ï¼Œ<a href=\"https://github.com/boundary/wireshark/blob/master/epan/dissectors/packet-bt-utp.c\" target=\"_blank\" rel=\"noopener\">è¿˜æœ‰ä¸€ä¸ªåŸå§‹ç‰ˆæœ¬å· 0 å­˜åœ¨</a></li>\n<li><strong>connection_id</strong>ï¼šç”¨äºæ ‡è®°è¿æ¥ã€‚<a href=\"http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/#utp-context%E7%9A%84%E6%88%90%E5%91%98\" target=\"_blank\" rel=\"noopener\">è¿™ä¸ªå­—æ®µæ˜¯å¿…é¡»çš„ä¹ˆ?</a>ï¼›</li>\n<li><strong>timestamp_microseconds</strong>ï¼šå‘é€æ•°æ®åŒ…çš„æ—¶é—´ï¼Œå’Œè®¡ç®—å»¶è¿Ÿæ—¶é—´ï¼Œrtt ç›¸å…³ï¼›</li>\n<li><strong>timestamp_difference_microseconds</strong>ï¼šå½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡æ”¶åˆ°çš„åŒ…ä¸­çš„ timestamp_microseconds ä¹‹å·®ï¼›</li>\n<li><strong>wnd_size</strong>ï¼šè¡¨ç¤ºå¦ä¸€ç«¯å»ºè®®çš„çª—å£å¤§å°ï¼Œç›¸å½“äº TCP ä¸­çš„æ¥æ”¶çª—å£ï¼›</li>\n<li><strong>extension</strong>ï¼šä»£è¡¨ç¬¬ä¸€ä¸ªæ‰©å±•çš„ç±»å‹ï¼Œ0 è¡¨ç¤ºæ²¡æœ‰æ‰©å±•ï¼Œ1 è¡¨ç¤º Selective ACKsï¼ˆé€‰æ‹©ç¡®è®¤æ‰©å±•ï¼‰ã€‚</li>\n<li><strong>type</strong>ï¼šæ•°æ®åŒ…çš„ç±»å‹ã€‚å¯ä»¥æœ‰ï¼š<ul>\n<li>ST_DATA  = 0ï¼šæ‰¿è½½æœ‰æ•ˆæ•°æ®çš„æ•°æ®åŒ…ï¼›</li>\n<li>ST_FIN   = 1ï¼šç»ˆæ­¢è¿æ¥ã€‚æ˜¯é€šä¿¡å•æ–¹å‘é€çš„æœ€åä¸€ä¸ªåŒ…ï¼Œç±»ä¼¼äº TCP çš„ FIN æ ‡è®°ã€‚ä½†æ˜¯å‘é€ ST_FIN çš„ä¸€æ–¹è¿˜æ˜¯ä¼šç­‰å¾…å¯èƒ½ä¸¢å¤±æˆ–è€…å¤±åºåˆ°è¾¾çš„åŒ…ï¼Œå³ä½¿æ”¶åˆ°äº†å¯¹æ–¹çš„ ST_FIN åŒ…ï¼›</li>\n<li>ST_STATE = 2ï¼šç”¨äºæŠ¥å‘ŠçŠ¶æ€ï¼Œä¼ è¾“ä¸€ä¸ªæ²¡æœ‰æ•°æ®çš„ ACKã€‚å’Œ TCP ä¸­æœªæºå¸¦æ•°æ®çš„ ACK åŒ…ä¸€æ ·ï¼Œå®ƒä¸æ¶ˆè€—åºå·ï¼›</li>\n<li>ST_RESET = 3ï¼šå¼ºåˆ¶é‡ç½®è¿æ¥ã€‚ç±»ä¼¼ TCP çš„ RST æ ‡è®°ã€‚</li>\n<li>ST_SYN   = 4ï¼šå‘èµ·è¿æ¥ã€‚ç±»ä¼¼ TCP çš„ SYN æ ‡è®°ã€‚å‘èµ·æ–¹ä¼šéšæœºä¸€ä¸ª connection_id ID ç”¨äºç»™æ¥æ”¶æ–¹åç»­çš„å›å¤ä½¿ç”¨ã€‚ç„¶åå‘èµ·æ–¹ä¹‹åçš„åŒ…ä¸­ä¼ è¾“çš„ connection_id ä¸º ID + 1ï¼›</li>\n</ul>\n</li>\n<li><strong>seq_nr</strong>ï¼šè¡¨ç¤ºè¿™ä¸ªæ•°æ®åŒ…çš„åºå·ã€‚æ³¨æ„å’Œ TCP ä¸­ä»£è¡¨å­—å·å·çš„åºå·æœ‰æ‰€ä¸åŒã€‚åˆå§‹åºå·åŒæ ·ä¹Ÿæ˜¯éšæœºç”Ÿæˆã€‚</li>\n<li><strong>ack_nr</strong>ï¼šè¡¨ç¤ºæœ€åæ”¶åˆ°çš„æ•°æ®åŒ…çš„seq_nrï¼›</li>\n</ul>\n<h2 id=\"è¿æ¥è¿‡ç¨‹\"><a href=\"#è¿æ¥è¿‡ç¨‹\" class=\"headerlink\" title=\"è¿æ¥è¿‡ç¨‹\"></a>è¿æ¥è¿‡ç¨‹</h2><p>â€ƒâ€ƒå›¾ç¤ºä¸ºä¸€æ¬¡åœ¨ qBittorrent ä¸­å¯¹ä¸€ä¸ªç§å­å¼€å§‹ BT ä¸‹è½½äºŒåç§’å·¦å³ååœæ­¢ä¸‹è½½æ—¶ï¼Œä¸å…¶ä¸­ä¸€ä¸ª peer çš„äº¤äº’è¿‡ç¨‹ã€‚<br><img src=\"wireshark.png\" alt=\"è¿æ¥è¿‡ç¨‹ï¼ˆä»¥ connection_id ä¸º 8671 å’Œ 8672 çš„è¿™ä¸€ä¸ªè¿‡ç¨‹ä¸ºä¾‹ï¼‰\"></p>\n<h2 id=\"ä¸¢åŒ…\"><a href=\"#ä¸¢åŒ…\" class=\"headerlink\" title=\"ä¸¢åŒ…\"></a>ä¸¢åŒ…</h2><p>å’Œä¸¢åŒ…å¤„ç†æœ‰ä¸€ä¸ªå’Œçª—å£ç›¸å…³çš„å˜é‡éœ€è¦å…ˆè¿›è¡Œè¯´æ˜ï¼š</p>\n<ul>\n<li><strong><em>max_window</em></strong>ï¼šå®šä¹‰äº†æœªè¢«ç¡®è®¤çš„å­—èŠ‚çš„ä¸Šé™ï¼Œç›¸å½“ä¸ TCP ä¸­çš„æ‹¥å¡çª—å£ï¼›</li>\n<li><strong><em>wnd_size</em></strong>ï¼šåŒé¦–éƒ¨ä¸­çš„ wnd_sizeï¼Œå’Œ TCP ä¸­ç›¸åŒï¼Œå®é™…çš„å‘é€çª—å£å¤§å°ä¸º <code>min(max_windows, wnd_size)</code>ï¼›</li>\n<li><strong><em>cur_window</em></strong>ï¼šè¡¨ç¤ºå½“å‰æœªè¢«ç¡®è®¤çš„å­—èŠ‚çš„æ•°é‡ï¼›</li>\n</ul>\n<p>å½“éœ€è¦å‘é€æ•°æ®åŒ…æ—¶ï¼Œä»…å½“ <code>cur_window + packet_size &lt;= min(max_windows, wnd_size)</code> æˆç«‹ï¼Œè¿™ä¸ªæ•°æ®åŒ…æ‰èƒ½è¢«å‘é€ã€‚</p>\n<ul>\n<li>å½“åºå·ä¸º <code>seq_nr - cur_window</code> çš„æ•°æ®åŒ…ï¼ˆå‘é€é˜Ÿåˆ—ä¸­å¹´é¾„æœ€å¤§çš„æœªè¢«ç¡®è®¤çš„æ•°æ®åŒ…ï¼Œä¸‹ä¸€ä¸ªç†è®ºä¸Šéœ€è¦è¢«ç¡®è®¤çš„å°±æ˜¯å®ƒï¼‰æ²¡æœ‰è¢«ç¡®è®¤ï¼Œä½†æ˜¯å·²ç»æœ‰è‡³å°‘ä¸‰ä¸ªåºå·å¤§äºå®ƒçš„æ•°æ®åŒ…é€šè¿‡ Selective ACK è¢«ç¡®è®¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®åŒ…è¢«è®¤ä¸ºæ˜¯ä¸¢å¤±äº†ã€‚</li>\n<li>å¦‚æœ <code>ack_nr + 1</code> è¿™ä¸ªåŒ…å·²ç»å‘é€äº†ï¼Œè€Œæ”¶åˆ°ä¸‰ä¸ªé‡å¤çš„ <code>ack_nr</code> çš„ ACKï¼Œé‚£ä¹ˆ <code>ack_nr + 1</code>è¿™ä¸ªåŒ…è¢«è®¤ä¸ºæ˜¯ä¸¢å¤±äº†ã€‚</li>\n</ul>\n<p>å¦‚æœæ£€æµ‹åˆ°ä¸¢åŒ…ï¼Œé‚£ä¹ˆæ‹¥å¡çª—å£ <strong>max_window</strong> å¤§å°å‡åŠã€‚</p>\n<h2 id=\"è¶…æ—¶\"><a href=\"#è¶…æ—¶\" class=\"headerlink\" title=\"è¶…æ—¶\"></a>è¶…æ—¶</h2><p>ÂµTP çš„è¶…æ—¶è®¡æ—¶å’Œ TCP ä¸­ RTO è®¡æ—¶å™¨ä¸å¤ªä¸€æ ·ï¼ŒRTO è®¡æ—¶å™¨ä¸»è¦ç”¨äºå¯¹ ACK çš„è®¡æ—¶ï¼Œä½†æ˜¯ã€€ÂµTP çš„è®¡æ—¶å™¨åˆ™æ˜¯æŒ‡æ¥æ”¶ä»»ä½•æ•°æ®åŒ…è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…æ—¶æ—¶é—´å†…æ²¡æœ‰ä»»ä½•æ•°æ®åŒ…åˆ°è¾¾åˆ™è¶…æ—¶ï¼Œå¦‚æœè¶…æ—¶ï¼Œåˆ™ <strong>packet_size</strong> å’Œ <strong>max_window</strong> å°†éƒ½ä¼šè¢«è®¾ç½®ä¸ºæœ€å°æ•°æ®åŒ…å¤§å°ï¼ˆ150 å­—èŠ‚ï¼‰ã€‚ <strong>ï¼ˆç–‘é—®ï¼Ÿï¼špacket_size çš„è°ƒæ•´ç­–ç•¥æ˜¯ä»€ä¹ˆï¼‰</strong></p>\n<h3 id=\"è¶…æ—¶æ—¶é—´çš„è®¡ç®—\"><a href=\"#è¶…æ—¶æ—¶é—´çš„è®¡ç®—\" class=\"headerlink\" title=\"è¶…æ—¶æ—¶é—´çš„è®¡ç®—\"></a>è¶…æ—¶æ—¶é—´çš„è®¡ç®—</h3><p>æ¯å½“æ”¶åˆ°ä¸€ä¸ªæ•°æ®åŒ…çš„ ACKï¼Œå°±ä¼šæ›´æ–°å¾€è¿”æ—¶é—´ï¼ˆä¸è€ƒè™‘é‡ä¼ çš„åŒ…ï¼‰ï¼Œå¾€è¿”æ—¶é—´ç”¨äºè®¡ç®—è¶…æ—¶æ—¶é—´ã€‚å…ˆè¯´æ˜ä¸‹ç›¸å…³çš„å˜é‡ï¼š</p>\n<ul>\n<li><strong><em>rtt</em></strong>ï¼šå¾€è¿”æ—¶é—´ï¼›</li>\n<li><strong><em>rtt_var</em></strong>ï¼šå¾€è¿”æ—¶é—´å·®å¼‚ï¼›</li>\n<li><strong><em>packet_rtt</em></strong>ï¼šå½“å‰æ”¶åˆ° ACK å¯¹åº”çš„åŒ…çš„å¾€è¿”æ—¶é—´ï¼Œå³å½“å‰æ—¶é—´å‡å»è¿™ä¸ªåŒ…å‘é€æ—¶çš„æ—¶é—´ï¼Œå³é¦–éƒ¨ä¸­çš„ timestamp å­—æ®µè®°å½•çš„å€¼ã€‚</li>\n<li><strong><em>timeout</em></strong>ï¼šè¶…æ—¶æ—¶é—´ï¼›</li>\n</ul>\n<p>é€šè¿‡ä»¥ä¸‹å…¬å¼æ›´æ–° rttï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">delta = rtt - packet_rtt</span><br><span class=\"line\">rtt_var += (abs(delta) - rtt_var) / 4;</span><br><span class=\"line\">rtt += (packet_rtt - rtt) / 8;</span><br></pre></td></tr></table></figure>\n\n<p>æ­£å¸¸æƒ…å†µä¸‹é€šè¿‡ rtt è®¡ç®—å¾—åˆ° timeoutï¼ˆç¬¬ä¸€æ¬¡ç”±äºæ²¡æœ‰ rttï¼Œtimeout ä½¿ç”¨åˆå§‹å€¼ 1000 msï¼Œï¼‰ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">timeout = max(rtt + rtt_var * 4, 500);</span><br></pre></td></tr></table></figure>\n\n<p>å¦‚æœé‡åˆ°è¶…æ—¶ï¼Œåˆ™ timeout ç¿»å€ã€‚</p>\n<h2 id=\"æ‹¥å¡æ§åˆ¶\"><a href=\"#æ‹¥å¡æ§åˆ¶\" class=\"headerlink\" title=\"æ‹¥å¡æ§åˆ¶\"></a>æ‹¥å¡æ§åˆ¶</h2><p>åœ¨<strong>ä¸¢åŒ…</strong>å’Œ<strong>è¶…æ—¶</strong>éƒ¨åˆ†å·²ç»æ¶‰åŠåˆ°æ‹¥å¡çª—å£çš„è°ƒæ•´äº†ã€‚ÂµTP çš„æ‹¥å¡æ§åˆ¶å¯ä»¥ç†è§£ä¸ºä¸€ç§åŸºäºå»¶è¿Ÿçš„è´Ÿåé¦ˆæ‹¥å¡æ§åˆ¶ï¼Œé€šè¿‡å»¶è¿Ÿçš„å˜åŒ–æ§åˆ¶çª—å£å¤§å°çš„å˜åŒ–ï¼Œè¾¾åˆ°æ‹¥å¡æ§åˆ¶ç›®çš„ã€‚è®¡ç®—çª—å£å¤§å°è¿‡ç¨‹ä¸­çš„ç›¸å…³å¸¸é‡å’Œå˜é‡çš„å®šä¹‰å¦‚ä¸‹ï¼š</p>\n<ul>\n<li><strong><em>CONTROL_TARGET</em></strong>ï¼šÂµTP æ‰€èƒ½æ¥æ”¶çš„ä¸Šè¡Œç¼“å†²å»¶è¿Ÿï¼Œç°åœ¨æ˜¯ 100 msï¼›</li>\n<li><strong><em>base_delay</em></strong>ï¼šä¸¤åˆ†é’Ÿå†…çš„æ”¶åˆ°çš„æ•°æ®åŒ…çš„æœ€ä½å»¶è¿Ÿï¼›</li>\n<li><strong><em>our_delay</em></strong>ï¼šå½“å‰çš„æ•°æ®åŒ…å»¶è¿Ÿï¼›</li>\n<li><strong><em>off_target</em></strong>ï¼šå®é™…å»¶è¿Ÿå’Œç›®æ ‡å»¶è¿Ÿçš„å·®è·ã€‚å³<code>CONTROL_TARGET - our_delay</code>ï¼›</li>\n<li><strong><em>outstanding_packet</em></strong>ï¼šå·²ç»è¢«å‘é€ä½†æ˜¯æœªè¢«ç¡®è®¤çš„æ•°æ®åŒ…ï¼›</li>\n</ul>\n<p>å…·ä½“è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">delay_factor = off_target / CCONTROL_TARGET;</span><br><span class=\"line\">window_factor = outstanding_packet / max_window;</span><br><span class=\"line\">scaled_gain = MAX_CWND_INCREASE_PACKETS_PER_RTT * delay_factor * window_factor;</span><br><span class=\"line\"></span><br><span class=\"line\">max_window += scaled_gain;</span><br></pre></td></tr></table></figure>\n\n<p>å½“ <code>off_target &gt; 0</code> æ—¶ï¼Œå½“å‰åŒ…çš„å»¶è¿Ÿæ—¶é—´æ¯”è®¾å®šçš„è¿˜å°ä¸€äº›ï¼Œé‚£ä¹ˆçª—å£ä¼šç¼©å°ï¼Œå‘é€é€Ÿç‡å°±ä¼šæ”¾æ…¢ï¼›åä¹‹ï¼Œçª—å£å¢åŠ ï¼Œé€Ÿç‡åŠ å¿«ã€‚</p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a href=\"#å‚è€ƒèµ„æ–™\" class=\"headerlink\" title=\"å‚è€ƒèµ„æ–™\"></a>å‚è€ƒèµ„æ–™</h2><ol>\n<li><a href=\"http://www.bittorrent.org/beps/bep_0029.html\" target=\"_blank\" rel=\"noopener\">BitTorrent Enhancement Proposal 29 - ÂµTorrent transport protocol</a></li>\n<li><a href=\"https://tools.ietf.org/html/rfc6817\" target=\"_blank\" rel=\"noopener\">RFC 6817 - Low Extra Delay Background Transport (LEDBAT)</a></li>\n<li><a href=\"http://www.calvinneo.com/2017/12/05/libutp%E6%BA%90%E7%A0%81%E7%AE%80%E6%9E%90/\" target=\"_blank\" rel=\"noopener\">Calvinâ€™s Marbles - libutpæºç ç®€æ</a></li>\n</ol>\n"}],"PostAsset":[{"_id":"source/_posts/tcp/congestion_control_example.png","slug":"congestion_control_example.png","post":"ckcraiuhi000bw80vngyhn847","modified":0,"renderable":0},{"_id":"source/_posts/tcp/sliding_window.png","slug":"sliding_window.png","post":"ckcraiuhi000bw80vngyhn847","modified":0,"renderable":0},{"_id":"source/_posts/tcp/wireshark.png","slug":"wireshark.png","post":"ckcraiuhi000bw80vngyhn847","modified":0,"renderable":0},{"_id":"source/_posts/bt-overview/bep_possible_paths.png","slug":"bep_possible_paths.png","post":"ckcraiuhc0004w80vuzvf98im","modified":0,"renderable":0},{"_id":"source/_posts/Âµtp/udp_utp_header.png","slug":"udp_utp_header.png","post":"ckcraiuhj000cw80vneqqt73n","modified":0,"renderable":0},{"_id":"source/_posts/Âµtp/wireshark.png","slug":"wireshark.png","post":"ckcraiuhj000cw80vneqqt73n","modified":0,"renderable":0},{"_id":"source/_posts/dht-kademlia/kademlia-1.png","slug":"kademlia-1.png","post":"ckcraiuhi000aw80vrjzc7up5","modified":0,"renderable":0},{"_id":"source/_posts/dht-kademlia/kademlia-2.png","slug":"kademlia-2.png","post":"ckcraiuhi000aw80vrjzc7up5","modified":0,"renderable":0},{"_id":"source/_posts/dht-kademlia/kademlia-3.png","slug":"kademlia-3.png","post":"ckcraiuhi000aw80vrjzc7up5","modified":0,"renderable":0},{"_id":"source/_posts/dht-kademlia/kademlia-4.png","slug":"kademlia-4.png","post":"ckcraiuhi000aw80vrjzc7up5","modified":0,"renderable":0},{"_id":"source/_posts/dht-kademlia/kademlia-5.png","slug":"kademlia-5.png","post":"ckcraiuhi000aw80vrjzc7up5","modified":0,"renderable":0},{"_id":"source/_posts/tcp/tcp_connection.png","slug":"tcp_connection.png","post":"ckcraiuhi000bw80vngyhn847","modified":0,"renderable":0},{"_id":"source/_posts/tcp/tcp_header.png","slug":"tcp_header.png","post":"ckcraiuhi000bw80vngyhn847","modified":0,"renderable":0},{"_id":"source/_posts/tcp/todo.mdx","slug":"todo.mdx","post":"ckcraiuhi000bw80vngyhn847","modified":0,"renderable":0}],"PostCategory":[],"PostTag":[{"post_id":"ckcraiuh60001w80vleuabny5","tag_id":"ckcraiuig000dw80vlv88pjor","_id":"ckcraiuiw000rw80v5jg13c5p"},{"post_id":"ckcraiuhb0003w80v41haxnk7","tag_id":"ckcraiuig000dw80vlv88pjor","_id":"ckcraiuix000sw80vqpelzmed"},{"post_id":"ckcraiuhc0004w80vuzvf98im","tag_id":"ckcraiuig000dw80vlv88pjor","_id":"ckcraiuix000tw80vnsi2f26w"},{"post_id":"ckcraiuhd0005w80vtrf0gwfs","tag_id":"ckcraiuig000dw80vlv88pjor","_id":"ckcraiuix000uw80vuciw403w"},{"post_id":"ckcraiuhe0006w80vx7k2g6iq","tag_id":"ckcraiuig000dw80vlv88pjor","_id":"ckcraiuix000vw80v1wbjd25x"},{"post_id":"ckcraiuhf0007w80vo0hn8sqj","tag_id":"ckcraiuig000dw80vlv88pjor","_id":"ckcraiuiy000ww80vufq23qjz"},{"post_id":"ckcraiuhf0008w80vsfyim6xk","tag_id":"ckcraiuio000kw80vtx67ptdv","_id":"ckcraiuiy000xw80vlqrcrwvm"},{"post_id":"ckcraiuhg0009w80vmsapolqb","tag_id":"ckcraiuip000lw80vyhg2kinv","_id":"ckcraiuiy000yw80vy5y16mky"},{"post_id":"ckcraiuhi000aw80vrjzc7up5","tag_id":"ckcraiuip000mw80v0gduajow","_id":"ckcraiuiy000zw80vr7joonx3"},{"post_id":"ckcraiuhi000aw80vrjzc7up5","tag_id":"ckcraiuip000nw80vnn7pfera","_id":"ckcraiuiy0010w80vmarcdk9g"},{"post_id":"ckcraiuhi000bw80vngyhn847","tag_id":"ckcraiuip000ow80vecx7pvsp","_id":"ckcraiuiy0011w80vxfttdmlq"},{"post_id":"ckcraiuhj000cw80vneqqt73n","tag_id":"ckcraiuip000ow80vecx7pvsp","_id":"ckcraiuiy0012w80vkayyhv2l"},{"post_id":"ckcraiuhj000cw80vneqqt73n","tag_id":"ckcraiuig000dw80vlv88pjor","_id":"ckcraiuiy0013w80vnv0pda82"}],"Tag":[{"name":"BT","_id":"ckcraiuig000dw80vlv88pjor"},{"name":"Essay","_id":"ckcraiuio000kw80vtx67ptdv"},{"name":"IPFS","_id":"ckcraiuip000lw80vyhg2kinv"},{"name":"Algorithm","_id":"ckcraiuip000mw80v0gduajow"},{"name":"ç¿»è¯‘","_id":"ckcraiuip000nw80vnn7pfera"},{"name":"Network","_id":"ckcraiuip000ow80vecx7pvsp"}]}}